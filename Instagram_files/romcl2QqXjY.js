;/*FB_PKG_DELIM*/

__d("ACSCipherSuiteModule",[],(function(t,n,r,o,a,i){"use strict";var e={hash:"SHA-512",name:"HMAC"},l={curveName:"RISTRETTO",macAlgorithm:e,value:1},s=new Map([[l.value,l]]);function u(e){return s.has(e)?s.get(e):null}i.VOPRF_RISTRETTO_HMACSHA512=l,i.getACSCipherSuiteByValue=u}),66);
__d("XPlatReactCrypto",["err"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(e=self.crypto)==null?void 0:e.subtle;function u(e){var t;if(typeof((t=self.crypto)==null?void 0:t.getRandomValues)!="function")throw r("err")("crypto.getRandomValues: Not implemented");return self.crypto.getRandomValues(e),e}function c(){var e;if(typeof((e=self.crypto)==null?void 0:e.randomUUID)!="function")return null;var t=self.crypto.randomUUID();return typeof t=="string"?t:null}function d(e,t,n,o,a){if(s==null)throw r("err")("crypto.subtle.importKey: Not implemented");return s.importKey(e,t,n,o,a)}function m(e,t){if(s==null)throw r("err")("crypto.subtle.exportKey: Not implemented");return s.exportKey(e,t)}function p(e,t,n){if(s==null)throw r("err")("crypto.subtle.generateKey: Not implemented");return s.generateKey(e,t,n)}function _(e,t,n){if(s==null)throw r("err")("crypto.subtle.encrypt: Not implemented");return s.encrypt(e,t,n)}function f(e,t,n){if(s==null)throw r("err")("crypto.subtle.decrypt: Not implemented");return s.decrypt(e,t,n)}function g(e,t,n){if(s==null)throw r("err")("crypto.subtle.sign: Not implemented");return s.sign(e,t,n)}function h(e,t){if(s==null)throw r("err")("crypto.subtle.digest: Not implemented");return s.digest(e,t)}function y(e,t,n){if(s==null)throw r("err")("crypto.subtle.deriveBits: Not implemented");return s.deriveBits(e,t,n)}function C(e,t,n,o,a){if(s==null)throw r("err")("crypto.subtle.deriveKey: Not implemented");return s.deriveKey(e,t,n,o,a)}l.getRandomValues=u,l.randomUUID=c,l.subtleImportKey=d,l.subtleExportKey=m,l.subtleGenerateKey=p,l.subtleEncrypt=_,l.subtleDecrypt=f,l.subtleSign=g,l.subtleDigest=h,l.subtleDeriveBits=y,l.subtleDeriveKey=C}),98);
__d("ACSTokenHmacUtil",["XPlatReactCrypto"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){return s(e,t).then(function(e){return c(e,n)})}function s(e,t){return o("XPlatReactCrypto").subtleImportKey("raw",t,e,!1,["sign"]).then(function(t){return{algo:e,key:t}})}function u(e){return typeof e.hash=="string"?e.hash:e.hash.name}function c(e,t){var n=e.algo,r=e.key,a={hash:u(n),name:"HMAC"};return o("XPlatReactCrypto").subtleSign(a,r,t).then(function(e){return new Uint8Array(e)})}l.hmac=e}),98);
__d("ArmadilloDataTraceType",["I64"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(e||(e=o("I64"))).of_string("13");l.armadilloMessageSend=s}),98);
__d("XPlatReactTextEncoder",[],(function(t,n,r,o,a,i){"use strict";var e=self.TextEncoder;i.TextEncoder=e}),66);
__d("base64Binary",["invariant"],(function(t,n,r,o,a,i,l,s){"use strict";function e(e){for(var t="",n=0;n<e.byteLength;n+=3){var r=e.subarray(n,n+3);t+=m(r)}var o=(e.byteLength+2)%3;return t.slice(0,t.length+o-2)+"==".slice(o)}function u(e){var t,n;e.length%4===0||s(0,51156);for(var r=e.length/4,o=(t=(n=e.match(/={0,2}$/))==null?void 0:n[0].length)!=null?t:0,a=new Uint8Array(r*3-o),i=0;i<r;i++){var l=p(e.slice(i*4,i*4+4));a.set(l.subarray(0,a.byteLength-i*3),i*3)}return a}var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=">___?456789:;<=___\0___\0\x07\b	\n\v\f\r______\x1B !\"#$%&'()*+,-./0123";function m(e){var t,n,r=e[0]<<16|((t=e[1])!=null?t:0)<<8|((n=e[2])!=null?n:0);return String.fromCharCode(c.charCodeAt(r>>>18),c.charCodeAt(r>>>12&63),c.charCodeAt(r>>>6&63),c.charCodeAt(r&63))}function p(e){var t=d.charCodeAt(e.charCodeAt(0)-43)<<18|d.charCodeAt(e.charCodeAt(1)-43)<<12|d.charCodeAt(e.charCodeAt(2)-43)<<6|d.charCodeAt(e.charCodeAt(3)-43);return new Uint8Array([t>>>16,t>>>8&255,t&255])}l.encode=e,l.decode=u}),98);
__d("Base64Utils",["XPlatReactTextEncoder","base64Binary"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return o("base64Binary").encode(new(o("XPlatReactTextEncoder")).TextEncoder().encode(e))}function s(e){return o("base64Binary").encode(new Uint8Array(e))}function u(e){return o("base64Binary").decode(e).buffer}l.encodeUnicode=e,l.fromArrayBuffer=s,l.toArrayBuffer=u}),98);
__d("CryptoLogger",["FBLogger"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return r("FBLogger")("labyrinth_web","crypto."+e)}function s(e,t){return t instanceof Error?e.catching(t):e}l.CryptoLogger=e,l.captureError=s}),98);
__d("LSMaxInt32",["I64"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(e||(e=o("I64"))).of_int32(2147483647);l.default=s}),98);
__d("LSResult",[],(function(t,n,r,o,a,i){"use strict";function e(e){return[e]}i.default=e}),66);
__d("RetUtil",["LSResult"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return r("LSResult")(e)}l.getNullableRetResult=e}),98);
__d("CreateDerivedKeys",["CryptoLogger","I64","LSMaxInt32","LSVec","Promise","RetUtil","XPlatReactCrypto"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t,a,i,l){var u=o("CryptoLogger").CryptoLogger("create_derived_keys");if(l.length<1||l.some(function(e){return(s||(s=o("I64"))).gt(e,r("LSMaxInt32"))}))return u.mustfix("Invalid key lengths for derive keys"),(e||(e=n("Promise"))).resolve(o("RetUtil").getNullableRetResult(void 0));var c=l.map((s||(s=o("I64"))).to_int32),d=l.map(s.to_int32).reduce(function(e,t){return e+t},0),m=function(t){for(var e=[],n=0,a=0,i=c.length;a<i;++a){var l=n+c[a];e.push(t.slice(n,l).buffer),n=l}return o("RetUtil").getNullableRetResult(r("LSVec").ofArray(e))};return o("XPlatReactCrypto").subtleImportKey("raw",i,"HKDF",!1,["deriveBits"]).then(function(e){return o("XPlatReactCrypto").subtleDeriveBits({hash:"SHA-256",info:t,name:"HKDF",salt:a!=null?a:new Uint8Array(10).buffer},e,d*8)}).then(function(e){var t=new Uint8Array(e);return m(t)}).catch(function(e){return u.catching(e).mustfix("Failed to create derived keys"),o("RetUtil").getNullableRetResult()})}l.CreateDerivedKeys=u}),98);
__d("DoubleKeyMap",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(){this.$1=new Map}var t=e.prototype;return t.set=function(t,n,r){var e=this.$1.get(t);e||this.$1.set(t,e=new Map),e.set(n,r)},t.get=function(t,n){var e;return(e=this.$1.get(t))==null?void 0:e.get(n)},t.delete=function(t,n){var e=this.$1.get(t);e&&(e.delete(n),e.size===0&&this.$1.delete(t))},t.getAll=function(t){return this.$1.get(t)},t.deleteAll=function(t){this.$1.delete(t)},e})();i.DoubleKeyMap=e}),66);
__d("EBBase64Encode",["Base64Utils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return o("Base64Utils").fromArrayBuffer(e)}l.default=e}),98);
__d("EBMarkerIdToQPLEvent",["I64","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n=(e||(e=o("I64"))).to_int32(t);switch(n){case 1021646192:return r("qpl")._(1021646192,"3099");case 1021656232:return r("qpl")._(1021656232,"3100");case 1021647318:return r("qpl")._(1021647318,"3101");case 1021651622:return r("qpl")._(1021651622,"3102");case 1021655799:return r("qpl")._(1021655799,"3103");case 1021648929:return r("qpl")._(1021648929,"3104");case 1021647593:return r("qpl")._(1021647593,"3105");case 1021653744:return r("qpl")._(1021653744,"3106");case 1021655355:return r("qpl")._(1021655355,"3107");case 1021648240:return r("qpl")._(1021648240,"3108");case 1021651939:return r("qpl")._(1021651939,"3109");case 1021656851:return r("qpl")._(1021656851,"3110");case 1021652813:return r("qpl")._(1021652813,"3111");case 1021653501:return r("qpl")._(1021653501,"3112");case 1021655710:return r("qpl")._(1021655710,"3114");case 1021655643:return r("qpl")._(1021655643,"3115");case 1021646076:return r("qpl")._(1021646076,"3116");case 1021642512:return r("qpl")._(1021642512,"3117");case 1021654781:return r("qpl")._(1021654781,"3118");case 1021649468:return r("qpl")._(1021649468,"3120");case 1021652080:return r("qpl")._(1021652080,"3121");case 1021652512:return r("qpl")._(1021652512,"3122");case 1021655828:return r("qpl")._(1021655828,"3124");case 1021642298:return r("qpl")._(1021642298,"3126");case 1021652377:return r("qpl")._(1021652377,"3127");case 521471316:return r("qpl")._(521471316,"2831");case 521478596:return r("qpl")._(521478596,"1329");case 521479468:return r("qpl")._(521479468,"3128");case 521473151:return r("qpl")._(521473151,"2593");case 521482563:return r("qpl")._(521482563,"3129");case 521482912:return r("qpl")._(521482912,"3131");case 521481876:return r("qpl")._(521481876,"1407");case 521471732:return r("qpl")._(521471732,"1454");case 521477507:return r("qpl")._(521477507,"1406");case 521478817:return r("qpl")._(521478817,"2806");case 521476801:return r("qpl")._(521476801,"3132");case 521484724:return r("qpl")._(521484724,"141");case 521473756:return r("qpl")._(521473756,"2768");case 521477113:return r("qpl")._(521477113,"2698");case 521478750:return r("qpl")._(521478750,"2850");case 521479165:return r("qpl")._(521479165,"3055");case 521484370:return r("qpl")._(521484370,"2995");case 521473213:return r("qpl")._(521473213,"27");case 521482281:return r("qpl")._(521482281,"2703");case 521476771:return r("qpl")._(521476771,"2454");case 521474469:return r("qpl")._(521474469,"2612");case 521471755:return r("qpl")._(521471755,"2586");case 521476367:return r("qpl")._(521476367,"2704");case 521473850:return r("qpl")._(521473850,"2910");case 521482558:return r("qpl")._(521482558,"2558");case 521482880:return r("qpl")._(521482880,"16");case 521473150:return r("qpl")._(521473150,"2143");case 521473369:return r("qpl")._(521473369,"2834");case 521485893:return r("qpl")._(521485893,"2835");case 521473922:return r("qpl")._(521473922,"2832");case 521479146:return r("qpl")._(521479146,"3133");case 521471468:return r("qpl")._(521471468,"2968");case 521480391:return r("qpl")._(521480391,"1167");case 521480745:return r("qpl")._(521480745,"3134");case 521481602:return r("qpl")._(521481602,"829");case 521475102:return r("qpl")._(521475102,"3135");case 521484676:return r("qpl")._(521484676,"2684");case 521485625:return r("qpl")._(521485625,"1876");case 521482085:return r("qpl")._(521482085,"409");case 521471024:return r("qpl")._(521471024,"2275");case 521474385:return r("qpl")._(521474385,"263");case 521479842:return r("qpl")._(521479842,"2163");case 521485383:return r("qpl")._(521485383,"2200");case 521478580:return r("qpl")._(521478580,"3136");case 521485815:return r("qpl")._(521485815,"3137");case 521482969:return r("qpl")._(521482969,"1519");case 521485406:return r("qpl")._(521485406,"272");case 521479972:return r("qpl")._(521479972,"3138");case 521484777:return r("qpl")._(521484777,"2715");case 521483076:return r("qpl")._(521483076,"3140");case 521482858:return r("qpl")._(521482858,"1290");case 521472542:return r("qpl")._(521472542,"295");case 521472456:return r("qpl")._(521472456,"1646");case 521476140:return r("qpl")._(521476140,"378");case 521473194:return r("qpl")._(521473194,"1331");case 521482763:return r("qpl")._(521482763,"296");case 521484295:return r("qpl")._(521484295,"1460");case 521476165:return r("qpl")._(521476165,"2432");case 521477947:return r("qpl")._(521477947,"2395");case 521486220:return r("qpl")._(521486220,"827");case 521482576:return r("qpl")._(521482576,"1069");case 521479124:return r("qpl")._(521479124,"1939");case 521476098:return r("qpl")._(521476098,"504");case 521472095:return r("qpl")._(521472095,"2859")}return null}l.markerIdToQPLEvent=s}),98);
__d("EncryptedBackupsSymmetricEncryptionUtils",[],(function(t,n,r,o,a,i){"use strict";var e=16,l=28,s=16,u=128;i.hChaCha20SubKeyNonceLengthInBytes=e,i.totalNonceLengthInBytes=l,i.aesGcmTagLengthInBytes=s,i.aesGcmTagLength=u}),66);
__d("ErrorBrowserConsole",["fb-error"],(function(t,n,r,o,a,i,l){"use strict";l.default=r("fb-error").ErrorBrowserConsole}),98);
__d("GetBlobFromInt64BE",["I64","LSResult","Promise"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t){var a=new Uint8Array(8);return a.reduceRight(function(e,t,n){var r=(s||(s=o("I64"))).to_int32(s.mod_(e,s.of_string("256")));return a[n]=r,s.div(e,s.of_string("256"))},t),(e||(e=n("Promise"))).resolve(r("LSResult")(a.buffer))}l.GetBlobFromInt64BE=u}),98);
__d("HChaCha20",["err"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(){}e.fromHexString=function(t){var e=t.match(/[A-Fa-f0-9]{1,2}/g);if(t.length===0||t.length%2!==0||e==null)throw r("err")('The string "'+t+'" is not valid hex.');return new Uint8Array(e.map(function(e){return parseInt(e,16)}))},e.bufferToUint32Array=function(t){for(var e=new DataView(t),n=[],r=t.byteLength/4,o=0;o<r;o++)n.push(new DataView(e.buffer.slice(o*4,o*4+4)).getInt32(0));return Uint32Array.from(n)},e.rotate=function(t,n){var e=t&4294967295,r=n&31;return(e<<r|e>>>32-r)>>>0},e.quarterRound=function(n,r,o,a){var t=n,i=r,l=o,s=a;return t=t+i&4294967295,s=e.rotate(s^t,16),l=l+s&4294967295,i=e.rotate(i^l,12),t=t+i&4294967295,s=e.rotate(s^t,8),l=l+s&4294967295,i=e.rotate(i^l,7),[t>>>0,i>>>0,l>>>0,s>>>0]};var t=e.prototype;return t.createHCtx=function(n,o){var t=new Uint32Array(16),a=e.fromHexString("657870616e642033322d62797465206b");if(a.byteLength!==16)throw r("err")("Could not create context. Invalid constant buffer length of "+a.byteLength+". Expected a length of 16");if(n.byteLength!==32)throw r("err")("Could not create context. Invalid key buffer length of "+n.byteLength+". Expected a length of 32");if(o.byteLength!==16)throw r("err")("Could not create context. Invalid nonce buffer length of "+o.byteLength+". Expected a length of 16");var i=e.bufferToUint32Array(a.buffer),l=e.bufferToUint32Array(n),s=e.bufferToUint32Array(o);return t.set(i),t.set(l,i.length),t.set(s,i.length+l.length),t.buffer},t.hChaCha20Bytes=function(n,r){for(var t=new DataView(this.createHCtx(r,n)),o=t.getInt32(0),a=t.getInt32(4),i=t.getInt32(8),l=t.getInt32(12),s=t.getInt32(16),u=t.getInt32(20),c=t.getInt32(24),d=t.getInt32(28),m=t.getInt32(32),p=t.getInt32(36),_=t.getInt32(40),f=t.getInt32(44),g=t.getInt32(48),h=t.getInt32(52),y=t.getInt32(56),C=t.getInt32(60),b=0;b<10;b++){var v=e.quarterRound(o,s,m,g);o=v[0],s=v[1],m=v[2],g=v[3];var S=e.quarterRound(a,u,p,h);a=S[0],u=S[1],p=S[2],h=S[3];var R=e.quarterRound(i,c,_,y);i=R[0],c=R[1],_=R[2],y=R[3];var L=e.quarterRound(l,d,f,C);l=L[0],d=L[1],f=L[2],C=L[3];var E=e.quarterRound(o,u,_,C);o=E[0],u=E[1],_=E[2],C=E[3];var k=e.quarterRound(a,c,f,g);a=k[0],c=k[1],f=k[2],g=k[3];var I=e.quarterRound(i,d,m,h);i=I[0],d=I[1],m=I[2],h=I[3];var T=e.quarterRound(l,s,p,y);l=T[0],s=T[1],p=T[2],y=T[3]}return Uint32Array.from([o,a,i,l,g,h,y,C]).buffer},e})();l.HChaCha20=e}),98);
__d("PakeCpaceUtils",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e.buffer.slice(e.byteOffset,e.byteLength+e.byteOffset)}function l(e,t){var n=new e.VectorInt;return t.forEach(function(e){n.push_back(e)}),n}i.typedArrayToBuffer=e,i.uint8ArrayToVectorInt=l}),66);
__d("Hmac_v2",["CryptoLogger","LSResult","PakeCpaceUtils","Promise","WACryptoSha256HmacBuilder"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(a,i){try{var t=new(o("WACryptoSha256HmacBuilder")).Sha256HMacBuilder(new Uint8Array(a)).update(new Uint8Array(i)).finish();return(e||(e=n("Promise"))).resolve(r("LSResult")(o("PakeCpaceUtils").typedArrayToBuffer(t)))}catch(e){throw o("CryptoLogger").captureError(o("CryptoLogger").CryptoLogger("hmac_v2"),e).mustfix("Crypto signing failed: data length: %s, was_timeout: %s",i==null?void 0:i.byteLength,!1),e}};l.default=s}),98);
__d("MAWBridge",["WABridge"],(function(t,n,r,o,a,i,l){"use strict";function e(){return o("WABridge").getBridge()}l.getBridge=e}),98);
__d("IIGDAPI",["MAWBridge"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return o("MAWBridge").getBridge().sendAndReceive("backend","igdapi",{args:n,type:e})}}l.makeBridgedApi=e}),98);
__d("IGDBridgedAPI",["IIGDAPI"],(function(t,n,r,o,a,i,l){"use strict";var e,s={33:(e=o("IIGDAPI")).makeBridgedApi("33"),46:e.makeBridgedApi("46"),sendEditMessage:e.makeBridgedApi("sendEditMessage"),sendMediaMessage:e.makeBridgedApi("sendMediaMessage"),sendOrRemoveReaction:e.makeBridgedApi("sendOrRemoveReaction"),sendXmaReceiverFetch:e.makeBridgedApi("sendXmaReceiverFetch")},u=s;l.default=u}),98);
__d("IGDRouteProvider.react",["react","react-compiler-runtime","useCurrentRoute"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e,c=u.createContext,d=u.useContext;function m(e){var t,n=e==null||(t=e.params)==null?void 0:t.thread_key;return n!=null&&typeof n=="string"?n:null}var p=c();function _(e){var t=o("react-compiler-runtime").c(5),n=e.children,a=r("useCurrentRoute")(),i;t[0]!==a?(i=m(a),t[0]=a,t[1]=i):i=t[1];var l=i,u;return t[2]!==n||t[3]!==l?(u=s.jsx(p.Provider,{value:l,children:n}),t[2]=n,t[3]=l,t[4]=u):u=t[4],u}function f(){return d(p)}l.IGDRouteContextProvider=_,l.useThreadKeyFromCurrentRoute=f}),98);
__d("MAWUnsafeCoerce",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e}i.unsafeCoerce=e}),66);
__d("WAAssertUnreachable",["err"],(function(t,n,r,o,a,i,l){"use strict";function e(e){throw r("err")("Impossible value, the default statement should never be reached for value: "+e)}l.default=e}),98);
__d("WAJids",["WAAssertUnreachable","err"],(function(t,n,r,o,a,i,l){"use strict";var e=0,s="@me",u="@system",c="status@broadcast",d="0@s.whatsapp.net",m="call",p="@g.us",_=/^([1-9][0-9]{0,19}|(?!10)[1-9][0-9]{4,19}-[1-9][0-9]{9})@g.us$/,f="@call",g="@msgr",h="msgr",y="@interop",C="interop",b=/^([1-9][0-9]{0,2}-[1-9][0-9]{0,14}(:[0])?)@interop$/,v=/^([1-9][0-9]{0,2}-[1-9][0-9]{0,14}(:[0])?)@interop$/,S=/^([1-9][0-9]{0,19}(:[1-9][0-9]{0,2})?)@msgr$/,R=/^([1-9][0-9]{0,19})@msgr$/,L=/^([1-9][0-9]{0,19})(:0)?@msgr$/,E="@s.whatsapp.net",k="s.whatsapp.net",I="@s.whatsapp.net",T="s.whatsapp.net",D="lid",x="@newsletter",$=/^([1-9][0-9]{0,19})@newsletter$/,P=/^(0|((?!10)[1-9][0-9]{4,19}(\.[0-9]{1,2})?(:[0-9]{1,2})))@s.whatsapp.net$/,N=/^(0|((?!10)[1-9][0-9]{4,19})(\.[0-9]{1,2})?)@s.whatsapp.net$/,M="@lid",w="lid",A=/^([1-9][0-9]{0,14})@lid$/,F=/^([1-9][0-9]{0,14}(:[0-9]{1,2})?)@lid$/,O="@broadcast",B=/^(status|location|[1-9][0-9]{0,19})@broadcast$/,W=/^([0-9a-fA-F]{18,32})@call$/,q="@hosted",U="hosted",V=/^(((?!10)[1-9][0-9]{4,19})):99@hosted$/,H="@hosted.lid",G="hosted.lid",z=/^([1-9][0-9]{0,14}):99@hosted.lid$/,j="@bot",K=/^[1-9][0-9]{0,19}(:0)?@bot$/,Q="16505361212"+I,X=/([0-9a-zA-Z-:]+)@(g\.us|call|s\.whatsapp\.net|broadcast|msgr|lid)/g;function Y(e){return""+e+I}function J(e){return""+e+M}function Z(e){return""+e+g}function ee(e){return e.endsWith(p)?e:""+e+p}function te(e){return e.endsWith(x)?e:""+e+x}function ne(e){return e.endsWith(q)?e:""+e+q}function re(e){return e.endsWith(H)?e:""+e+H}function oe(){return p}function ae(e){if(e.endsWith(I))return e.slice(0,-I.length);if(e.endsWith(g))return e.slice(0,-g.length);if(e.endsWith(y))return e.slice(0,-y.length);if(e.endsWith(M))return e.slice(0,-M.length);if(e.endsWith(j))return e.slice(0,-j.length);throw r("err")('userIdFromJid called with non-user jid "'+e+'"')}function ie(e,t){return ae(e)+":"+t+I}function le(e,t){return ae(e)+":"+t+g}function se(e,t){return Ee(e)+":"+t+M}function ue(e,t){return ae(e)+":"+t+Ct(e)}function ce(e){return""+e+O}function de(e){return e.split("@")[0]}function me(e){return e.split("@")[0]}function pe(e){var t=e.split("@")[0],n=t.split(":"),r=n[0],o=n[1],a=parseInt(o,10);return{userId:r,deviceID:a}}function _e(e){var t=pe(e);return t.deviceID}function fe(e,t){return e===s||e===u?t:de(e)}function ge(e){return e===s||e===u?null:e}function he(e){return e===s||e===u||!e.endsWith(I)?null:e}function ye(e){if(!e.endsWith(I))throw r("err")('phoneNumberFromJid called with non-user jid "'+e+'"');return e.slice(0,-I.length)}function Ce(e){if(e.endsWith(I))return ye(e);if(e.endsWith(M))return Ee(e);throw r("err")('lidOrPhoneFromUserJid called with non phone or lid jid "'+e+'"')}function be(e){return e.endsWith(I)||e.endsWith(y)||e.endsWith(g)||e.endsWith(M)?e:null}function ve(e){return e.endsWith(I)?e:null}function Se(e){return e===c?null:e}function Re(e){return e===c?null:e}function Le(e){return e===c?c:null}function Ee(e){if(!e.endsWith(M))throw r("err")('lidFromLidUserJid called with non-LidUserJid "'+e+'"');return e.slice(0,-M.length)}function ke(e){var t=e.split("@"),n=t[0],r=t[1];return n=n.split(":")[0],n=n.split(".")[0],r===U&&(r=T),r===G&&(r=D),n+"@"+r}function Ie(e){return ke(e)}function Te(e){return ke(e)}function De(e){return e.jidType==="phoneDevice"||e.jidType==="interopDevice"||e.jidType==="lidDevice"||e.jidType==="msgrDevice"?e.deviceJid:e.jidType==="lidUser"||e.jidType==="interopUser"||e.jidType==="msgrUser"||e.jidType==="phoneUser"?e.userJid:e.jidType==="group"?e.groupJid:e.jidType==="status"?e.statusJid:e.jidType==="call"?e.callJid:e.jidType==="newsletter"?e.newsletterJid:e.jidType==="hosted"?e.hostedDeviceJid:e.jidType==="hostedLid"?e.hostedLidDeviceJid:e.jidType==="bot"?e.botJid:(e.jidType,e.broadcastJid)}function xe(t){return ae(t)+":"+e+I}function $e(t){return ae(t)+":"+e+g}function Pe(t){return se(t,e)}function Ne(t){return _e(t)===e}function Me(e){return e}function we(e){return e}function Ae(e){var t=e.split("@"),n=t[0],r=t[1],o=n.split(":"),a=o[0],i=o[1],l=a.split("."),s=l[0],u=l[1];return{user:s,device:i,agent:u,server:r}}function Fe(e){var t=Ae(e),n=t.user,r=t.agent,o=r===void 0?"0":r,a=t.device,i=a===void 0?"0":a,l=t.server;return n+"."+o+":"+i+"@"+l}function Oe(e){switch(e.jidType){case"interopUser":return e.userJid;case"lidUser":return e.userJid;case"msgrUser":return e.userJid;case"phoneUser":return e.userJid;case"group":return e.groupJid;case"status":return e.statusJid;case"interopDevice":return e.deviceJid;case"lidDevice":return e.deviceJid;case"msgrDevice":return e.deviceJid;case"phoneDevice":return e.deviceJid;case"broadcast":return e.broadcastJid;case"call":return e.callJid;case"newsletter":return e.newsletterJid;case"hosted":return e.hostedDeviceJid;case"hostedLid":return e.hostedLidDeviceJid;case"bot":return e.botJid;default:return r("WAAssertUnreachable")(e.jidType)}}function Be(e){if(e===m)return{jidType:"call",callJid:m};if(e===c)return{jidType:"status",statusJid:c};if(N.test(e))return{jidType:"phoneUser",userJid:e};if(v.test(e))return{jidType:"interopUser",userJid:e};if(R.test(e))return{jidType:"msgrUser",userJid:e};if(L.test(e)){var t=e.substr(0,e.indexOf(":"));return{jidType:"msgrUser",userJid:Z(t)}}else return P.test(e)?{jidType:"phoneDevice",deviceJid:e}:b.test(e)?{jidType:"interopDevice",deviceJid:e}:S.test(e)?{jidType:"msgrDevice",deviceJid:e}:_.test(e)?{jidType:"group",groupJid:e.endsWith(p)?e:""+e+p}:B.test(e)?{jidType:"broadcast",broadcastJid:e}:W.test(e)?{jidType:"call",callJid:e}:A.test(e)?{jidType:"lidUser",userJid:e}:F.test(e)?{jidType:"lidDevice",deviceJid:e}:$.test(e)?{jidType:"newsletter",newsletterJid:e}:V.test(e)?{jidType:"hosted",hostedDeviceJid:e}:z.test(e)?{jidType:"hostedLid",hostedLidDeviceJid:e}:K.test(e)?{jidType:"bot",botJid:e}:{jidType:"unknown"}}function We(e){return e==="status@broadcast"?e:null}function qe(e){if(N.test(e)||v.test(e)||R.test(e)||A.test(e))return e;if(L.test(e)){var t=e.substr(0,e.indexOf(":"));return Z(t)}else return null}function Ue(e){return A.test(e)?e:null}function Ve(e){return B.test(e)?e:null}function He(e){return P.test(e)||S.test(e)||b.test(e)||F.test(e)||V.test(e)||z.test(e)?e:N.test(e)?bt(e):K.test(e)?vt(e):null}function Ge(e){return b.test(e)?e:null}function ze(e){return _.test(e)?e:null}function je(e){return We(e)||ze(e)||Ve(e)?e:null}function Ke(e){return W.test(e)?e:null}function Qe(e){return e==="s.whatsapp.net"||e==="g.us"||e==="call"?e:null}function Xe(e){return qe(e)||ze(e)}function Ye(e){return $.test(e)?e:null}function Je(e){return V.test(e)?e:null}function Ze(e){return z.test(e)?e:null}function et(e){return be(e)==null?e:null}function tt(e){var t=Ae(e),n=t.user,r=t.device,o=r===void 0?"0":r,a=t.server;return n+":"+o+"@"+a}function nt(e){if(e.endsWith(p))return e.slice(0,-p.length);throw r("err")('groupId called with non-group jid "'+e+'"')}function rt(e){var t=Be(e);return t.jidType==="unknown"?e:t.jidType==="status"?t.statusJid:(t.jidType,Oe(t).replace(/^([^@]*)([^@][^@][^@][^@])@(.*)$/,"...$2@$3"))}function ot(e){return e.includes("@")?e.replace(X,rt):e}function at(e){return e.endsWith(p)?e:null}function it(e,t){if(e.endsWith(I))return t.phoneUser(e);if(e.endsWith(g))return t.msgrUser(e);if(e.endsWith(y))return t.interopUser(e);if(e.endsWith(M))return t.lidUser(e);if(at(e)!=null)return t.group(e);throw r("err")("Can not switch on chat jid "+e)}function lt(e,t){if(e.endsWith(g))return t.user(e);if(at(e)!=null)return t.group(e);throw r("err")("Can not switch on chat jid "+e)}function st(e,t){if(e.endsWith(I))return t.user(e);if(at(e)!=null)return t.group(e);throw r("err")("Can not switch on chat jid "+e)}function ut(e,t){return it(e,{lidUser:function(n){return t.user(n)},interopUser:function(n){return t.user(n)},msgrUser:function(n){return t.user(n)},phoneUser:function(n){return t.user(n)},group:function(n){return t.group(n)}})}function ct(e,t){return e===c?t.status():st(e,{user:t.user,group:t.group})}function dt(e,t){return e===c?t.status():it(e,{interopUser:t.interopUser,phoneUser:t.phoneUser,msgrUser:t.msgrUser,lidUser:t.lidUser,group:t.group})}function mt(e,t){return e===c?t.multicast(c):st(e,{user:t.user,group:t.multicast})}function pt(e){return e.endsWith(M)}function _t(e){return e==="@me"}function ft(e){return e==="@system"}function gt(){return g}function ht(){return I}function yt(){return E}function Ct(e){if(e.endsWith(I))return I;if(e.endsWith(g))return g;if(e.endsWith(M))return M;if(e.endsWith(j))return j;throw r("err")('userDomainFromJid called with non-user jid "'+e+'"')}function bt(t){return ae(t)+":"+e+Ct(t)}function vt(e){return""+ae(e)+Ct(e)}function St(e){var t=e.platform,n=t==="msgr"?g:I;function r(e){return""+e+n}function o(){return n}return{toUserJid:r,getUserDomain:o}}function Rt(e){return e}function Lt(e){return e}function Et(e){return e}function kt(e){return e}function It(e){return e}function Tt(e){return e}function Dt(e){return e}function xt(e){return e}function $t(e){return e}function Pt(e){return e}function Nt(e){return e}function Mt(e){return e}function wt(e){return e}function At(e){return e}function Ft(e){return e}function Ot(e){return e}function Bt(e){return it(e,{group:function(t){return nt(t)},lidUser:function(t){return ae(t)},interopUser:function(t){return ae(t)},phoneUser:function(t){return ae(t)},msgrUser:function(t){return ae(t)}})}function Wt(){return f}l.DEFAULT_DEVICE_ID=e,l.AUTHOR_ME=s,l.AUTHOR_SYSTEM=u,l.STATUS_JID=c,l.PSA_JID=d,l.CALL_LINK_JID=m,l.MSGR_USER_DOMAIN=g,l.MSGR_USER_JID_SUFFIX=h,l.INTEROP_DOMAIN=y,l.INTEROP_USER_JID_SUFFIX=C,l.WA_SERVER_JID_SUFFIX=k,l.WA_USER_DOMAIN=I,l.WA_USER_JID_SUFFIX=T,l.WA_LID_SUFFIX=D,l.WA_NEWSLETTER_JID_DOMAIN=x,l.LID_DOMAIN=M,l.LID_SUFFIX=w,l.HOSTED_DOMAIN=q,l.HOSTED_SUFFIX=U,l.HOSTED_LID_DOMAIN=H,l.HOSTED_LID_SUFFIX=G,l.BOT_DOMAIN=j,l.SURVEY_USER_JID=Q,l.toPhoneUserJid=Y,l.toLidUserJid=J,l.toMsgrUserJid=Z,l.toGroupJid=ee,l.toNewsletterJid=te,l.toHostedDeviceJid=ne,l.toHostedLidDeviceJid=re,l.getGroupDomain=oe,l.userIdFromJid=ae,l.toPhoneDeviceJid=ie,l.toMsgrDeviceJid=le,l.toLidDeviceJid=se,l.toDeviceJid=ue,l.toBroadcastJid=ce,l.extractUserId=de,l.extractChatId__DANGEROUS=me,l.extractDeviceIDParts=pe,l.extractDeviceId=_e,l.authorToUserId=fe,l.authorAsUserJid=ge,l.authorAsPhoneUserJid=he,l.phoneNumberFromJid=ye,l.lidOrPhoneFromUserJid=Ce,l.interpretAsUserJid=be,l.interpretAsPhoneUserJid=ve,l.asChatJid=Se,l.asPhoneChatJid=Re,l.asStatusJid=Le,l.lidFromLidUserJid=Ee,l.extractUserJid=ke,l.extractPhoneUserJid=Ie,l.extractLidUserJid=Te,l.extractJidFromJidWithType=De,l.defaultPhoneDeviceJidForUser=xe,l.defaultMsgrDeviceJidForUser=$e,l.defaultLidDeviceJidForLidUserJid=Pe,l.isPrimaryDevice=Ne,l.interpretAsDeviceId=Me,l.interpretAsNumber=we,l.parseJidParts=Ae,l.fullFormDeviceJidString=Fe,l.extractFromJid=Oe,l.interpretAndValidateJid=Be,l.validateStatusJid=We,l.validateUserJid=qe,l.validateLidUserJid=Ue,l.validateBroadcastJid=Ve,l.validateDeviceJid=He,l.validateInteropDeviceJid=Ge,l.validateGroupJid=ze,l.validateMulticastJid=je,l.validateCallJid=Ke,l.validateDomainJid=Qe,l.validateChatJid=Xe,l.validateNewsletterJid=Ye,l.validateHostedDeviceJid=Je,l.validateHostedLidDeviceJid=Ze,l.asMulticastJid=et,l.stripAgentIdFromPhoneDeviceJid=tt,l.groupIdFromJid=nt,l.sanitizeJidForLogging=rt,l.maybeSanitizeLogLineText=ot,l.interpretAsGroupJid=at,l.switchOnChatJidType=it,l.switchOnMsgrChatJidType=lt,l.switchOnPhoneChatJidType=st,l.switchOnUserChatJidType=ut,l.switchOnPhoneJidType=ct,l.switchOnJidType=dt,l.switchOnMulticastJidType=mt,l.isLidUser=pt,l.isAuthorMe=_t,l.isAuthorSystem=ft,l.getMsgrUserDomain=gt,l.getWhatsappUserDomain=ht,l.getServerDomain=yt,l.defaultDeviceJidForUser=bt,l.defaultDeviceJidForBot=vt,l.createJidUtils=St,l.unsafeCoerceToChatJid=Rt,l.unsafeCoerceToDeviceJid=Lt,l.unsafeCoerceToPhoneDeviceJid=Et,l.unsafeCoerceToMsgrDeviceJid=kt,l.unsafeCoerceToInteropDeviceJid=It,l.unsafeCoerceToLidDeviceJid=Tt,l.unsafeCoerceToUserJid=Dt,l.unsafeCoerceToLidUserJid=xt,l.unsafeCoerceToPhoneUserJid=$t,l.unsafeCoerceToInteropUserJid=Pt,l.unsafeCoerceToMsgrUserJid=Nt,l.unsafeCoerceToGroupJid=Mt,l.unsafeCoerceToDeviceId=wt,l.unsafeCoerceToNewsletterJid=At,l.unsafeCoerceToHostedDeviceJid=Ft,l.unsafeCoerceToHostedLidDeviceJid=Ot,l.threadIdForChatJid=Bt,l.getGroupCallDomain=Wt}),98);
__d("InstamadilloMessageIdUtils",["FBLogger","I64","MAWUnsafeCoerce","WAJids"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,n){var r;return(e||(e=o("I64"))).isI64(t)?r=(e||(e=o("I64"))).to_string(t):r=t,r+":"+n}function u(e){var t=e.split(":");if(t.length!==2)throw r("FBLogger")("igd_web").mustfixThrow("Invalid instamadillo message id format. Format is <threadKey>:<stanzaId>.");return{stanzaId:t[1],threadKey:t[0]}}function c(e){var t=e.split(":");return t.length!==2?(r("FBLogger")("igd_web").warn("Invalid instamadillo message id format. Format is <threadKey>:<stanzaId>."),null):{stanzaId:t[1],threadKey:t[0]}}function d(e){var t=e.message.decrypted.id;return m(t)}function m(e){var t=e.externalId,n=o("WAJids").threadIdForChatJid(e.chat);return s(n,t)}function p(t,n,r){return{author:o("WAJids").toMsgrUserJid(r),chat:o("WAJids").toMsgrUserJid((e||(e=o("I64"))).to_string(t)),externalId:o("MAWUnsafeCoerce").unsafeCoerce(n)}}l.toInstamadilloMessageId=s,l.fromInstamadilloMessageId=u,l.maybeFromInstamadilloMessageId=c,l.getInstamadilloMessageIdFromStanza=d,l.getInstamadilloMessageIdFromProtocolMsgId=m,l.toProtocolMsgId=p}),98);
__d("LSClientDependencies",[],(function(t,n,r,o,a,i){}),null);
__d("LSDynamicDependencies",["Bootloader","LSDynamicDependenciesEventEmitter","ODS","Promise","SiteData","asyncToGeneratorRuntime","clearTimeout","cr:19620","err","justknobx","nullthrows","setTimeout"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=babelHelpers.extends({},n("cr:19620"));function c(e){Object.assign(u,e)}var d={_tombstone:!0};function m(t){var a=new Map;for(var i of t){var l=i.name;l!=null&&!f(l)&&a.set(l,r("nullthrows")(i.value))}if(a.size===0)return(s||(s=n("Promise"))).resolve();var c=new(s||(s=n("Promise")))(function(t){var i={},l=[],s=function(){var t=d[0],r=d[1],a=r==null?void 0:r.__dr;i[a]={be:1,r:[]},l.push(a),(e||(e=o("ODS"))).bumpEntityKey(3185,"ls_download_dependency.relay",a),u[t]={load:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){return yield c,u[t]});function r(){return e.apply(this,arguments)}return r})()}};for(var d of a)s();r("Bootloader").handlePayload({compMap:i,consistency:{rev:r("SiteData").client_revision}}),p(r("Bootloader"),l,function(e){Array.from(a.entries()).forEach(function(t,n){var r=t[0],o=t[1];u[r]=e[n]}),t()})});return c}function p(e,t,n){return e.loadModules.call(e,t,function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return n(t)})}function _(e){return e.charAt(0).toUpperCase()+e.slice(1)}function f(e){return e in u&&u[e]!==d}var g=r("justknobx")._("2800");function h(t,a,i){var l=new Map;for(var c of t!=null?t:[])f(c)||l.set(c,"LS"+_(c));for(var m of a!=null?a:[])f(m+".bs")?m+".nop"in u||l.set(m+".nop","LS"+_(m)+".nop"):l.set(m+".bs","LS"+_(m)+".nop");for(var h of i!=null?i:[])h in u||l.set(h,"LS"+_(h));if(l.size===0)return(s||(s=n("Promise"))).resolve();var y=new(s||(s=n("Promise")))(function(t,a){var i={},s=[],c=function(){var t=m[0],r=m[1];(e||(e=o("ODS"))).bumpEntityKey(3185,"ls_download_dependency.bootloader",r),o("LSDynamicDependenciesEventEmitter").emitLoadModuleEvent(r),i[r]={be:1,r:[]},s.push(r),u[t]={load:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{yield y}catch(e){throw u[t]=d,e}return u[t]});function r(){return e.apply(this,arguments)}return r})()}};for(var m of l)c();r("Bootloader").handlePayload({compMap:i,consistency:{rev:r("SiteData").client_revision}});var _=p(r("Bootloader"),s,function(e){r("clearTimeout")(f),Array.from(l.entries()).forEach(function(t,n){var r=t[0],o=t[1];u[r]=e[n]}),t()}),f=r("setTimeout")(function(){_.remove();var e=r("err")("Dynamic sproc loading timeout (%s ms); was loading: %s",g,Array.from(l.keys()));e.name="dynamic_sproc_loading_timeout",a(e)},g)});return y}l.cachedModules=u,l.addToCachedModules=c,l.TOMBSTONE=d,l.downloadRelayDependencies=m,l.downloadBootloaderDependencies=h}),98);
__d("LSInt64Lite",["FBLogger","I64","XPlatReactCrypto"],(function(t,n,r,o,a,i,l){"use strict";var e,s={add:(e||(e=o("I64"))).add,and_:e.and_,asr_:e.asr_,cast:function(n){return(e||(e=o("I64"))).mk(n[1],n[0])},div:e.div,eq:function(n,r){return n==null&&r==null||n!=null&&r!=null&&(e||(e=o("I64"))).equal(n,r)},from_string:function(n){try{return(e||(e=o("I64"))).of_string(n)}catch(e){throw r("FBLogger")("messenger_web").mustfixThrow('Unable to cast "%s" to int64',n)}},ge:e.ge,gt:e.gt,le:e.le,lsl_:e.lsl_,lsr_:e.lsr_,lt:e.lt,max:e.max,min:e.min,mod_:e.mod_,mul:e.mul,neq:function(n,r){return n==null&&r!=null||n!=null&&r==null||n!=null&&r!=null&&!(e||(e=o("I64"))).equal(n,r)},of_float:e.of_float,of_int32:e.of_int32,or_:e.or_,random:function(){var t=Array.from(o("XPlatReactCrypto").getRandomValues(new Uint32Array(2)));return t[0]>>>=1,(e||(e=o("I64"))).add(e.lsl_(e.of_float(t[0]),32),e.of_float(t[1]))},sub:e.sub,to_float:e.to_float,to_int32:e.to_int32,to_string:function(n){return n==null?n:(e||(e=o("I64"))).to_string(n)},xor:e.xor};l.default=s}),98);
__d("LSMaybeSyncIteration",["LSSynchronousPromise","isPromise"],(function(t,n,r,o,a,i,l){"use strict";var e,s={__val__:"__stop_iteration__"};function u(e){return{__val__:"__next_value__",next:e}}function c(e){return e!=null&&typeof e=="object"&&e.__val__==="__next_value__"}function d(t,n,a){for(var i=m(t,a);!(e||(e=r("isPromise")))(i);){if(i.done)return o("LSSynchronousPromise").makeSynchronousPromise(i);var l=o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(n(i));if((e||(e=r("isPromise")))(l))return l.then(function(e){if(e===s)return i;var r=c(e)?e.next:void 0;return d(t,n,r)});if(l===s)return o("LSSynchronousPromise").makeSynchronousPromise(i);var u=c(l)?l.next:void 0;i=m(t,u)}var _=p(n);return i.then(function(e){return e.done?e:_(e).then(function(r){if(r===s)return e;var o=c(r)?r.next:void 0;return d(t,n,o)})})}function m(t,n){var a=t.next(n);return(e||(e=r("isPromise")))(a)?o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a):a}function p(e){return function(t){var n=e(t);return o("LSSynchronousPromise").wrapInSyncPromiseIfNotPromise(n)}}l.STOP_ITERATION=s,l.wrapNextValue=u,l.iteratorLoop=d}),98);
__d("LSIterationOperations",["I64","LSDict","LSMaybeSyncIteration","LSSynchronousPromise","ReStoreKeyComparer"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(e,t){var n;return n={},n[typeof Symbol=="function"?Symbol.asyncIterator:"@@asyncIterator"]=function(){return u(e,t)},n.next=function(){var n={done:!0},r=function(r){return o("LSSynchronousPromise").wrapInSyncPromiseIfNotPromise(t(r.value.item)).then(function(e){if(e)return n=r,o("LSMaybeSyncIteration").STOP_ITERATION})};return o("LSMaybeSyncIteration").iteratorLoop(e,r).then(function(){return n})},n}function c(e,t,n){var r,a=0;return r={},r[typeof Symbol=="function"?Symbol.asyncIterator:"@@asyncIterator"]=function(){return c(e,t,n)},r.next=function(){if(a>=n)return o("LSSynchronousPromise").makeSynchronousPromise({done:!0});var r={done:!0},i=function(n){if(!(a++<t))return r=n,o("LSMaybeSyncIteration").STOP_ITERATION};return o("LSMaybeSyncIteration").iteratorLoop(e,i).then(function(){return r})},r}function d(e,t){return m(e).then(function(e){return e.reduce(function(e,n){return e.then(function(){return t(n)})},o("LSSynchronousPromise").makeSynchronousPromise(void 0))})}function m(e){var t=[],n=function(n){t.push(n.value)};return o("LSMaybeSyncIteration").iteratorLoop(e,n).then(function(){return t})}function p(t,n,r){var a;r===void 0&&(r=[]);var i={ASC:1,DESC:-1},l=function(r,a){for(var t=r.item,l=a.item,s=0;s<n.length;s++){var u=n[s],c=u[0],d=t[c],m=l[c],p=0;if(d==null&&m==null?p=0:d==null&&m!=null?p=-1:d!=null&&m==null?p=1:p=(e||(e=o("ReStoreKeyComparer"))).compareValue(d,m),p!==0)return p*i[n[s][1]]}return 0},s,u=[],c=[],d=function(t){for(var e=[],n=r.length-1;n>=0;n--)e.push(t[r[n]]);return e},m=function(){c=u,c.sort(l),u=[]};return a={},a[typeof Symbol=="function"?Symbol.asyncIterator:"@@asyncIterator"]=function(){return p(t,n,r)},a.next=function(){if(c.length)return o("LSSynchronousPromise").makeSynchronousPromise({done:!1,value:c.shift()});var n=function(n){var t=d(n.value.item);if(s!=null&&(e||(e=o("ReStoreKeyComparer"))).compareKey(s,t)!==0)return m(),u.push(n.value),s=t,o("LSMaybeSyncIteration").STOP_ITERATION;s=t,u.push(n.value)};return o("LSMaybeSyncIteration").iteratorLoop(t,n).then(function(){return!c.length&&u.length&&m(),c.length?{done:!1,value:c.shift()}:{done:!0}})},a}function _(e){var t=0,n=function(){t++};return o("LSMaybeSyncIteration").iteratorLoop(e,n).then(function(){return(s||(s=o("I64"))).of_int32(t)})}function f(e,t){return{forEach:function(a){return m(e).then(function(e){var n=e.reduce(function(e,n){var r=n.item[t],o=(e.get(r)||0)+1;return e.set(r,o)},new(r("LSDict"))),i=o("LSSynchronousPromise").makeSynchronousPromise(void 0),l=function(){var e=u[0],n=u[1];i=i.then(function(){var r;return a((r={},r[t]=e,r.group_count=(s||(s=o("I64"))).of_int32(n),r))})};for(var u of n.entries())l();return i})}}}l.filter=u,l.slice=c,l.forEach=d,l.toArray=m,l.sortBy=p,l.count=_,l.groupBy=f}),98);
__d("LSJson",["FBLogger","I64","LSDict","LSVec"],(function(t,n,r,o,a,i,l){"use strict";var e,s=512,u={useLSTypes:!1};function c(t,n){var a=n===void 0?u:n,i=a.useLSTypes;function l(e,t){return function(){return function(n){var r=e()(n);if(r!=null){var o=r[0],a=r[1];return[t(o),a]}}}}function s(e){return JSON.parse('"'+e+'"')}function c(e){return function(){return function(t){var n=s(e);if(t.startsWith(n))return[n,t.substr(n.length)]}}}function d(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){return function(e){var n=[],r=e;for(var o of t){var a=o()(r);if(a==null)return;r=a[1],n.push(a[0])}return[n,r]}}}function m(e){return function(){return function(t){var n=e.exec(t);return n!=null?[n,t.substr(n[0].length)]:void 0}}}function p(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){return function(e){for(var n of t){var r=n()(e);if(r!=null)return r}}}}function _(e){return function(){return function(t){var n=e()(t);return n!=null?n:[void 0,t]}}}function f(e){return function(){return function(t){for(var n=e()(t),r=[],o=t;n!=null;)o=n[1],r.push(n[0]),n=e()(o);return[r,o]}}}var g=m(/^[\n\r\s]*/),h=l(m(/^\"((?:[^\"\\]|\\.)*)\"/),function(e){var t=e[1];return s(t)}),y=l(m(/^-?\d+(?:(?:\.\d+)?[eE][-\+]?\d+|\.\d+)/),function(e){var t=e[0];return Number(t)}),C=l(m(/^-?\d+/),function(t){var n=t[0];return(e||(e=o("I64"))).of_string(n)}),b=l(c("null"),function(e){return null}),v=l(c("true"),function(e){return!0}),S=l(c("false"),function(e){return!1}),R=l(d(g,h,g,c(":"),function(){return T()}),function(e){var t=e[1],n=e[4];return[t,n]}),L=l(d(R,f(d(g,c(","),R))),function(e){var t=e[0],n=e[1];return[t].concat(n.map(function(e){var t=e[2];return t}))}),E=l(d(c("{"),_(L),g,c("}")),function(e){var t=e[1],n=t===void 0?[]:t;return i?new(r("LSDict"))(n):Object.fromEntries(n)}),k=l(d(function(){return T()},f(d(g,c(","),function(){return T()}))),function(e){var t=e[0],n=e[1];return[t].concat(n.map(function(e){var t=e[2];return t}))}),I=l(d(c("["),g,_(k),g,c("]")),function(e){var t=e[2],n=t===void 0?[]:t;return i?r("LSVec").ofArray(n):n}),T=l(d(g,p(E,h,y,C,I,b,v,S),g),function(e){var t=e[1];return t}),D=T()(t);if(D==null)throw r("FBLogger")("messenger_web").mustfixThrow("error parsing string");if(D[1]!=="")throw r("FBLogger")("messenger_web").mustfixThrow("unexpected %s",D[1]);return D[0]}function d(t,n,a){if(n===void 0&&(n=0),a===void 0&&(a=""),n>s)throw r("FBLogger")("messenger_web").mustfixThrow("recursion limit exceeded");if(typeof t=="string"||typeof t=="number")return JSON.stringify(t);if(typeof t=="boolean")return t?"1":"0";if(t==null)return"null";if(typeof t=="object"){if(Array.isArray(t))return t.tag==="ls-array"?"["+t.map(function(e,t){return d(e,n+1,a+"/"+t.toString())}).join(",")+"]":(t._tag!=="i64"&&r("FBLogger")("messenger_web").warn("LSJson payload contains untagged i64: %s",a),(e||(e=o("I64"))).to_string(t));if(t instanceof r("LSDict"))return"{"+Array.from(t.entries()).map(function(e){var t=e[0],o=e[1];if(typeof t=="string")return JSON.stringify(t)+":"+d(o,n+1,a+"/"+t);throw r("FBLogger")("messenger_web").mustfixThrow("key must be a string")}).join(",")+"}"}throw r("FBLogger")("messenger_web").mustfixThrow("type not supported: %s, path: %s",t===null?"null":typeof t,a)}l.parse=c,l.stringify=d}),98);
__d("LSPendingTasksPluginType",[],(function(t,n,r,o,a,i){var e=Object.freeze({LS_BROKER:0,PAYMENTS:1,EPHEMERAL_MESSAGING:2,CARRIER_MESSAGING:3,BUG_REPORTER:4,MESSAGE_DENORMALIZATIONS:5,SEEN_HEADS:6,MEDIA_UPLOAD:7,SECURE_THREAD_SEEN_HEADS:8,WHATSAPP_THREAD:9,SECURE_THREAD_OVER_WA_MESSAGE_SEND:10,CONTACT_PRUNING:11,MEDIA_MANAGER:12,SECURE_THREAD_OVER_WA_ENCRYPTION:13,STORY_POST:14,CO_PRESENCE_HEARTBEAT:16,SECURE_THREAD_OVER_WA_GROUP_MANAGEMENT:17,ENCRYPTED_BACKUPS:23,ANONYMOUS_REQUEST:25,MESSAGE_ACTIONS:28,MESSAGE_UNSEND_ATTACHMENT_CLEANUP:39,IGD_INSTAMADILLO:40,PENDING_MESSAGE_SEND:46});i.default=e}),66);
__d("isNativeTask",["I64","LSPendingTasksPluginType"],(function(t,n,r,o,a,i,l){"use strict";var e,s="4",u="16",c=new Set([r("LSPendingTasksPluginType").IGD_INSTAMADILLO]);function d(t){var n=c.has((e||(e=o("I64"))).to_float(t.pluginType)),r=t.context===u||t.context===s;return n||r}l.default=d}),98);
__d("LSIterationHelpers",["FBLogger","LSMaybeSyncIteration","LSSynchronousPromise","ReStoreKeyComparer","ReStoreVaulting","isNativeTask"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=new Set(["messages","attachments","reactions"]);function c(e){return u.has(e)}function d(e,t,n){return e&&t.name==="pending_tasks"&&n!=null&&r("isNativeTask")(n)}function m(e){for(var t of Object.keys(e))e[t]===void 0&&delete e[t];return e}function p(e,t,n){n===void 0&&(n="asc");var r=e.entries(new WeakMap,n);function a(){var e;return e={},e[typeof Symbol=="function"?Symbol.asyncIterator:"@@asyncIterator"]=a,e.next=function(){var e={done:!0},a=0,i="start",l=[],u=function(u){for(var r=function(){var e=a,r=t[e]||{},c=r.end,d=r.start,m=u.value[0];if(d&&i==="start"){var p=(s||(s=o("ReStoreKeyComparer"))).compareValue(m[e],d[0]),_=p*(n==="asc"?1:-1)<d[1];if(_){if(i="start_verify",l=m.slice(0,e),e===m.length-1&&p===0)return{v:void 0};var f=[].concat(l,[d[0]],d[1]&&n==="asc"||!d[1]&&n==="desc"?[(s||(s=o("ReStoreKeyComparer"))).MAX_KEY]:[]);return{v:o("LSMaybeSyncIteration").wrapNextValue(f)}}else i="check_end"}if(d&&i==="start_verify"&&!l.every(function(e,t){return(s||(s=o("ReStoreKeyComparer"))).compareValue(e,m[t])===0}))return a=0,i="start",{v:void 0};if(c&&(s||(s=o("ReStoreKeyComparer"))).compareValue(c[0],m[e])*(n==="asc"?1:-1)<c[1])return a=0,i="start",{v:o("LSMaybeSyncIteration").wrapNextValue([].concat(m.slice(0,e),n==="asc"?[(s||(s=o("ReStoreKeyComparer"))).MAX_KEY]:[]))};a++,i="start"},c;a<t.length;)if(c=r(),c)return c.v;return e=u,o("LSMaybeSyncIteration").STOP_ITERATION};return o("LSMaybeSyncIteration").iteratorLoop(r,u).then(function(){return e})},e}return a()}function _(e,t,n,o,a){return{delete:function(){return n.delete.apply(n,e)},item:t,update:function(l){var i=a&&c(o.name)?{transportKey:"FBBroker"}:{},s=babelHelpers.extends({},t,l,i);if(d(a,o,s))throw r("FBLogger")("messenger_web").mustfixThrow("cannot insert native task in dynamic mode");return n.upsert(e,m(s))}}}function f(e,t){var n;return n={},n[typeof Symbol=="function"?Symbol.asyncIterator:"@@asyncIterator"]=function(){return f(e,t)},n.next=function(){var n={done:!0},r=function(t){return n=t,o("LSMaybeSyncIteration").STOP_ITERATION};return o("LSMaybeSyncIteration").iteratorLoop(e,r).then(function(){if(n.done)return o("LSMaybeSyncIteration").iteratorLoop(t,r)}).then(function(){return n})},n}function g(e,t,n){var r,a=[{done:!0},{done:!0}],i=function(t){var e=a[t];return a[t]={done:!0},e};return r={},r[typeof Symbol=="function"?Symbol.asyncIterator:"@@asyncIterator"]=function(){return g(e,t,n)},r.next=function(){var r=function(t){return function(e){return t==="a"?a[0]=e:a[1]=e,o("LSMaybeSyncIteration").STOP_ITERATION}},l=o("LSSynchronousPromise").makeSynchronousPromise();return a[0].done&&(l=l.then(function(){return o("LSMaybeSyncIteration").iteratorLoop(e,r("a"))})),a[1].done&&(l=l.then(function(){return o("LSMaybeSyncIteration").iteratorLoop(t,r("b"))})),l.then(function(){if(a[0].done&&a[1].done)return{done:!0};if(a[0].done)return i(1);if(a[1].done)return i(0);var e=(s||(s=o("ReStoreKeyComparer"))).compareKey(a[0].value[0],a[1].value[0]);return e===0||e*(n==="asc"?1:-1)<0?i(0):i(1)})},r}var h=(e={},e[typeof Symbol=="function"?Symbol.asyncIterator:"@@asyncIterator"]=function(){return h},e.next=function(){return o("LSSynchronousPromise").makeSynchronousPromise({done:!0})},e);function y(e,t,n,a,i,l,s,u){var m=new Set,y=e.length>1,C=e.length===1&&e[0][1]==null,b=e.map(function(e){var r=e[0],s=e[1];return r.map(function(e){a.key_lookup===!0&&e.length!==0&&(s==null?"primary":"index "+s)+""+n.name+(JSON.stringify(e)||""),a.table_scan===!0&&e.length===0&&""+n.name;var r=e.map(function(e){return l(e,t)}),u=r.length===(s==null?n.primaryKeyIds:n.indexes[s]).length&&r.every(function(e){var t=e.end,n=e.start;return n&&t&&n[0]===t[0]&&n[1]===0&&t[1]===0});if(u){var c=function(){var e,t=!1;return e={},e[typeof Symbol=="function"?Symbol.asyncIterator:"@@asyncIterator"]=c,e.next=function(){var e;if(t)return o("LSSynchronousPromise").makeSynchronousPromise({done:!0});t=!0;var a=r.map(function(e){var t=e.start;return t[0]});return(e=s==null?i:i.index(s)).get.apply(e,a).then(function(e){if(!e)return{done:!0};var t=o("ReStoreVaulting").maybeUnvaultDbRow(e,n.name);return{done:!1,value:[a,t]}})},e};return c()}return p(s==null?i:i.index(s),r,t)})}).flat().reduce(function(n,r,o){var a=o===0&&n==null?h:n;return e.length>1?f(a,r):g(a,r,t)});function v(){var e;return e={},e[typeof Symbol=="function"?Symbol.asyncIterator:"@@asyncIterator"]=v,e.next=function(){var e=!0,t,a,l,p,f=function(i){e=!1;var r=i.value;if(a=r[0],l=r[1],t=C?a:n.primaryKeyIds.map(function(e){return l[e]}),d(s,n,l)){p=i,e=!0;return}if(c(n.name)&&s&&l!=null&&l.transportKey!=="FBBroker"){p=i,e=!0;return}if(y){var u=JSON.stringify(t);if(m.has(u)){e=!0;return}m.add(u)}return o("LSMaybeSyncIteration").STOP_ITERATION};return o("LSMaybeSyncIteration").iteratorLoop(b,f).then(function(){if(p!=null){var o=p.value[1].transportKey;r("FBLogger")("messenger_web").warn('Expected transportKey to equal ("FBBroker") in %s, provided transportKey: %s',u,o)}return e||t==null||l==null?{done:!0}:{done:!1,value:_(t,l,i,n,s)}})},e}return v()}l.isTranportKeyEnforcedTable=c,l.isNativePendingTaskViolation=d,l.stripUndefinedProperties=m,l.unionIterators=f,l.mergeIterators=g,l.fetch=y}),98);
__d("LSRuntimeDb",["FBLogger","LSIterationHelpers","gkx"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return e.name.match(/secure_|inbox(?!_)/i)}function s(t,n,o,a,i,l,s){return{metadata:o,table:function(d){var c=o.tableNames[o.tableIds[d]];if(n===0&&e(c))throw r("FBLogger")("messenger_web").mustfixThrow("cannot access secure table from dynamic mode");return u(t,c,a,i,l,s)},transactionId:t.__internal__transaction_id}}function u(e,t,n,a,i,l){var s=e.transactionTable(t.name,a[a.length-1]);return{add:function(n){l==null||l.logTableOperation(t.name,"add"),t.name.includes("encrypted_backups")&&(l==null||l.shouldSample()),o("LSIterationHelpers").isTranportKeyEnforcedTable(t.name)&&i&&(n.transportKey="FBBroker");var e=s.add(n);return r("gkx")("6636")?e:Promise.resolve(e)},fetch:function(){l==null||l.logTableOperation(t.name,"fetch"),t.name.includes("encrypted_backups")&&(l==null||l.shouldSample());for(var e=arguments.length,r=new Array(e),u=0;u<e;u++)r[u]=arguments[u];return o("LSIterationHelpers").fetch(r.length===0?[[[[]],void 0]]:r,"asc",t,n,s,c,i,a.join(", "))},fetchDesc:function(){l==null||l.logTableOperation(t.name,"fetchDesc"),t.name.includes("encrypted_backups")&&(l==null||l.shouldSample());for(var e=arguments.length,r=new Array(e),u=0;u<e;u++)r[u]=arguments[u];return o("LSIterationHelpers").fetch(r.length===0?[[[[]],void 0]]:r,"desc",t,n,s,c,i,a.join(", "))},peekNextAutoIncrementId:function(){return l==null||l.logTableOperation(t.name,"peekNextAutoIncrementId"),t.name.includes("encrypted_backups")&&(l==null||l.shouldSample()),s.peekNextAutoIncrementId()},put:function(n){if(l==null||l.logTableOperation(t.name,"put"),t.name.includes("encrypted_backups")&&(l==null||l.shouldSample()),o("LSIterationHelpers").isTranportKeyEnforcedTable(t.name)&&i&&(n.transportKey="FBBroker"),o("LSIterationHelpers").isNativePendingTaskViolation(i,t,n))throw r("FBLogger")("messenger_web").mustfixThrow("cannot put native task via LS transport");var e=t.primaryKeyIds.map(function(e){if(n[e]!==void 0)return n[e];throw r("FBLogger")("messenger_web").mustfixThrow("primary key must be defined on object")}),a=s.delete.apply(s,e).then(function(){return s.add(o("LSIterationHelpers").stripUndefinedProperties(babelHelpers.extends({},n)))});return r("gkx")("6636")?a:Promise.resolve(a)}}}function c(e,t){if(typeof e=="object"&&!Array.isArray(e)){var n,o;if(t==="asc"){if(Object.prototype.hasOwnProperty.call(e,"gt")&&(n=[e.gt,1]),Object.prototype.hasOwnProperty.call(e,"gte")){if(n!=null)throw r("FBLogger")("messenger_web").mustfixThrow("Cannot specify both gt and gte");n=[e.gte,0]}if(Object.prototype.hasOwnProperty.call(e,"lt")&&(o=[e.lt,1]),Object.prototype.hasOwnProperty.call(e,"lte")){if(o!=null)throw r("FBLogger")("messenger_web").mustfixThrow("Cannot specify both lt and lte");o=[e.lte,0]}}else{if(Object.prototype.hasOwnProperty.call(e,"lt")&&(n=[e.lt,1]),Object.prototype.hasOwnProperty.call(e,"lte")){if(n!=null)throw r("FBLogger")("messenger_web").mustfixThrow("Cannot specify both lt and lte");n=[e.lte,0]}if(Object.prototype.hasOwnProperty.call(e,"gt")&&(o=[e.gt,1]),Object.prototype.hasOwnProperty.call(e,"gte")){if(o!=null)throw r("FBLogger")("messenger_web").mustfixThrow("Cannot specify both gt and gte");o=[e.gte,0]}}return{end:o,start:n}}return{end:[e,0],start:[e,0]}}l.LSRuntimeDb=s,l.parseConstraint=c}),98);
__d("XPlatReactTextDecoder",[],(function(t,n,r,o,a,i){"use strict";var e=self.TextDecoder;i.TextDecoder=e}),66);
__d("LS",["ExecutionEnvironment","FBLogger","I64","LSDatascriptRuntimeTypes","LSDict","LSDynamicDependencies","LSInt64Lite","LSIterationOperations","LSJson","LSRuntimeDb","LSSynchronousPromise","LSVec","MWFBLogger","MessengerLogHistory","MetaConfig","ODS","ReStoreKeyComparer","XPlatReactTextDecoder","XPlatReactTextEncoder","base64Binary","cr:1088","cr:4790","emptyFunction","err","gkx","isPromise","justknobx","qpl","setTimeout"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h="LS_WEB",y=o("MessengerLogHistory").getInstance("ls");function C(e){return o("base64Binary").decode(e).buffer}var b={compareTo:function(t,n){for(var e=new Uint8Array(t),r=new Uint8Array(n),o=Math.min(e.length,r.length),a=0;a<o;a++){var i=e[a]-r[a];if(i!==0)return i}return e.length===r.length?0:e.length-r.length},eq:function(t,n){if(t==null&&n==null)return!0;if(t==null||n==null)return!1;var e=new Uint8Array(t),r=new Uint8Array(n);if(e.length!==r.length)return!1;for(var o=0;o<e.length;o++)if(e[o]!==r[o])return!1;return!0},ge:function(t,n){return b.compareTo(t,n)>=0},gt:function(t,n){return b.compareTo(t,n)>0},le:function(t,n){return b.compareTo(t,n)<=0},lt:function(t,n){return b.compareTo(t,n)<0},neq:function(t,n){return!b.eq(t,n)},of_string:function(t){if(t!=null){var e=new(o("XPlatReactTextEncoder")).TextEncoder;return e.encode(t).buffer}},to_string:function(t){if(t!=null){var e=new(o("XPlatReactTextDecoder")).TextDecoder;return e.decode(t)}}};function v(e){if(e.length!==1)throw r("FBLogger")("messenger_web").mustfixThrow("only literal strings supported");var t=e[0],n=parseInt(t.substr(-8),16),a=parseInt(t.substr(0,t.length-8),16);return(g||(g=o("I64"))).mk((n>>>1)+(a&1)*2147483648^-(n&1),a>>>1^-(n&1))}function S(e){var t,n;return(t=(n=e.__sproc_name__)!=null?n:e.__debugModuleSource)!=null?t:"<unknown_sproc>"}var R=(function(){var e=0;function t(t){var o=t.args,a=t.shouldLog,i=t.sprocName;if(n("cr:1088")==null||n("cr:1088").logStoredProcedureCall(i,o),!(!a||!n("cr:4790"))){var l=++e;return n("cr:4790").markerStart(r("qpl")._(25302991,"143"),l),n("cr:4790").markerAnnotate(r("qpl")._(25302991,"143"),{string:{name:i}},{instanceKey:l}),l}}function o(e,t,o){var a=e.shouldLog;!a||t==null||n("cr:4790")==null||n("cr:4790").markerEnd(r("qpl")._(25302991,"143"),o,t)}function a(e){return Math.random()*r("MetaConfig")._("10")<1}return{call:t,logSprocDone:o,shouldLogSproc:a}})(),L="Native operation timeout; transaction blocked",E=30*1e3;function k(t,n,a,i,l,g,I,T){l===void 0&&(l={}),g===void 0&&(g=void 0);var D=[],x=o("LSRuntimeDb").LSRuntimeDb(i,t,n,l,D,I,T),$=function(n,l){for(var e=arguments.length,s=new Array(e>2?e-2:0),u=2;u<e;u++)s[u-2]=arguments[u];var c;if(typeof l=="string"){if(c=a[l.toString()],c==null)throw r("FBLogger")("messenger_web").mustfixThrow("Attempted to call unimplemented native type op with type: %s and id: %s",n,l);if(c===o("LSDynamicDependencies").TOMBSTONE)throw r("err")("Concurrent native type op loading failed for: %s (retryable)",l);c.load&&(c=c.load())}else c=l;return o("LSSynchronousPromise").wrapInSyncPromiseIfNotPromise(c).then(function(e){return e.call.apply(e,[i,t].concat(s))})},P=function(n){for(var e=arguments.length,l=new Array(e>1?e-1:0),s=1;s<e;s++)l[s-1]=arguments[s];var u;if(typeof n=="string"){if(u=a[n+".bs"]||a[n+".nop"],u==null)throw r("FBLogger")("messenger_web").mustfixThrow("Attempted to call unimplemented native op with id: %s",n);if(u===o("LSDynamicDependencies").TOMBSTONE)throw r("err")("Concurrent native type op loading failed for: %s (retryable)",n);u.load&&(u=u.load())}else u=n;var c,d;return o("LSSynchronousPromise").wrapInSyncPromiseIfNotPromise(u).then(function(e){var n,a;c=(n=(a=e.__nop_name__)!=null?a:e==null?void 0:e.toString().slice(0,250))!=null?n:"<unknown nop name>",d=T==null?void 0:T.logNativeOperationStart(c);var s=o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(e.apply(void 0,[i,t].concat(l)));return(m||(m=r("isPromise")))(s)&&r("justknobx")._("3895")&&(f||(f=r("ExecutionEnvironment"))).isInBrowser?Promise.race([s,new Promise(function(e,t){return r("setTimeout")(function(){return t(r("err")(L))},E)})]):s}).then(function(e){var t;return(t=d)==null||t.end(),e},function(e){var t;(t=d)==null||t.end(),r("FBLogger")("messenger_web").catching(e).addMetadata(h,"NATIVE_OP_ID",c).mustfixThrow("Native operation %s failed: was_timeout: %s, is_in_worker: %s",c,(e==null?void 0:e.message)===L,(f||(f=r("ExecutionEnvironment"))).isInWorker)})},N=function(t){return t.slice(1).reduce(function(e,n){return typeof n!="function"?(r("FBLogger")("messenger_web").mustfix("Non-function passed (%s, type %s) in sequence (%s)",n,typeof n,JSON.stringify(t.map(function(e){return typeof e}))),e):e.then(n)},t[0]())},M=function(t,n){return t.slice(n)};return{Map:r("LSDict"),blob:C,blobs:b,constructor:{n:v},count:o("LSIterationOperations").count,createArray:function(){return r("LSVec").ofArray([])},createArrayWithElements:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r("LSVec").ofArray(t)},db:x,filter:o("LSIterationOperations").filter,forEach:o("LSIterationOperations").forEach,groupBy:o("LSIterationOperations").groupBy,i64:r("LSInt64Lite"),islc:o("LSIterationOperations").slice,like:function(t,n){var e=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/%/g,".*").replace(/_/g,".");return RegExp(e).test(t)},logger:function(t){if(g)return{debug:g,info:g,mustfix:g,warn:g};var e=o("MWFBLogger").MWLogger(),n=t.startsWith("epoch mismatch"),a=t.startsWith("cursor mismatch");if(n||a){var i=function(t){y.error(t,"error");var e=(function(){return n?"epoch_mismatch":a?"cursor_mismatch":"fixme_could_not_produce_key"})();(p||(p=o("ODS"))).bumpEntityKey(3185,"lsplatform",e)};return{debug:function(t){return y.debug(t)},info:function(t){return y.debug(t)},mustfix:i,warn:i}}else return r("gkx")("26382")||(e.info=r("emptyFunction")),e},loopAsync:function(n,a){function t(i){if(r("LSInt64Lite").lt(i,n)){for(var l=i,u=o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a(l));!(m||(m=r("isPromise")))(u);){if(l=r("LSInt64Lite").add(l,v(e||(e=babelHelpers.taggedTemplateLiteralLoose(["2"])))),!r("LSInt64Lite").lt(l,n))return o("LSSynchronousPromise").makeSynchronousPromise(void 0);u=o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a(l))}return u.then(function(){return t(r("LSInt64Lite").add(l,v(s||(s=babelHelpers.taggedTemplateLiteralLoose(["2"])))))})}return o("LSSynchronousPromise").makeSynchronousPromise(void 0)}return t(v(u||(u=babelHelpers.taggedTemplateLiteralLoose(["0"]))))},loopSync:function(t,n){for(var e=v(c||(c=babelHelpers.taggedTemplateLiteralLoose(["0"])));r("LSInt64Lite").lt(e,t);e=r("LSInt64Lite").add(e,v(d||(d=babelHelpers.taggedTemplateLiteralLoose(["2"])))))n(e)},merge:function(){function e(e,t){return(_||(_=o("ReStoreKeyComparer"))).compareValue(e,t)>0?e:t}function t(e,t){return(_||(_=o("ReStoreKeyComparer"))).compareValue([e[0],-e[1]],[t[0],-t[1]])<0?e:t}for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i=r.reduce(function(n,r){var a=o("LSRuntimeDb").parseConstraint(r,"asc");return{end:n.end&&a.end?t(a.end,n.end):a.end||n.end,start:n.start&&a.start?e(a.start,n.start):a.start||n.start}},{});return babelHelpers.extends({},i.start?i.start[1]?{gt:i.start[0]}:{gte:i.start[0]}:null,i.end?i.end[1]?{lt:i.end[0]}:{lte:i.end[0]}:null)},n:v,nativeOperation:P,nativeTypeOperation:$,notnull:function(t){if(t===null)throw r("FBLogger")("messenger_web").mustfixThrow("value should not be null");return t},print:function(t){},resolve:function(t){return o("LSSynchronousPromise").wrapInSyncPromiseIfNotPromise(t)},resolveGuaranteeAsync:function(t){var e;return((e=self.Promise)!=null?e:Promise).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(t))},rm:r("LSInt64Lite").of_int32(t),sequence:N,slice:M,sortBy:o("LSIterationOperations").sortBy,storedProcedure:function(s){for(var e=arguments.length,u=new Array(e>1?e-1:0),c=1;c<e;c++)u[c-1]=arguments[c];var d;if(typeof s=="string"){if(d=a[s],d==null)throw r("FBLogger")("messenger_web").mustfixThrow("Attempted to call unimplemented stored procedure with id: %s",s);if(d===o("LSDynamicDependencies").TOMBSTONE)throw r("err")("Concurrent sproc loading failed for: %s (retryable)",s);d.load&&(d=d.load())}else d=s;var m=this;switch(t){case 0:m=k(2,n,a,i,l,g,I);break;case 2:m=k(1,n,a,i,l,g,I);break}var p,_,f,y;return o("LSSynchronousPromise").wrapInSyncPromiseIfNotPromise(d).then(function(e){return _=S(e),f=R.shouldLogSproc(_),D.push(_),p=R.call({args:u,shouldLog:f,sprocName:_}),y=T==null?void 0:T.logSprocCallStart(_,o("LSDatascriptRuntimeTypes").TopLevelCallOrigin.UI),i.reportUsedTablesForSyncAccess(e.__tables__),e.apply(void 0,u.concat([m]))}).then(function(e){var t;return D.pop(),R.logSprocDone({args:u,shouldLog:f,sprocName:_},p,2),(t=y)==null||t.end(),e},function(e){var t;throw D.pop(),R.logSprocDone({args:u,shouldLog:f,sprocName:_},p,3),(t=y)==null||t.end(),r("FBLogger")("messenger_web").catching(e).addMetadata(h,"SPROC_STACK",D.join(`
`)).warn("Sproc %s failed",_),e})},throw:function(t){throw r("FBLogger")("messenger_web").mustfixThrow(t)},toArray:o("LSIterationOperations").toArray,toJSON:function(t){return o("LSJson").stringify(t)}}}k.n=v,l.default=k}),98);
__d("LSACSExperimentCapability",[],(function(t,n,r,o,a,i){var e=Object.freeze({RETRY_AFTER_TASK_SERIALIZATION_FAILURE_EXPONENTIAL_BACKOFF:0,BUMP_TOKEN_SYNC_TASK_AT_TASK_SERIALIZATION:1,INSERT_PENDING_TASK_PARENT_ROW_WHEN_NO_ACS_TOKENS_AT_TASK_INSERTION:2});i.default=e}),66);
__d("LSAuthorityLevel",[],(function(t,n,r,o,a,i){var e=Object.freeze({OPTIMISTIC:20,CLIENT_PARTIAL:40,SERVER_PARTIAL:60,AUTHORITATIVE_PENDING_REPLACEMENT:75,AUTHORITATIVE:80,CLIENT_AUTHORITATIVE_DELETE:100});i.default=e}),66);
__d("LSBase64Encode.nop",["EBBase64Encode","LSResult","LSSynchronousPromise"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n,a){return o("LSSynchronousPromise").makeSynchronousPromise(r("LSResult")(a?r("EBBase64Encode")(a):void 0))};e.__nop_name__="LSBase64Encode",l.default=e}),98);
__d("LSBeginHandlingFireForgetTasksForQueue",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(o){return t.sequence([function(r){return n[0]=t.createArray(),t.forEach(t.filter(t.db.table(5).fetch(),function(t){return t.queueName===e[0]}),function(e){var r=e.item;return n[3]=new t.Map,n[3].set("label",r.context),n[3].set("payload",r.taskValue),n[3].set("queue_name",r.queueName),n[3].set("task_id",r.taskId),n[3].set("failure_count",t.i64.eq(t.i64.cast([0,0]),t.i64.cast([0,0]))?void 0:t.i64.cast([0,0])),n[4]=(n[0].push(n[3]),n[0])})},function(o){return n[1]=new t.Map,n[1].set("tasks",n[0]),n[1].set("epoch_id",void 0),n[2]=new t.Map,n[2].set("queue_name",e[0]),n[2].set("next_sync_ms",void 0),n[2].set("work_item_type",t.i64.cast([0,5])),n[2].set("network_payload",n[1]),n[2].set("http_url_override",void 0),n[2].set("skip_realtime_gateway",!1),r[0]=n[2]}])},function(e){return t.resolve(r)}])}e.__sproc_name__="LSCoreBeginHandlingFireForgetTasksForQueueStoredProcedure",e.__tables__=["pending_fire_and_forget_tasks"],a.exports=e}),null);
__d("LSBeginHandlingFireForgetTasksForQueueStoredProcedure",["LSBeginHandlingFireForgetTasksForQueue","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSBeginHandlingFireForgetTasksForQueue"),a.queueName);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSFactory",["ExecutionEnvironment","LS","LSDynamicDependencies","LSMetadata","cr:8709"],(function(t,n,r,o,a,i,l){"use strict";var e,s={dynamic:!1};function u(t,a){a===void 0&&(a=s);var i=r("LS")(1,o("LSMetadata").schema,o("LSDynamicDependencies").cachedModules,t,void 0,void 0,a.dynamic,a.lsRuntimeLogger);return n("cr:8709")!=null&&(e||(e=r("ExecutionEnvironment"))).isInBrowser?n("cr:8709").wrapSprocInvocationWithProfiler(i):i}l.default=u}),98);
__d("LSForceTaskExecutionImmediately",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(r){return t.db.table(2).fetch([[[e[0]]]]).next().then(function(r,o){var a=r.done,i=r.value;return a?0:(o=i.item,n[1]=t.i64.of_float(Date.now()),t.i64.lt(n[1],o.minTimeToSyncTimestampMs)?t.forEach(t.db.table(2).fetch([[[e[0]]]]),function(e){var n=e.update,r=e.item;return n({minTimeToSyncTimestampMs:t.i64.cast([0,0]),failureCount:t.i64.add(r.failureCount,t.i64.cast([0,1]))})}):t.resolve())})},function(e){return t.resolve(r)}])}e.__sproc_name__="LSCoreForceTaskExecutionImmediatelyStoredProcedure",e.__tables__=["pending_tasks"],a.exports=e}),null);
__d("MebClientLogsFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("3226"),s=o("FalcoLoggerInternal").create("meb_client_logs",e),u=s;l.default=u}),98);
__d("LSLogMebClientEvent.nop",["I64","LSVec","MebClientLogsFalcoEvent","Promise"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=function(a,i,l,u,c,d){return r("MebClientLogsFalcoEvent").log(function(){return{calling_class:l,device_family_id:void 0,device_registration_id:void 0,log_level:(s||(s=o("I64"))).to_string(d),msg:u,trace_ids:r("LSVec").toArray(c)}}),(e||(e=n("Promise"))).resolve()};u.__nop_name__="LSLogMebClientEvent",l.default=u}),98);
__d("LSRemoveBlindedTokens",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(n){return t.forEach(t.filter(t.db.table(308).fetch(),function(t){return t.configId===e[0]}),function(e){return e.delete()})},function(e){return t.resolve(r)}])}e.__sproc_name__="LSAnonymousCredentialsRemoveBlindedTokensStoredProcedure",e.__tables__=["secure_acs_blinded_tokens"],a.exports=e}),null);
__d("LSRemoveUsedTokens",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(e){return t.forEach(t.filter(t.db.table(309).fetch(),function(e){return t.i64.le(e.redeemLimit,t.i64.cast([0,0]))}),function(e){return e.delete()})},function(e){return t.resolve(r)}])}e.__sproc_name__="LSAnonymousCredentialsRemoveUsedTokensStoredProcedure",e.__tables__=["secure_acs_tokens"],a.exports=e}),null);
__d("LSGetCurrentTokenPoolState",["LSArrayGetObjectAt","LSRemoveBlindedTokens","LSRemoveUsedTokens"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(n){return r[0]=t.i64.of_float(Date.now()),r[1]=t.createArray(),t.count(t.filter(t.db.table(307).fetch(),function(t){return t.projectName===e[0]})).then(function(e){return r[2]=e})},function(n){return t.forEach(t.filter(t.db.table(307).fetch(),function(t){return t.projectName===e[0]}),function(e){var n=e.item;return r[7]=n.configId,t.i64.gt(r[0],n.expirationTimestampMs)?t.forEach(t.db.table(307).fetch([[[r[7]]]]),function(e){return e.delete()}):t.resolve(r[8]=(r[1].push(r[7]),r[1]))})},function(e){return t.storedProcedure(n("LSRemoveUsedTokens"))},function(e){return r[3]=t.i64.cast([0,0]),r[4]=t.i64.of_int32(r[1].length),t.i64.gt(r[4],t.i64.cast([0,0]))?t.loopAsync(r[4],function(e){return r[7]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[1],r[7]).then(function(e){var t;return t=e,r[8]=t[0],r[9]=t[1],t})},function(e){return t.count(t.filter(t.db.table(309).fetch(),function(e){return e.configId===r[8]})).then(function(e){return r[10]=e})},function(e){return r[3]=t.i64.add(r[10],r[3]),t.storedProcedure(n("LSRemoveBlindedTokens"),r[8])}])}):t.resolve()},function(e){var n;return t.i64.gt(r[2],t.i64.cast([0,0]))?(r[7]=t.i64.of_int32(r[1].length),r[5]=t.i64.ge(r[7],t.i64.cast([0,1]))):r[5]=void 0,r[5]!==void 0?(r[5]?(t.i64.gt(r[3],t.i64.cast([0,0]))?r[8]=t.i64.cast([0,3]):r[8]=t.i64.cast([0,2]),r[7]=r[8]):r[7]=t.i64.cast([0,1]),r[6]=r[7]):r[6]=t.i64.cast([0,0]),n=[r[6],r[3]],o[0]=n[0],o[1]=n[1]}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSAnonymousCredentialsGetCurrentTokenPoolStateStoredProcedure",e.__tables__=["secure_acs_configurations","secure_acs_tokens"],a.exports=e}),null);
__d("LSIssueNextSync",["LSIssueNewTaskAndGetTaskID"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(n){return t.count(t.filter(t.db.table(310).fetch(),function(t){return t.projectName===e[1]})).then(function(e){return r[0]=e})},function(o){return t.i64.gt(r[0],t.i64.cast([0,0]))&&e[3]===!0?t.resolve(0):t.sequence([function(n){return t.forEach(t.filter(t.db.table(310).fetch(),function(t){return t.projectName===e[1]}),function(e){return e.delete()})},function(o){return t.i64.gt(e[2],t.i64.cast([0,0]))?(r[3]=t.i64.of_float(Date.now()),r[1]=t.i64.add(r[3],e[2])):r[1]=t.i64.cast([0,0]),t.storedProcedure(n("LSIssueNewTaskAndGetTaskID"),["acs_sync","_",e[1]].join(""),t.i64.cast([0,362]),"",void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),void 0,void 0,r[1],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[2]=t[0],t})},function(n){return t.db.table(310).add({taskId:r[2],projectName:e[1],maxClientTokenPoolSize:e[0]})}])}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSAnonymousCredentialsIssueNextSyncStoredProcedure",e.__tables__=["acs_request_context"],a.exports=e}),null);
__d("XPlatReactVoprf",["Promise","WAWasmModuleCache","asyncToGeneratorRuntime","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s=r("requireDeferred")("LSVoprfWasm").__setRef("XPlatReactVoprf");function u(){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=yield s.load(),t=e.LSVoprfWasm,n=e.locateFile,r=yield t({getWasmModule:function(){return o("WAWasmModuleCache").loadWasmModule(n())}}),a,i;try{a=r.createCurveRistretto(),i=r.createVoprfExpTwohashdh(a);var l={voprfInfo:{curvePtr:a,voprfPtr:i},voprfWasm:r};return{voprfInstance:l}}catch(e){throw a!=null&&r.freeCurve(a),i!=null&&r.freeVoprf(i),e}}),c.apply(this,arguments)}function d(){return(e||(e=n("Promise"))).resolve(u())}function m(e){var t=e.voprfInfo,n=e.voprfWasm,r=t.curvePtr,o=t.voprfPtr;n.freeCurve(r),n.freeVoprf(o)}l.loadXPlatReactVoprf=d,l.freeVoprfInstance=m}),98);
__d("LSVoprfBlind.nop",["XPlatReactVoprf","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=yield o("XPlatReactVoprf").loadXPlatReactVoprf(),a=r.voprfInstance,i=a.voprfInfo,l=a.voprfWasm;try{var s=l.blind(i,new Uint8Array(n));return[s.blindedElement.buffer,s.blindingFactor.buffer]}catch(e){throw e}finally{o("XPlatReactVoprf").freeVoprfInstance(a)}});function t(t,n,r){return e.apply(this,arguments)}return t})();e.__nop_name__="LSVoprfBlind",l.default=e}),98);
__d("LSVoprfCreateNonce.nop",["LSSynchronousPromise","XPlatReactCrypto"],(function(t,n,r,o,a,i,l){"use strict";var e=32,s=function(n,r){var t=e,a=new Uint8Array(t);return o("XPlatReactCrypto").getRandomValues(a),o("LSSynchronousPromise").makeSynchronousPromise([a.buffer])};s.__nop_name__="LSVoprfCreateNonce",l.default=s}),98);
__d("LSTaskSerializerAcsIssueNextSync",["LSBase64Encode.nop","LSGetCurrentTokenPoolState","LSIssueNextSync","LSVoprfBlind.nop","LSVoprfCreateNonce.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return t.db.table(310).fetch([[[e[0]]]]).next().then(function(e,o){var a,i=e.done,l=e.value;return i?((function(e){t.logger(e).mustfix(e)})("Request context for the passed task_id was not found"),a=[void 0,void 0,void 0],r[0]=a[0],r[1]=a[1],r[2]=a[2]):(o=l.item,t.sequence([function(e){return r[9]=o.projectName,r[10]=o.maxClientTokenPoolSize,t.storedProcedure(n("LSGetCurrentTokenPoolState"),r[9]).then(function(e){var t;return t=e,r[4]=t[0],r[5]=t[1],t})},function(e){var o;return t.i64.eq(r[4],t.i64.cast([0,0]))||t.i64.eq(r[4],t.i64.cast([0,1]))?t.resolve((r[11]=new t.Map,r[11].set("project_name",r[9]),r[12]=t.toJSON(r[11]),o=[r[12],t.i64.cast([0,351]),void 0],r[6]=o[0],r[7]=o[1],r[8]=o[2])):t.sequence([function(e){return r[11]=t.i64.of_float(Date.now()),t.islc(t.sortBy(t.filter(t.db.table(307).fetch(),function(e){return e.projectName===r[9]&&t.i64.gt(e.expirationTimestampMs,r[11])}),[["expirationTimestampMs","DESC"]]),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,o){var a,i=e.done,l=e.value;return i?((function(e){t.logger(e).mustfix(e)})("A config for the passed project name was not found"),r[16]=new t.Map,r[16].set("project_name",r[9]),r[16].set("max_client_token_pool_size",r[10]),r[17]=t.toJSON(r[16]),a=[r[17],t.i64.cast([0,362]),void 0],r[12]=a[0],r[13]=a[1],r[14]=a[2]):(o=l.item,t.sequence([function(e){return r[24]=o.configId,r[16]=o.maxEvals,r[26]=o.tokenPollFrequencyMs,r[25]=o.maxClientTokenPoolSize,r[17]=t.i64.sub(r[10],r[5]),r[23]=t.i64.lt(r[16],r[17])?r[16]:r[17],r[18]=t.createArray(),t.i64.gt(r[23],t.i64.cast([0,0]))?t.loopAsync(r[23],function(e){return r[27]=e,t.sequence([function(e){return t.nativeOperation(n("LSVoprfCreateNonce.nop")).then(function(e){var t;return t=e,r[28]=t[0],t})},function(e){return t.blobs.neq(r[28],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSVoprfBlind.nop"),r[28]).then(function(e){var t;return t=e,r[29]=t[0],r[30]=t[1],t})},function(e){return t.blobs.neq(r[29],void 0)&&t.blobs.neq(r[30],void 0)?t.sequence([function(e){return r[31]=t.i64.cast([-1,4294967295]),t.db.table(308).peekNextAutoIncrementId().then(function(e){return r[31]=e})},function(e){return t.db.table(308).add({tokenId:void 0,blindedNonce:r[29],blindingFactor:r[30],nonce:r[28],configId:r[24]})},function(e){return t.db.table(308).fetch([[[r[31]]]]).next().then(function(e,n){var o=e.done,a=e.value;return o?r[32]=t.i64.cast([-1,4294967295]):(n=a.item,r[32]=n.tokenId)})},function(e){return t.i64.eq(r[32],t.i64.cast([-1,4294967295]))?t.sequence([function(e){return t.islc(t.db.table(308).fetchDesc([[[{gt:t.i64.cast([0,0])}]]]),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,n){var o=e.done,a=e.value;return o?r[37]=t.i64.cast([-1,4294967295]):(n=a.item,r[37]=n.tokenId)})},function(e){return r[34]=r[37]}]):t.resolve(r[34]=r[32])},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[29]).then(function(e){var t;return t=e,r[35]=t[0],t})},function(e){return r[36]=new t.Map,r[36].set("id",r[34]),r[36].set("data",r[35]==null?"":r[35]),r[37]=(r[18].push(r[36]),r[18])}]):t.resolve()}]):t.resolve()}])}):t.resolve()},function(e){var o;return r[19]=t.i64.of_int32(r[18].length),t.i64.gt(r[19],t.i64.cast([0,0]))?t.resolve((r[27]=new t.Map,r[27].set("project_name",r[9]),r[27].set("config_id",r[24]),r[27].set("blinded_nonces",r[18]),r[28]=t.toJSON(r[27]),o=[r[28],t.i64.cast([0,354]),void 0],r[20]=o[0],r[21]=o[1],r[22]=o[2])):t.sequence([function(e){var o;return t.i64.neq(r[26],void 0)?t.sequence([function(e){var o;return t.i64.neq(r[25],void 0)?t.sequence([function(e){return(function(e){t.logger(e).info(e)})(["Already have the max number of tokens. Scheduling next ACS token sync locally for project: ",r[9]].join("")),t.storedProcedure(n("LSIssueNextSync"),r[25],r[9],r[26],!1)},function(e){var t;return t=[void 0,void 0,void 0],r[30]=t[0],r[31]=t[1],r[32]=t[2],t}]):t.resolve(((function(e){t.logger(e).info(e)})(["token_poll_frequency is nonnull but max_client_token_pool_size is null. Already have the max number of tokens. Scheduling the next ACS token sync for project: ",r[9]].join("")),r[33]=new t.Map,r[33].set("project_name",r[9]),r[33].set("max_client_token_pool_size",r[10]),r[34]=t.toJSON(r[33]),o=[r[34],t.i64.cast([0,362]),void 0],r[30]=o[0],r[31]=o[1],r[32]=o[2]))},function(e){var t;return t=[r[30],r[31],r[32]],r[27]=t[0],r[28]=t[1],r[29]=t[2],t}]):t.resolve(((function(e){t.logger(e).info(e)})(["Already have the max number of tokens. Scheduling the next ACS token sync for project: ",r[9]].join("")),r[30]=new t.Map,r[30].set("project_name",r[9]),r[30].set("max_client_token_pool_size",r[10]),r[31]=t.toJSON(r[30]),o=[r[31],t.i64.cast([0,362]),void 0],r[27]=o[0],r[28]=o[1],r[29]=o[2]))},function(e){var t;return t=[r[27],r[28],r[29]],r[20]=t[0],r[21]=t[1],r[22]=t[2],t}])},function(e){var t;return t=[r[20],r[21],r[22]],r[12]=t[0],r[13]=t[1],r[14]=t[2],t}]))})},function(e){var t;return t=[r[12],r[13],r[14]],r[6]=t[0],r[7]=t[1],r[8]=t[2],t}])},function(e){var t;return t=[r[6],r[7],r[8]],r[0]=t[0],r[1]=t[1],r[2]=t[2],t}]))})},function(e){var t;return t=[r[0],r[1],r[2]],o[0]=t[0],o[1]=t[1],o[2]=t[2],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSAnonymousCredentialsTaskSerializerAcsIssueNextSyncStoredProcedure",e.__tables__=["acs_request_context","secure_acs_configurations","secure_acs_blinded_tokens"],a.exports=e}),null);
__d("LSTaskSerializerDeleteChatHistory",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(o){return t.sequence([function(r){return t.db.table(32).fetch([[[e[0]]]]).next().then(function(r,o){var a,i=r.done,l=r.value;return i?(n[4]=t.createArray(),n[5]=(n[4].push("taskSerializerDeleteChatHistory: Task ID not found"),n[4]),n[6]=(n[4].push(e[0]),n[4]),n[7]=t.toJSON(n[4]),(function(e){t.logger(e).mustfix(e)})(n[7]),a=[void 0,void 0,void 0],n[0]=a[0],n[1]=a[1],n[2]=a[2]):(o=l.item,t.sequence([function(e){return n[8]=o.threadKey,t.db.table(9).fetch([[[n[8]]]]).next().then(function(e,r){var o,a=e.done,i=e.value;return a?(n[9]=t.createArray(),n[10]=(n[9].push("taskSerializerDeleteChatHistory: Thread not found"),n[9]),n[11]=(n[9].push(n[8]),n[9]),n[12]=t.toJSON(n[9]),(function(e){t.logger(e).mustfix(e)})(n[12]),o=[void 0,void 0,void 0],n[4]=o[0],n[5]=o[1],n[6]=o[2]):(r=i.item,t.sequence([function(e){return t.db.table(9).fetch([[[n[8]]]]).next().then(function(e,r){var o=e.done,a=e.value;return o?n[9]=t.i64.cast([0,1]):(r=a.item,n[14]=r.syncGroup,t.i64.neq(n[14],void 0)?n[13]=n[14]:n[13]=t.i64.cast([0,1]),n[9]=n[13])})},function(e){var r;return n[11]=new t.Map,n[11].set("thread_key",n[8]),n[11].set("sync_group",n[9]),n[12]=t.toJSON(n[11]),r=[n[12],t.i64.cast([0,903]),void 0],n[4]=r[0],n[5]=r[1],n[6]=r[2]}]))})},function(e){var t;return t=[n[4],n[5],n[6]],n[0]=t[0],n[1]=t[1],n[2]=t[2],t}]))})},function(e){var t;return t=[n[0],n[1],n[2]],r[0]=t[0],r[1]=t[1],r[2]=t[2],t}])},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxTaskSerializerDeleteChatHistoryStoredProcedure",e.__tables__=["threads_optimistic_context","threads"],a.exports=e}),null);
__d("LSTaskSerializerE2eeMessageIntegrityCheckV2",[],(function(t,n,r,o,a,i){function e(){var e,t=arguments,n=t[t.length-1],r=[],o=[];return e=[void 0,n.i64.cast([0,705]),void 0],o[0]=e[0],o[1]=e[1],o[2]=e[2],n.resolve(o)}e.__sproc_name__="LSEncryptedBackupsTaskSerializerE2eeMessageIntegrityCheckV2StoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSTaskSerializerE2eeMetadataThreadIntegrityCheck",[],(function(t,n,r,o,a,i){function e(){var e,t=arguments,n=t[t.length-1],r=[],o=[];return e=[void 0,n.i64.cast([0,700]),void 0],o[0]=e[0],o[1]=e[1],o[2]=e[2],n.resolve(o)}e.__sproc_name__="LSE2EEMessagingMetadataMailboxTaskSerializerE2eeMetadataThreadIntegrityCheckStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSTaskSerializerEncryptedBackupAction",[],(function(t,n,r,o,a,i){function e(){var e,t=arguments,n=t[t.length-1],r=[],o=[];return e=[void 0,n.i64.cast([0,319]),void 0],o[0]=e[0],o[1]=e[1],o[2]=e[2],n.resolve(o)}e.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupActionStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSTaskSerializerEncryptedBackupsLoopingUpload",["LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(e){return t.sequence([function(e){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][taskSerializerEncryptedBackupsLoopingUpload] Beginning execution."),r[1]=t.i64.of_float(Date.now()),(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsLoopingUploadStoredProcedure] LSEncryptedBackupsLoopingUploadPayloadsTable table not found"),r[3]="LSEncryptedBackupsLoopingUploadPayloadsTable table not found",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsLoopingUploadStoredProcedure] ","",r[3]].join("")),r[2]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsTaskSerializerEncryptedBackupsLoopingUploadStoredProcedure",r[3],r[2],t.i64.cast([0,3]))},function(e){return r[4]=t.i64.of_float(Date.now()),r[5]=t.i64.random(),r[7]="Finishing execution. Execution time: ",r[8]=t.i64.to_string(t.i64.sub(r[4],r[0])),r[9]=" ms",r[6]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][taskSerializerEncryptedBackupsLoopingUpload] ",r[6],r[7],r[6],r[8],r[6],r[9]].join("")),t.i64.eq(t.i64.mod_(r[5],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[10]=",",r[11]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"taskSerializerEncryptedBackupsLoopingUpload",[r[7],r[10],r[8],r[10],r[9]].join(""),r[11],t.i64.cast([0,4]))):t.resolve()},function(e){var n;return n=['{"request_id":"unknown","upload_type":"FBN","payload":{"error_code":2,"operation":"","error_message":"","__typename":"MPSUploadFailurePayload"}}',t.i64.cast([0,50043]),void 0],o[0]=n[0],o[1]=n[1],o[2]=n[2],n}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsLoopingUploadStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSDeserializeFromJsonIntoDictionaryV2.nop",["FBLogger","LSDict","LSJson","Promise"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(a,i,l){var t=o("LSJson").parse(l,{useLSTypes:!0});if(t instanceof r("LSDict"))return(e||(e=n("Promise"))).resolve([t]);throw r("FBLogger")("messenger_web").mustfixThrow("unexpected Dictionary type")};s.__nop_name__="LSDeserializeFromJsonIntoDictionary",l.default=s}),98);
__d("LSGetBlobFromString.nop",["CryptoLogger","LSResult","LSSynchronousPromise","XPlatReactTextEncoder","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n,a){var e=new(o("XPlatReactTextEncoder")).TextEncoder;try{var i=e.encode(a).buffer;return o("LSSynchronousPromise").makeSynchronousPromise(r("LSResult")(i))}catch(e){var l=r("getErrorSafe")(e),s=o("CryptoLogger").CryptoLogger("get_blob_from_string");throw s.catching(l).mustfix(l.message),l}};e.__nop_name__="LSGetBlobFromString",l.default=e}),98);
__d("LSQueryLocalPersistenceStoreForBackup.nop",["Promise","ReQL","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r,a,i){var l=yield o("ReQL").toArrayAsync(o("ReQL").fromTableDescending(t.local_message_persistence_store).filter(function(e){var t=e.offlineThreadingId,n=e.threadId;return n===a&&i===t}));if(l.length===0)return(e||(e=n("Promise"))).resolve([void 0,void 0,!1]);var s=l[0];return(e||(e=n("Promise"))).resolve([s.messagePayload,s.messageTimestampMs,!1])});function r(e,n,r,o){return t.apply(this,arguments)}return r})();s.__nop_name__="LSQueryLocalPersistenceStoreForBackup",l.default=s}),98);
__d("LSQueryLocalPersistenceStoreSupplementalForBackup.nop",["Promise","ReQL","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r,a,i,l){var s=yield o("ReQL").firstAsync(o("ReQL").fromTableDescending(t.local_message_persistence_store_supplemental).filter(function(e){var t=e.supplementalKey,n=e.threadId,r=e.toplevelOfflineThreadingId;return n===a&&r===i&&t===l}));return s==null?(e||(e=n("Promise"))).resolve([void 0,void 0]):(e||(e=n("Promise"))).resolve([s.messagePayload,s.messageTimestampMs])});function r(e,n,r,o,a){return t.apply(this,arguments)}return r})();s.__nop_name__="LSQueryLocalPersistenceStoreSupplementalForBackup",l.default=s}),98);
__d("LSQueryLocalPersistenceStoreTagsForBackup.nop",["LSVec","Promise","ReQL","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=":",u=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a,i,l){var u=yield o("ReQL").firstAsync(o("ReQL").fromTableDescending(t.local_message_persistence_store_tag_index.index("offlineThreadingId")).getKeyRange(l,i));if(u==null)return(e||(e=n("Promise"))).resolve([r("LSVec").ofArray([])]);var c=u.tag;return(e||(e=n("Promise"))).resolve([r("LSVec").ofArray(c.split(s))])});function a(e,n,r,o){return t.apply(this,arguments)}return a})();u.__nop_name__="LSQueryLocalPersistenceStoreTagsForBackup",l.default=u}),98);
__d("LSLoadUnencryptedProtobufWithInputs",["LSBase64Encode.nop","LSGetBlobFromString.nop","LSLogMebClientEvent.nop","LSQueryLocalPersistenceStoreForBackup.nop","LSQueryLocalPersistenceStoreSupplementalForBackup.nop","LSQueryLocalPersistenceStoreTagsForBackup.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][loadUnencryptedProtobufWithInputs] Beginning execution."),r[1]=t.i64.of_float(Date.now()),t.i64.eq(e[0],t.i64.cast([0,1]))?t.sequence([function(o){return t.nativeOperation(n("LSQueryLocalPersistenceStoreForBackup.nop"),e[1],e[2]).then(function(e){var t;return t=e,r[10]=t[0],r[11]=t[1],r[12]=t[2],t})},function(o){return t.nativeOperation(n("LSQueryLocalPersistenceStoreTagsForBackup.nop"),e[1],e[2]).then(function(e){var t;return t=e,r[13]=t[0],t})},function(o){var a,i,l;return t.blobs.neq(r[10],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[10]).then(function(e){var t;return t=e,r[16]=t[0],t})},function(n){var o,a,i;return r[16]!==void 0?(r[13]!==void 0?(r[21]=new t.Map,r[21].set("message_tags",r[13]),r[22]=t.toJSON(r[21]),r[19]=r[22]):r[19]=void 0,r[20]=new t.Map,r[20].set("backup_action",e[0]),r[20].set("protobuf_encrypted",r[16]),r[20].set("supplemental_data_encrypted",void 0),r[20].set("timestamp_ms",e[4]),r[20].set("message_tags",r[19]),o=[r[20],void 0],r[17]=o[0],r[18]=o[1]):((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error PROTOBUF_FORMATTING_FAILED"),r[19]=new t.Map,r[19].set("error_code",t.i64.cast([0,68])),r[19].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),r[19].set("error_message",""),a=[void 0,r[19]],r[17]=a[0],r[18]=a[1]),i=[r[17],r[18]],r[14]=i[0],r[15]=i[1]}]):t.resolve((r[12]?((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error PROTOBUF_ALREADY_DELETED"),r[18]=new t.Map,r[18].set("error_code",t.i64.cast([0,70])),r[18].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),r[18].set("error_message",""),a=[void 0,r[18]],r[16]=a[0],r[17]=a[1]):((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error PROTOBUF_NOT_FOUND_IN_TOPLEVEL_TABLE"),r[18]=new t.Map,r[18].set("error_code",t.i64.cast([0,63])),r[18].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),r[18].set("error_message",""),i=[void 0,r[18]],r[16]=i[0],r[17]=i[1]),l=[r[16],r[17]],r[14]=l[0],r[15]=l[1]))},function(e){var t;return t=[r[14],r[15]],r[2]=t[0],r[3]=t[1],t}]):t.sequence([function(o){var a,i,l;return t.i64.eq(e[0],t.i64.cast([0,2]))?t.sequence([function(o){var a;return e[3]!==void 0?t.sequence([function(o){return t.nativeOperation(n("LSQueryLocalPersistenceStoreSupplementalForBackup.nop"),e[1],e[2],e[3]).then(function(e){var t;return t=e,r[14]=t[0],r[15]=t[1],t})},function(o){return t.nativeOperation(n("LSQueryLocalPersistenceStoreTagsForBackup.nop"),e[1],e[2]).then(function(e){var t;return t=e,r[16]=t[0],t})},function(o){var a;return t.blobs.neq(r[14],void 0)?t.sequence([function(o){return t.nativeOperation(n("LSGetBlobFromString.nop"),e[3]).then(function(e){var t;return t=e,r[19]=t[0],t})},function(o){var a;return t.blobs.neq(r[19],void 0)?t.sequence([function(e){return r[22]=new t.Map,r[22].set("sk_ciphertext",r[19]),r[22].set("sk_hash",r[19]),t.nativeOperation(n("LSBase64Encode.nop"),r[14]).then(function(e){var t;return t=e,r[23]=t[0],t})},function(n){var o,a,i;return r[23]!==void 0?(r[16]!==void 0?(r[28]=new t.Map,r[28].set("message_tags",r[16]),r[29]=t.toJSON(r[28]),r[26]=r[29]):r[26]=void 0,r[27]=new t.Map,r[27].set("backup_action",e[0]),r[27].set("protobuf_encrypted",r[23]),r[27].set("supplemental_data_encrypted",r[22]),r[27].set("timestamp_ms",e[4]),r[27].set("message_tags",r[26]),o=[r[27],void 0],r[24]=o[0],r[25]=o[1]):((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error PROTOBUF_FORMATTING_FAILED"),r[26]=new t.Map,r[26].set("error_code",t.i64.cast([0,68])),r[26].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),r[26].set("error_message",""),a=[void 0,r[26]],r[24]=a[0],r[25]=a[1]),i=[r[24],r[25]],r[20]=i[0],r[21]=i[1]}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error SUPPLEMENTAL_FORMATTING_FAILED"),r[22]=new t.Map,r[22].set("error_code",t.i64.cast([0,69])),r[22].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),r[22].set("error_message",""),a=[void 0,r[22]],r[20]=a[0],r[21]=a[1]))},function(e){var t;return t=[r[20],r[21]],r[17]=t[0],r[18]=t[1],t}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error PROTOBUF_NOT_FOUND_IN_SUPPLEMENTAL_TABLE"),r[19]=new t.Map,r[19].set("error_code",t.i64.cast([0,64])),r[19].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),r[19].set("error_message",""),a=[void 0,r[19]],r[17]=a[0],r[18]=a[1]))},function(e){var t;return t=[r[17],r[18]],r[12]=t[0],r[13]=t[1],t}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error SUPPLEMENTAL_KEY_NOT_SET_IN_CONTEXT_TABLE"),r[14]=new t.Map,r[14].set("error_code",t.i64.cast([0,65])),r[14].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),r[14].set("error_message",""),a=[void 0,r[14]],r[12]=a[0],r[13]=a[1]))},function(e){var t;return t=[r[12],r[13]],r[10]=t[0],r[11]=t[1],t}]):t.resolve((t.i64.eq(e[0],t.i64.cast([0,3]))?(r[14]=new t.Map,r[14].set("backup_action",e[0]),r[14].set("protobuf_encrypted",void 0),r[14].set("supplemental_data_encrypted",void 0),r[14].set("timestamp_ms",e[4]),r[14].set("message_tags",void 0),a=[r[14],void 0],r[12]=a[0],r[13]=a[1]):((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error INVALID_BACKUP_OPERATION"),r[14]=new t.Map,r[14].set("error_code",t.i64.cast([-1,4294967289])),r[14].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),r[14].set("error_message",""),i=[void 0,r[14]],r[12]=i[0],r[13]=i[1]),l=[r[12],r[13]],r[10]=l[0],r[11]=l[1]))},function(e){var t;return t=[r[10],r[11]],r[2]=t[0],r[3]=t[1],t}])},function(e){return r[4]=t.i64.of_float(Date.now()),r[5]=t.i64.random(),r[7]="Finishing execution. Execution time: ",r[8]=t.i64.to_string(t.i64.sub(r[4],r[0])),r[9]=" ms",r[6]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][loadUnencryptedProtobufWithInputs] ",r[6],r[7],r[6],r[8],r[6],r[9]].join("")),t.i64.eq(t.i64.mod_(r[5],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[10]=",",r[11]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"loadUnencryptedProtobufWithInputs",[r[7],r[10],r[8],r[10],r[9]].join(""),r[11],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[2],r[3]],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSLoadUnencryptedProtobufBackupSerializedPayloadData",["LSLoadUnencryptedProtobufWithInputs","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(n){var o;return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][loadUnencryptedProtobufBackupSerializedPayloadData] Beginning execution."),r[1]=t.i64.of_float(Date.now()),r[18]=t.i64.mul(r[1],t.i64.cast([0,1e6])),t.sequence([function(n){return t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,o){var a,i,l=n.done,s=n.value;return l?(r[30]=t.i64.of_float(Date.now()),a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(r[30],t.i64.cast([0,1e6])),r[18]),void 0],r[22]=a[0],r[23]=a[1],r[24]=a[2],r[25]=a[3],r[26]=a[4],r[27]=a[5],r[28]=a[6]):(o=s.item,r[30]=t.i64.of_float(Date.now()),i=[e[0],o.queueName,o.enqueueTimestampMs,o.priority,o.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(r[30],t.i64.cast([0,1e6])),r[18]),void 0],r[22]=i[0],r[23]=i[1],r[24]=i[2],r[25]=i[3],r[26]=i[4],r[27]=i[5],r[28]=i[6])})},function(e){var t;return t=[r[22],r[23],r[24],r[25],r[26],r[27],r[28]],r[2]=t[0],r[3]=t[1],r[4]=t[2],r[5]=t[3],r[6]=t[4],r[7]=t[5],r[8]=t[6],t}])},function(o){return r[9]=new t.Map,r[9].set("task_id",r[2]),r[9].set("queue_name",r[3]),r[9].set("enqueue_timestamp_ms",r[4]),r[9].set("priority",r[5]),r[9].set("first_executed_timestamp_ms",r[6]),r[9].set("execution_time_ns",r[7]),r[9].set("echo_encoding_execution_time_ns",r[8]),r[10]=new t.Map,r[10].set("task_metadata",r[9]),r[10].set("action_type",void 0),r[10].set("content_type",void 0),r[10].set("identifiers",void 0),r[10].set("identifiers_v2",void 0),r[10].set("task_creation_source",void 0),r[10].set("message_payload_source",t.i64.cast([0,2])),t.filter(t.db.table(305).fetch(),function(n){return t.i64.eq(n.pendingBackupTaskId,e[0])}).next().then(function(o,a){var i,l=o.done,s=o.value;return l?(r[22]=new t.Map,r[22].set("error_code",t.i64.cast([0,5])),r[22].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufBackupSerializedPayloadDataStoredProcedure"),r[22].set("error_message",""),i=[void 0,r[22],r[10]],r[11]=i[0],r[12]=i[1],r[13]=i[2]):(a=s.item,t.sequence([function(n){var o;return r[39]=a.actThreadId,r[40]=a.toplevelOfflineThreadingId,r[23]=a.messageTimestampMs,r[22]=new t.Map,r[22].set("backup_id","openEbUploadGenericBackupId"),r[22].set("act_thread_id",r[39]),r[22].set("server_thread_id",r[39]),r[22].set("timestamp",t.i64.to_string(r[23])),r[22].set("otid",r[40]),r[24]=new t.Map,r[24].set("backup_id","openEbUploadGenericBackupId"),r[24].set("act_thread_id",r[39]),r[24].set("timestamp",t.i64.to_string(r[23])),r[24].set("otid",r[40]),t.sequence([function(n){return t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,o){var a,i,l=n.done,s=n.value;return l?(r[49]=t.i64.of_float(Date.now()),a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(r[49],t.i64.cast([0,1e6])),r[18]),void 0],r[41]=a[0],r[42]=a[1],r[43]=a[2],r[44]=a[3],r[45]=a[4],r[46]=a[5],r[47]=a[6]):(o=s.item,r[49]=t.i64.of_float(Date.now()),i=[e[0],o.queueName,o.enqueueTimestampMs,o.priority,o.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(r[49],t.i64.cast([0,1e6])),r[18]),void 0],r[41]=i[0],r[42]=i[1],r[43]=i[2],r[44]=i[3],r[45]=i[4],r[46]=i[5],r[47]=i[6])})},function(e){var t;return t=[r[41],r[42],r[43],r[44],r[45],r[46],r[47]],r[25]=t[0],r[26]=t[1],r[27]=t[2],r[28]=t[3],r[29]=t[4],r[30]=t[5],r[31]=t[6],t}])},function(e){return r[32]=new t.Map,r[32].set("task_id",r[25]),r[32].set("queue_name",r[26]),r[32].set("enqueue_timestamp_ms",r[27]),r[32].set("priority",r[28]),r[32].set("first_executed_timestamp_ms",r[29]),r[32].set("execution_time_ns",r[30]),r[32].set("echo_encoding_execution_time_ns",r[31]),r[33]=new t.Map,r[33].set("task_metadata",r[32]),r[33].set("action_type",void 0),r[33].set("content_type",void 0),r[33].set("identifiers",void 0),r[33].set("identifiers_v2",r[24]),r[33].set("task_creation_source",void 0),r[33].set("message_payload_source",t.i64.cast([0,2])),t.storedProcedure(n("LSLoadUnencryptedProtobufWithInputs"),a.backupAction,r[39],r[40],a.supplementalKey,r[23],r[22]).then(function(e){var t;return t=e,r[34]=t[0],r[35]=t[1],t})},function(e){var n,o,i;return r[34]!==void 0?(r[41]=new t.Map,r[41].set("unencrypted_protobuf_backup_payload",r[34]),r[41].set("message_identifiers",r[22]),r[41].set("attachment_backup_payload",a.attachmentPayload),r[41].set("sender_id",a.senderId),r[41].set("extra_data_for_eb_upload",void 0),n=[r[41],void 0,r[33]],r[36]=n[0],r[37]=n[1],r[38]=n[2]):(o=[void 0,r[35],r[33]],r[36]=o[0],r[37]=o[1],r[38]=o[2]),i=[r[36],r[37],r[38]],r[11]=i[0],r[12]=i[1],r[13]=i[2]}]))})},function(e){return r[15]=t.i64.of_float(Date.now()),r[16]=t.i64.random(),r[19]="Finishing execution. Execution time: ",r[20]=t.i64.to_string(t.i64.sub(r[15],r[0])),r[21]=" ms",r[17]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][loadUnencryptedProtobufBackupSerializedPayloadData] ",r[17],r[19],r[17],r[20],r[17],r[21]].join("")),t.i64.eq(t.i64.mod_(r[16],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[22]=",",r[23]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"loadUnencryptedProtobufBackupSerializedPayloadData",[r[19],r[22],r[20],r[22],r[21]].join(""),r[23],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[11],r[12],r[13]],o[0]=t[0],o[1]=t[1],o[2]=t[2],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsLoadUnencryptedProtobufBackupSerializedPayloadDataStoredProcedure",e.__tables__=["pending_tasks","pending_protobuf_backups_context"],a.exports=e}),null);
__d("LSTaskSerializerEncryptedBackupsOpenUpload",["LSArrayGetObjectAt","LSBase64Encode.nop","LSDeserializeFromJsonIntoDictionaryV2.nop","LSLoadUnencryptedProtobufBackupSerializedPayloadData","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][taskSerializerEncryptedBackupsOpenUpload] Beginning execution."),r[1]=t.i64.of_float(Date.now()),t.storedProcedure(n("LSLoadUnencryptedProtobufBackupSerializedPayloadData"),e[0]).then(function(e){var t;return t=e,r[2]=t[0],r[3]=t[1],r[4]=t[2],t})},function(e){var o,a,i;return r[2]!==void 0?t.sequence([function(e){return r[15]=r[2].get("message_identifiers"),r[16]=r[2].get("unencrypted_protobuf_backup_payload"),r[17]=r[15].get("server_thread_id"),r[18]=r[15].get("timestamp"),r[19]=r[15].get("otid"),r[20]=r[15].get("act_thread_id"),r[21]=new t.Map,r[21].set("server_thread_key",r[17]),r[21].set("timestamp",r[18]),r[21].set("otid",r[19]),r[21].set("wa_thread_id",t.i64.from_string(r[20])),r[22]=new t.Map,r[22].set("message_identifiers",r[21]),r[23]=r[2].get("extra_data_for_eb_upload"),r[23]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSDeserializeFromJsonIntoDictionaryV2.nop"),r[23]).then(function(e){var t;return t=e,r[32]=t[0],t})},function(e){return r[33]=new t.Map,r[34]=r[32].keys(),r[35]=t.i64.of_int32(r[34].length),t.i64.gt(r[35],t.i64.cast([0,0]))?t.loopAsync(r[35],function(e){return r[36]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[34],r[36]).then(function(e){var t;return t=e,r[37]=t[0],r[38]=t[1],t})},function(e){return r[39]=r[32].get(r[37]),r[33].set(r[37],r[39])}])}):t.resolve()},function(e){return r[24]=r[33]}]):t.resolve(r[24]=void 0)},function(e){return r[24]!==void 0?t.sequence([function(e){return r[32]=r[24].get("mt"),r[32]?r[33]=!1:r[33]=!0,r[33]?t.resolve(r[34]=void 0):t.sequence([function(e){return r[36]=new t.Map,r[37]=r[32].keys(),r[38]=t.i64.of_int32(r[37].length),t.i64.gt(r[38],t.i64.cast([0,0]))?t.loopAsync(r[38],function(e){return r[39]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[37],r[39]).then(function(e){var t;return t=e,r[40]=t[0],r[41]=t[1],t})},function(e){return r[42]=r[32].get(r[40]),r[36].set(r[40],r[42])}])}):t.resolve()},function(e){return r[34]=r[36]}])},function(e){return r[34]!==void 0?(r[36]=t.toJSON(r[34]),r[35]=r[36]):r[35]=void 0,r[25]=r[35]}]):t.resolve(r[25]=void 0)},function(e){return r[26]=r[16].get("supplemental_data_encrypted"),r[26]!==void 0?t.sequence([function(e){return r[32]=r[16].get("protobuf_encrypted"),r[33]=r[16].get("backup_action"),r[34]=r[16].get("timestamp_ms"),r[35]=r[26].get("sk_ciphertext"),t.nativeOperation(n("LSBase64Encode.nop"),r[35]).then(function(e){var t;return t=e,r[36]=t[0],t})},function(e){return r[37]=r[26].get("sk_hash"),t.nativeOperation(n("LSBase64Encode.nop"),r[37]).then(function(e){var t;return t=e,r[38]=t[0],t})},function(e){return r[39]=new t.Map,r[39].set("supplementary_data_key",void 0),r[39].set("encrypted_protobuf",r[32]),r[39].set("key_value_backup_action",r[33]),r[39].set("protobuf_ts_ms",r[34]),r[39].set("supplemental_key_ciphertext",r[36]),r[39].set("supplemental_key_hash",r[38]),r[39].set("message_tags",r[25]),r[27]=r[39]}]):t.resolve((r[32]=r[16].get("protobuf_encrypted"),r[33]=r[16].get("backup_action"),r[34]=r[16].get("timestamp_ms"),r[35]=new t.Map,r[35].set("supplementary_data_key",void 0),r[35].set("encrypted_protobuf",r[32]),r[35].set("key_value_backup_action",r[33]),r[35].set("protobuf_ts_ms",r[34]),r[35].set("message_tags",r[25]),r[27]=r[35]))},function(e){return r[22].set("key_value_backup_unencrypted_payload",r[27]),r[28]=r[2].get("sender_id"),r[22].set("sender_id",r[28]),r[29]=r[2].get("attachment_backup_payload"),r[29]!==void 0&&r[22].set("attachment_backup_payload",r[29]),r[24]!==void 0?t.sequence([function(e){return r[32]=r[24].get("ttd"),r[32]?r[33]=!1:r[33]=!0,r[33]?t.resolve(r[34]=void 0):t.sequence([function(e){return r[36]=new t.Map,r[37]=r[32].keys(),r[38]=t.i64.of_int32(r[37].length),t.i64.gt(r[38],t.i64.cast([0,0]))?t.loopAsync(r[38],function(e){return r[39]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[37],r[39]).then(function(e){var t;return t=e,r[40]=t[0],r[41]=t[1],t})},function(e){return r[42]=r[32].get(r[40]),r[36].set(r[40],r[42])}])}):t.resolve()},function(e){return r[34]=r[36]}])},function(e){return r[34]!==void 0?(r[36]=t.toJSON(r[34]),r[35]=r[36]):r[35]=void 0,r[30]=r[35]}]):t.resolve(r[30]=void 0)},function(e){var n;return r[30]!==void 0&&r[22].set("tags_to_delete",r[30]),r[31]=t.toJSON(r[22]),n=[r[31],void 0,r[4]],r[5]=n[0],r[6]=n[1],r[7]=n[2]}]):t.resolve((r[3]?r[15]=!1:r[15]=!0,r[15]?(a=[void 0,void 0,r[4]],r[16]=a[0],r[17]=a[1],r[18]=a[2]):(o=[void 0,r[3],r[4]],r[16]=o[0],r[17]=o[1],r[18]=o[2]),i=[r[16],r[17],r[18]],r[5]=i[0],r[6]=i[1],r[7]=i[2]))},function(e){return r[15]=new t.Map,r[16]=r[15].set("success",r[5]),r[17]=r[15].set("failure",r[6]),r[18]=r[15].set("context",r[7]),r[19]=t.toJSON(r[15]),r[8]=r[19],r[9]=t.i64.of_float(Date.now()),r[10]=t.i64.random(),r[12]="Finishing execution. Execution time: ",r[13]=t.i64.to_string(t.i64.sub(r[9],r[0])),r[14]=" ms",r[11]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][taskSerializerEncryptedBackupsOpenUpload] ",r[11],r[12],r[11],r[13],r[11],r[14]].join("")),t.i64.eq(t.i64.mod_(r[10],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[15]=",",r[16]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"taskSerializerEncryptedBackupsOpenUpload",[r[12],r[15],r[13],r[15],r[14]].join(""),r[16],t.i64.cast([0,4]))):t.resolve()},function(e){var n;return n=[r[8],t.i64.cast([0,50048])],o[0]=n[0],o[1]=n[1],n}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsOpenUploadStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSTaskSerializerEncryptedBackupsRestoreWithSerializer",[],(function(t,n,r,o,a,i){function e(){var e,t=arguments,n=t[t.length-1],r=[],o=[];return e=[void 0,void 0,void 0],o[0]=e[0],o[1]=e[1],o[2]=e[2],n.resolve(o)}e.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsRestoreWithSerializerStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSCreateDerivedKeys.nop",["CreateDerivedKeys","LSVec"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n,a,i,l,s){return o("CreateDerivedKeys").CreateDerivedKeys(a,i,l,r("LSVec").toArray(s))};e.__nop_name__="LSCreateDerivedKeys",l.default=e}),98);
__d("LSDeriveValueSecretRefV2",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][deriveValueSecretRefV2] Beginning execution."),r[1]=t.i64.of_float(Date.now()),r[2]=e[2].get("message_payload_encryption_keys"),r[3]=r[2].get("encryption_version"),r[4]=r[2].get("epoch_anon_id"),r[5]=r[2].get("epoch_root_key"),r[6]=r[2].get("payload_key"),r[7]=t.createArray(),r[41]=(r[7].push(t.i64.cast([0,6])),r[7]),t.nativeOperation(n("LSGetBlobFromString.nop"),"epoch_anon_id_debug").then(function(e){var t;return t=e,r[8]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),r[8],void 0,r[4],r[7]).then(function(e){var t;return t=e,r[9]=t[0],t})},function(e){return r[9]?r[10]=!1:r[10]=!0,r[10]?t.resolve(r[11]=""):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[9],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[41]=t[0],r[42]=t[1],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[41]).then(function(e){var t;return t=e,r[43]=t[0],t})},function(e){return r[11]=r[43]==null?"":r[43]}])},function(e){return r[12]=t.createArray(),r[41]=(r[12].push(t.i64.cast([0,6])),r[12]),t.nativeOperation(n("LSGetBlobFromString.nop"),"epoch_root_key_debug").then(function(e){var t;return t=e,r[13]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),r[13],void 0,r[5],r[12]).then(function(e){var t;return t=e,r[14]=t[0],t})},function(e){return r[14]?r[15]=!1:r[15]=!0,r[15]?t.resolve(r[16]=""):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[14],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[41]=t[0],r[42]=t[1],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[41]).then(function(e){var t;return t=e,r[43]=t[0],t})},function(e){return r[16]=r[43]==null?"":r[43]}])},function(e){return r[17]=t.createArray(),r[41]=(r[17].push(t.i64.cast([0,6])),r[17]),t.nativeOperation(n("LSGetBlobFromString.nop"),"message_key_debug").then(function(e){var t;return t=e,r[18]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),r[18],void 0,r[6],r[17]).then(function(e){var t;return t=e,r[19]=t[0],t})},function(e){return r[19]?r[20]=!1:r[20]=!0,r[20]?t.resolve(r[21]=""):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[19],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[41]=t[0],r[42]=t[1],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[41]).then(function(e){var t;return t=e,r[43]=t[0],t})},function(e){return r[21]=r[43]==null?"":r[43]}])},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[5]).then(function(e){var t;return t=e,r[22]=t[0],t})},function(o){return t.nativeOperation(n("LSGetBlobFromString.nop"),[r[22]==null?"":r[22],e[0]].join("")).then(function(e){var t;return t=e,r[23]=t[0],t})},function(e){return r[24]=t.createArray(),r[41]=(r[24].push(t.i64.cast([0,6])),r[24]),t.nativeOperation(n("LSGetBlobFromString.nop"),"epoch_root_key_thread_id_debug").then(function(e){var t;return t=e,r[25]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),r[25],void 0,r[23],r[24]).then(function(e){var t;return t=e,r[26]=t[0],t})},function(e){return r[26]?r[27]=!1:r[27]=!0,r[27]?t.resolve(r[28]=""):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[26],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[41]=t[0],r[42]=t[1],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[41]).then(function(e){var t;return t=e,r[43]=t[0],t})},function(e){return r[28]=r[43]==null?"":r[43]}])},function(e){return r[29]=":",t.blobs.neq(r[5],void 0)?t.sequence([function(e){return r[41]=t.createArray(),r[47]=(r[41].push(t.i64.cast([0,18])),r[41]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,r[5],r[41]).then(function(e){var t;return t=e,r[42]=t[0],t})},function(e){return r[42]!==void 0?t.sequence([function(e){return r[47]=t.i64.of_int32(r[42].length),t.i64.ge(r[47],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[42],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[49]=t[0],r[50]=t[1],t})},function(e){return r[48]=r[49]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),r[50]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",r[50]].join("")),r[49]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",r[50],r[49],t.i64.cast([0,3]))},function(e){return r[48]=void 0}])},function(e){return r[43]=r[48]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),r[48]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",r[48]].join("")),r[47]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",r[48],r[47],t.i64.cast([0,3]))},function(e){return r[43]=void 0}])},function(e){return t.blobs.neq(r[43],void 0)?r[44]=!0:r[44]=!1,r[44]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),t.nativeOperation(n("LSBase64Encode.nop"),r[43]).then(function(e){var t;return t=e,r[45]=t[0],t})},function(e){return r[45]!==void 0?r[46]=r[45]:r[46]="encodingfailed",r[30]=r[46]}]):t.resolve(r[30]="null")},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[4]).then(function(e){var t;return t=e,r[31]=t[0],t})},function(o){return r[32]=new t.Map,r[32].set("encryption_version",r[3]),r[32].set("epoch_anon_id",r[31]==null?"":r[31]),r[32].set("message_encryption_values",[r[11],r[29],r[16],r[29],r[21],r[29],r[28]].join("")),r[32].set("root_key_fingerprint",r[30]),r[32].set("backup_id",e[1]),r[33]=t.toJSON(r[32]),r[34]=new t.Map,r[34].set("value_secret_ref",r[33]),r[35]=t.i64.of_float(Date.now()),r[36]=t.i64.random(),r[38]="Finishing execution. Execution time: ",r[39]=t.i64.to_string(t.i64.sub(r[35],r[0])),r[40]=" ms",r[37]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][deriveValueSecretRefV2] ",r[37],r[38],r[37],r[39],r[37],r[40]].join("")),t.i64.eq(t.i64.mod_(r[36],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[41]=",",r[42]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"deriveValueSecretRefV2",[r[38],r[41],r[39],r[41],r[40]].join(""),r[42],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[34],void 0],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsDeriveValueSecretRefV2StoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSBinaryToHex.nop",["LSResult","Promise"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(o,a,i){var t=Array.from(new Uint8Array(i)),l=t.map(function(e){return e.toString(16).padStart(2,"0")}),s=l.join("").toUpperCase();return(e||(e=n("Promise"))).resolve(r("LSResult")(s))};s.__nop_name__="LSBinaryToHex",l.default=s}),98);
__d("LSGetBlobFromInt64BE.nop",["GetBlobFromInt64BE"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n,r){return o("GetBlobFromInt64BE").GetBlobFromInt64BE(r)};e.__nop_name__="LSGetBlobFromInt64BE",l.default=e}),98);
__d("LSHmac_v2.nop",["Hmac_v2"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n,o,a){return r("Hmac_v2")(o,a)};e.__nop_name__="LSHmac_v2",l.default=e}),98);
__d("LSCryptoUtils",["FBLogger","XPlatReactTextDecoder","XPlatReactTextEncoder"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return new Uint8Array(e)}function s(e){var t=new(o("XPlatReactTextEncoder")).TextEncoder;return t.encode(e)}function u(e){var t=new(o("XPlatReactTextDecoder")).TextDecoder;return t.decode(e)}function c(e){return u(new Uint8Array(e))}function d(e){return s(e).buffer}function m(e,t){var n=e.byteLength,o=t.byteLength;if(n!==o)throw r("FBLogger")("messenger_web").mustfixThrow("[LS] Mismatched lengths for modAdd, %d != %d",n,o);var a=new Uint8Array(n);return new Uint8Array(n).reduceRight(function(n,r,o){var i=e[o],l=t[o],s=i+l+n,u=s>255?[s-256,1]:[s,0];return a[o]=u[0],u[1]},0),a}l.bufToUint8=e,l.strToUint8=s,l.uint8ToStr=u,l.bufToStr=c,l.strToBuf=d,l.modAddBytes=m}),98);
__d("OcmfClientMap",["CryptoLogger","LSCryptoUtils","Promise","requireDeferred","tweetnacl"],(function(t,n,r,o,a,i,l){"use strict";var e,s=r("requireDeferred")("ristretto255").__setRef("OcmfClientMap"),u=function(r,a){var t=o("tweetnacl").hash(o("LSCryptoUtils").bufToUint8(a));return(e||(e=n("Promise"))).all([t,s.load()]).then(function(e){var t=e[0],n=e[1],o=n.fromHash(new Uint8Array(t)),a=n.scalarMult(new Uint8Array(r),o);return a.buffer}).catch(function(e){throw o("CryptoLogger").captureError(o("CryptoLogger").CryptoLogger("ocmf_client_map"),e).mustfix("Failed OcmfClientMap."),e})};l.default=u}),98);
__d("LSOcmfClientMap.nop",["LSResult","OcmfClientMap"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n,o,a){return r("OcmfClientMap")(o,a).then(function(e){return r("LSResult")(e)})};e.__nop_name__="LSOcmfClientMap",l.default=e}),98);
__d("UInt8Array",["XPlatReactCrypto"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.length;if(t>0&&t%2===0&&/^[\da-f]+$/gi.test(e)){for(var n=[],r=0,o=t/2|0;r<o;++r){var a=parseInt(e.substring(r<<1,(r<<1)+2|0),16);n.push(a)}return new Uint8Array(n)}}function s(e){return o("XPlatReactCrypto").getRandomValues(new Uint8Array(e)).buffer}function u(e){var t=e.filter(function(e){return e.byteLength!==0}),n=t.reduce(function(e,t){return e+t.byteLength|0},0),r=new Uint8Array(n);return t.reduce(function(e,t){return r.set(t,e),e+t.byteLength|0},0),r}l.fromHexString=e,l.getBufferWithRandomValuesFromLength=s,l.concatBytes=u}),98);
__d("OrderPreservingEncryption",["FBLogger","LSCryptoUtils","Promise","UInt8Array","XPlatReactCrypto"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return o("XPlatReactCrypto").getRandomValues(new Uint8Array(32)).buffer}function u(e){var t=e.length;return t%2!==0?"0"+e:e}function c(e){for(var t=BigInt(e),n=u(t.toString(16)),r=n.length,o=r/2,a=[],i=0;i<o;++i)a.push(i*2);return new Uint8Array(a.map(function(e){var t=e+2;return n.slice(e,t)}).map(function(e){return parseInt(e,16)}))}function d(e){var t=e.map(function(e){return e._0});return{_0:o("UInt8Array").concatBytes(t)}}function m(e){return"OPE key has length "+String(e)+", expected  "+String(32)}function p(e,t,n){var r=new ArrayBuffer(0);return o("XPlatReactCrypto").subtleImportKey("raw",e.buffer,"HKDF",!1,["deriveKey","deriveBits"]).then(function(e){return o("XPlatReactCrypto").subtleDeriveBits({hash:"SHA-256",info:t.buffer,name:"HKDF",salt:r},e,n*8)}).then(function(e){return{_0:new Uint8Array(e)}})}function _(e,t){return{_0:o("LSCryptoUtils").modAddBytes(e._0,t)}}function f(t,a,i,l){var s=i.byteLength;if(s!==32)throw r("FBLogger")("wmi_eb").mustfixThrow(m(s));var u=l.byteLength,c=function(t,n){var e=new Uint8Array(1+u),r=new Uint8Array(u-n).fill(0);return e.set([n]),e.set(t.subarray(0,n),1),e.set(r,n+1),e};if(u>=255)throw r("FBLogger")("wmi_eb").mustfixThrow("Input is too large");var f=Array.from(l).map(function(e,n){var r=c(l,n),o=new Uint8Array(t);o[t-1]=e;var a=new Uint8Array(i);return p(a,r,t).then(function(e){return _(e,o)})});return(e||(e=n("Promise"))).all(f).then(function(e){return o("UInt8Array").concatBytes([new Uint8Array([a]),d(e)._0])})}function g(e,t,n,r){var o=c(r);return f(e,t,n,o)}l.keyGen=s,l.intStringToBEBytes=c,l.buildKeyLengthErrorMsg=m,l.encryptBigEndianBytes=f,l.encryptIntString=g}),98);
__d("OpeEncrypt",["CryptoLogger","I64","LSResult","OrderPreservingEncryption"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,n,a){var i=o("CryptoLogger").CryptoLogger("ope_encrypt");return o("OrderPreservingEncryption").encryptBigEndianBytes((e||(e=o("I64"))).to_int32(a),1,t,new Uint8Array(n)).then(function(e){return r("LSResult")(e.buffer)},function(e){throw o("CryptoLogger").captureError(i,e).mustfix("OpeEncrypt_impl failed"),e})}l.OpeEncrypt=s}),98);
__d("LSOpeEncrypt.nop",["OpeEncrypt"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n,r,a,i){return o("OpeEncrypt").OpeEncrypt(r,a,i)};e.__nop_name__="LSOpeEncrypt",l.default=e}),98);
__d("TruncateSortKey",["CryptoLogger","LSResult","Promise"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("CryptoLogger").CryptoLogger("truncate_sort_key");function u(t){if(t.byteLength!==8)throw s.mustfixThrow("Bad length on sort key for truncation");var o=new Uint8Array(t),a=o.subarray(0,2);if(a.some(function(e){return e!==0}))throw s.mustfixThrow("Bad prefix on sort key for truncation");return(e||(e=n("Promise"))).resolve(r("LSResult")(t.slice(2)))}l.TruncateSortKey=u}),98);
__d("LSTruncateSortKey.nop",["TruncateSortKey"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n,r){return o("TruncateSortKey").TruncateSortKey(r)};e.__nop_name__="LSTruncateSortKey",l.default=e}),98);
__d("LSEncryptIdentifiersV2",["LSBase64Encode.nop","LSBinaryToHex.nop","LSGetBlobFromInt64BE.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSLogMebClientEvent.nop","LSOcmfClientMap.nop","LSOpeEncrypt.nop","LSTruncateSortKey.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][encryptIdentifiersV2] Beginning execution."),r[1]=t.i64.of_float(Date.now()),r[2]=e[6].get("ocmf_shared_key"),t.nativeOperation(n("LSGetBlobFromString.nop"),e[2]).then(function(e){var t;return t=e,r[3]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("bWFpbGJveF9pZF9zY29wZQ=="),r[3]).then(function(e){var t;return t=e,r[4]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[2],r[4]).then(function(e){var t;return t=e,r[5]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[5]).then(function(e){var t;return t=e,r[6]=t[0],t})},function(o){return t.i64.eq(e[0],t.i64.cast([0,2]))&&t.i64.eq(e[1],t.i64.cast([0,2]))?r[7]=e[5]:r[7]=e[3],r[8]=e[6].get("ocmf_shared_key"),t.nativeOperation(n("LSGetBlobFromString.nop"),r[7]).then(function(e){var t;return t=e,r[9]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("dGhyZWFkX2lkX3Njb3Bl"),r[9]).then(function(e){var t;return t=e,r[10]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[8],r[10]).then(function(e){var t;return t=e,r[11]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[11]).then(function(e){var t;return t=e,r[12]=t[0],t})},function(o){return r[13]=e[6].get("ope_key"),t.nativeOperation(n("LSGetBlobFromInt64BE.nop"),e[4]).then(function(e){var t;return t=e,r[14]=t[0],t})},function(e){return t.nativeOperation(n("LSTruncateSortKey.nop"),r[14]).then(function(e){var t;return t=e,r[15]=t[0],t})},function(e){return t.nativeOperation(n("LSOpeEncrypt.nop"),r[13],r[15],t.i64.cast([0,16])).then(function(e){var t;return t=e,r[16]=t[0],t})},function(e){return t.nativeOperation(n("LSBinaryToHex.nop"),r[16]).then(function(e){var t;return t=e,r[17]=t[0],t})},function(o){return r[18]=e[6].get("ocmf_shared_key"),t.nativeOperation(n("LSGetBlobFromString.nop"),e[5]).then(function(e){var t;return t=e,r[19]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("bWVzc2FnZV9pZF9zY29wZQ=="),r[19]).then(function(e){var t;return t=e,r[20]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[18],r[20]).then(function(e){var t;return t=e,r[21]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[21]).then(function(e){var t;return t=e,r[22]=t[0],t})},function(e){return r[23]=new t.Map,r[23].set("backup_id_ocmf_partial",r[6]==null?"":r[6]),r[23].set("act_thread_id_ocmf_partial",r[12]==null?"":r[12]),r[23].set("timestamp_encrypted",r[17]==null?"":r[17]),r[23].set("otid_ocmf_partial",r[22]==null?"":r[22]),r[24]=t.i64.of_float(Date.now()),r[25]=t.i64.random(),r[27]="Finishing execution. Execution time: ",r[28]=t.i64.to_string(t.i64.sub(r[24],r[0])),r[29]=" ms",r[26]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][encryptIdentifiersV2] ",r[26],r[27],r[26],r[28],r[26],r[29]].join("")),t.i64.eq(t.i64.mod_(r[25],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[30]=",",r[31]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"encryptIdentifiersV2",[r[27],r[30],r[28],r[30],r[29]].join(""),r[31],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[23],void 0],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsEncryptIdentifiersV2StoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("SymmetricEncryptionPaddingUtils",["XPlatReactTextEncoder"],(function(t,n,r,o,a,i,l){"use strict";function e(e){if(e<10)return 10-e;var t=Math.floor(Math.log2(e)),n=Math.floor(Math.log2(t))+1,r=t-n,o=(1<<r)-1,a=e+o&(o^-1);return a-e}function s(t){var n=Uint32Array.BYTES_PER_ELEMENT,r=t.byteLength,o=e(r),a=n+r+o,i=new DataView(new ArrayBuffer(a));i.setUint32(0,r);var l=new Uint8Array(i.buffer);return l.set(new Uint8Array(t),n),l.buffer}function u(e){var t=new(o("XPlatReactTextEncoder")).TextEncoder,n=t.encode(e).buffer;return s(n)}function c(e){var t=Uint32Array.BYTES_PER_ELEMENT,n=new DataView(e);if(!(n.byteLength<t)){var r=e.byteLength,o=n.getUint32(0),a=r-t;if(o>=0&&o<=a)return e.slice(t,t+o)}}l.getPaddingLength=e,l.padData=s,l.pad=u,l.stripPadding=c}),98);
__d("SymmetricEncryptionCreateEncryptedData",["CryptoLogger","EncryptedBackupsSymmetricEncryptionUtils","HChaCha20","Promise","RetUtil","SymmetricEncryptionPaddingUtils","XPlatReactCrypto"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(r,a,i){var t=o("CryptoLogger").CryptoLogger("symmetric_encryption_create_encrypted_data"),l=o("SymmetricEncryptionPaddingUtils").padData(i),s=o("XPlatReactCrypto").getRandomValues(new Uint8Array(o("EncryptedBackupsSymmetricEncryptionUtils").totalNonceLengthInBytes)),u=new(o("HChaCha20")).HChaCha20,c=u.hChaCha20Bytes(s.slice(0,o("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes).buffer,r);return o("XPlatReactCrypto").subtleImportKey("raw",c,"AES-GCM",!1,["encrypt"]).then(function(e){return o("XPlatReactCrypto").subtleEncrypt({additionalData:a,iv:new Uint8Array(s.slice(o("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes).buffer),name:"AES-GCM",tagLength:o("EncryptedBackupsSymmetricEncryptionUtils").aesGcmTagLength},e,l)}).then(function(t){var r=s.byteLength+t.byteLength,a=new Uint8Array(r);return a.set(s),a.set(new Uint8Array(t),o("EncryptedBackupsSymmetricEncryptionUtils").totalNonceLengthInBytes),(e||(e=n("Promise"))).resolve(o("RetUtil").getNullableRetResult(a.buffer))}).catch(function(r){return o("CryptoLogger").captureError(t,r).mustfix("symmetric data encryption failed"),(e||(e=n("Promise"))).resolve(o("RetUtil").getNullableRetResult())})};l.default=s}),98);
__d("LSSymmetricEncryptionCreateEncryptedData.nop",["SymmetricEncryptionCreateEncryptedData"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n,o,a,i){return r("SymmetricEncryptionCreateEncryptedData")(o,a,i)};e.__nop_name__="LSSymmetricEncryptionCreateEncryptedData",l.default=e}),98);
__d("LSSymmetricEncryptionCreateEncryptedString.nop",["Base64Utils","CryptoLogger","LSCryptoUtils","LSSymmetricEncryptionCreateEncryptedData.nop","Promise","RetUtil"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(a,i,l,s,u){var t=o("CryptoLogger").CryptoLogger("symmetric_encryption_create_encrypted_string");return r("LSSymmetricEncryptionCreateEncryptedData.nop")(a,i,l,s,o("LSCryptoUtils").strToBuf(u)).then(function(e){return e[0]}).then(function(t){return(e||(e=n("Promise"))).resolve(o("RetUtil").getNullableRetResult(t?o("Base64Utils").fromArrayBuffer(t):void 0))}).catch(function(r){return o("CryptoLogger").captureError(t,r).mustfix("symmetric string encryption failed"),(e||(e=n("Promise"))).resolve(o("RetUtil").getNullableRetResult())})};s.__nop_name__="LSSymmetricEncryptionCreateEncryptedString",l.default=s}),98);
__d("LSEncryptMessagePayloadV2",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSLogMebClientEvent.nop","LSSymmetricEncryptionCreateEncryptedString.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][encryptMessagePayloadV2] Beginning execution."),r[1]=t.i64.of_float(Date.now()),r[2]=e[2].get("message_payload_encryption_keys"),r[3]=r[2].get("payload_key"),t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[3],t.blobs.of_string(["message_thread","_",e[1]].join("")),e[3]).then(function(e){var t;return t=e,r[4]=t[0],t})},function(o){var a;return r[4]!==void 0?t.sequence([function(e){return r[13]=r[2].get("encryption_version"),r[14]=r[2].get("epoch_anon_id"),r[15]=r[2].get("epoch_root_key"),r[16]=r[2].get("payload_key"),r[17]=t.createArray(),r[45]=(r[17].push(t.i64.cast([0,6])),r[17]),t.nativeOperation(n("LSGetBlobFromString.nop"),"epoch_anon_id_debug").then(function(e){var t;return t=e,r[18]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),r[18],void 0,r[14],r[17]).then(function(e){var t;return t=e,r[19]=t[0],t})},function(e){return r[19]?r[20]=!1:r[20]=!0,r[20]?t.resolve(r[21]=""):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[19],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[45]=t[0],r[46]=t[1],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[45]).then(function(e){var t;return t=e,r[47]=t[0],t})},function(e){return r[21]=r[47]==null?"":r[47]}])},function(e){return r[22]=t.createArray(),r[45]=(r[22].push(t.i64.cast([0,6])),r[22]),t.nativeOperation(n("LSGetBlobFromString.nop"),"epoch_root_key_debug").then(function(e){var t;return t=e,r[23]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),r[23],void 0,r[15],r[22]).then(function(e){var t;return t=e,r[24]=t[0],t})},function(e){return r[24]?r[25]=!1:r[25]=!0,r[25]?t.resolve(r[26]=""):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[24],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[45]=t[0],r[46]=t[1],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[45]).then(function(e){var t;return t=e,r[47]=t[0],t})},function(e){return r[26]=r[47]==null?"":r[47]}])},function(e){return r[27]=t.createArray(),r[45]=(r[27].push(t.i64.cast([0,6])),r[27]),t.nativeOperation(n("LSGetBlobFromString.nop"),"message_key_debug").then(function(e){var t;return t=e,r[28]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),r[28],void 0,r[16],r[27]).then(function(e){var t;return t=e,r[29]=t[0],t})},function(e){return r[29]?r[30]=!1:r[30]=!0,r[30]?t.resolve(r[31]=""):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[29],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[45]=t[0],r[46]=t[1],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[45]).then(function(e){var t;return t=e,r[47]=t[0],t})},function(e){return r[31]=r[47]==null?"":r[47]}])},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[15]).then(function(e){var t;return t=e,r[32]=t[0],t})},function(o){return t.nativeOperation(n("LSGetBlobFromString.nop"),[r[32]==null?"":r[32],e[1]].join("")).then(function(e){var t;return t=e,r[33]=t[0],t})},function(e){return r[34]=t.createArray(),r[45]=(r[34].push(t.i64.cast([0,6])),r[34]),t.nativeOperation(n("LSGetBlobFromString.nop"),"epoch_root_key_thread_id_debug").then(function(e){var t;return t=e,r[35]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),r[35],void 0,r[33],r[34]).then(function(e){var t;return t=e,r[36]=t[0],t})},function(e){return r[36]?r[37]=!1:r[37]=!0,r[37]?t.resolve(r[38]=""):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[36],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[45]=t[0],r[46]=t[1],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[45]).then(function(e){var t;return t=e,r[47]=t[0],t})},function(e){return r[38]=r[47]==null?"":r[47]}])},function(e){return r[39]=":",t.blobs.neq(r[15],void 0)?t.sequence([function(e){return r[45]=t.createArray(),r[51]=(r[45].push(t.i64.cast([0,18])),r[45]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,r[15],r[45]).then(function(e){var t;return t=e,r[46]=t[0],t})},function(e){return r[46]!==void 0?t.sequence([function(e){return r[51]=t.i64.of_int32(r[46].length),t.i64.ge(r[51],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[46],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[53]=t[0],r[54]=t[1],t})},function(e){return r[52]=r[53]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),r[54]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",r[54]].join("")),r[53]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",r[54],r[53],t.i64.cast([0,3]))},function(e){return r[52]=void 0}])},function(e){return r[47]=r[52]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),r[52]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",r[52]].join("")),r[51]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",r[52],r[51],t.i64.cast([0,3]))},function(e){return r[47]=void 0}])},function(e){return t.blobs.neq(r[47],void 0)?r[48]=!0:r[48]=!1,r[48]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),t.nativeOperation(n("LSBase64Encode.nop"),r[47]).then(function(e){var t;return t=e,r[49]=t[0],t})},function(e){return r[49]!==void 0?r[50]=r[49]:r[50]="encodingfailed",r[40]=r[50]}]):t.resolve(r[40]="null")},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[14]).then(function(e){var t;return t=e,r[41]=t[0],t})},function(n){var o;return r[42]=new t.Map,r[42].set("encryption_version",r[13]),r[42].set("epoch_anon_id",r[41]==null?"":r[41]),r[42].set("message_encryption_values",[r[21],r[39],r[26],r[39],r[31],r[39],r[38]].join("")),r[42].set("root_key_fingerprint",r[40]),r[42].set("backup_id",e[0]),r[43]=t.toJSON(r[42]),r[44]=new t.Map,r[44].set("encrypted_message_payload",r[4]),r[44].set("value_secret_ref",r[43]),o=[r[44],void 0],r[5]=o[0],r[6]=o[1]}]):t.resolve((r[13]=new t.Map,r[13].set("error_code",t.i64.cast([0,40])),r[13].set("stored_procedure","LSEncryptedBackupsEncryptMessagePayloadV2StoredProcedure"),r[13].set("error_message",""),a=[void 0,r[13]],r[5]=a[0],r[6]=a[1]))},function(e){return r[7]=t.i64.of_float(Date.now()),r[8]=t.i64.random(),r[10]="Finishing execution. Execution time: ",r[11]=t.i64.to_string(t.i64.sub(r[7],r[0])),r[12]=" ms",r[9]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][encryptMessagePayloadV2] ",r[9],r[10],r[9],r[11],r[9],r[12]].join("")),t.i64.eq(t.i64.mod_(r[8],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[13]=",",r[14]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"encryptMessagePayloadV2",[r[10],r[13],r[11],r[13],r[12]].join(""),r[14],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[5],r[6]],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsEncryptMessagePayloadV2StoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSGetLatestEpochKeys",["LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(n){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][getLatestEpochKeys] Beginning execution."),r[1]=t.i64.of_float(Date.now()),r[2]="",r[3]=void 0,r[4]=void 0,r[5]=void 0,e[0]?t.resolve(0):(r[15]=void 0,t.i64.neq(r[15],void 0)?t.sequence([function(e){return t.count(t.db.table(169).fetch([[[r[15]]]])).then(function(e){return r[16]=e})},function(e){return t.i64.le(r[16],t.i64.cast([0,1]))?t.sequence([function(e){return t.db.table(169).fetch([[[r[15]]]]).next().then(function(e,n){var o,a,i=e.done,l=e.value;return i?(r[26]=new t.Map,r[26].set("error_msg","Expected a nonempty query result"),r[26].set("code",t.i64.cast([0,3])),r[26].set("src_line","MEBEpochClientUtils.php:313 MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly()"),r[27]=t.createArray(),r[28]=(r[27].push(r[26]),r[27]),o=[void 0,r[27]],r[22]=o[0],r[23]=o[1]):(n=l.item,r[26]=new t.Map,r[26].set("epoch_id",n.epochId),r[26].set("backup_id",n.backupId),r[26].set("epoch_anon_id_blob",n.epochAnonIdBlob),r[26].set("epoch_root_key_blob",n.epochRootKeyBlob),r[26].set("epoch_status",n.epochStatus),r[26].set("epoch_head",n.epochHead),r[26].set("authority_level",n.authorityLevel),a=[r[26],void 0],r[22]=a[0],r[23]=a[1])})},function(e){return r[25]=new t.Map,r[25].set("value",r[22]),r[25].set("errors",r[23]),r[17]=r[25]}]):t.resolve((r[22]=new t.Map,r[22].set("error_msg","Expected at most one result"),r[22].set("code",t.i64.cast([0,4])),r[22].set("src_line","MEBEpochClientUtils.php:313 MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly()"),r[23]=t.createArray(),r[25]=(r[23].push(r[22]),r[23]),r[24]=new t.Map,r[24].set("value",void 0),r[24].set("errors",r[23]),r[17]=r[24]))},function(e){return r[18]=r[17].get("value"),r[18]!==void 0?(r[22]=r[18].get("epoch_id"),r[23]=r[18].get("backup_id"),r[24]=r[18].get("epoch_anon_id_blob"),r[25]=r[18].get("epoch_root_key_blob"),r[26]=r[18].get("epoch_status"),r[27]=r[18].get("epoch_head"),r[28]=r[18].get("authority_level"),r[29]=r[17],r[19]=r[29]):(r[22]=r[17].get("errors"),r[23]=r[17].get("errors"),r[24]=new t.Map,r[24].set("value",void 0),r[24].set("errors",r[22]),r[19]=r[24]),r[20]=r[19].get("value"),r[20]!==void 0?(r[22]=r[20].get("epoch_id"),r[23]=r[20].get("backup_id"),r[24]=r[20].get("epoch_anon_id_blob"),r[25]=r[20].get("epoch_root_key_blob"),r[26]=r[20].get("epoch_status"),r[27]=r[20].get("epoch_head"),r[28]=r[20].get("authority_level"),r[2]=t.blobs.to_string(r[24]),r[3]=r[22],r[4]=r[25],t.blobs.neq(r[27],void 0)&&(r[5]=r[27]),r[21]=!0):(r[22]=r[19].get("errors"),r[23]=r[19].get("errors"),r[21]=!1)}]):t.resolve())},function(n){return t.i64.neq(r[3],void 0)?t.resolve(0):t.sequence([function(n){return r[15]=void 0,r[16]="",r[17]=void 0,r[18]=void 0,t.forEach(t.filter(t.db.table(169).fetch(),function(n){return e[0]||t.i64.eq(n.authorityLevel,t.i64.cast([0,80]))}),function(e){var n=e.item;return r[20]=t.blobs.to_string(n.epochAnonIdBlob),t.i64.eq([0,r[20].length],[0,r[16].length])?r[19]=r[20]>r[16]:r[19]=t.i64.gt([0,r[20].length],[0,r[16].length]),r[19]?(r[15]=n.epochId,r[16]=r[20],r[17]=n.epochRootKeyBlob,r[18]=n.epochHead):0})},function(e){return t.i64.neq(r[15],void 0)&&(r[2]=r[16],r[3]=r[15],r[4]=r[17],t.blobs.neq(r[18],void 0)&&(r[5]=r[18]),r[19]=t.i64.of_float(Date.now())),0}])},function(e){var o,a,i,l,s,u;return r[11]=t.blobs.of_string(r[2]),t.i64.neq(r[3],void 0)?(t.blobs.neq(r[11],void 0)?(t.blobs.neq(r[4],void 0)?(r[19]=new t.Map,r[19].set("epoch_id",r[3]),r[19].set("epoch_root_key",r[4]),r[19].set("epoch_anon_id",r[11]),r[19].set("epoch_head",r[5]),r[20]=new t.Map,r[20].set("epoch_keys",r[19]),o=[r[20],void 0],r[17]=o[0],r[18]=o[1]):(r[19]=new t.Map,r[19].set("error_code",t.i64.cast([0,402])),r[19].set("error_message","failed to query latest epoch"),r[19].set("stored_procedure","LSEncryptedBackupsGetLatestEpochKeysStoredProcedure"),a=[void 0,r[19]],r[17]=a[0],r[18]=a[1]),i=[r[17],r[18]],r[15]=i[0],r[16]=i[1]):(r[17]=new t.Map,r[17].set("error_code",t.i64.cast([0,403])),r[17].set("error_message","failed to query latest epoch"),r[17].set("stored_procedure","LSEncryptedBackupsGetLatestEpochKeysStoredProcedure"),l=[void 0,r[17]],r[15]=l[0],r[16]=l[1]),s=[r[15],r[16]],r[6]=s[0],r[7]=s[1]):(r[15]=new t.Map,r[15].set("error_code",t.i64.cast([0,400])),r[15].set("error_message","failed to query latest epoch"),r[15].set("stored_procedure","LSEncryptedBackupsGetLatestEpochKeysStoredProcedure"),u=[void 0,r[15]],r[6]=u[0],r[7]=u[1]),r[8]=t.i64.of_float(Date.now()),r[9]=t.i64.random(),r[12]="Finishing execution. Execution time: ",r[13]=t.i64.to_string(t.i64.sub(r[8],r[0])),r[14]=" ms",r[10]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][getLatestEpochKeys] ",r[10],r[12],r[10],r[13],r[10],r[14]].join("")),t.i64.eq(t.i64.mod_(r[9],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[15]=",",r[16]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"getLatestEpochKeys",[r[12],r[15],r[13],r[15],r[14]].join(""),r[16],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[6],r[7]],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsGetLatestEpochKeysStoredProcedure",e.__tables__=["secure_encrypted_backups_epochs"],a.exports=e}),null);
__d("LSIsEncryptionVersionSecure",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.i64.eq(e[0],t.i64.cast([0,4]))?n[0]=!1:(t.i64.eq(e[0],t.i64.cast([0,3]))?n[1]=!0:(t.i64.eq(e[0],t.i64.cast([0,2]))?n[2]=!0:(t.i64.eq(e[0],t.i64.cast([0,0]))?n[3]=!0:(t.i64.eq(e[0],t.i64.cast([0,99])),n[4]=!1,n[3]=n[4]),n[2]=n[3]),n[1]=n[2]),n[0]=n[1]),r[0]=n[0],t.resolve(r)}e.__sproc_name__="LSEncryptedBackupsVersioningIsEncryptionVersionSecureStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSLoadAndEncryptProtobufWithInputsV2",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSLogMebClientEvent.nop","LSQueryLocalPersistenceStoreForBackup.nop","LSQueryLocalPersistenceStoreSupplementalForBackup.nop","LSQueryLocalPersistenceStoreTagsForBackup.nop","LSSymmetricEncryptionCreateEncryptedData.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][loadAndEncryptProtobufWithInputsV2] Beginning execution."),r[1]=t.i64.of_float(Date.now()),t.i64.eq(e[0],t.i64.cast([0,1]))?t.sequence([function(o){return t.nativeOperation(n("LSQueryLocalPersistenceStoreForBackup.nop"),e[1],e[2]).then(function(e){var t;return t=e,r[10]=t[0],r[11]=t[1],r[12]=t[2],t})},function(o){return t.nativeOperation(n("LSQueryLocalPersistenceStoreTagsForBackup.nop"),e[1],e[2]).then(function(e){var t;return t=e,r[13]=t[0],t})},function(o){var a,i,l;return r[14]=new t.Map,r[14].set("message_tags",r[13]),r[15]=new t.Map,r[15].set("mt",r[14]),t.blobs.neq(r[10],void 0)?t.sequence([function(o){return r[18]=e[5].get("message_payload_encryption_keys"),r[19]=r[18].get("payload_key"),t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedData.nop"),r[19],t.blobs.of_string(["message_thread","_",e[1]].join("")),r[10]).then(function(e){var t;return t=e,r[20]=t[0],t})},function(e){return t.blobs.neq(r[20],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[20]).then(function(e){var t;return t=e,r[24]=t[0],t})},function(e){return r[21]=r[24]}]):t.resolve(r[21]=void 0)},function(o){var a;return r[21]!==void 0?t.sequence([function(e){return r[15]!==void 0?t.sequence([function(e){return r[27]=r[15].get("mt"),r[27]?r[28]=!1:r[28]=!0,r[28]?t.resolve(r[29]=void 0):t.sequence([function(e){return r[31]=new t.Map,r[32]=r[27].keys(),r[33]=t.i64.of_int32(r[32].length),t.i64.gt(r[33],t.i64.cast([0,0]))?t.loopAsync(r[33],function(e){return r[34]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[32],r[34]).then(function(e){var t;return t=e,r[35]=t[0],r[36]=t[1],t})},function(e){return r[37]=r[27].get(r[35]),r[31].set(r[35],r[37])}])}):t.resolve()},function(e){return r[29]=r[31]}])},function(e){return r[29]!==void 0?(r[31]=t.toJSON(r[29]),r[30]=r[31]):r[30]=void 0,r[24]=r[30]}]):t.resolve(r[24]=void 0)},function(n){var o;return r[15]!==void 0?(r[27]=r[15].get("mooos"),r[25]=r[27]):r[25]=void 0,r[26]=new t.Map,r[26].set("backup_action",e[0]),r[26].set("protobuf_encrypted",r[21]),r[26].set("supplemental_data_encrypted",void 0),r[26].set("timestamp_ms",e[4]),r[26].set("message_tags",r[24]),r[26].set("serialized_attachment_backup_payload",void 0),r[26].set("maybe_ooo_supplemental_upload",r[25]),o=[r[26],void 0],r[22]=o[0],r[23]=o[1]}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_ENCRYPTION_FAILED"),r[24]=new t.Map,r[24].set("error_code",t.i64.cast([0,62])),r[24].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),r[24].set("error_message",""),a=[void 0,r[24]],r[22]=a[0],r[23]=a[1]))},function(e){var t;return t=[r[22],r[23]],r[16]=t[0],r[17]=t[1],t}]):t.resolve((r[12]?((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_ALREADY_DELETED"),r[20]=new t.Map,r[20].set("error_code",t.i64.cast([0,70])),r[20].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),r[20].set("error_message",""),a=[void 0,r[20]],r[18]=a[0],r[19]=a[1]):((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_NOT_FOUND_IN_TOPLEVEL_TABLE"),r[20]=new t.Map,r[20].set("error_code",t.i64.cast([0,63])),r[20].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),r[20].set("error_message",""),i=[void 0,r[20]],r[18]=i[0],r[19]=i[1]),l=[r[18],r[19]],r[16]=l[0],r[17]=l[1]))},function(e){var t;return t=[r[16],r[17]],r[2]=t[0],r[3]=t[1],t}]):t.sequence([function(o){return t.i64.eq(e[0],t.i64.cast([0,2]))?t.sequence([function(o){var a;return e[3]!==void 0?t.sequence([function(o){return t.nativeOperation(n("LSQueryLocalPersistenceStoreSupplementalForBackup.nop"),e[1],e[2],e[3]).then(function(e){var t;return t=e,r[14]=t[0],r[15]=t[1],t})},function(o){return t.nativeOperation(n("LSQueryLocalPersistenceStoreTagsForBackup.nop"),e[1],e[2]).then(function(e){var t;return t=e,r[16]=t[0],t})},function(o){var a;return r[17]=new t.Map,r[17].set("message_tags",r[16]),r[18]=new t.Map,r[18].set("mt",r[17]),t.blobs.neq(r[14],void 0)?t.sequence([function(o){var a;return e[3]!==void 0?t.sequence([function(o){var a;return r[23]=e[5].get("mailbox_root_key_v2"),t.blobs.neq(r[23],void 0)?t.sequence([function(o){return r[26]=e[5].get("message_payload_encryption_keys"),r[27]=r[26].get("epoch_root_key"),r[28]=t.createArray(),r[41]=(r[28].push(t.i64.cast([0,32])),r[28]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleV92Mj5zdXBwbGVtZW50YWxfcHJmX2tleQ=="),void 0,r[23],r[28]).then(function(e){var t;return t=e,r[29]=t[0],t})},function(e){return r[29]!==void 0?t.sequence([function(e){return r[41]=t.i64.of_int32(r[29].length),t.i64.ge(r[41],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[29],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[43]=t[0],r[44]=t[1],t})},function(e){return r[42]=r[43]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),r[44]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoUtils] ","",r[44]].join("")),r[43]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoUtils",r[44],r[43],t.i64.cast([0,3]))},function(e){return r[42]=void 0}])},function(e){return r[30]=r[42]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),r[42]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoUtils] ","",r[42]].join("")),r[41]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoUtils",r[42],r[41],t.i64.cast([0,3]))},function(e){return r[30]=void 0}])},function(e){return t.blobs.neq(r[30],void 0)?r[31]=!0:r[31]=!1,r[31]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),r[32]=t.createArray(),r[41]=(r[32].push(t.i64.cast([0,32])),r[32]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleV92Mj5zdXBwbGVtZW50YWxfZW5jX2tleQ=="),void 0,r[27],r[32]).then(function(e){var t;return t=e,r[33]=t[0],t})},function(e){return r[33]!==void 0?t.sequence([function(e){return r[41]=t.i64.of_int32(r[33].length),t.i64.ge(r[41],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[33],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[43]=t[0],r[44]=t[1],t})},function(e){return r[42]=r[43]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),r[44]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoUtils] ","",r[44]].join("")),r[43]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoUtils",r[44],r[43],t.i64.cast([0,3]))},function(e){return r[42]=void 0}])},function(e){return r[34]=r[42]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),r[42]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoUtils] ","",r[42]].join("")),r[41]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoUtils",r[42],r[41],t.i64.cast([0,3]))},function(e){return r[34]=void 0}])},function(o){return t.blobs.neq(r[34],void 0)?r[35]=!0:r[35]=!1,r[35]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),t.nativeOperation(n("LSGetBlobFromString.nop"),e[3]).then(function(e){var t;return t=e,r[36]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),r[30],r[36]).then(function(e){var t;return t=e,r[37]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedData.nop"),r[34],t.blob("c3VwcGxlbWVudGFsX2VuY19hYWQ="),r[36]).then(function(e){var t;return t=e,r[38]=t[0],t})},function(o){var a;return t.blobs.neq(r[38],void 0)?t.sequence([function(o){return r[41]=new t.Map,r[41].set("sk_ciphertext",r[38]),r[41].set("sk_hash",r[37]),r[42]=e[5].get("message_payload_encryption_keys"),r[43]=r[42].get("payload_key"),t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedData.nop"),r[43],t.blobs.of_string(["message_thread","_",e[1]].join("")),r[14]).then(function(e){var t;return t=e,r[44]=t[0],t})},function(e){return t.blobs.neq(r[44],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[44]).then(function(e){var t;return t=e,r[48]=t[0],t})},function(e){return r[45]=r[48]}]):t.resolve(r[45]=void 0)},function(o){var a;return r[45]!==void 0?t.sequence([function(e){return r[18]!==void 0?t.sequence([function(e){return r[51]=r[18].get("mt"),r[51]?r[52]=!1:r[52]=!0,r[52]?t.resolve(r[53]=void 0):t.sequence([function(e){return r[55]=new t.Map,r[56]=r[51].keys(),r[57]=t.i64.of_int32(r[56].length),t.i64.gt(r[57],t.i64.cast([0,0]))?t.loopAsync(r[57],function(e){return r[58]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[56],r[58]).then(function(e){var t;return t=e,r[59]=t[0],r[60]=t[1],t})},function(e){return r[61]=r[51].get(r[59]),r[55].set(r[59],r[61])}])}):t.resolve()},function(e){return r[53]=r[55]}])},function(e){return r[53]!==void 0?(r[55]=t.toJSON(r[53]),r[54]=r[55]):r[54]=void 0,r[48]=r[54]}]):t.resolve(r[48]=void 0)},function(n){var o;return r[18]!==void 0?(r[51]=r[18].get("mooos"),r[49]=r[51]):r[49]=void 0,r[50]=new t.Map,r[50].set("backup_action",e[0]),r[50].set("protobuf_encrypted",r[45]),r[50].set("supplemental_data_encrypted",r[41]),r[50].set("timestamp_ms",e[4]),r[50].set("message_tags",r[48]),r[50].set("serialized_attachment_backup_payload",void 0),r[50].set("maybe_ooo_supplemental_upload",r[49]),o=[r[50],void 0],r[46]=o[0],r[47]=o[1]}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_ENCRYPTION_FAILED"),r[48]=new t.Map,r[48].set("error_code",t.i64.cast([0,62])),r[48].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),r[48].set("error_message",""),a=[void 0,r[48]],r[46]=a[0],r[47]=a[1]))},function(e){var t;return t=[r[46],r[47]],r[39]=t[0],r[40]=t[1],t}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error SUPPLEMENTAL_ENCRYPTION_FAILED"),r[41]=new t.Map,r[41].set("error_code",t.i64.cast([0,66])),r[41].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),r[41].set("error_message",""),a=[void 0,r[41]],r[39]=a[0],r[40]=a[1]))},function(e){var t;return t=[r[39],r[40]],r[24]=t[0],r[25]=t[1],t}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error NULL_MAILBOX_ROOT_KEY_V2"),r[26]=new t.Map,r[26].set("error_code",t.i64.cast([0,27])),r[26].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),r[26].set("error_message",""),a=[void 0,r[26]],r[24]=a[0],r[25]=a[1]))},function(e){var t;return t=[r[24],r[25]],r[21]=t[0],r[22]=t[1],t}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error SUPPLEMENTAL_KEY_NOT_SET_IN_CONTEXT_TABLE"),r[23]=new t.Map,r[23].set("error_code",t.i64.cast([0,65])),r[23].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),r[23].set("error_message",""),a=[void 0,r[23]],r[21]=a[0],r[22]=a[1]))},function(e){var t;return t=[r[21],r[22]],r[19]=t[0],r[20]=t[1],t}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_NOT_FOUND_IN_SUPPLEMENTAL_TABLE"),r[21]=new t.Map,r[21].set("error_code",t.i64.cast([0,64])),r[21].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),r[21].set("error_message",""),a=[void 0,r[21]],r[19]=a[0],r[20]=a[1]))},function(e){var t;return t=[r[19],r[20]],r[12]=t[0],r[13]=t[1],t}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error SUPPLEMENTAL_KEY_NOT_SET_IN_CONTEXT_TABLE"),r[14]=new t.Map,r[14].set("error_code",t.i64.cast([0,65])),r[14].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),r[14].set("error_message",""),a=[void 0,r[14]],r[12]=a[0],r[13]=a[1]))},function(e){var t;return t=[r[12],r[13]],r[10]=t[0],r[11]=t[1],t}]):t.sequence([function(o){return t.i64.eq(e[0],t.i64.cast([0,4]))?t.sequence([function(o){return t.nativeOperation(n("LSQueryLocalPersistenceStoreForBackup.nop"),e[1],e[2]).then(function(e){var t;return t=e,r[14]=t[0],r[15]=t[1],r[16]=t[2],t})},function(o){return t.nativeOperation(n("LSQueryLocalPersistenceStoreTagsForBackup.nop"),e[1],e[2]).then(function(e){var t;return t=e,r[17]=t[0],t})},function(o){var a,i,l;return r[18]=new t.Map,r[18].set("message_tags",r[17]),r[19]=new t.Map,r[19].set("mt",r[18]),t.blobs.neq(r[14],void 0)?t.sequence([function(o){return r[22]=e[5].get("message_payload_encryption_keys"),r[23]=r[22].get("payload_key"),t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedData.nop"),r[23],t.blobs.of_string(["message_thread","_",e[1]].join("")),r[14]).then(function(e){var t;return t=e,r[24]=t[0],t})},function(e){return t.blobs.neq(r[24],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[24]).then(function(e){var t;return t=e,r[28]=t[0],t})},function(e){return r[25]=r[28]}]):t.resolve(r[25]=void 0)},function(o){var a;return r[25]!==void 0?t.sequence([function(e){return r[19]!==void 0?t.sequence([function(e){return r[31]=r[19].get("mt"),r[31]?r[32]=!1:r[32]=!0,r[32]?t.resolve(r[33]=void 0):t.sequence([function(e){return r[35]=new t.Map,r[36]=r[31].keys(),r[37]=t.i64.of_int32(r[36].length),t.i64.gt(r[37],t.i64.cast([0,0]))?t.loopAsync(r[37],function(e){return r[38]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[36],r[38]).then(function(e){var t;return t=e,r[39]=t[0],r[40]=t[1],t})},function(e){return r[41]=r[31].get(r[39]),r[35].set(r[39],r[41])}])}):t.resolve()},function(e){return r[33]=r[35]}])},function(e){return r[33]!==void 0?(r[35]=t.toJSON(r[33]),r[34]=r[35]):r[34]=void 0,r[28]=r[34]}]):t.resolve(r[28]=void 0)},function(n){var o;return r[19]!==void 0?(r[31]=r[19].get("mooos"),r[29]=r[31]):r[29]=void 0,r[30]=new t.Map,r[30].set("backup_action",e[0]),r[30].set("protobuf_encrypted",r[25]),r[30].set("supplemental_data_encrypted",void 0),r[30].set("timestamp_ms",e[4]),r[30].set("message_tags",r[28]),r[30].set("serialized_attachment_backup_payload",void 0),r[30].set("maybe_ooo_supplemental_upload",r[29]),o=[r[30],void 0],r[26]=o[0],r[27]=o[1]}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_ENCRYPTION_FAILED"),r[28]=new t.Map,r[28].set("error_code",t.i64.cast([0,62])),r[28].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),r[28].set("error_message",""),a=[void 0,r[28]],r[26]=a[0],r[27]=a[1]))},function(e){var t;return t=[r[26],r[27]],r[20]=t[0],r[21]=t[1],t}]):t.resolve((r[16]?((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_ALREADY_DELETED"),r[24]=new t.Map,r[24].set("error_code",t.i64.cast([0,70])),r[24].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),r[24].set("error_message",""),a=[void 0,r[24]],r[22]=a[0],r[23]=a[1]):((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_NOT_FOUND_IN_TOPLEVEL_TABLE"),r[24]=new t.Map,r[24].set("error_code",t.i64.cast([0,63])),r[24].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),r[24].set("error_message",""),i=[void 0,r[24]],r[22]=i[0],r[23]=i[1]),l=[r[22],r[23]],r[20]=l[0],r[21]=l[1]))},function(e){var t;return t=[r[20],r[21]],r[12]=t[0],r[13]=t[1],t}]):t.sequence([function(n){var o;return t.i64.eq(e[0],t.i64.cast([0,3]))?t.sequence([function(e){return t.resolve(r[16]=void 0)},function(n){var o;return r[17]=void 0,r[18]=new t.Map,r[18].set("backup_action",e[0]),r[18].set("protobuf_encrypted",void 0),r[18].set("supplemental_data_encrypted",void 0),r[18].set("timestamp_ms",e[4]),r[18].set("message_tags",r[16]),r[18].set("serialized_attachment_backup_payload",void 0),r[18].set("maybe_ooo_supplemental_upload",r[17]),o=[r[18],void 0],r[14]=o[0],r[15]=o[1]}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error UNKNOWN_PROTOBUF_TYPE"),r[16]=new t.Map,r[16].set("error_code",t.i64.cast([0,60])),r[16].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),r[16].set("error_message",""),o=[void 0,r[16]],r[14]=o[0],r[15]=o[1]))},function(e){var t;return t=[r[14],r[15]],r[12]=t[0],r[13]=t[1],t}])},function(e){var t;return t=[r[12],r[13]],r[10]=t[0],r[11]=t[1],t}])},function(e){var t;return t=[r[10],r[11]],r[2]=t[0],r[3]=t[1],t}])},function(e){return r[4]=t.i64.of_float(Date.now()),r[5]=t.i64.random(),r[7]="Finishing execution. Execution time: ",r[8]=t.i64.to_string(t.i64.sub(r[4],r[0])),r[9]=" ms",r[6]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][loadAndEncryptProtobufWithInputsV2] ",r[6],r[7],r[6],r[8],r[6],r[9]].join("")),t.i64.eq(t.i64.mod_(r[5],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[10]=",",r[11]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"loadAndEncryptProtobufWithInputsV2",[r[7],r[10],r[8],r[10],r[9]].join(""),r[11],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[2],r[3]],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSLoadAndEncryptProtobufV2",["LSLoadAndEncryptProtobufWithInputsV2","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][loadAndEncryptProtobufV2] Beginning execution."),r[1]=t.i64.of_float(Date.now()),t.filter(t.db.table(305).fetch(),function(n){return t.i64.eq(n.pendingBackupTaskId,e[0])}).next().then(function(o,a){var i,l=o.done,s=o.value;return l?((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufV2StoredProcedure] Returning error PROTOBUF_CONTEXT_ROW_NOT_FOUND"),r[11]=new t.Map,r[11].set("error_code",t.i64.cast([0,67])),r[11].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufV2StoredProcedure"),r[11].set("error_message",""),i=[void 0,r[11]],r[2]=i[0],r[3]=i[1]):(a=s.item,t.sequence([function(o){return t.storedProcedure(n("LSLoadAndEncryptProtobufWithInputsV2"),a.backupAction,e[2],a.toplevelOfflineThreadingId,a.supplementalKey,a.messageTimestampMs,e[1]).then(function(e){var t;return t=e,r[11]=t[0],r[12]=t[1],t})},function(e){var t;return t=[r[11],r[12]],r[2]=t[0],r[3]=t[1],t}]))})},function(e){return r[5]=t.i64.of_float(Date.now()),r[6]=t.i64.random(),r[8]="Finishing execution. Execution time: ",r[9]=t.i64.to_string(t.i64.sub(r[5],r[0])),r[10]=" ms",r[7]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][loadAndEncryptProtobufV2] ",r[7],r[8],r[7],r[9],r[7],r[10]].join("")),t.i64.eq(t.i64.mod_(r[6],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[11]=",",r[12]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"loadAndEncryptProtobufV2",[r[8],r[11],r[9],r[11],r[10]].join(""),r[12],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[2],r[3]],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsLoadAndEncryptProtobufV2StoredProcedure",e.__tables__=["pending_protobuf_backups_context"],a.exports=e}),null);
__d("LSLogWebQpl.nop",["requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e=r("requireDeferred")("LogWebQplNOP").__setRef("LSLogWebQpl.nop"),s=function(n,r,o,a,i,l,s,u){return e.load().then(function(e){return e.call(o,a,i,l,s,u)})};s.__nop_name__="LSLogWebQpl",l.default=s}),98);
__d("WAHashStringToNumber",[],(function(t,n,r,o,a,i){"use strict";function e(e){for(var t=0,n=0;n<e.length;n++){var r=e.charCodeAt(n);t=(t<<5)-t+r,t|=0}return Math.abs(t)}i.hashStringToNumber=e}),66);
__d("LSQplAnnotateBool.nop",["EBMarkerIdToQPLEvent","Promise","QPLUserFlow","WAHashStringToNumber","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(a,i,l,s,u,c){try{var t,d=r("nullthrows")(o("EBMarkerIdToQPLEvent").markerIdToQPLEvent(l)),m=o("WAHashStringToNumber").hashStringToNumber(s);return r("QPLUserFlow").addAnnotations(d,{bool:(t={},t[u]=c,t)},{instanceKey:m}),(e||(e=n("Promise"))).resolve()}catch(t){return(e||(e=n("Promise"))).resolve()}};s.__nop_name__="LSQplAnnotateBool",l.default=s}),98);
__d("LSQplAnnotateString.nop",["EBMarkerIdToQPLEvent","Promise","QPLUserFlow","WAHashStringToNumber","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(a,i,l,s,u,c){try{var t,d=r("nullthrows")(o("EBMarkerIdToQPLEvent").markerIdToQPLEvent(l)),m=o("WAHashStringToNumber").hashStringToNumber(s);return r("QPLUserFlow").addAnnotations(d,{string:(t={},t[u]=c,t)},{instanceKey:m}),(e||(e=n("Promise"))).resolve()}catch(t){return(e||(e=n("Promise"))).resolve()}};s.__nop_name__="LSQplAnnotateString",l.default=s}),98);
__d("LSQplMarkEnd.nop",["EBMarkerIdToQPLEvent","Promise","QPLUserFlow","WAHashStringToNumber","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(a,i,l,s,u){try{var t=r("nullthrows")(o("EBMarkerIdToQPLEvent").markerIdToQPLEvent(l)),c=o("WAHashStringToNumber").hashStringToNumber(s);return u?r("QPLUserFlow").endSuccess(t,{instanceKey:c}):r("QPLUserFlow").endFailure(t,"failure",{instanceKey:c}),(e||(e=n("Promise"))).resolve()}catch(t){return(e||(e=n("Promise"))).resolve()}};s.__nop_name__="LSQplMarkEnd",l.default=s}),98);
__d("LSQplMarkPoint.nop",["EBMarkerIdToQPLEvent","Promise","QPLUserFlow","WAHashStringToNumber","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(a,i,l,s,u){try{var t=r("nullthrows")(o("EBMarkerIdToQPLEvent").markerIdToQPLEvent(l)),c=o("WAHashStringToNumber").hashStringToNumber(s);return r("QPLUserFlow").addPoint(t,u,{instanceKey:c}),(e||(e=n("Promise"))).resolve()}catch(t){return(e||(e=n("Promise"))).resolve()}};s.__nop_name__="LSQplMarkPoint",l.default=s}),98);
__d("LSQplStartTrace.nop",["EBMarkerIdToQPLEvent","Promise","QPLUserFlow","WAHashStringToNumber","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(a,i,l,s,u,c){try{var t=r("nullthrows")(o("EBMarkerIdToQPLEvent").markerIdToQPLEvent(l)),d=o("WAHashStringToNumber").hashStringToNumber(s);return r("QPLUserFlow").start(t,{instanceKey:d}),(e||(e=n("Promise"))).resolve()}catch(t){return(e||(e=n("Promise"))).resolve()}};s.__nop_name__="LSQplStartTrace",l.default=s}),98);
__d("LSSerializeBackupPayloadV2",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSDeriveValueSecretRefV2","LSEncryptIdentifiersV2","LSEncryptMessagePayloadV2","LSGetBlobFromString.nop","LSGetLatestEpochKeys","LSIsEncryptionVersionSecure","LSLoadAndEncryptProtobufV2","LSLogMebClientEvent.nop","LSLogWebQpl.nop","LSQplAnnotateBool.nop","LSQplAnnotateString.nop","LSQplMarkEnd.nop","LSQplMarkPoint.nop","LSQplStartTrace.nop","gkx"],(function(t,n,r,o,a,i,l){function e(){var e=arguments,t=e[e.length-1],o=[],a=[];return t.sequence([function(i){return t.sequence([function(n){return o[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][serializeBackupPayloadV2] Beginning execution."),o[1]=t.i64.of_float(Date.now()),o[19]=t.i64.mul(o[1],t.i64.cast([0,1e6])),o[2]=t.i64.random(),o[6]=t.i64.to_string(o[2]),t.db.table(2).fetch([[[e[0]]]]).next().then(function(e,t){var n=e.done,r=e.value;return n?o[3]=void 0:(t=r.item,o[3]=t.dataTraceId)})},function(e){return o[3]!==void 0?o[5]=o[3]:o[5]=void 0,o[6]!==void 0?t.nativeOperation(n("LSQplStartTrace.nop"),t.i64.cast([0,637746317]),o[6],!0,o[5]):t.resolve()},function(e){return o[6]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,637746317]),o[6],"LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure_start"):t.resolve()},function(e){return t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))||!1}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,n){var r,a,i=e.done,l=e.value;return i?(o[23]=new t.Map,o[23].set("error_msg","Expected a nonempty query result"),o[23].set("code",t.i64.cast([0,3])),o[23].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),o[24]=t.createArray(),o[25]=(o[24].push(o[23]),o[24]),r=[void 0,o[24]],o[7]=r[0],o[8]=r[1]):(n=l.item,o[23]=new t.Map,o[23].set("backup_id",n.backupId),o[23].set("device_public_key_blob",n.devicePublicKeyBlob),o[23].set("device_private_key_blob",n.devicePrivateKeyBlob),o[23].set("epoch_storage_public_key_blob",n.epochStoragePublicKeyBlob),o[23].set("epoch_storage_private_key_blob",n.epochStoragePrivateKeyBlob),o[23].set("epoch_auth_public_key_blob",n.epochAuthPublicKeyBlob),o[23].set("epoch_auth_private_key_blob",n.epochAuthPrivateKeyBlob),o[23].set("mailbox_root_key_blob",n.mailboxRootKeyBlob),o[23].set("ocmf_client_state_blob",n.ocmfClientStateBlob),o[23].set("orf_client_state_v2_blob",void 0),o[23].set("orf_v2_authority_level",void 0),o[23].set("oblivious_validation_token_blob",n.obliviousValidationTokenBlob),o[23].set("device_id",n.deviceId),o[23].set("backup_tenancy",n.backupTenancy),o[23].set("encryption_version",n.encryptionVersion),o[23].set("revision_version",n.revisionVersion),o[23].set("initialize_restore_result",void 0),o[23].set("device_creation_timestamp_sec",void 0),o[23].set("authority_level",n.authorityLevel),a=[o[23],void 0],o[7]=a[0],o[8]=a[1])})},function(a){return o[10]=new t.Map,o[10].set("value",o[7]),o[10].set("errors",o[8]),o[11]=o[10].get("value"),o[11]!==void 0?t.sequence([function(a){return o[23]=o[11].get("backup_id"),o[24]=o[11].get("device_public_key_blob"),o[25]=o[11].get("device_private_key_blob"),o[26]=o[11].get("epoch_storage_public_key_blob"),o[27]=o[11].get("epoch_storage_private_key_blob"),o[28]=o[11].get("epoch_auth_public_key_blob"),o[29]=o[11].get("epoch_auth_private_key_blob"),o[30]=o[11].get("mailbox_root_key_blob"),o[31]=o[11].get("ocmf_client_state_blob"),o[32]=o[11].get("orf_client_state_v2_blob"),o[33]=o[11].get("orf_v2_authority_level"),o[34]=o[11].get("oblivious_validation_token_blob"),o[35]=o[11].get("device_id"),o[36]=o[11].get("backup_tenancy"),o[37]=o[11].get("encryption_version"),o[38]=o[11].get("revision_version"),o[39]=o[11].get("initialize_restore_result"),o[40]=o[11].get("device_creation_timestamp_sec"),o[41]=o[11].get("authority_level"),t.i64.neq(o[35],void 0)?t.sequence([function(e){return o[46]=void 0,t.i64.neq(o[46],void 0)?t.resolve(o[47]=o[46]):t.sequence([function(e){return o[55]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,o[56]=t[0],t})},function(e){return o[56]&&(o[65]=(o[55].push(t.i64.cast([0,0])),o[55])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,o[57]=t[0],t})},function(e){return o[57]&&(o[65]=(o[55].push(t.i64.cast([0,2])),o[55])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,o[58]=t[0],t})},function(e){return o[58]&&(o[65]=(o[55].push(t.i64.cast([0,3])),o[55])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,o[59]=t[0],t})},function(e){return o[59]&&(o[65]=(o[55].push(t.i64.cast([0,4])),o[55])),o[60]=t.createArray(),o[61]=t.i64.of_int32(o[55].length),t.i64.gt(o[61],t.i64.cast([0,0]))?t.loopAsync(o[61],function(e){return o[65]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[55],o[65]).then(function(e){var t;return t=e,o[66]=t[0],o[67]=t[1],t})},function(e){return o[68]=(o[60].push(o[66]),o[60])}])}):t.resolve()},function(e){return t.sequence([function(e){return o[65]=t.createArray(),o[66]=t.i64.of_int32(o[60].length),t.i64.gt(o[66],t.i64.cast([0,0]))?t.loopAsync(o[66],function(e){return o[68]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[60],o[68]).then(function(e){var t;return t=e,o[69]=t[0],o[70]=t[1],t})},function(e){return o[71]=(o[65].push(t.i64.to_string(o[69])),o[65])}])}):t.resolve()},function(e){return o[67]=o[65].join(","),o[62]=o[67]}])},function(e){return o[60].some(function(e){return t.i64.eq(o[37],e)})?o[63]=o[37]:o[63]=void 0,t.i64.neq(o[63],void 0)?o[64]=o[63]:o[64]=void 0,o[47]=o[64]}])},function(a){return t.i64.neq(o[47],void 0)?o[48]=o[47]:o[48]=t.i64.cast([0,0]),t.i64.neq(o[36],void 0)?o[49]=o[36]:o[49]=t.i64.cast([0,1]),t.db.table(177).fetch([[[e[0]]],"fk_pending_tasks"]).next().then(function(a,i){var l=a.done,s=a.value;return l?t.sequence([function(n){return t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,r){var a,i,l=n.done,s=n.value;return l?(o[67]=t.i64.of_float(Date.now()),a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(o[67],t.i64.cast([0,1e6])),o[19]),void 0],o[55]=a[0],o[56]=a[1],o[57]=a[2],o[58]=a[3],o[59]=a[4],o[60]=a[5],o[61]=a[6]):(r=s.item,o[67]=t.i64.of_float(Date.now()),i=[e[0],r.queueName,r.enqueueTimestampMs,void 0,r.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(o[67],t.i64.cast([0,1e6])),o[19]),void 0],o[55]=i[0],o[56]=i[1],o[57]=i[2],o[58]=i[3],o[59]=i[4],o[60]=i[5],o[61]=i[6])})},function(e){return o[63]=new t.Map,o[63].set("task_id",o[55]),o[63].set("queue_name",o[56]),o[63].set("enqueue_timestamp_ms",o[57]),o[63].set("priority",o[58]),o[63].set("first_executed_timestamp_ms",o[59]),o[63].set("execution_time_ns",o[60]),o[63].set("echo_encoding_execution_time_ns",o[61]),o[64]=new t.Map,o[64].set("task_metadata",o[63]),o[64].set("action_type",void 0),o[64].set("content_type",void 0),o[64].set("identifiers",void 0),o[64].set("identifiers_v2",void 0),o[64].set("task_creation_source",void 0),o[64].set("message_payload_source",t.i64.cast([0,2])),o[65]=new t.Map,o[65].set("error_code",t.i64.cast([0,5])),o[65].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),o[65].set("error_message","Pending backup context row not found"),o[65]!==void 0?(o[67]=o[65].get("stored_procedure"),o[68]=o[65].get("error_code"),o[69]=o[65].get("error_message"),o[70]=".",o[71]=[o[67],o[70],t.i64.to_string(o[68]),o[70],o[69]].join(""),o[6]!==void 0&&o[71]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),o[6],"exception_error",o[71]):t.resolve()):t.resolve()},function(e){return t.resolve()},function(e){return o[6]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,637746317]),o[6],!1):t.resolve()},function(e){var n;return o[66]=t.createArray(),n=[void 0,o[65],o[64],o[66]],o[50]=n[0],o[51]=n[1],o[52]=n[2],o[53]=n[3]}]):(i=s.item,t.sequence([function(n){return o[62]=i.actionType,o[63]=i.contentType,o[68]=i.echoContent,o[69]=i.lsTraceId,o[67]=i.echoEncodingLatencyNs,o[66]=i.attachmentPayload,o[70]=i.tamThreadSubtype,o[71]=i.isInstamadillo,o[55]=new t.Map,o[55].set("backup_id",t.i64.to_string(o[23])),o[55].set("act_thread_id",i.listKey),o[55].set("timestamp",i.sortKey),o[55].set("otid",i.uniqueKey),t.filter(t.db.table(305).fetch(),function(n){return t.i64.eq(n.pendingBackupTaskId,e[0])}).next().then(function(e,t){var n=e.done,r=e.value;return n?o[56]=!1:(t=r.item,o[55].set("supplemental_otid",t.supplementalOfflineThreadingId),o[55].set("deletion_otid",t.deletionOfflineThreadingId),o[56]=!0)})},function(e){return o[65]=t.i64.eq(void 0,void 0),o[6]!==void 0?t.nativeOperation(n("LSQplAnnotateBool.nop"),t.i64.cast([0,637746317]),o[6],"should_run_device_timestamp_sync",o[65]):t.resolve()},function(a){return o[64]=i.error==null?t.i64.cast([0,0]):i.error,[t.i64.cast([0,0]),t.i64.cast([0,32])].some(function(e){return t.i64.eq(o[64],e)})?t.sequence([function(e){return o[72]=o[55].get("act_thread_id"),o[73]=o[55].get("otid"),t.storedProcedure(n("LSGetLatestEpochKeys"),!1).then(function(e){var t;return t=e,o[74]=t[0],o[75]=t[1],t})},function(e){var r;return o[74]!==void 0?t.sequence([function(e){return t.i64.eq(o[63],t.i64.cast([0,1]))?t.sequence([function(e){return o[85]=t.createArray(),o[90]=(o[85].push(t.i64.cast([0,32])),o[85]),t.nativeOperation(n("LSGetBlobFromString.nop"),["thread_ope_key","_",o[72]].join("")).then(function(e){var t;return t=e,o[86]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),o[86],void 0,o[30],o[85]).then(function(e){var t;return t=e,o[87]=t[0],t})},function(e){return o[87]?o[88]=!1:o[88]=!0,o[88]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),o[91]="Got null keys while deriving message list OPE key. Returning null blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoUtils] ","",o[91]].join("")),o[90]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoUtils",o[91],o[90],t.i64.cast([0,3]))},function(e){return o[89]=void 0}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[87],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[90]=t[0],o[91]=t[1],t})},function(e){return o[89]=o[90]}])},function(e){return o[82]=o[89]}]):t.sequence([function(e){return t.i64.eq(o[62],t.i64.cast([0,2]))?t.sequence([function(e){return o[86]=t.createArray(),o[91]=(o[86].push(t.i64.cast([0,32])),o[86]),t.nativeOperation(n("LSGetBlobFromString.nop"),["thread_ope_key","_",o[73]].join("")).then(function(e){var t;return t=e,o[87]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),o[87],void 0,o[30],o[86]).then(function(e){var t;return t=e,o[88]=t[0],t})},function(e){return o[88]?o[89]=!1:o[89]=!0,o[89]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),o[92]="Got null keys while deriving message list OPE key. Returning null blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoUtils] ","",o[92]].join("")),o[91]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoUtils",o[92],o[91],t.i64.cast([0,3]))},function(e){return o[90]=void 0}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[88],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[91]=t[0],o[92]=t[1],t})},function(e){return o[90]=o[91]}])},function(e){return o[85]=o[90]}]):t.resolve(o[85]=void 0)},function(e){return o[82]=o[85]}])},function(e){var r;return t.blobs.neq(o[82],void 0)?t.sequence([function(e){return o[85]=o[74].get("epoch_keys"),o[86]=o[85].get("epoch_anon_id"),o[87]=o[85].get("epoch_root_key"),o[88]=t.createArray(),o[103]=(o[88].push(t.i64.cast([0,32])),o[88]),t.i64.ge(o[48],t.i64.cast([0,3]))?t.resolve(o[89]=void 0):t.sequence([function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),o[72]).then(function(e){var t;return t=e,o[103]=t[0],t})},function(e){return o[89]=o[103]}])},function(e){return t.i64.ge(o[48],t.i64.cast([0,4]))?(o[103]="_",o[90]=["message_key_in_epoch",o[103],t.blobs.to_string(o[86]),o[103],"cipher_version",o[103],t.i64.to_string(o[48]),o[103],"thread",o[103],o[72]==null?"":o[72]].join("")):(t.i64.ge(o[48],t.i64.cast([0,3]))?(o[104]="_",o[103]=["message_key_in_epoch",o[104],t.blobs.to_string(o[86]),o[104],"cipher_version",o[104],t.i64.to_string(o[48]),o[104],"thread",o[104],o[72]==null?"":o[72]].join("")):(t.i64.ge(o[48],t.i64.cast([0,2]))?(o[105]="_",o[104]=["message_key_in_epoch",o[105],t.blobs.to_string(o[86]),o[105],"cipher_version",o[105],t.i64.to_string(o[48])].join("")):o[104]=["message_key_in_epoch","_",t.blobs.to_string(o[86])].join(""),o[103]=o[104]),o[90]=o[103]),t.nativeOperation(n("LSGetBlobFromString.nop"),o[90]).then(function(e){var t;return t=e,o[91]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),o[91],o[89],o[87],o[88]).then(function(e){var t;return t=e,o[92]=t[0],t})},function(e){return o[92]?o[93]=!1:o[93]=!0,o[93]?t.resolve(o[94]=void 0):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[92],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[103]=t[0],o[104]=t[1],t})},function(e){return o[94]=o[103]}])},function(e){return t.filter(t.db.table(169).fetch(),function(e){return t.blobs.eq(e.epochAnonIdBlob,t.blob("MA=="))}).next().then(function(e,n){var r,a,i=e.done,l=e.value;return i?(o[103]=new t.Map,o[103].set("error_msg","Expected a nonempty query result"),o[103].set("code",t.i64.cast([0,3])),o[103].set("src_line","MEBEpochClientUtils.php:556 MEBEpochClientUtils::maybeEpochWithAnonIDFromPersistentEpochsTableDirectly()"),o[104]=t.createArray(),o[105]=(o[104].push(o[103]),o[104]),r=[void 0,o[104]],o[95]=r[0],o[96]=r[1]):(n=l.item,o[103]=new t.Map,o[103].set("epoch_id",n.epochId),o[103].set("backup_id",n.backupId),o[103].set("epoch_anon_id_blob",n.epochAnonIdBlob),o[103].set("epoch_root_key_blob",n.epochRootKeyBlob),o[103].set("epoch_status",n.epochStatus),o[103].set("epoch_head",n.epochHead),o[103].set("authority_level",n.authorityLevel),a=[o[103],void 0],o[95]=a[0],o[96]=a[1])})},function(e){return o[98]=new t.Map,o[98].set("value",o[95]),o[98].set("errors",o[96]),o[99]=o[98].get("value"),o[99]!==void 0?t.sequence([function(e){return o[103]=o[99].get("epoch_id"),o[104]=o[99].get("backup_id"),o[105]=o[99].get("epoch_anon_id_blob"),o[106]=o[99].get("epoch_root_key_blob"),o[107]=o[99].get("epoch_status"),o[108]=o[99].get("epoch_head"),o[109]=o[99].get("authority_level"),o[110]=t.createArray(),o[118]=(o[110].push(t.i64.cast([0,32])),o[110]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleT5zYWx0X21haWxib3hfcm9vdF9rZXlfdjI="),void 0,o[30],o[110]).then(function(e){var t;return t=e,o[111]=t[0],t})},function(e){return o[111]!==void 0?t.sequence([function(e){return o[118]=t.i64.of_int32(o[111].length),t.i64.ge(o[118],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[111],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[120]=t[0],o[121]=t[1],t})},function(e){return o[119]=o[120]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),o[121]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoUtils] ","",o[121]].join("")),o[120]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoUtils",o[121],o[120],t.i64.cast([0,3]))},function(e){return o[119]=void 0}])},function(e){return o[112]=o[119]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),o[119]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoUtils] ","",o[119]].join("")),o[118]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoUtils",o[119],o[118],t.i64.cast([0,3]))},function(e){return o[112]=void 0}])},function(e){return t.blobs.neq(o[112],void 0)?o[113]=!0:o[113]=!1,o[113]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),o[114]=t.createArray(),o[118]=(o[114].push(t.i64.cast([0,32])),o[114]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleT5tYWlsYm94X3Jvb3Rfa2V5X3Yy"),o[112],o[106],o[114]).then(function(e){var t;return t=e,o[115]=t[0],t})},function(e){return o[115]!==void 0?t.sequence([function(e){return o[118]=t.i64.of_int32(o[115].length),t.i64.ge(o[118],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[115],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[120]=t[0],o[121]=t[1],t})},function(e){return o[119]=o[120]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),o[121]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoUtils] ","",o[121]].join("")),o[120]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoUtils",o[121],o[120],t.i64.cast([0,3]))},function(e){return o[119]=void 0}])},function(e){return o[116]=o[119]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),o[119]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoUtils] ","",o[119]].join("")),o[118]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoUtils",o[119],o[118],t.i64.cast([0,3]))},function(e){return o[116]=void 0}])},function(e){return t.blobs.neq(o[116],void 0)?o[117]=!0:o[117]=!1,o[117]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),o[100]=o[116]}]):t.sequence([function(e){return o[103]=o[98].get("errors"),o[104]=o[98].get("errors"),(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBEpochClientUtils] Failed to get mailbox_root_key_v2: epoch 0 is not available."),o[106]="Failed to get mailbox_root_key_v2: epoch 0 is not available.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochClientUtils] ","",o[106]].join("")),o[105]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochClientUtils",o[106],o[105],t.i64.cast([0,3]))},function(e){return o[100]=void 0}])},function(e){var r;return t.blobs.neq(o[94],void 0)?t.sequence([function(e){return t.blobs.neq(o[100],void 0)?t.sequence([function(e){return o[109]=t.createArray(),o[113]=(o[109].push(t.i64.cast([0,32])),o[109]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleV92Mj5mYWxsYmFja19rZXk="),void 0,o[100],o[109]).then(function(e){var t;return t=e,o[110]=t[0],t})},function(e){return o[110]!==void 0?t.sequence([function(e){return o[113]=t.i64.of_int32(o[110].length),t.i64.ge(o[113],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[110],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[115]=t[0],o[116]=t[1],t})},function(e){return o[114]=o[115]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),o[116]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoUtils] ","",o[116]].join("")),o[115]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoUtils",o[116],o[115],t.i64.cast([0,3]))},function(e){return o[114]=void 0}])},function(e){return o[111]=o[114]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),o[114]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoUtils] ","",o[114]].join("")),o[113]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoUtils",o[114],o[113],t.i64.cast([0,3]))},function(e){return o[111]=void 0}])},function(e){return t.blobs.neq(o[111],void 0)?o[112]=!0:o[112]=!1,o[112]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),o[103]=o[111]}]):t.resolve(o[103]=void 0)},function(e){var n;return o[104]=o[85].get("epoch_root_key"),o[105]=o[85].get("epoch_anon_id"),o[106]=o[85].get("epoch_id"),o[107]=new t.Map,o[107].set("payload_key",o[94]),o[107].set("payload_fallback_key",o[103]),o[107].set("encryption_version",o[48]),o[107].set("epoch_root_key",o[104]),o[107].set("epoch_anon_id",o[105]),o[107].set("epoch_id",o[106]),o[108]=new t.Map,o[108].set("ope_key",o[82]),o[108].set("message_payload_encryption_keys",o[107]),o[108].set("ocmf_shared_key",o[31]),o[108].set("mailbox_base_salt",o[30]),o[108].set("mailbox_root_key_v2",o[100]),n=[o[108],void 0],o[101]=n[0],o[102]=n[1]}]):t.resolve((o[103]=new t.Map,o[103].set("error_code",t.i64.cast([0,26])),o[103].set("stored_procedure","MEBKeyDeriver"),o[103].set("error_message",""),r=[void 0,o[103]],o[101]=r[0],o[102]=r[1]))},function(e){var t;return t=[o[101],o[102]],o[83]=t[0],o[84]=t[1],t}]):t.resolve((o[85]=new t.Map,o[85].set("error_code",t.i64.cast([0,25])),o[85].set("stored_procedure","MEBKeyDeriver"),o[85].set("error_message",""),r=[void 0,o[85]],o[83]=r[0],o[84]=r[1]))},function(e){var t;return t=[o[83],o[84]],o[76]=t[0],o[77]=t[1],t}]):t.resolve((r=[void 0,o[75]],o[76]=r[0],o[77]=r[1],r))},function(a){return o[76]!==void 0?t.sequence([function(e){return o[82]=o[55].get("backup_id"),o[83]=o[55].get("act_thread_id"),o[84]=o[55].get("timestamp"),o[85]=o[55].get("otid"),t.storedProcedure(n("LSEncryptIdentifiersV2"),o[62],o[63],o[82],o[83],t.i64.from_string(o[84]),o[85],o[76]).then(function(e){var t;return t=e,o[86]=t[0],o[87]=t[1],t})},function(a){return o[86]!==void 0?t.sequence([function(r){return o[92]=o[55].get("act_thread_id"),t.storedProcedure(n("LSLoadAndEncryptProtobufV2"),e[0],o[76],o[92]).then(function(e){var t;return t=e,o[93]=t[0],o[94]=t[1],t})},function(a){return o[99]=t.i64.eq(o[64],t.i64.cast([0,32]))||!1||r("gkx")("12541")||!1,o[100]=o[93]!==void 0,o[99]&&o[100]?t.sequence([function(e){return o[101]=o[55].get("act_thread_id"),o[102]=o[55].get("backup_id"),t.storedProcedure(n("LSDeriveValueSecretRefV2"),o[101],o[102],o[76]).then(function(e){var t;return t=e,o[103]=t[0],o[104]=t[1],t})},function(r){return o[93]!==void 0?t.sequence([function(r){return o[103]!==void 0?t.sequence([function(e){return o[113]=o[103].get("value_secret_ref"),o[114]=o[86].get("act_thread_id_ocmf_partial"),o[115]=o[86].get("otid_ocmf_partial"),o[116]=o[86].get("timestamp_encrypted"),o[117]=new t.Map,o[117].set("list_key",o[114]),o[117].set("unique_key",o[115]),o[117].set("sort_key",o[116]),o[118]=void 0,o[119]=new t.Map,o[119].set("list_item_id",o[117]),o[119].set("list_item",o[118]),o[119].set("action_type",o[62]),o[120]=o[55].get("timestamp"),o[121]=o[55].get("otid"),o[122]=o[55].get("act_thread_id"),o[123]=o[55].get("supplemental_otid"),o[124]=o[55].get("deletion_otid"),o[125]=new t.Map,o[125].set("timestamp",o[120]),o[125].set("otid",o[121]),o[125].set("wa_thread_id",t.i64.from_string(o[122])),o[125].set("supplemental_otid",o[123]),o[125].set("deletion_otid",o[124]),o[126]=o[76].get("mailbox_base_salt"),t.nativeOperation(n("LSBase64Encode.nop"),o[126]).then(function(e){var t;return t=e,o[127]=t[0],t})},function(e){return o[128]=o[76].get("ocmf_shared_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[128]).then(function(e){var t;return t=e,o[129]=t[0],t})},function(e){return o[130]=new t.Map,o[130].set("mailbox_root_key",o[127]==null?"":o[127]),o[130].set("ocmf_client_state_blob",o[129]==null?"":o[129]),o[131]=o[86].get("backup_id_ocmf_partial"),o[132]=o[76].get("message_payload_encryption_keys"),o[133]=o[132].get("epoch_id"),o[134]=o[76].get("message_payload_encryption_keys"),o[135]=o[134].get("encryption_version"),o[150]=o[69]==null?"":o[69],o[136]=new t.Map,o[136].set("mailbox_partial_id",o[131]),o[136].set("action",o[119]),o[136].set("device_id",o[35]),o[136].set("echo_version",t.i64.cast([0,0])),o[136].set("epoch_id",o[133]),o[136].set("trace_id",void 0),o[136].set("encryption_version",o[135]),o[136].set("is_thread",t.i64.eq(o[63],t.i64.cast([0,2]))),o[136].set("raw_identifiers",o[125]),o[136].set("raw_tokens",o[130]),o[136].set("request_id",o[150]),o[136].set("tam_thread_subtype",o[70]==null?t.i64.cast([0,0]):o[70]),o[136].set("is_instamadillo",o[71]==null?!1:o[71]),o[136].set("should_run_device_creation_timestamp_sync",o[65]),o[136].set("value_secret_ref",o[113]),o[136].set("empty_echo_payload_reason",t.i64.cast([0,1])),o[93]!==void 0?t.sequence([function(e){return o[151]=o[93].get("supplemental_data_encrypted"),o[151]!==void 0?t.sequence([function(e){return o[153]=o[93].get("protobuf_encrypted"),o[154]=o[93].get("backup_action"),o[155]=o[93].get("timestamp_ms"),o[156]=o[151].get("sk_ciphertext"),t.nativeOperation(n("LSBase64Encode.nop"),o[156]).then(function(e){var t;return t=e,o[157]=t[0],t})},function(e){return o[158]=o[151].get("sk_hash"),t.nativeOperation(n("LSBase64Encode.nop"),o[158]).then(function(e){var t;return t=e,o[159]=t[0],t})},function(e){return o[160]=o[93].get("message_tags"),o[161]=o[93].get("maybe_ooo_supplemental_upload"),o[162]=new t.Map,o[162].set("supplementary_data_key",void 0),o[162].set("encrypted_protobuf",o[153]),o[162].set("key_value_backup_action",o[154]),o[162].set("protobuf_ts_ms",o[155]),o[162].set("supplemental_key_ciphertext",o[157]),o[162].set("supplemental_key_hash",o[159]),o[162].set("message_tags",o[160]),o[162].set("maybe_ooo_supplemental_upload",o[161]),o[152]=o[162]}]):t.resolve((o[153]=o[93].get("protobuf_encrypted"),o[154]=o[93].get("backup_action"),o[155]=o[93].get("timestamp_ms"),o[156]=o[93].get("message_tags"),o[157]=new t.Map,o[157].set("supplementary_data_key",void 0),o[157].set("encrypted_protobuf",o[153]),o[157].set("key_value_backup_action",o[154]),o[157].set("protobuf_ts_ms",o[155]),o[157].set("message_tags",o[156]),o[152]=o[157]))},function(e){return o[136].set("key_value_backup_payload",o[152])}]):t.resolve()},function(e){return o[66]!==void 0?t.resolve(o[136].set("attachment_backup_payload",o[66])):((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure] attachment_payload is null."),o[151]="payload_null",o[6]!==void 0&&o[151]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),o[6],"attachment_info",o[151]):t.resolve())},function(e){return o[6]!==void 0?t.nativeOperation(n("LSQplAnnotateBool.nop"),t.i64.cast([0,637746317]),o[6],"process_attachments_via_message_upload",!0):t.resolve()},function(e){return o[150]!==void 0?t.nativeOperation(n("LSLogWebQpl.nop"),o[150],t.i64.cast([0,521481602]),"upload_start",t.i64.cast([0,0]),void 0,void 0):t.resolve()},function(n){return o[137]=t.toJSON(o[136]),t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,r){var a,i,l=n.done,s=n.value;return l?(o[151]=t.i64.of_float(Date.now()),t.i64.eq(o[67],t.i64.cast([0,0]))||t.i64.eq(o[67],void 0)?o[152]=void 0:o[152]=o[67],a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(o[151],t.i64.cast([0,1e6])),o[19]),o[152]],o[138]=a[0],o[139]=a[1],o[140]=a[2],o[141]=a[3],o[142]=a[4],o[143]=a[5],o[144]=a[6]):(r=s.item,o[151]=t.i64.of_float(Date.now()),t.i64.eq(o[67],t.i64.cast([0,0]))||t.i64.eq(o[67],void 0)?o[152]=void 0:o[152]=o[67],i=[e[0],r.queueName,r.enqueueTimestampMs,void 0,r.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(o[151],t.i64.cast([0,1e6])),o[19]),o[152]],o[138]=i[0],o[139]=i[1],o[140]=i[2],o[141]=i[3],o[142]=i[4],o[143]=i[5],o[144]=i[6])})},function(e){return o[146]=new t.Map,o[146].set("task_id",o[138]),o[146].set("queue_name",o[139]),o[146].set("enqueue_timestamp_ms",o[140]),o[146].set("priority",o[141]),o[146].set("first_executed_timestamp_ms",o[142]),o[146].set("execution_time_ns",o[143]),o[146].set("echo_encoding_execution_time_ns",o[144]),o[147]=new t.Map,o[147].set("task_metadata",o[146]),o[147].set("action_type",o[62]),o[147].set("content_type",o[63]),o[147].set("identifiers",void 0),o[147].set("identifiers_v2",o[55]),o[147].set("task_creation_source",void 0),o[147].set("message_payload_source",t.i64.cast([0,2])),t.resolve()},function(e){return t.resolve()},function(e){return o[6]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,637746317]),o[6],!0):t.resolve()},function(e){var n;return o[148]=new t.Map,o[148].set("payload",o[137]),o[149]=t.createArray(),o[151]=(o[149].push(void 0),o[149]),n=[o[148],void 0,o[147],o[149]],o[109]=n[0],o[110]=n[1],o[111]=n[2],o[112]=n[3]}]):t.sequence([function(n){return t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,r){var a,i,l=n.done,s=n.value;return l?(o[124]=t.i64.of_float(Date.now()),t.i64.eq(o[67],t.i64.cast([0,0]))||t.i64.eq(o[67],void 0)?o[125]=void 0:o[125]=o[67],a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(o[124],t.i64.cast([0,1e6])),o[19]),o[125]],o[113]=a[0],o[114]=a[1],o[115]=a[2],o[116]=a[3],o[117]=a[4],o[118]=a[5],o[119]=a[6]):(r=s.item,o[124]=t.i64.of_float(Date.now()),t.i64.eq(o[67],t.i64.cast([0,0]))||t.i64.eq(o[67],void 0)?o[125]=void 0:o[125]=o[67],i=[e[0],r.queueName,r.enqueueTimestampMs,void 0,r.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(o[124],t.i64.cast([0,1e6])),o[19]),o[125]],o[113]=i[0],o[114]=i[1],o[115]=i[2],o[116]=i[3],o[117]=i[4],o[118]=i[5],o[119]=i[6])})},function(e){return o[121]=new t.Map,o[121].set("task_id",o[113]),o[121].set("queue_name",o[114]),o[121].set("enqueue_timestamp_ms",o[115]),o[121].set("priority",o[116]),o[121].set("first_executed_timestamp_ms",o[117]),o[121].set("execution_time_ns",o[118]),o[121].set("echo_encoding_execution_time_ns",o[119]),o[122]=new t.Map,o[122].set("task_metadata",o[121]),o[122].set("action_type",o[62]),o[122].set("content_type",o[63]),o[122].set("identifiers",void 0),o[122].set("identifiers_v2",o[55]),o[122].set("task_creation_source",void 0),o[122].set("message_payload_source",t.i64.cast([0,2])),o[104]!==void 0?(o[124]=o[104].get("stored_procedure"),o[125]=o[104].get("error_code"),o[126]=o[104].get("error_message"),o[127]=".",o[128]=[o[124],o[127],t.i64.to_string(o[125]),o[127],o[126]].join(""),o[6]!==void 0&&o[128]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),o[6],"exception_error",o[128]):t.resolve()):t.resolve()},function(e){return t.resolve()},function(e){return o[6]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,637746317]),o[6],!1):t.resolve()},function(e){var n;return o[123]=t.createArray(),o[124]=(o[123].push(void 0),o[123]),n=[void 0,o[104],o[122],o[123]],o[109]=n[0],o[110]=n[1],o[111]=n[2],o[112]=n[3]}])},function(e){var t;return t=[o[109],o[110],o[111],o[112]],o[105]=t[0],o[106]=t[1],o[107]=t[2],o[108]=t[3],t}]):t.sequence([function(n){return t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,r){var a,i,l=n.done,s=n.value;return l?(o[120]=t.i64.of_float(Date.now()),t.i64.eq(o[67],t.i64.cast([0,0]))||t.i64.eq(o[67],void 0)?o[121]=void 0:o[121]=o[67],a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(o[120],t.i64.cast([0,1e6])),o[19]),o[121]],o[109]=a[0],o[110]=a[1],o[111]=a[2],o[112]=a[3],o[113]=a[4],o[114]=a[5],o[115]=a[6]):(r=s.item,o[120]=t.i64.of_float(Date.now()),t.i64.eq(o[67],t.i64.cast([0,0]))||t.i64.eq(o[67],void 0)?o[121]=void 0:o[121]=o[67],i=[e[0],r.queueName,r.enqueueTimestampMs,void 0,r.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(o[120],t.i64.cast([0,1e6])),o[19]),o[121]],o[109]=i[0],o[110]=i[1],o[111]=i[2],o[112]=i[3],o[113]=i[4],o[114]=i[5],o[115]=i[6])})},function(e){return o[117]=new t.Map,o[117].set("task_id",o[109]),o[117].set("queue_name",o[110]),o[117].set("enqueue_timestamp_ms",o[111]),o[117].set("priority",o[112]),o[117].set("first_executed_timestamp_ms",o[113]),o[117].set("execution_time_ns",o[114]),o[117].set("echo_encoding_execution_time_ns",o[115]),o[118]=new t.Map,o[118].set("task_metadata",o[117]),o[118].set("action_type",o[62]),o[118].set("content_type",o[63]),o[118].set("identifiers",void 0),o[118].set("identifiers_v2",o[55]),o[118].set("task_creation_source",void 0),o[118].set("message_payload_source",t.i64.cast([0,2])),t.resolve()},function(e){return o[94]!==void 0?(o[120]=o[94].get("stored_procedure"),o[121]=o[94].get("error_code"),o[122]=o[94].get("error_message"),o[123]=".",o[124]=[o[120],o[123],t.i64.to_string(o[121]),o[123],o[122]].join(""),o[6]!==void 0&&o[124]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),o[6],"exception_error",o[124]):t.resolve()):t.resolve()},function(e){return o[6]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,637746317]),o[6],!1):t.resolve()},function(e){var n;return o[119]=t.createArray(),o[120]=(o[119].push(o[94]),o[119]),n=[void 0,void 0,o[118],o[119]],o[105]=n[0],o[106]=n[1],o[107]=n[2],o[108]=n[3]}])},function(e){var t;return t=[o[105],o[106],o[107],o[108]],o[95]=t[0],o[96]=t[1],o[97]=t[2],o[98]=t[3],t}]):t.sequence([function(r){return o[99]===!0&&o[100]===!1?t.sequence([function(n){return t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,r){var a,i,l=n.done,s=n.value;return l?(o[116]=t.i64.of_float(Date.now()),t.i64.eq(o[67],t.i64.cast([0,0]))||t.i64.eq(o[67],void 0)?o[117]=void 0:o[117]=o[67],a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(o[116],t.i64.cast([0,1e6])),o[19]),o[117]],o[105]=a[0],o[106]=a[1],o[107]=a[2],o[108]=a[3],o[109]=a[4],o[110]=a[5],o[111]=a[6]):(r=s.item,o[116]=t.i64.of_float(Date.now()),t.i64.eq(o[67],t.i64.cast([0,0]))||t.i64.eq(o[67],void 0)?o[117]=void 0:o[117]=o[67],i=[e[0],r.queueName,r.enqueueTimestampMs,void 0,r.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(o[116],t.i64.cast([0,1e6])),o[19]),o[117]],o[105]=i[0],o[106]=i[1],o[107]=i[2],o[108]=i[3],o[109]=i[4],o[110]=i[5],o[111]=i[6])})},function(e){return o[113]=new t.Map,o[113].set("task_id",o[105]),o[113].set("queue_name",o[106]),o[113].set("enqueue_timestamp_ms",o[107]),o[113].set("priority",o[108]),o[113].set("first_executed_timestamp_ms",o[109]),o[113].set("execution_time_ns",o[110]),o[113].set("echo_encoding_execution_time_ns",o[111]),o[114]=new t.Map,o[114].set("task_metadata",o[113]),o[114].set("action_type",o[62]),o[114].set("content_type",o[63]),o[114].set("identifiers",void 0),o[114].set("identifiers_v2",o[55]),o[114].set("task_creation_source",void 0),o[114].set("message_payload_source",t.i64.cast([0,2])),t.resolve()},function(e){return o[94]!==void 0?(o[116]=o[94].get("stored_procedure"),o[117]=o[94].get("error_code"),o[118]=o[94].get("error_message"),o[119]=".",o[120]=[o[116],o[119],t.i64.to_string(o[117]),o[119],o[118]].join(""),o[6]!==void 0&&o[120]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),o[6],"exception_error",o[120]):t.resolve()):t.resolve()},function(e){return o[6]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,637746317]),o[6],!1):t.resolve()},function(e){var n;return o[115]=t.createArray(),o[116]=(o[115].push(o[94]),o[115]),n=[void 0,void 0,o[114],o[115]],o[101]=n[0],o[102]=n[1],o[103]=n[2],o[104]=n[3]}]):t.sequence([function(r){var a,i,l,s;return t.i64.eq(o[62],t.i64.cast([0,1]))?(o[113]=o[68]===""?void 0:o[68],o[113]!==void 0?(a=[o[113],void 0],o[111]=a[0],o[112]=a[1]):(o[114]=new t.Map,o[114].set("error_code",t.i64.cast([0,30])),o[114].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),o[114].set("error_message",""),i=[void 0,o[114]],o[111]=i[0],o[112]=i[1]),l=[o[111],o[112]],o[105]=l[0],o[106]=l[1]):(s=["",void 0],o[105]=s[0],o[106]=s[1]),o[105]!==void 0?t.sequence([function(e){var r;return t.i64.eq(o[62],t.i64.cast([0,1]))?t.sequence([function(e){return o[117]=o[55].get("backup_id"),o[118]=o[55].get("act_thread_id"),t.storedProcedure(n("LSEncryptMessagePayloadV2"),o[117],o[118],o[76],o[105]).then(function(e){var t;return t=e,o[119]=t[0],o[120]=t[1],t})},function(e){var t;return t=[o[119],o[120]],o[111]=t[0],o[112]=t[1],t}]):t.resolve((o[117]=new t.Map,o[117].set("encrypted_message_payload",""),o[117].set("value_secret_ref",""),r=[o[117],void 0],o[111]=r[0],o[112]=r[1]))},function(r){return o[111]!==void 0?t.sequence([function(e){return o[93]!==void 0&&t.i64.eq(o[62],t.i64.cast([0,2]))?t.sequence([function(e){return o[155]=o[55].get("act_thread_id"),o[156]=o[55].get("backup_id"),t.storedProcedure(n("LSDeriveValueSecretRefV2"),o[155],o[156],o[76]).then(function(e){var t;return t=e,o[157]=t[0],o[158]=t[1],t})},function(e){return o[157]!==void 0?(o[160]=o[157].get("value_secret_ref"),o[159]=o[160]):o[159]="",o[117]=o[159]}]):t.resolve(o[117]="")},function(e){return o[118]=o[86].get("act_thread_id_ocmf_partial"),o[119]=o[86].get("otid_ocmf_partial"),o[120]=o[86].get("timestamp_encrypted"),o[121]=new t.Map,o[121].set("list_key",o[118]),o[121].set("unique_key",o[119]),o[121].set("sort_key",o[120]),o[111]!==void 0?(o[155]=o[111].get("encrypted_message_payload"),o[156]=o[111].get("value_secret_ref"),o[157]=new t.Map,o[157].set("value",o[155]),o[157].set("value_secret_ref",o[156]),o[122]=o[157]):o[122]=void 0,o[123]=new t.Map,o[123].set("list_item_id",o[121]),o[123].set("list_item",o[122]),o[123].set("action_type",o[62]),o[124]=o[55].get("timestamp"),o[125]=o[55].get("otid"),o[126]=o[55].get("act_thread_id"),o[127]=o[55].get("supplemental_otid"),o[128]=o[55].get("deletion_otid"),o[129]=new t.Map,o[129].set("timestamp",o[124]),o[129].set("otid",o[125]),o[129].set("wa_thread_id",t.i64.from_string(o[126])),o[129].set("supplemental_otid",o[127]),o[129].set("deletion_otid",o[128]),o[130]=o[76].get("mailbox_base_salt"),t.nativeOperation(n("LSBase64Encode.nop"),o[130]).then(function(e){var t;return t=e,o[131]=t[0],t})},function(e){return o[132]=o[76].get("ocmf_shared_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[132]).then(function(e){var t;return t=e,o[133]=t[0],t})},function(e){return o[134]=new t.Map,o[134].set("mailbox_root_key",o[131]==null?"":o[131]),o[134].set("ocmf_client_state_blob",o[133]==null?"":o[133]),o[135]=o[86].get("backup_id_ocmf_partial"),o[136]=o[76].get("message_payload_encryption_keys"),o[137]=o[136].get("epoch_id"),o[138]=o[76].get("message_payload_encryption_keys"),o[139]=o[138].get("encryption_version"),o[154]=o[69]==null?"":o[69],o[140]=new t.Map,o[140].set("mailbox_partial_id",o[135]),o[140].set("action",o[123]),o[140].set("device_id",o[35]),o[140].set("echo_version",t.i64.cast([0,0])),o[140].set("epoch_id",o[137]),o[140].set("trace_id",void 0),o[140].set("encryption_version",o[139]),o[140].set("is_thread",t.i64.eq(o[63],t.i64.cast([0,2]))),o[140].set("raw_identifiers",o[129]),o[140].set("raw_tokens",o[134]),o[140].set("request_id",o[154]),o[140].set("tam_thread_subtype",o[70]==null?t.i64.cast([0,0]):o[70]),o[140].set("is_instamadillo",o[71]==null?!1:o[71]),o[140].set("should_run_device_creation_timestamp_sync",o[65]),o[140].set("value_secret_ref",o[117]),o[93]!==void 0?t.sequence([function(e){return o[155]=o[93].get("supplemental_data_encrypted"),o[155]!==void 0?t.sequence([function(e){return o[157]=o[93].get("protobuf_encrypted"),o[158]=o[93].get("backup_action"),o[159]=o[93].get("timestamp_ms"),o[160]=o[155].get("sk_ciphertext"),t.nativeOperation(n("LSBase64Encode.nop"),o[160]).then(function(e){var t;return t=e,o[161]=t[0],t})},function(e){return o[162]=o[155].get("sk_hash"),t.nativeOperation(n("LSBase64Encode.nop"),o[162]).then(function(e){var t;return t=e,o[163]=t[0],t})},function(e){return o[164]=o[93].get("message_tags"),o[165]=o[93].get("maybe_ooo_supplemental_upload"),o[166]=new t.Map,o[166].set("supplementary_data_key",void 0),o[166].set("encrypted_protobuf",o[157]),o[166].set("key_value_backup_action",o[158]),o[166].set("protobuf_ts_ms",o[159]),o[166].set("supplemental_key_ciphertext",o[161]),o[166].set("supplemental_key_hash",o[163]),o[166].set("message_tags",o[164]),o[166].set("maybe_ooo_supplemental_upload",o[165]),o[156]=o[166]}]):t.resolve((o[157]=o[93].get("protobuf_encrypted"),o[158]=o[93].get("backup_action"),o[159]=o[93].get("timestamp_ms"),o[160]=o[93].get("message_tags"),o[161]=new t.Map,o[161].set("supplementary_data_key",void 0),o[161].set("encrypted_protobuf",o[157]),o[161].set("key_value_backup_action",o[158]),o[161].set("protobuf_ts_ms",o[159]),o[161].set("message_tags",o[160]),o[156]=o[161]))},function(e){return o[140].set("key_value_backup_payload",o[156])}]):t.resolve()},function(e){return o[66]!==void 0?t.resolve(o[140].set("attachment_backup_payload",o[66])):((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure] attachment_payload is null."),o[155]="payload_null",o[6]!==void 0&&o[155]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),o[6],"attachment_info",o[155]):t.resolve())},function(e){return o[6]!==void 0?t.nativeOperation(n("LSQplAnnotateBool.nop"),t.i64.cast([0,637746317]),o[6],"process_attachments_via_message_upload",!0):t.resolve()},function(e){return o[154]!==void 0?t.nativeOperation(n("LSLogWebQpl.nop"),o[154],t.i64.cast([0,521481602]),"upload_start",t.i64.cast([0,0]),void 0,void 0):t.resolve()},function(n){return o[141]=t.toJSON(o[140]),t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,r){var a,i,l=n.done,s=n.value;return l?(o[155]=t.i64.of_float(Date.now()),t.i64.eq(o[67],t.i64.cast([0,0]))||t.i64.eq(o[67],void 0)?o[156]=void 0:o[156]=o[67],a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(o[155],t.i64.cast([0,1e6])),o[19]),o[156]],o[142]=a[0],o[143]=a[1],o[144]=a[2],o[145]=a[3],o[146]=a[4],o[147]=a[5],o[148]=a[6]):(r=s.item,o[155]=t.i64.of_float(Date.now()),t.i64.eq(o[67],t.i64.cast([0,0]))||t.i64.eq(o[67],void 0)?o[156]=void 0:o[156]=o[67],i=[e[0],r.queueName,r.enqueueTimestampMs,void 0,r.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(o[155],t.i64.cast([0,1e6])),o[19]),o[156]],o[142]=i[0],o[143]=i[1],o[144]=i[2],o[145]=i[3],o[146]=i[4],o[147]=i[5],o[148]=i[6])})},function(e){return o[150]=new t.Map,o[150].set("task_id",o[142]),o[150].set("queue_name",o[143]),o[150].set("enqueue_timestamp_ms",o[144]),o[150].set("priority",o[145]),o[150].set("first_executed_timestamp_ms",o[146]),o[150].set("execution_time_ns",o[147]),o[150].set("echo_encoding_execution_time_ns",o[148]),o[151]=new t.Map,o[151].set("task_metadata",o[150]),o[151].set("action_type",o[62]),o[151].set("content_type",o[63]),o[151].set("identifiers",void 0),o[151].set("identifiers_v2",o[55]),o[151].set("task_creation_source",void 0),o[151].set("message_payload_source",t.i64.cast([0,2])),t.resolve()},function(e){return o[94]!==void 0?(o[155]=o[94].get("stored_procedure"),o[156]=o[94].get("error_code"),o[157]=o[94].get("error_message"),o[158]=".",o[159]=[o[155],o[158],t.i64.to_string(o[156]),o[158],o[157]].join(""),o[6]!==void 0&&o[159]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),o[6],"exception_error",o[159]):t.resolve()):t.resolve()},function(e){return o[6]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,637746317]),o[6],!0):t.resolve()},function(e){var n;return o[152]=new t.Map,o[152].set("payload",o[141]),o[153]=t.createArray(),o[155]=(o[153].push(o[94]),o[153]),n=[o[152],void 0,o[151],o[153]],o[113]=n[0],o[114]=n[1],o[115]=n[2],o[116]=n[3]}]):t.sequence([function(n){return t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,r){var a,i,l=n.done,s=n.value;return l?(o[128]=t.i64.of_float(Date.now()),t.i64.eq(o[67],t.i64.cast([0,0]))||t.i64.eq(o[67],void 0)?o[129]=void 0:o[129]=o[67],a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(o[128],t.i64.cast([0,1e6])),o[19]),o[129]],o[117]=a[0],o[118]=a[1],o[119]=a[2],o[120]=a[3],o[121]=a[4],o[122]=a[5],o[123]=a[6]):(r=s.item,o[128]=t.i64.of_float(Date.now()),t.i64.eq(o[67],t.i64.cast([0,0]))||t.i64.eq(o[67],void 0)?o[129]=void 0:o[129]=o[67],i=[e[0],r.queueName,r.enqueueTimestampMs,void 0,r.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(o[128],t.i64.cast([0,1e6])),o[19]),o[129]],o[117]=i[0],o[118]=i[1],o[119]=i[2],o[120]=i[3],o[121]=i[4],o[122]=i[5],o[123]=i[6])})},function(e){return o[125]=new t.Map,o[125].set("task_id",o[117]),o[125].set("queue_name",o[118]),o[125].set("enqueue_timestamp_ms",o[119]),o[125].set("priority",o[120]),o[125].set("first_executed_timestamp_ms",o[121]),o[125].set("execution_time_ns",o[122]),o[125].set("echo_encoding_execution_time_ns",o[123]),o[126]=new t.Map,o[126].set("task_metadata",o[125]),o[126].set("action_type",o[62]),o[126].set("content_type",o[63]),o[126].set("identifiers",void 0),o[126].set("identifiers_v2",o[55]),o[126].set("task_creation_source",void 0),o[126].set("message_payload_source",t.i64.cast([0,2])),o[112]!==void 0?(o[128]=o[112].get("stored_procedure"),o[129]=o[112].get("error_code"),o[130]=o[112].get("error_message"),o[131]=".",o[132]=[o[128],o[131],t.i64.to_string(o[129]),o[131],o[130]].join(""),o[6]!==void 0&&o[132]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),o[6],"exception_error",o[132]):t.resolve()):t.resolve()},function(e){return o[94]!==void 0?(o[128]=o[94].get("stored_procedure"),o[129]=o[94].get("error_code"),o[130]=o[94].get("error_message"),o[131]=".",o[132]=[o[128],o[131],t.i64.to_string(o[129]),o[131],o[130]].join(""),o[6]!==void 0&&o[132]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),o[6],"exception_error",o[132]):t.resolve()):t.resolve()},function(e){return o[6]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,637746317]),o[6],!1):t.resolve()},function(e){var n;return o[127]=t.createArray(),o[128]=(o[127].push(o[94]),o[127]),n=[void 0,o[112],o[126],o[127]],o[113]=n[0],o[114]=n[1],o[115]=n[2],o[116]=n[3]}])},function(e){var t;return t=[o[113],o[114],o[115],o[116]],o[107]=t[0],o[108]=t[1],o[109]=t[2],o[110]=t[3],t}]):t.sequence([function(n){return t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,r){var a,i,l=n.done,s=n.value;return l?(o[122]=t.i64.of_float(Date.now()),t.i64.eq(o[67],t.i64.cast([0,0]))||t.i64.eq(o[67],void 0)?o[123]=void 0:o[123]=o[67],a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(o[122],t.i64.cast([0,1e6])),o[19]),o[123]],o[111]=a[0],o[112]=a[1],o[113]=a[2],o[114]=a[3],o[115]=a[4],o[116]=a[5],o[117]=a[6]):(r=s.item,o[122]=t.i64.of_float(Date.now()),t.i64.eq(o[67],t.i64.cast([0,0]))||t.i64.eq(o[67],void 0)?o[123]=void 0:o[123]=o[67],i=[e[0],r.queueName,r.enqueueTimestampMs,void 0,r.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(o[122],t.i64.cast([0,1e6])),o[19]),o[123]],o[111]=i[0],o[112]=i[1],o[113]=i[2],o[114]=i[3],o[115]=i[4],o[116]=i[5],o[117]=i[6])})},function(e){return o[119]=new t.Map,o[119].set("task_id",o[111]),o[119].set("queue_name",o[112]),o[119].set("enqueue_timestamp_ms",o[113]),o[119].set("priority",o[114]),o[119].set("first_executed_timestamp_ms",o[115]),o[119].set("execution_time_ns",o[116]),o[119].set("echo_encoding_execution_time_ns",o[117]),o[120]=new t.Map,o[120].set("task_metadata",o[119]),o[120].set("action_type",o[62]),o[120].set("content_type",o[63]),o[120].set("identifiers",void 0),o[120].set("identifiers_v2",o[55]),o[120].set("task_creation_source",void 0),o[120].set("message_payload_source",t.i64.cast([0,2])),o[106]!==void 0?(o[122]=o[106].get("stored_procedure"),o[123]=o[106].get("error_code"),o[124]=o[106].get("error_message"),o[125]=".",o[126]=[o[122],o[125],t.i64.to_string(o[123]),o[125],o[124]].join(""),o[6]!==void 0&&o[126]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),o[6],"exception_error",o[126]):t.resolve()):t.resolve()},function(e){return o[94]!==void 0?(o[122]=o[94].get("stored_procedure"),o[123]=o[94].get("error_code"),o[124]=o[94].get("error_message"),o[125]=".",o[126]=[o[122],o[125],t.i64.to_string(o[123]),o[125],o[124]].join(""),o[6]!==void 0&&o[126]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),o[6],"exception_error",o[126]):t.resolve()):t.resolve()},function(e){return o[6]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,637746317]),o[6],!1):t.resolve()},function(e){var n;return o[121]=t.createArray(),o[122]=(o[121].push(o[94]),o[121]),n=[void 0,o[106],o[120],o[121]],o[107]=n[0],o[108]=n[1],o[109]=n[2],o[110]=n[3]}])},function(e){var t;return t=[o[107],o[108],o[109],o[110]],o[101]=t[0],o[102]=t[1],o[103]=t[2],o[104]=t[3],t}])},function(e){var t;return t=[o[101],o[102],o[103],o[104]],o[95]=t[0],o[96]=t[1],o[97]=t[2],o[98]=t[3],t}])},function(e){var t;return t=[o[95],o[96],o[97],o[98]],o[88]=t[0],o[89]=t[1],o[90]=t[2],o[91]=t[3],t}]):t.sequence([function(n){return t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,r){var a,i,l=n.done,s=n.value;return l?(o[103]=t.i64.of_float(Date.now()),t.i64.eq(o[67],t.i64.cast([0,0]))||t.i64.eq(o[67],void 0)?o[104]=void 0:o[104]=o[67],a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(o[103],t.i64.cast([0,1e6])),o[19]),o[104]],o[92]=a[0],o[93]=a[1],o[94]=a[2],o[95]=a[3],o[96]=a[4],o[97]=a[5],o[98]=a[6]):(r=s.item,o[103]=t.i64.of_float(Date.now()),t.i64.eq(o[67],t.i64.cast([0,0]))||t.i64.eq(o[67],void 0)?o[104]=void 0:o[104]=o[67],i=[e[0],r.queueName,r.enqueueTimestampMs,void 0,r.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(o[103],t.i64.cast([0,1e6])),o[19]),o[104]],o[92]=i[0],o[93]=i[1],o[94]=i[2],o[95]=i[3],o[96]=i[4],o[97]=i[5],o[98]=i[6])})},function(e){return o[100]=new t.Map,o[100].set("task_id",o[92]),o[100].set("queue_name",o[93]),o[100].set("enqueue_timestamp_ms",o[94]),o[100].set("priority",o[95]),o[100].set("first_executed_timestamp_ms",o[96]),o[100].set("execution_time_ns",o[97]),o[100].set("echo_encoding_execution_time_ns",o[98]),o[101]=new t.Map,o[101].set("task_metadata",o[100]),o[101].set("action_type",o[62]),o[101].set("content_type",o[63]),o[101].set("identifiers",void 0),o[101].set("identifiers_v2",o[55]),o[101].set("task_creation_source",void 0),o[101].set("message_payload_source",t.i64.cast([0,2])),o[87]!==void 0?(o[103]=o[87].get("stored_procedure"),o[104]=o[87].get("error_code"),o[105]=o[87].get("error_message"),o[106]=".",o[107]=[o[103],o[106],t.i64.to_string(o[104]),o[106],o[105]].join(""),o[6]!==void 0&&o[107]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),o[6],"exception_error",o[107]):t.resolve()):t.resolve()},function(e){return t.resolve()},function(e){return o[6]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,637746317]),o[6],!1):t.resolve()},function(e){var n;return o[102]=t.createArray(),o[103]=(o[102].push(void 0),o[102]),n=[void 0,o[87],o[101],o[102]],o[88]=n[0],o[89]=n[1],o[90]=n[2],o[91]=n[3]}])},function(e){var t;return t=[o[88],o[89],o[90],o[91]],o[78]=t[0],o[79]=t[1],o[80]=t[2],o[81]=t[3],t}]):t.sequence([function(n){return t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,r){var a,i,l=n.done,s=n.value;return l?(o[93]=t.i64.of_float(Date.now()),t.i64.eq(o[67],t.i64.cast([0,0]))||t.i64.eq(o[67],void 0)?o[94]=void 0:o[94]=o[67],a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(o[93],t.i64.cast([0,1e6])),o[19]),o[94]],o[82]=a[0],o[83]=a[1],o[84]=a[2],o[85]=a[3],o[86]=a[4],o[87]=a[5],o[88]=a[6]):(r=s.item,o[93]=t.i64.of_float(Date.now()),t.i64.eq(o[67],t.i64.cast([0,0]))||t.i64.eq(o[67],void 0)?o[94]=void 0:o[94]=o[67],i=[e[0],r.queueName,r.enqueueTimestampMs,void 0,r.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(o[93],t.i64.cast([0,1e6])),o[19]),o[94]],o[82]=i[0],o[83]=i[1],o[84]=i[2],o[85]=i[3],o[86]=i[4],o[87]=i[5],o[88]=i[6])})},function(e){return o[90]=new t.Map,o[90].set("task_id",o[82]),o[90].set("queue_name",o[83]),o[90].set("enqueue_timestamp_ms",o[84]),o[90].set("priority",o[85]),o[90].set("first_executed_timestamp_ms",o[86]),o[90].set("execution_time_ns",o[87]),o[90].set("echo_encoding_execution_time_ns",o[88]),o[91]=new t.Map,o[91].set("task_metadata",o[90]),o[91].set("action_type",o[62]),o[91].set("content_type",o[63]),o[91].set("identifiers",void 0),o[91].set("identifiers_v2",o[55]),o[91].set("task_creation_source",void 0),o[91].set("message_payload_source",t.i64.cast([0,2])),o[77]!==void 0?(o[93]=o[77].get("stored_procedure"),o[94]=o[77].get("error_code"),o[95]=o[77].get("error_message"),o[96]=".",o[97]=[o[93],o[96],t.i64.to_string(o[94]),o[96],o[95]].join(""),o[6]!==void 0&&o[97]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),o[6],"exception_error",o[97]):t.resolve()):t.resolve()},function(e){return t.resolve()},function(e){return o[6]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,637746317]),o[6],!1):t.resolve()},function(e){var n;return o[92]=t.createArray(),o[93]=(o[92].push(void 0),o[92]),n=[void 0,o[77],o[91],o[92]],o[78]=n[0],o[79]=n[1],o[80]=n[2],o[81]=n[3]}])},function(e){var t;return t=[o[78],o[79],o[80],o[81]],o[58]=t[0],o[59]=t[1],o[60]=t[2],o[61]=t[3],t}]):t.sequence([function(n){return t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,r){var a,i,l=n.done,s=n.value;return l?(o[84]=t.i64.of_float(Date.now()),t.i64.eq(o[67],t.i64.cast([0,0]))||t.i64.eq(o[67],void 0)?o[85]=void 0:o[85]=o[67],a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(o[84],t.i64.cast([0,1e6])),o[19]),o[85]],o[72]=a[0],o[73]=a[1],o[74]=a[2],o[75]=a[3],o[76]=a[4],o[77]=a[5],o[78]=a[6]):(r=s.item,o[84]=t.i64.of_float(Date.now()),t.i64.eq(o[67],t.i64.cast([0,0]))||t.i64.eq(o[67],void 0)?o[85]=void 0:o[85]=o[67],i=[e[0],r.queueName,r.enqueueTimestampMs,void 0,r.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(o[84],t.i64.cast([0,1e6])),o[19]),o[85]],o[72]=i[0],o[73]=i[1],o[74]=i[2],o[75]=i[3],o[76]=i[4],o[77]=i[5],o[78]=i[6])})},function(e){return o[80]=new t.Map,o[80].set("task_id",o[72]),o[80].set("queue_name",o[73]),o[80].set("enqueue_timestamp_ms",o[74]),o[80].set("priority",o[75]),o[80].set("first_executed_timestamp_ms",o[76]),o[80].set("execution_time_ns",o[77]),o[80].set("echo_encoding_execution_time_ns",o[78]),o[81]=new t.Map,o[81].set("task_metadata",o[80]),o[81].set("action_type",o[62]),o[81].set("content_type",o[63]),o[81].set("identifiers",void 0),o[81].set("identifiers_v2",o[55]),o[81].set("task_creation_source",void 0),o[81].set("message_payload_source",t.i64.cast([0,2])),o[82]=new t.Map,o[82].set("error_code",o[64]),o[82].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),o[82].set("error_message",""),o[82]!==void 0?(o[84]=o[82].get("stored_procedure"),o[85]=o[82].get("error_code"),o[86]=o[82].get("error_message"),o[87]=".",o[88]=[o[84],o[87],t.i64.to_string(o[85]),o[87],o[86]].join(""),o[6]!==void 0&&o[88]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),o[6],"exception_error",o[88]):t.resolve()):t.resolve()},function(e){return t.resolve()},function(e){return o[6]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,637746317]),o[6],!1):t.resolve()},function(e){var n;return o[83]=t.createArray(),n=[void 0,o[82],o[81],o[83]],o[58]=n[0],o[59]=n[1],o[60]=n[2],o[61]=n[3]}])},function(e){var t;return t=[o[58],o[59],o[60],o[61]],o[50]=t[0],o[51]=t[1],o[52]=t[2],o[53]=t[3],t}]))})},function(e){var t;return t=[o[50],o[51],o[52],o[53]],o[42]=t[0],o[43]=t[1],o[44]=t[2],o[45]=t[3],t}]):t.sequence([function(n){return t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,r){var a,i,l=n.done,s=n.value;return l?(o[58]=t.i64.of_float(Date.now()),a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(o[58],t.i64.cast([0,1e6])),o[19]),void 0],o[46]=a[0],o[47]=a[1],o[48]=a[2],o[49]=a[3],o[50]=a[4],o[51]=a[5],o[52]=a[6]):(r=s.item,o[58]=t.i64.of_float(Date.now()),i=[e[0],r.queueName,r.enqueueTimestampMs,void 0,r.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(o[58],t.i64.cast([0,1e6])),o[19]),void 0],o[46]=i[0],o[47]=i[1],o[48]=i[2],o[49]=i[3],o[50]=i[4],o[51]=i[5],o[52]=i[6])})},function(e){return o[54]=new t.Map,o[54].set("task_id",o[46]),o[54].set("queue_name",o[47]),o[54].set("enqueue_timestamp_ms",o[48]),o[54].set("priority",o[49]),o[54].set("first_executed_timestamp_ms",o[50]),o[54].set("execution_time_ns",o[51]),o[54].set("echo_encoding_execution_time_ns",o[52]),o[55]=new t.Map,o[55].set("task_metadata",o[54]),o[55].set("action_type",void 0),o[55].set("content_type",void 0),o[55].set("identifiers",void 0),o[55].set("identifiers_v2",void 0),o[55].set("task_creation_source",void 0),o[55].set("message_payload_source",t.i64.cast([0,2])),o[56]=new t.Map,o[56].set("error_code",t.i64.cast([0,24])),o[56].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),o[56].set("error_message",""),o[56]!==void 0?(o[58]=o[56].get("stored_procedure"),o[59]=o[56].get("error_code"),o[60]=o[56].get("error_message"),o[61]=".",o[62]=[o[58],o[61],t.i64.to_string(o[59]),o[61],o[60]].join(""),o[6]!==void 0&&o[62]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),o[6],"exception_error",o[62]):t.resolve()):t.resolve()},function(e){return t.resolve()},function(e){return o[6]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,637746317]),o[6],!1):t.resolve()},function(e){var n;return o[57]=t.createArray(),n=[void 0,o[56],o[55],o[57]],o[42]=n[0],o[43]=n[1],o[44]=n[2],o[45]=n[3]}])},function(e){var t;return t=[o[42],o[43],o[44],o[45]],o[12]=t[0],o[13]=t[1],o[14]=t[2],o[15]=t[3],t}]):t.sequence([function(n){return o[23]=o[10].get("errors"),o[24]=o[10].get("errors"),t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,r){var a,i,l=n.done,s=n.value;return l?(o[37]=t.i64.of_float(Date.now()),a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(o[37],t.i64.cast([0,1e6])),o[19]),void 0],o[25]=a[0],o[26]=a[1],o[27]=a[2],o[28]=a[3],o[29]=a[4],o[30]=a[5],o[31]=a[6]):(r=s.item,o[37]=t.i64.of_float(Date.now()),i=[e[0],r.queueName,r.enqueueTimestampMs,void 0,r.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(o[37],t.i64.cast([0,1e6])),o[19]),void 0],o[25]=i[0],o[26]=i[1],o[27]=i[2],o[28]=i[3],o[29]=i[4],o[30]=i[5],o[31]=i[6])})},function(e){return o[33]=new t.Map,o[33].set("task_id",o[25]),o[33].set("queue_name",o[26]),o[33].set("enqueue_timestamp_ms",o[27]),o[33].set("priority",o[28]),o[33].set("first_executed_timestamp_ms",o[29]),o[33].set("execution_time_ns",o[30]),o[33].set("echo_encoding_execution_time_ns",o[31]),o[34]=new t.Map,o[34].set("task_metadata",o[33]),o[34].set("action_type",void 0),o[34].set("content_type",void 0),o[34].set("identifiers",void 0),o[34].set("identifiers_v2",void 0),o[34].set("task_creation_source",void 0),o[34].set("message_payload_source",t.i64.cast([0,2])),o[35]=new t.Map,o[35].set("error_code",t.i64.cast([0,1])),o[35].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),o[35].set("error_message",""),o[35]!==void 0?(o[37]=o[35].get("stored_procedure"),o[38]=o[35].get("error_code"),o[39]=o[35].get("error_message"),o[40]=".",o[41]=[o[37],o[40],t.i64.to_string(o[38]),o[40],o[39]].join(""),o[6]!==void 0&&o[41]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),o[6],"exception_error",o[41]):t.resolve()):t.resolve()},function(e){return t.resolve()},function(e){return o[6]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,637746317]),o[6],!1):t.resolve()},function(e){var n;return o[36]=t.createArray(),n=[void 0,o[35],o[34],o[36]],o[12]=n[0],o[13]=n[1],o[14]=n[2],o[15]=n[3]}])},function(e){return o[16]=t.i64.of_float(Date.now()),o[17]=t.i64.random(),o[20]="Finishing execution. Execution time: ",o[21]=t.i64.to_string(t.i64.sub(o[16],o[0])),o[22]=" ms",o[18]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][serializeBackupPayloadV2] ",o[18],o[20],o[18],o[21],o[18],o[22]].join("")),t.i64.eq(t.i64.mod_(o[17],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(o[23]=",",o[24]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"serializeBackupPayloadV2",[o[20],o[23],o[21],o[23],o[22]].join(""),o[24],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[o[12],o[13],o[14],o[15]],a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],t}])},function(e){return t.resolve(a)}])}e.__sproc_name__="LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure",e.__tables__=["pending_tasks","secure_encrypted_backups_client_state","pending_backups_context_v2","pending_protobuf_backups_context","secure_encrypted_backups_epochs"];var s=e;l.default=s}),98);
__d("LSTaskSerializerEncryptedBackupsUpload",["LSArrayGetObjectAt","LSLogMebClientEvent.nop","LSSerializeBackupPayloadV2"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(n){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][taskSerializerEncryptedBackupsUpload] Beginning execution."),r[1]=t.i64.of_float(Date.now()),t.forEach(t.db.table(177).fetch([[[e[0]]],"fk_pending_tasks"]),function(e){var n=e.update,r=e.item;return n({backupStatus:t.i64.cast([0,2])})})},function(o){return t.storedProcedure(n("LSSerializeBackupPayloadV2"),e[0]).then(function(e){var t;return t=e,r[2]=t[0],r[3]=t[1],r[4]=t[2],r[5]=t[3],t})},function(e){return r[6]=t.createArray(),r[7]=t.i64.of_int32(r[5].length),t.i64.gt(r[7],t.i64.cast([0,0]))?t.loopAsync(r[7],function(e){return r[23]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[5],r[23]).then(function(e){var t;return t=e,r[24]=t[0],r[25]=t[1],t})},function(e){return r[24]!==void 0?r[26]=(r[6].push(r[24]),r[6]):0}])}):t.resolve()},function(e){return r[8]=t.i64.of_int32(r[6].length),t.i64.gt(r[8],t.i64.cast([0,0]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[6],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[23]=t[0],r[24]=t[1],t})},function(e){return r[9]=r[23]}]):t.resolve(r[9]=void 0)},function(e){var o,a,i,l;return r[2]?r[10]=!1:r[10]=!0,r[10]?(r[3]?r[23]=!1:r[23]=!0,r[23]?(i=[void 0,void 0,r[9],r[6],r[4]],r[24]=i[0],r[25]=i[1],r[26]=i[2],r[27]=i[3],r[28]=i[4]):(a=[void 0,r[3],r[9],r[6],r[4]],r[24]=a[0],r[25]=a[1],r[26]=a[2],r[27]=a[3],r[28]=a[4]),l=[r[24],r[25],r[26],r[27],r[28]],r[11]=l[0],r[12]=l[1],r[13]=l[2],r[14]=l[3],r[15]=l[4]):(r[23]=r[2].get("payload"),o=[r[23],r[3],r[9],r[6],r[4]],r[11]=o[0],r[12]=o[1],r[13]=o[2],r[14]=o[3],r[15]=o[4]),r[23]=new t.Map,r[24]=r[23].set("success",r[11]),r[25]=r[23].set("failure",r[12]),r[26]=r[23].set("protobuf_failure",r[13]),r[27]=r[23].set("protobuf_failures",r[14]),r[28]=r[23].set("context",r[15]),r[29]=t.toJSON(r[23]),r[16]=r[29],r[17]=t.i64.of_float(Date.now()),r[18]=t.i64.random(),r[20]="Finishing execution. Execution time: ",r[21]=t.i64.to_string(t.i64.sub(r[17],r[0])),r[22]=" ms",r[19]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][taskSerializerEncryptedBackupsUpload] ",r[19],r[20],r[19],r[21],r[19],r[22]].join("")),t.i64.eq(t.i64.mod_(r[18],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[23]=",",r[24]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"taskSerializerEncryptedBackupsUpload",[r[20],r[23],r[21],r[23],r[22]].join(""),r[24],t.i64.cast([0,4]))):t.resolve()},function(e){var n;return n=[r[16],t.i64.cast([0,50026])],o[0]=n[0],o[1]=n[1],n}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadStoredProcedure",e.__tables__=["pending_backups_context_v2"],a.exports=e}),null);
__d("LSTaskSerializerEncryptedBackupsUploadProtobufOnly",[],(function(t,n,r,o,a,i){function e(){var e,t=arguments,n=t[t.length-1],r=[],o=[];return r[0]=new n.Map,r[0].set("error_code",n.i64.cast([0,802])),r[0].set("stored_procedure","LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadProtobufOnlyStoredProcedure"),r[0].set("error_message",""),r[2]=new n.Map,r[3]=r[2].set("success",void 0),r[4]=r[2].set("failure",r[0]),r[5]=r[2].set("context",void 0),r[6]=n.toJSON(r[2]),r[1]=r[6],e=[r[1],n.i64.cast([0,50042]),void 0],o[0]=e[0],o[1]=e[1],o[2]=e[2],n.resolve(o)}e.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadProtobufOnlyStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSTaskSerializerEncryptedBackupsUploadSenderBackup",["LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(e){return t.sequence([function(e){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][taskSerializerEncryptedBackupsUploadSenderBackup] Beginning execution."),r[1]=t.i64.of_float(Date.now()),(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadSenderBackupStoredProcedure] LSEncryptedBackupsMinosEncrypt native op not supported"),r[3]="LSEncryptedBackupsMinosEncrypt native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadSenderBackupStoredProcedure] ","",r[3]].join("")),r[2]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadSenderBackupStoredProcedure",r[3],r[2],t.i64.cast([0,3]))},function(e){return r[4]=new t.Map,r[4].set("error_code",t.i64.cast([0,3])),r[4].set("stored_procedure","taskSerializerEncryptedBackupsUploadSenderBackup"),r[4].set("error_message",""),r[12]=new t.Map,r[13]=r[12].set("success",void 0),r[14]=r[12].set("failure",r[4]),r[15]=r[12].set("context",void 0),r[16]=t.toJSON(r[12]),r[5]=r[16],r[6]=t.i64.of_float(Date.now()),r[7]=t.i64.random(),r[9]="Finishing execution. Execution time: ",r[10]=t.i64.to_string(t.i64.sub(r[6],r[0])),r[11]=" ms",r[8]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][taskSerializerEncryptedBackupsUploadSenderBackup] ",r[8],r[9],r[8],r[10],r[8],r[11]].join("")),t.i64.eq(t.i64.mod_(r[7],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[12]=",",r[13]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"taskSerializerEncryptedBackupsUploadSenderBackup",[r[9],r[12],r[10],r[12],r[11]].join(""),r[13],t.i64.cast([0,4]))):t.resolve()},function(e){var n;return n=[r[5],t.i64.cast([0,50057]),void 0],o[0]=n[0],o[1]=n[1],o[2]=n[2],n}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadSenderBackupStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSTaskSerializerMuteThreadV2",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(o){return t.sequence([function(r){return t.db.table(32).fetch([[[e[0]]]]).next().then(function(r,o){var a,i=r.done,l=r.value;return i?(n[4]=t.createArray(),n[5]=(n[4].push("TaskSerializerMuteThreadV2: Task ID not found"),n[4]),n[6]=(n[4].push(e[0]),n[4]),n[7]=t.toJSON(n[4]),(function(e){t.logger(e).mustfix(e)})(n[7]),a=[void 0,void 0,void 0],n[0]=a[0],n[1]=a[1],n[2]=a[2]):(o=l.item,t.sequence([function(e){return n[8]=o.threadKey,t.db.table(9).fetch([[[n[8]]]]).next().then(function(e,r){var o,a=e.done,i=e.value;return a?(n[9]=t.createArray(),n[10]=(n[9].push("TaskSerializerMuteThreadV2: Thread not found"),n[9]),n[11]=(n[9].push(n[8]),n[9]),n[12]=t.toJSON(n[9]),(function(e){t.logger(e).mustfix(e)})(n[12]),o=[void 0,void 0,void 0],n[4]=o[0],n[5]=o[1],n[6]=o[2]):(r=i.item,t.sequence([function(e){return t.db.table(9).fetch([[[n[8]]]]).next().then(function(e,r){var o=e.done,a=e.value;return o?n[9]=t.i64.cast([0,1]):(r=a.item,n[14]=r.syncGroup,t.i64.neq(n[14],void 0)?n[13]=n[14]:n[13]=t.i64.cast([0,1]),n[9]=n[13])})},function(e){var o;return n[11]=new t.Map,n[11].set("thread_key",n[8]),n[11].set("mailbox_type",t.i64.cast([0,0])),n[11].set("mute_expire_time_ms",r.muteExpireTimeMs),n[11].set("sync_group",n[9]),n[12]=t.toJSON(n[11]),o=[n[12],t.i64.cast([0,144]),void 0],n[4]=o[0],n[5]=o[1],n[6]=o[2]}]))})},function(e){var t;return t=[n[4],n[5],n[6]],n[0]=t[0],n[1]=t[1],n[2]=t[2],t}]))})},function(e){var t;return t=[n[0],n[1]],r[0]=t[0],r[1]=t[1],t}])},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxTaskSerializerMuteThreadV2StoredProcedure",e.__tables__=["threads_optimistic_context","threads"],a.exports=e}),null);
__d("LSTaskSerializerRemoveThread",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(o){return t.sequence([function(r){return t.db.table(32).fetch([[[e[0]]]]).next().then(function(r,o){var a,i,l,s,u=r.done,c=r.value;return u?(n[4]=t.createArray(),n[5]=(n[4].push("TaskSerializerRemoveThreadV2: Task ID not found"),n[4]),n[6]=(n[4].push(e[0]),n[4]),n[7]=t.toJSON(n[4]),(function(e){t.logger(e).mustfix(e)})(n[7]),a=[void 0,void 0,void 0],n[0]=a[0],n[1]=a[1],n[2]=a[2]):(o=c.item,n[7]=o.removeType,t.i64.neq(n[7],void 0)?(n[8]=new t.Map,n[8].set("thread_key",o.threadKey),n[8].set("remove_type",n[7]),n[8].set("sync_group",o.syncGroup==null?t.i64.cast([0,1]):o.syncGroup),n[9]=t.toJSON(n[8]),i=[n[9],t.i64.cast([0,146]),void 0],n[4]=i[0],n[5]=i[1],n[6]=i[2]):(l=[void 0,void 0,void 0],n[4]=l[0],n[5]=l[1],n[6]=l[2]),s=[n[4],n[5],n[6]],n[0]=s[0],n[1]=s[1],n[2]=s[2])})},function(e){var t;return t=[n[0],n[1]],r[0]=t[0],r[1]=t[1],t}])},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxTaskSerializerRemoveThreadStoredProcedure",e.__tables__=["threads_optimistic_context"],a.exports=e}),null);
__d("LSTaskSerializerSendMessageV2",["LSArrayGetObjectAt","LSDeserializeFromJsonIntoDictionaryV2.nop","LSSymmetricEncryptionCreateEncryptedString.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return t.db.table(31).fetch([[[e[0]]]]).next().then(function(o,a){var i,l=o.done,s=o.value;return l?(r[4]=t.createArray(),r[5]=(r[4].push("task ID not found"),r[4]),r[6]=(r[4].push(e[0]),r[4]),r[7]=t.toJSON(r[4]),(function(e){t.logger(e).mustfix(e)})(r[7]),i=[void 0,void 0,void 0],r[0]=i[0],r[1]=i[1],r[2]=i[2]):(a=s.item,t.sequence([function(o){return r[11]=a.offlineThreadingId,r[12]=a.messageId,r[23]=a.threadAttributionSource,r[9]=a.platformRef,r[10]=a.platformToken,r[8]=a.replySourceId,r[13]=a.replySourceType,r[22]=a.sendType,r[25]=a.markThreadRead,r[15]=a.initiatingSource,r[16]=a.skipUrlPreviewGen,r[18]=a.textHasLinks,r[19]=a.dataclassParams,r[20]=a.multitabEnv,r[21]=a.metadataDataclass,r[17]=a.richTextFormatType,r[24]=a.subthreadParentMessageId,r[14]=a.isExclusiveToSubthread,t.db.table(12).fetch([[[r[11]]],"optimistic"]).next().then(function(o,a){var i,l=o.done,s=o.value;return l?(r[26]=t.createArray(),r[27]=(r[26].push("OTID not found"),r[26]),r[28]=(r[26].push(r[11]),r[26]),r[29]=t.toJSON(r[26]),(function(e){t.logger(e).mustfix(e)})(r[29]),i=[void 0,void 0,void 0],r[4]=i[0],r[5]=i[1],r[6]=i[2]):(a=s.item,t.sequence([function(o){return r[34]=a.text,r[30]=a.threadKey,r[35]=a.messageId,r[43]=a.senderId,r[32]=a.stickerId,r[37]=a.mentionOffsets,r[38]=a.mentionLengths,r[31]=a.mentionIds,r[39]=a.mentionTypes,r[42]=a.replyType,r[40]=a.isForwarded,r[36]=a.forwardScore,r[41]=a.hotEmojiSize,r[33]=a.metadataDataclass,t.db.table(9).fetch([[[r[30]]]]).next().then(function(o,i){var l,s=o.done,u=o.value;return s?(r[44]=t.createArray(),r[45]=(r[44].push("thread not found"),r[44]),r[46]=(r[44].push(r[30]),r[44]),r[47]=t.toJSON(r[44]),(function(e){t.logger(e).mustfix(e)})(r[47]),l=[void 0,void 0,void 0],r[26]=l[0],r[27]=l[1],r[28]=l[2]):(i=u.item,t.sequence([function(n){return r[51]=i.threadName,r[49]=i.threadKey,r[52]=i.mailboxType,r[50]=i.threadType,r[53]=i.capabilities,r[54]=i.capabilities2,r[55]=i.capabilities3,r[56]=i.capabilities4,r[57]=i.capabilities5,t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,o){var a=n.done,i=n.value;return a?r[44]=!1:(o=i.item,t.sequence([function(n){return t.islc(t.db.table(2).fetch([[[o.queueName]],"queueNameTaskId"]),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(n,o){var a=n.done,i=n.value;return a?r[58]=!1:(o=i.item,r[58]=t.i64.eq(o.taskId,e[0]))})},function(e){return r[44]=r[58]}]))})},function(e){return t.i64.eq(i.authorityLevel,t.i64.cast([0,20]))&&[t.i64.cast([0,2]),t.i64.cast([0,5]),t.i64.cast([0,205]),t.i64.cast([0,206]),t.i64.cast([0,26])].some(function(e){return t.i64.eq(r[50],e)})&&r[44]?t.sequence([function(e){return r[61]=r[22]==null?t.i64.cast([0,1]):r[22],t.db.table(9).fetch([[[r[30]]]]).next().then(function(e,n){var o=e.done,a=e.value;return o?r[58]=t.i64.cast([0,1]):(n=a.item,r[77]=n.syncGroup,t.i64.neq(r[77],void 0)?r[76]=r[77]:r[76]=t.i64.cast([0,1]),r[58]=r[76])})},function(e){return r[60]=new t.Map,r[60].set("thread_id",r[30]),r[60].set("otid",r[11]),r[60].set("source",r[23]==null?t.i64.cast([0,0]):r[23]),r[60].set("send_type",t.i64.cast([0,1])),r[60].set("sync_group",r[58]),r[60].set("mark_thread_read",r[25]),t.i64.eq(r[61],t.i64.cast([0,1]))?t.resolve(r[60].set("text",r[34])):t.i64.eq(r[61],t.i64.cast([0,2]))?(t.i64.neq(r[32],void 0)&&(r[60].set("sticker_id",r[32]),r[60].set("send_type",r[61])),r[33]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSDeserializeFromJsonIntoDictionaryV2.nop"),r[33]).then(function(e){var t;return t=e,r[76]=t[0],t})},function(e){return r[77]=new t.Map,r[78]=r[76].keys(),r[79]=t.i64.of_int32(r[78].length),t.i64.gt(r[79],t.i64.cast([0,0]))?t.loopAsync(r[79],function(e){return r[83]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[78],r[83]).then(function(e){var t;return t=e,r[84]=t[0],r[85]=t[1],t})},function(e){return r[86]=r[76].get(r[84]),r[77].set(r[84],r[86])}])}):t.resolve()},function(e){return r[80]=r[77].get("xma_music_sticker_message_metadata"),r[80]?r[81]=!1:r[81]=!0,r[81]?t.resolve(r[82]=void 0):t.sequence([function(e){return r[83]=new t.Map,r[84]=r[80].keys(),r[85]=t.i64.of_int32(r[84].length),t.i64.gt(r[85],t.i64.cast([0,0]))?t.loopAsync(r[85],function(e){return r[86]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[84],r[86]).then(function(e){var t;return t=e,r[87]=t[0],r[88]=t[1],t})},function(e){return r[89]=r[80].get(r[87]),r[83].set(r[87],r[89])}])}):t.resolve()},function(e){return r[82]=r[83]}])},function(e){return r[82]!==void 0?r[60].set("send_type",r[61]):0}]):t.resolve()):t.i64.eq(r[61],t.i64.cast([0,7]))?t.sequence([function(e){return t.db.table(16).fetch([[[r[30],r[35]]]]).next().then(function(e,t){var n,o,a=e.done,i=e.value;return a?(n=[void 0,void 0],r[76]=n[0],r[77]=n[1],n):(t=i.item,o=[t.filename,t.attributionAppId],r[76]=o[0],r[77]=o[1])})},function(e){return r[76]!==void 0&&t.i64.neq(r[77],void 0)?(r[60].set("url",r[76]),r[60].set("attribution_app_id",r[77]),r[60].set("send_type",r[61]),r[33]!==void 0?r[60].set("metadata_dataclass",r[33]):0):0}]):t.i64.eq(r[61],t.i64.cast([0,3]))?t.sequence([function(e){return r[60].set("text",r[34]),r[76]=t.createArray(),r[77]=t.createArray(),t.forEach(t.sortBy(t.db.table(16).fetch([[[r[30],r[35]]]]),[["attachmentIndex","ASC"]]),function(e){var n=e.item;return r[78]=n.offlineAttachmentId,r[79]=(r[76].push(t.i64.from_string(n.attachmentFbid)),r[76]),r[78]!==void 0?r[79]=(r[77].push(r[78]),r[77]):0})},function(e){return r[60].set("attachment_fbids",r[76]),t.i64.eq(r[61],t.i64.cast([0,9]))&&r[60].set("offline_attachment_ids",r[77]),r[60].set("send_type",r[61])}]):t.i64.eq(r[61],t.i64.cast([0,9]))?t.sequence([function(e){return r[60].set("text",r[34]),r[76]=t.createArray(),r[77]=t.createArray(),t.forEach(t.sortBy(t.db.table(16).fetch([[[r[30],r[35]]]]),[["attachmentIndex","ASC"]]),function(e){var n=e.item;return r[78]=n.offlineAttachmentId,r[79]=(r[76].push(t.i64.from_string(n.attachmentFbid)),r[76]),r[78]!==void 0?r[79]=(r[77].push(r[78]),r[77]):0})},function(e){return r[60].set("attachment_fbids",r[76]),t.i64.eq(r[61],t.i64.cast([0,9]))&&r[60].set("offline_attachment_ids",r[77]),r[60].set("send_type",r[61])}]):t.i64.eq(r[61],t.i64.cast([0,4]))?t.sequence([function(e){return t.db.table(16).fetch([[[r[30],r[35]]]]).next().then(function(e,t){var n=e.done,o=e.value;return n?r[76]=void 0:(t=o.item,r[76]=t.attachmentFbid)})},function(e){return t.db.table(16).fetch([[[r[30],r[35]]]]).next().then(function(e,t){var n=e.done,o=e.value;return n?r[78]=void 0:(t=o.item,r[78]=t.actionUrl)})},function(e){return r[76]!==void 0?(r[60].set("text",r[34]),r[78]!==void 0&&r[60].set("url",r[78]),r[60].set("forwarded_share_id",r[76]),r[60].set("send_type",r[61])):0}]):t.i64.eq(r[61],t.i64.cast([0,5]))?t.resolve(r[12]!==void 0?(r[60].set("forwarded_msg_id",r[12]),r[60].set("send_type",r[61]),t.i64.neq(r[36],void 0)&&r[60].set("forward_score",r[36]),r[60].set("strip_forwarded_msg_caption",!1)):0):t.i64.eq(r[61],t.i64.cast([0,6]))?t.sequence([function(e){return t.db.table(16).fetch([[[r[30],r[35]]]]).next().then(function(e,t){var n,o,a=e.done,i=e.value;return a?(n=[void 0,void 0],r[76]=n[0],r[77]=n[1],n):(t=i.item,o=[t.filename,t.attributionAppId],r[76]=o[0],r[77]=o[1])})},function(e){return r[76]!==void 0?(r[60].set("url",r[76]),r[60].set("text",r[34]),r[60].set("send_type",r[61])):0}]):t.i64.eq(r[61],t.i64.cast([0,11]))?t.sequence([function(e){return t.db.table(16).fetch([[[r[30],r[35]]]]).next().then(function(e,t){var n,o,a=e.done,i=e.value;return a?(n=[void 0,void 0],r[76]=n[0],r[77]=n[1],n):(t=i.item,o=[t.actionUrl,t.attributionAppId],r[76]=o[0],r[77]=o[1])})},function(e){return r[76]!==void 0?(r[60].set("url",r[76]),r[60].set("text",r[34]),r[60].set("send_type",r[61])):0}]):t.resolve(t.i64.eq(r[61],t.i64.cast([0,12]))?r[60].set("send_type",r[61]):0)},function(e){return r[72]=r[24]==null?void 0:r[24],r[71]=r[8]===""?void 0:r[8],r[71]!==void 0&&t.i64.neq(r[13],void 0)&&(r[76]=new t.Map,r[76].set("reply_source_id",r[71]),r[76].set("reply_source_type",r[13]),r[76].set("reply_type",r[42]==null?t.i64.cast([0,0]):r[42]),r[76].set("reply_source_attachment_id",void 0),r[60].set("reply_metadata",r[76])),r[72]!==void 0&&r[14]!==void 0&&(r[76]=new t.Map,r[76].set("subthread_parent_message_id",r[72]),r[76].set("is_exclusive_to_subthread",r[14]),r[60].set("subthread_data",r[76])),r[73]=r[31]===""?void 0:r[31],r[73]!==void 0&&(r[76]=r[37]===""?void 0:r[37],r[76]!==void 0&&(r[77]=r[38]===""?void 0:r[38],r[77]!==void 0&&(r[78]=new t.Map,r[78].set("mention_ids",r[73]),r[78].set("mention_offsets",r[76]),r[78].set("mention_lengths",r[77]),r[78].set("mention_types",r[39]===""?void 0:r[39]),r[60].set("mention_data",r[78])))),r[40]!==void 0&&r[60].set("is_forwarded",r[40]),r[74]=r[9]===""?void 0:r[9],r[74]!==void 0&&r[60].set("platform_ref",r[74]),r[75]=r[10]===""?void 0:r[10],r[75]!==void 0&&r[60].set("platform_token",r[75]),[t.i64.cast([0,1]),t.i64.cast([0,2])].some(function(e){return t.i64.eq(r[61],e)})&&t.i64.neq(r[41],void 0)&&r[60].set("hot_emoji_size",r[41]),t.i64.neq(r[15],void 0)&&r[60].set("initiating_source",r[15]),r[16]!==void 0&&r[60].set("skip_url_preview_gen",r[16]),t.i64.neq(r[17],void 0)&&r[60].set("rich_text_format_type",r[17]),t.resolve()},function(e){return r[18]!==void 0&&r[60].set("text_has_links",r[18]),r[19]!==void 0&&r[60].set("dataclass_params",r[19]),r[20]!==void 0&&r[60].set("multitab_env",r[20]),r[21]!==void 0&&r[60].set("metadata_dataclass",r[21]),t.filter(t.db.table(14).fetch([[[r[49],r[43]]]]),function(e){return t.i64.eq(e.threadKey,r[49])&&t.i64.eq(t.i64.cast([0,0]),r[52])&&t.i64.eq(e.contactId,r[43])}).next().then(function(e,n){var o=e.done,a=e.value;return o?r[62]=!1:(n=a.item,t.i64.eq(r[50],t.i64.cast([0,152]))?(r[77]=n.threadRoles,t.i64.lt(t.i64.cast([0,7]),t.i64.cast([0,0]))||t.i64.gt(t.i64.cast([0,7]),t.i64.cast([0,9]))?r[78]=!1:r[78]=!t.i64.eq(t.i64.and_(t.i64.lsl_(t.i64.cast([0,1]),t.i64.to_int32(t.i64.cast([0,7]))),r[77]),t.i64.cast([0,0])),r[79]=r[53],r[80]=r[54],r[81]=r[55],r[82]=r[56],r[83]=r[57],r[85]=t.i64.div(t.i64.cast([0,223]),t.i64.cast([0,64])),r[86]=t.i64.lsl_(t.i64.cast([0,1]),t.i64.to_int32(t.i64.sub(t.i64.cast([0,223]),t.i64.mul(r[85],t.i64.cast([0,64]))))),t.i64.lt(t.i64.cast([0,223]),t.i64.cast([0,0]))||t.i64.gt(t.i64.cast([0,223]),t.i64.cast([0,300]))?r[84]=!1:(t.i64.eq(r[85],t.i64.cast([0,0]))?r[87]=!t.i64.eq(t.i64.and_(r[86],r[79]),t.i64.cast([0,0])):(t.i64.eq(r[85],t.i64.cast([0,1]))?r[88]=!t.i64.eq(t.i64.and_(r[86],r[80]),t.i64.cast([0,0])):(t.i64.eq(r[85],t.i64.cast([0,2]))?r[89]=!t.i64.eq(t.i64.and_(r[86],r[81]),t.i64.cast([0,0])):(t.i64.eq(r[85],t.i64.cast([0,3]))?r[90]=!t.i64.eq(t.i64.and_(r[86],r[82]),t.i64.cast([0,0])):(t.i64.eq(r[85],t.i64.cast([0,4]))?r[91]=!t.i64.eq(t.i64.and_(r[86],r[83]),t.i64.cast([0,0])):r[91]=!1,r[90]=r[91]),r[89]=r[90]),r[88]=r[89]),r[87]=r[88]),r[84]=r[87]),r[78]!==r[84]&&((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Thread role and thread capability don't agree for Broadcast Channels message-as-page functionality; aborting"),t.throw("LS::assert is failed. Thread role and thread capability don't agree for Broadcast Channels message-as-page functionality; aborting")),r[76]=r[78]):r[76]=!1,r[62]=r[76])})},function(e){return r[62]&&r[60].set("perform_action_as_page",!0),r[64]=t.createArray(),t.forEach(t.db.table(14).fetch([[[r[30]]]]),function(e){var t=e.item;return r[76]=(r[64].push(t.contactId),r[64])})},function(e){return r[65]=new t.Map,r[65].set("participants",r[64]),r[65].set("send_payload",r[60]),r[51]!==void 0&&r[65].set("thread_name",r[51]),t.db.table(312).fetch([[[r[30]]]]).next().then(function(e,t){var n=e.done,o=e.value;return n?r[66]=void 0:(t=o.item,r[66]=t.metadata)})},function(e){return r[65].set("thread_metadata",r[66]),t.forEach(t.db.table(9).fetch([[[r[49]]]]),function(e){var t=e.update,n=e.item;return t({otidOfFirstMessage:a.offlineThreadingId})})},function(e){var n,o,a,i,l,s,u,c,d;return r[66]===void 0?(t.i64.eq(r[50],t.i64.cast([0,5]))||t.i64.eq(r[50],t.i64.cast([0,26]))?((function(e){t.logger(e).mustfix(e)})("For Marketplace & community chat subthreads, thread metadata cannot be null"),n=[void 0,void 0,void 0],r[76]=n[0],r[77]=n[1],r[78]=n[2]):(r[79]=t.toJSON(r[65]),o=[r[79],t.i64.cast([0,130]),void 0],r[76]=o[0],r[77]=o[1],r[78]=o[2]),a=[r[76],r[77],r[78]],r[68]=a[0],r[69]=a[1],r[70]=a[2]):(t.i64.eq(r[50],t.i64.cast([0,5]))?(r[79]=t.toJSON(r[65]),i=[r[79],t.i64.cast([0,645]),void 0],r[76]=i[0],r[77]=i[1],r[78]=i[2]):(t.i64.eq(r[50],t.i64.cast([0,2]))?(r[82]=t.toJSON(r[65]),l=[r[82],t.i64.cast([0,787]),void 0],r[79]=l[0],r[80]=l[1],r[81]=l[2]):(r[82]=t.toJSON(r[65]),s=[r[82],t.i64.cast([0,645]),void 0],r[79]=s[0],r[80]=s[1],r[81]=s[2]),u=[r[79],r[80],r[81]],r[76]=u[0],r[77]=u[1],r[78]=u[2]),c=[r[76],r[77],r[78]],r[68]=c[0],r[69]=c[1],r[70]=c[2]),d=[r[68],r[69],r[70]],r[46]=d[0],r[47]=d[1],r[48]=d[2]}]):t.sequence([function(e){return r[61]=r[22]==null?t.i64.cast([0,1]):r[22],t.db.table(9).fetch([[[r[30]]]]).next().then(function(e,n){var o=e.done,a=e.value;return o?r[58]=t.i64.cast([0,1]):(n=a.item,r[71]=n.syncGroup,t.i64.neq(r[71],void 0)?r[70]=r[71]:r[70]=t.i64.cast([0,1]),r[58]=r[70])})},function(e){return r[60]=new t.Map,r[60].set("thread_id",r[30]),r[60].set("otid",r[11]),r[60].set("source",r[23]==null?t.i64.cast([0,0]):r[23]),r[60].set("send_type",t.i64.cast([0,1])),r[60].set("sync_group",r[58]),r[60].set("mark_thread_read",r[25]),t.i64.eq(r[61],t.i64.cast([0,1]))?t.resolve(r[60].set("text",r[34])):t.i64.eq(r[61],t.i64.cast([0,2]))?(t.i64.neq(r[32],void 0)&&(r[60].set("sticker_id",r[32]),r[60].set("send_type",r[61])),r[33]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSDeserializeFromJsonIntoDictionaryV2.nop"),r[33]).then(function(e){var t;return t=e,r[70]=t[0],t})},function(e){return r[71]=new t.Map,r[72]=r[70].keys(),r[73]=t.i64.of_int32(r[72].length),t.i64.gt(r[73],t.i64.cast([0,0]))?t.loopAsync(r[73],function(e){return r[77]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[72],r[77]).then(function(e){var t;return t=e,r[78]=t[0],r[79]=t[1],t})},function(e){return r[80]=r[70].get(r[78]),r[71].set(r[78],r[80])}])}):t.resolve()},function(e){return r[74]=r[71].get("xma_music_sticker_message_metadata"),r[74]?r[75]=!1:r[75]=!0,r[75]?t.resolve(r[76]=void 0):t.sequence([function(e){return r[77]=new t.Map,r[78]=r[74].keys(),r[79]=t.i64.of_int32(r[78].length),t.i64.gt(r[79],t.i64.cast([0,0]))?t.loopAsync(r[79],function(e){return r[80]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[78],r[80]).then(function(e){var t;return t=e,r[81]=t[0],r[82]=t[1],t})},function(e){return r[83]=r[74].get(r[81]),r[77].set(r[81],r[83])}])}):t.resolve()},function(e){return r[76]=r[77]}])},function(e){return r[76]!==void 0?r[60].set("send_type",r[61]):0}]):t.resolve()):t.i64.eq(r[61],t.i64.cast([0,7]))?t.sequence([function(e){return t.db.table(16).fetch([[[r[30],r[35]]]]).next().then(function(e,t){var n,o,a=e.done,i=e.value;return a?(n=[void 0,void 0],r[70]=n[0],r[71]=n[1],n):(t=i.item,o=[t.filename,t.attributionAppId],r[70]=o[0],r[71]=o[1])})},function(e){return r[70]!==void 0&&t.i64.neq(r[71],void 0)?(r[60].set("url",r[70]),r[60].set("attribution_app_id",r[71]),r[60].set("send_type",r[61]),r[33]!==void 0?r[60].set("metadata_dataclass",r[33]):0):0}]):t.i64.eq(r[61],t.i64.cast([0,3]))?t.sequence([function(e){return r[60].set("text",r[34]),r[70]=t.createArray(),r[71]=t.createArray(),t.forEach(t.sortBy(t.db.table(16).fetch([[[r[30],r[35]]]]),[["attachmentIndex","ASC"]]),function(e){var n=e.item;return r[72]=n.offlineAttachmentId,r[73]=(r[70].push(t.i64.from_string(n.attachmentFbid)),r[70]),r[72]!==void 0?r[73]=(r[71].push(r[72]),r[71]):0})},function(e){return r[60].set("attachment_fbids",r[70]),t.i64.eq(r[61],t.i64.cast([0,9]))&&r[60].set("offline_attachment_ids",r[71]),r[60].set("send_type",r[61])}]):t.i64.eq(r[61],t.i64.cast([0,9]))?t.sequence([function(e){return r[60].set("text",r[34]),r[70]=t.createArray(),r[71]=t.createArray(),t.forEach(t.sortBy(t.db.table(16).fetch([[[r[30],r[35]]]]),[["attachmentIndex","ASC"]]),function(e){var n=e.item;return r[72]=n.offlineAttachmentId,r[73]=(r[70].push(t.i64.from_string(n.attachmentFbid)),r[70]),r[72]!==void 0?r[73]=(r[71].push(r[72]),r[71]):0})},function(e){return r[60].set("attachment_fbids",r[70]),t.i64.eq(r[61],t.i64.cast([0,9]))&&r[60].set("offline_attachment_ids",r[71]),r[60].set("send_type",r[61])}]):t.i64.eq(r[61],t.i64.cast([0,4]))?t.sequence([function(e){return t.db.table(16).fetch([[[r[30],r[35]]]]).next().then(function(e,t){var n=e.done,o=e.value;return n?r[70]=void 0:(t=o.item,r[70]=t.attachmentFbid)})},function(e){return t.db.table(16).fetch([[[r[30],r[35]]]]).next().then(function(e,t){var n=e.done,o=e.value;return n?r[72]=void 0:(t=o.item,r[72]=t.actionUrl)})},function(e){return r[70]!==void 0?(r[60].set("text",r[34]),r[72]!==void 0&&r[60].set("url",r[72]),r[60].set("forwarded_share_id",r[70]),r[60].set("send_type",r[61])):0}]):t.i64.eq(r[61],t.i64.cast([0,5]))?t.resolve(r[12]!==void 0?(r[60].set("forwarded_msg_id",r[12]),r[60].set("send_type",r[61]),t.i64.neq(r[36],void 0)&&r[60].set("forward_score",r[36]),r[60].set("strip_forwarded_msg_caption",!1)):0):t.i64.eq(r[61],t.i64.cast([0,6]))?t.sequence([function(e){return t.db.table(16).fetch([[[r[30],r[35]]]]).next().then(function(e,t){var n,o,a=e.done,i=e.value;return a?(n=[void 0,void 0],r[70]=n[0],r[71]=n[1],n):(t=i.item,o=[t.filename,t.attributionAppId],r[70]=o[0],r[71]=o[1])})},function(e){return r[70]!==void 0?(r[60].set("url",r[70]),r[60].set("text",r[34]),r[60].set("send_type",r[61])):0}]):t.i64.eq(r[61],t.i64.cast([0,11]))?t.sequence([function(e){return t.db.table(16).fetch([[[r[30],r[35]]]]).next().then(function(e,t){var n,o,a=e.done,i=e.value;return a?(n=[void 0,void 0],r[70]=n[0],r[71]=n[1],n):(t=i.item,o=[t.actionUrl,t.attributionAppId],r[70]=o[0],r[71]=o[1])})},function(e){return r[70]!==void 0?(r[60].set("url",r[70]),r[60].set("text",r[34]),r[60].set("send_type",r[61])):0}]):t.resolve(t.i64.eq(r[61],t.i64.cast([0,12]))?r[60].set("send_type",r[61]):0)},function(e){return r[66]=r[24]==null?void 0:r[24],r[65]=r[8]===""?void 0:r[8],r[65]!==void 0&&t.i64.neq(r[13],void 0)&&(r[70]=new t.Map,r[70].set("reply_source_id",r[65]),r[70].set("reply_source_type",r[13]),r[70].set("reply_type",r[42]==null?t.i64.cast([0,0]):r[42]),r[70].set("reply_source_attachment_id",void 0),r[60].set("reply_metadata",r[70])),r[66]!==void 0&&r[14]!==void 0&&(r[70]=new t.Map,r[70].set("subthread_parent_message_id",r[66]),r[70].set("is_exclusive_to_subthread",r[14]),r[60].set("subthread_data",r[70])),r[67]=r[31]===""?void 0:r[31],r[67]!==void 0&&(r[70]=r[37]===""?void 0:r[37],r[70]!==void 0&&(r[71]=r[38]===""?void 0:r[38],r[71]!==void 0&&(r[72]=new t.Map,r[72].set("mention_ids",r[67]),r[72].set("mention_offsets",r[70]),r[72].set("mention_lengths",r[71]),r[72].set("mention_types",r[39]===""?void 0:r[39]),r[60].set("mention_data",r[72])))),r[40]!==void 0&&r[60].set("is_forwarded",r[40]),r[68]=r[9]===""?void 0:r[9],r[68]!==void 0&&r[60].set("platform_ref",r[68]),r[69]=r[10]===""?void 0:r[10],r[69]!==void 0&&r[60].set("platform_token",r[69]),[t.i64.cast([0,1]),t.i64.cast([0,2])].some(function(e){return t.i64.eq(r[61],e)})&&t.i64.neq(r[41],void 0)&&r[60].set("hot_emoji_size",r[41]),t.i64.neq(r[15],void 0)&&r[60].set("initiating_source",r[15]),r[16]!==void 0&&r[60].set("skip_url_preview_gen",r[16]),t.i64.neq(r[17],void 0)&&r[60].set("rich_text_format_type",r[17]),t.resolve()},function(e){return r[18]!==void 0&&r[60].set("text_has_links",r[18]),r[19]!==void 0&&r[60].set("dataclass_params",r[19]),r[20]!==void 0&&r[60].set("multitab_env",r[20]),r[21]!==void 0&&r[60].set("metadata_dataclass",r[21]),t.filter(t.db.table(14).fetch([[[r[49],r[43]]]]),function(e){return t.i64.eq(e.threadKey,r[49])&&t.i64.eq(t.i64.cast([0,0]),r[52])&&t.i64.eq(e.contactId,r[43])}).next().then(function(e,n){var o=e.done,a=e.value;return o?r[62]=!1:(n=a.item,t.i64.eq(r[50],t.i64.cast([0,152]))?(r[71]=n.threadRoles,t.i64.lt(t.i64.cast([0,7]),t.i64.cast([0,0]))||t.i64.gt(t.i64.cast([0,7]),t.i64.cast([0,9]))?r[72]=!1:r[72]=!t.i64.eq(t.i64.and_(t.i64.lsl_(t.i64.cast([0,1]),t.i64.to_int32(t.i64.cast([0,7]))),r[71]),t.i64.cast([0,0])),r[73]=r[53],r[74]=r[54],r[75]=r[55],r[76]=r[56],r[77]=r[57],r[79]=t.i64.div(t.i64.cast([0,223]),t.i64.cast([0,64])),r[80]=t.i64.lsl_(t.i64.cast([0,1]),t.i64.to_int32(t.i64.sub(t.i64.cast([0,223]),t.i64.mul(r[79],t.i64.cast([0,64]))))),t.i64.lt(t.i64.cast([0,223]),t.i64.cast([0,0]))||t.i64.gt(t.i64.cast([0,223]),t.i64.cast([0,300]))?r[78]=!1:(t.i64.eq(r[79],t.i64.cast([0,0]))?r[81]=!t.i64.eq(t.i64.and_(r[80],r[73]),t.i64.cast([0,0])):(t.i64.eq(r[79],t.i64.cast([0,1]))?r[82]=!t.i64.eq(t.i64.and_(r[80],r[74]),t.i64.cast([0,0])):(t.i64.eq(r[79],t.i64.cast([0,2]))?r[83]=!t.i64.eq(t.i64.and_(r[80],r[75]),t.i64.cast([0,0])):(t.i64.eq(r[79],t.i64.cast([0,3]))?r[84]=!t.i64.eq(t.i64.and_(r[80],r[76]),t.i64.cast([0,0])):(t.i64.eq(r[79],t.i64.cast([0,4]))?r[85]=!t.i64.eq(t.i64.and_(r[80],r[77]),t.i64.cast([0,0])):r[85]=!1,r[84]=r[85]),r[83]=r[84]),r[82]=r[83]),r[81]=r[82]),r[78]=r[81]),r[72]!==r[78]&&((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Thread role and thread capability don't agree for Broadcast Channels message-as-page functionality; aborting"),t.throw("LS::assert is failed. Thread role and thread capability don't agree for Broadcast Channels message-as-page functionality; aborting")),r[70]=r[72]):r[70]=!1,r[62]=r[70])})},function(e){var n;return r[62]&&r[60].set("perform_action_as_page",!0),r[64]=t.toJSON(r[60]),n=[r[64],t.i64.cast([0,46]),void 0],r[46]=n[0],r[47]=n[1],r[48]=n[2]}])},function(e){var t;return t=[r[46],r[47],r[48]],r[26]=t[0],r[27]=t[1],r[28]=t[2],t}]))})},function(e){var t;return t=[r[26],r[27],r[28]],r[4]=t[0],r[5]=t[1],r[6]=t[2],t}]))})},function(e){var t;return t=[r[4],r[5],r[6]],r[0]=t[0],r[1]=t[1],r[2]=t[2],t}]))})},function(e){var t;return t=[r[0],r[1]],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxTaskSerializerSendMessageV2StoredProcedure",e.__tables__=["messages_optimistic_context","messages","threads","pending_tasks","attachments","participants","threads_optimistic_metadata"],a.exports=e}),null);
__d("LSTaskSerializerSyncThreadCapabilities",[],(function(t,n,r,o,a,i){function e(){var e,t=arguments,n=t[t.length-1],r=[],o=[];return e=[void 0,void 0,void 0],o[0]=e[0],o[1]=e[1],o[2]=e[2],n.resolve(o)}e.__sproc_name__="LSMailboxTaskSerializerSyncThreadCapabilitiesStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSIsExperimentCapabilityEnabled.nop",["LSACSExperimentCapability","LSIntEnum","MetaConfig","Promise"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=r("MetaConfig")._("87"),c=r("MetaConfig")._("156"),d=function(a,i,l,d){switch((s||(s=o("LSIntEnum"))).toNumber(l)){case r("LSACSExperimentCapability").BUMP_TOKEN_SYNC_TASK_AT_TASK_SERIALIZATION:return(e||(e=n("Promise"))).resolve([c]);case r("LSACSExperimentCapability").INSERT_PENDING_TASK_PARENT_ROW_WHEN_NO_ACS_TOKENS_AT_TASK_INSERTION:return(e||(e=n("Promise"))).resolve([!1]);case r("LSACSExperimentCapability").RETRY_AFTER_TASK_SERIALIZATION_FAILURE_EXPONENTIAL_BACKOFF:return(e||(e=n("Promise"))).resolve([u])}return(e||(e=n("Promise"))).resolve([!1])};d.__nop_name__="LSIsExperimentCapabilityEnabled",l.default=d}),98);
__d("LSMailboxTaskCompletionApiOnTaskCompletion",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(n){return t.forEach(t.db.table(233).fetch([[[e[0]]]]),function(t){var n=t.update,r=t.item;return n({success:e[1]})})},function(e){return t.resolve(r)}])}e.__sproc_name__="LSCoreMailboxTaskCompletionApiOnTaskCompletionStoredProcedure",e.__tables__=["mailbox_task_completion_api_tasks"],a.exports=e}),null);
__d("LSVoprfHmac.nop",["ACSCipherSuiteModule","ACSTokenHmacUtil","Promise","XPlatReactTextEncoder","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r,a,i){var l=o("ACSCipherSuiteModule").getACSCipherSuiteByValue(o("ACSCipherSuiteModule").VOPRF_RISTRETTO_HMACSHA512.value);if(!l)return(e||(e=n("Promise"))).resolve([void 0]);var s=yield o("ACSTokenHmacUtil").hmac(l.macAlgorithm,new Uint8Array(i).slice(),new(o("XPlatReactTextEncoder")).TextEncoder().encode(a));return(e||(e=n("Promise"))).resolve([s.buffer])});function r(e,n,r,o){return t.apply(this,arguments)}return r})();s.__nop_name__="LSVoprfHmac",l.default=s}),98);
__d("LSTaskSerializerUnauthenticatedTask",["LSArrayGetObjectAt","LSBase64Encode.nop","LSIsExperimentCapabilityEnabled.nop","LSMailboxTaskCompletionApiOnTaskCompletion","LSRemoveUsedTokens","LSVoprfHmac.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(n){return t.db.table(311).fetch([[[e[0]]]]).next().then(function(e,t){var n=e.done,o=e.value;return n?r[0]=void 0:(t=o.item,r[0]=t.projectName)})},function(o){return r[0]!==void 0?t.sequence([function(o){return e[1]!==void 0?t.sequence([function(e){return r[9]=t.createArray(),r[10]=t.i64.of_float(Date.now()),t.forEach(t.filter(t.db.table(307).fetch(),function(e){return r[0]===e.projectName&&t.i64.gt(e.expirationTimestampMs,r[10])}),function(e){var t=e.item;return r[16]=(r[9].push(t.configId),r[9])})},function(e){return t.sequence([function(e){return r[16]=t.createArray(),r[17]=t.i64.of_int32(r[9].length),t.i64.gt(r[17],t.i64.cast([0,0]))?t.loopAsync(r[17],function(e){return r[19]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[9],r[19]).then(function(e){var t;return t=e,r[20]=t[0],r[21]=t[1],t})},function(e){return r[22]=(r[16].push(r[20]),r[16])}])}):t.resolve()},function(e){return r[18]=r[16].join(","),r[11]=r[18]}])},function(o){return t.filter(t.db.table(309).fetch(),function(e){return r[9].includes(e.configId)&&t.i64.gt(e.redeemLimit,t.i64.cast([0,0]))}).next().then(function(o,a){var i=o.done,l=o.value;return i?t.sequence([function(e){return t.nativeOperation(n("LSIsExperimentCapabilityEnabled.nop"),t.i64.cast([0,0]),r[0]).then(function(e){var t;return t=e,r[16]=t[0],t})},function(o){return r[16]?t.sequence([function(n){return t.db.table(311).fetch([[[e[0]]]]).next().then(function(e,n){var o=e.done,a=e.value;return o?r[20]=t.i64.cast([0,0]):(n=a.item,r[20]=n.failureCount)})},function(n){return t.forEach(t.db.table(311).fetch([[[e[0]]]]),function(e){var n=e.item;return t.forEach(t.db.table(311).fetch([[[n.taskId]]]),function(e){var n=e.update,o=e.item;return n({failureCount:t.i64.add(r[20],t.i64.cast([0,1]))})})})},function(e){var n;return n=[void 0,void 0,t.i64.mul(t.i64.lsl_(t.i64.cast([0,1]),t.i64.to_int32(t.i64.mod_(r[20],t.i64.cast([0,7])))),t.i64.cast([0,500]))],r[17]=n[0],r[18]=n[1],r[19]=n[2],n}]):t.sequence([function(r){return t.storedProcedure(n("LSMailboxTaskCompletionApiOnTaskCompletion"),e[0],!1)},function(n){var o;return r[20]=t.createArray(),r[21]=(r[20].push("Unauthenticated Task Serializer: no valid tokens"),r[20]),r[22]=(r[20].push(e[0]),r[20]),r[23]=(r[20].push(r[0]),r[20]),r[24]=t.toJSON(r[20]),(function(e){t.logger(e).mustfix(e)})(r[24]),o=[void 0,void 0,void 0],r[17]=o[0],r[18]=o[1],r[19]=o[2]}])},function(e){var t;return t=[r[17],r[18],r[19]],r[12]=t[0],r[13]=t[1],r[14]=t[2],t}]):(a=l.item,t.sequence([function(o){return r[20]=a.tokenId,t.nativeOperation(n("LSVoprfHmac.nop"),e[2]==null?"":e[2],a.sharedSecret).then(function(e){var t;return t=e,r[16]=t[0],t})},function(o){return t.blobs.neq(r[16],void 0)?t.sequence([function(e){return t.forEach(t.db.table(309).fetch([[[r[20]]]]),function(e){var n=e.update,r=e.item;return n({redeemLimit:t.i64.sub(r.redeemLimit,t.i64.cast([0,1]))})})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[16]).then(function(e){var t;return t=e,r[21]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),a.nonce).then(function(e){var t;return t=e,r[22]=t[0],t})},function(n){var o;return r[23]=new t.Map,r[23].set("config_id",a.configId),r[23].set("tag",r[21]==null?"":r[21]),r[23].set("aux",r[22]==null?"":r[22]),r[23].set("project_name",r[0]),r[24]=t.toJSON(r[23]),r[25]=new t.Map,r[25].set("payload",e[2]==null?"":e[2]),r[25].set("token",r[24]),r[26]=t.toJSON(r[25]),o=[r[26],t.i64.from_string(e[1]),void 0],r[17]=o[0],r[18]=o[1],r[19]=o[2]}]):t.sequence([function(e){return t.forEach(t.db.table(309).fetch([[[r[20]]]]),function(e){return e.delete()})},function(r){return t.storedProcedure(n("LSMailboxTaskCompletionApiOnTaskCompletion"),e[0],!1)},function(n){var o;return r[21]=t.createArray(),r[22]=(r[21].push("Unauthenticated Task Serializer: hmac failed"),r[21]),r[23]=(r[21].push(e[0]),r[21]),r[24]=t.toJSON(r[21]),(function(e){t.logger(e).mustfix(e)})(r[24]),o=[void 0,void 0,void 0],r[17]=o[0],r[18]=o[1],r[19]=o[2]}])},function(e){var t;return t=[r[17],r[18],r[19]],r[12]=t[0],r[13]=t[1],r[14]=t[2],t}]))})},function(e){var t;return t=[r[12],r[13],r[14]],r[6]=t[0],r[7]=t[1],r[8]=t[2],t}]):t.sequence([function(r){return t.storedProcedure(n("LSMailboxTaskCompletionApiOnTaskCompletion"),e[0],!1)},function(n){var o;return r[9]=t.createArray(),r[10]=(r[9].push("Unauthenticated Task Serializer: task has no write label"),r[9]),r[11]=(r[9].push(e[0]),r[9]),r[12]=t.toJSON(r[9]),(function(e){t.logger(e).mustfix(e)})(r[12]),o=[void 0,void 0,void 0],r[6]=o[0],r[7]=o[1],r[8]=o[2]}])},function(e){var t;return t=[r[6],r[7],r[8]],r[2]=t[0],r[3]=t[1],r[4]=t[2],t}]):t.sequence([function(r){return t.storedProcedure(n("LSMailboxTaskCompletionApiOnTaskCompletion"),e[0],!1)},function(n){var o;return r[6]=t.createArray(),r[7]=(r[6].push("Unauthenticated Task Serializer: anonymous_task_context row not found"),r[6]),r[8]=(r[6].push(e[0]),r[6]),r[9]=t.toJSON(r[6]),(function(e){t.logger(e).mustfix(e)})(r[9]),o=[void 0,void 0,void 0],r[2]=o[0],r[3]=o[1],r[4]=o[2]}])},function(e){return t.storedProcedure(n("LSRemoveUsedTokens"))},function(e){return r[0]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSIsExperimentCapabilityEnabled.nop"),t.i64.cast([0,1]),r[0]).then(function(e){var t;return t=e,r[6]=t[0],t})},function(e){return r[6]?t.sequence([function(e){return t.i64.neq(r[4],void 0)?t.resolve(r[8]=!0):t.sequence([function(e){return r[10]=t.createArray(),r[11]=t.i64.of_float(Date.now()),t.forEach(t.filter(t.db.table(307).fetch(),function(e){return r[0]===e.projectName&&t.i64.gt(e.expirationTimestampMs,r[11])}),function(e){var t=e.item;return r[15]=(r[10].push(t.configId),r[10])})},function(e){return t.sequence([function(e){return r[15]=t.createArray(),r[16]=t.i64.of_int32(r[10].length),t.i64.gt(r[16],t.i64.cast([0,0]))?t.loopAsync(r[16],function(e){return r[18]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[10],r[18]).then(function(e){var t;return t=e,r[19]=t[0],r[20]=t[1],t})},function(e){return r[21]=(r[15].push(r[19]),r[15])}])}):t.resolve()},function(e){return r[17]=r[15].join(","),r[12]=r[17]}])},function(e){return t.filter(t.db.table(309).fetch(),function(e){return r[10].includes(e.configId)&&t.i64.gt(e.redeemLimit,t.i64.cast([0,0]))}).next().then(function(e,t){var n=e.done,o=e.value;return n?r[13]=!0:(t=o.item,r[13]=!1)})},function(e){return r[8]=r[13]}])},function(e){return r[8]?t.sequence([function(e){return t.filter(t.db.table(310).fetch(),function(e){return e.projectName===r[0]}).next().then(function(e,t){var n=e.done,o=e.value;return n?r[10]=void 0:(t=o.item,r[10]=t.taskId)})},function(e){return r[9]=r[10]}]):t.resolve(r[9]=void 0)},function(e){return r[7]=r[9]}]):t.resolve(r[7]=void 0)},function(e){return r[5]=r[7]}]):t.resolve(r[5]=void 0)},function(e){var t;return t=[r[2],r[3],r[4],r[5]],o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSAnonymousCredentialsTaskSerializerUnauthenticatedTaskStoredProcedure",e.__tables__=["anonymous_task_context","secure_acs_configurations","secure_acs_tokens","acs_request_context"],a.exports=e}),null);
__d("LSTaskSerializerUpdateThreadName",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(o){return t.sequence([function(r){return t.db.table(32).fetch([[[e[0]]]]).next().then(function(r,o){var a,i=r.done,l=r.value;return i?(n[4]=t.createArray(),n[5]=(n[4].push("taskSerializerUpdateThreadName: Task ID not found"),n[4]),n[6]=(n[4].push(e[0]),n[4]),n[7]=t.toJSON(n[4]),(function(e){t.logger(e).mustfix(e)})(n[7]),a=[void 0,void 0,void 0],n[0]=a[0],n[1]=a[1],n[2]=a[2]):(o=l.item,t.sequence([function(e){return n[8]=o.threadKey,t.db.table(9).fetch([[[n[8]]]]).next().then(function(e,r){var o,a=e.done,i=e.value;return a?(n[9]=t.createArray(),n[10]=(n[9].push("taskSerializerUpdateThreadName: Thread not found"),n[9]),n[11]=(n[9].push(n[8]),n[9]),n[12]=t.toJSON(n[9]),(function(e){t.logger(e).mustfix(e)})(n[12]),o=[void 0,void 0,void 0],n[4]=o[0],n[5]=o[1],n[6]=o[2]):(r=i.item,t.sequence([function(e){return t.db.table(9).fetch([[[n[8]]]]).next().then(function(e,r){var o=e.done,a=e.value;return o?n[9]=t.i64.cast([0,1]):(r=a.item,n[14]=r.syncGroup,t.i64.neq(n[14],void 0)?n[13]=n[14]:n[13]=t.i64.cast([0,1]),n[9]=n[13])})},function(e){var o;return n[11]=new t.Map,n[11].set("thread_key",n[8]),n[11].set("thread_name",r.threadName==null?"":r.threadName),n[11].set("sync_group",n[9]),n[12]=t.toJSON(n[11]),o=[n[12],t.i64.cast([0,32]),void 0],n[4]=o[0],n[5]=o[1],n[6]=o[2]}]))})},function(e){var t;return t=[n[4],n[5],n[6]],n[0]=t[0],n[1]=t[1],n[2]=t[2],t}]))})},function(e){var t;return t=[n[0],n[1],n[2]],r[0]=t[0],r[1]=t[1],r[2]=t[2],t}])},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxTaskSerializerUpdateThreadNameStoredProcedure",e.__tables__=["threads_optimistic_context","threads"],a.exports=e}),null);
__d("LSSerializeTask",["LSForceTaskExecutionImmediately","LSLogMebClientEvent.nop","LSTaskSerializerAcsIssueNextSync","LSTaskSerializerDeleteChatHistory","LSTaskSerializerE2eeMessageIntegrityCheckV2","LSTaskSerializerE2eeMetadataThreadIntegrityCheck","LSTaskSerializerEncryptedBackupAction","LSTaskSerializerEncryptedBackupsLoopingUpload","LSTaskSerializerEncryptedBackupsOpenUpload","LSTaskSerializerEncryptedBackupsRestoreWithSerializer","LSTaskSerializerEncryptedBackupsUpload","LSTaskSerializerEncryptedBackupsUploadProtobufOnly","LSTaskSerializerEncryptedBackupsUploadSenderBackup","LSTaskSerializerMuteThreadV2","LSTaskSerializerRemoveThread","LSTaskSerializerSendMessageV2","LSTaskSerializerSyncThreadCapabilities","LSTaskSerializerUnauthenticatedTask","LSTaskSerializerUpdateThreadName"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return e[1]==="46"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerSendMessageV2"),e[0]).then(function(e){var t;return t=e,r[8]=t[0],r[9]=t[1],t})},function(e){var n;return n=[r[8],t.i64.to_string(r[9]),void 0,void 0],r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],n}]):t.sequence([function(o){return e[1]==="144"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerMuteThreadV2"),e[0]).then(function(e){var t;return t=e,r[12]=t[0],r[13]=t[1],t})},function(e){var n;return n=[r[12],t.i64.to_string(r[13]),void 0,void 0],r[8]=n[0],r[9]=n[1],r[10]=n[2],r[11]=n[3],n}]):t.sequence([function(o){return e[1]==="146"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerRemoveThread"),e[0]).then(function(e){var t;return t=e,r[16]=t[0],r[17]=t[1],t})},function(e){var n;return n=[r[16],t.i64.to_string(r[17]),void 0,void 0],r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=n[3],n}]):t.sequence([function(o){return e[1]==="32"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerUpdateThreadName"),e[0]).then(function(e){var t;return t=e,r[20]=t[0],r[21]=t[1],r[22]=t[2],t})},function(e){var n;return n=[r[20],t.i64.to_string(r[21]),void 0,r[22]],r[16]=n[0],r[17]=n[1],r[18]=n[2],r[19]=n[3],n}]):t.sequence([function(o){return e[1]==="362"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerAcsIssueNextSync"),e[0]).then(function(e){var t;return t=e,r[24]=t[0],r[25]=t[1],r[26]=t[2],t})},function(e){var n;return n=[r[24],t.i64.to_string(r[25]),void 0,r[26]],r[20]=n[0],r[21]=n[1],r[22]=n[2],r[23]=n[3],n}]):t.sequence([function(o){return e[1]==="50015"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerEncryptedBackupsRestoreWithSerializer"),e[0]).then(function(e){var t;return t=e,r[28]=t[0],r[29]=t[1],r[30]=t[2],t})},function(e){var n;return n=[r[28],t.i64.to_string(r[29]),void 0,r[30]],r[24]=n[0],r[25]=n[1],r[26]=n[2],r[27]=n[3],n}]):t.sequence([function(o){return e[1]==="319"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerEncryptedBackupAction"),e[0]).then(function(e){var t;return t=e,r[32]=t[0],r[33]=t[1],r[34]=t[2],t})},function(e){var n;return n=[r[32],t.i64.to_string(r[33]),void 0,r[34]],r[28]=n[0],r[29]=n[1],r[30]=n[2],r[31]=n[3],n}]):t.sequence([function(o){return e[1]==="50026"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerEncryptedBackupsUpload"),e[0]).then(function(e){var t;return t=e,r[36]=t[0],r[37]=t[1],t})},function(e){var n;return n=[r[36],t.i64.to_string(r[37]),void 0,void 0],r[32]=n[0],r[33]=n[1],r[34]=n[2],r[35]=n[3],n}]):t.sequence([function(o){return e[1]==="50042"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerEncryptedBackupsUploadProtobufOnly"),e[0]).then(function(e){var t;return t=e,r[40]=t[0],r[41]=t[1],r[42]=t[2],t})},function(e){var n;return n=[r[40],t.i64.to_string(r[41]),void 0,r[42]],r[36]=n[0],r[37]=n[1],r[38]=n[2],r[39]=n[3],n}]):t.sequence([function(o){return e[1]==="700"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerE2eeMetadataThreadIntegrityCheck"),e[0]).then(function(e){var t;return t=e,r[44]=t[0],r[45]=t[1],r[46]=t[2],t})},function(e){var n;return n=[r[44],t.i64.to_string(r[45]),void 0,r[46]],r[40]=n[0],r[41]=n[1],r[42]=n[2],r[43]=n[3],n}]):t.sequence([function(o){return e[1]==="705"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerE2eeMessageIntegrityCheckV2"),e[0]).then(function(e){var t;return t=e,r[48]=t[0],r[49]=t[1],r[50]=t[2],t})},function(e){var n;return n=[r[48],t.i64.to_string(r[49]),void 0,r[50]],r[44]=n[0],r[45]=n[1],r[46]=n[2],r[47]=n[3],n}]):t.sequence([function(o){return e[1]==="50043"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerEncryptedBackupsLoopingUpload"),e[0]).then(function(e){var t;return t=e,r[52]=t[0],r[53]=t[1],r[54]=t[2],t})},function(e){var n;return n=[r[52],t.i64.to_string(r[53]),void 0,r[54]],r[48]=n[0],r[49]=n[1],r[50]=n[2],r[51]=n[3],n}]):t.sequence([function(o){return e[1]==="50048"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerEncryptedBackupsOpenUpload"),e[0]).then(function(e){var t;return t=e,r[56]=t[0],r[57]=t[1],t})},function(e){var n;return n=[r[56],t.i64.to_string(r[57]),void 0,void 0],r[52]=n[0],r[53]=n[1],r[54]=n[2],r[55]=n[3],n}]):t.sequence([function(o){return e[1]==="160013"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerSyncThreadCapabilities"),e[0]).then(function(e){var t;return t=e,r[60]=t[0],r[61]=t[1],r[62]=t[2],t})},function(e){var n;return n=[r[60],t.i64.to_string(r[61]),void 0,r[62]],r[56]=n[0],r[57]=n[1],r[58]=n[2],r[59]=n[3],n}]):t.sequence([function(o){return e[1]==="903"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerDeleteChatHistory"),e[0]).then(function(e){var t;return t=e,r[64]=t[0],r[65]=t[1],r[66]=t[2],t})},function(e){var n;return n=[r[64],t.i64.to_string(r[65]),void 0,r[66]],r[60]=n[0],r[61]=n[1],r[62]=n[2],r[63]=n[3],n}]):t.sequence([function(o){var a;return e[1]==="50057"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerEncryptedBackupsUploadSenderBackup"),e[0]).then(function(e){var t;return t=e,r[68]=t[0],r[69]=t[1],r[70]=t[2],t})},function(e){var n;return n=[r[68],t.i64.to_string(r[69]),void 0,r[70]],r[64]=n[0],r[65]=n[1],r[66]=n[2],r[67]=n[3],n}]):t.resolve((a=[e[2],e[1],void 0,void 0],r[64]=a[0],r[65]=a[1],r[66]=a[2],r[67]=a[3],a))},function(e){var t;return t=[r[64],r[65],r[66],r[67]],r[60]=t[0],r[61]=t[1],r[62]=t[2],r[63]=t[3],t}])},function(e){var t;return t=[r[60],r[61],r[62],r[63]],r[56]=t[0],r[57]=t[1],r[58]=t[2],r[59]=t[3],t}])},function(e){var t;return t=[r[56],r[57],r[58],r[59]],r[52]=t[0],r[53]=t[1],r[54]=t[2],r[55]=t[3],t}])},function(e){var t;return t=[r[52],r[53],r[54],r[55]],r[48]=t[0],r[49]=t[1],r[50]=t[2],r[51]=t[3],t}])},function(e){var t;return t=[r[48],r[49],r[50],r[51]],r[44]=t[0],r[45]=t[1],r[46]=t[2],r[47]=t[3],t}])},function(e){var t;return t=[r[44],r[45],r[46],r[47]],r[40]=t[0],r[41]=t[1],r[42]=t[2],r[43]=t[3],t}])},function(e){var t;return t=[r[40],r[41],r[42],r[43]],r[36]=t[0],r[37]=t[1],r[38]=t[2],r[39]=t[3],t}])},function(e){var t;return t=[r[36],r[37],r[38],r[39]],r[32]=t[0],r[33]=t[1],r[34]=t[2],r[35]=t[3],t}])},function(e){var t;return t=[r[32],r[33],r[34],r[35]],r[28]=t[0],r[29]=t[1],r[30]=t[2],r[31]=t[3],t}])},function(e){var t;return t=[r[28],r[29],r[30],r[31]],r[24]=t[0],r[25]=t[1],r[26]=t[2],r[27]=t[3],t}])},function(e){var t;return t=[r[24],r[25],r[26],r[27]],r[20]=t[0],r[21]=t[1],r[22]=t[2],r[23]=t[3],t}])},function(e){var t;return t=[r[20],r[21],r[22],r[23]],r[16]=t[0],r[17]=t[1],r[18]=t[2],r[19]=t[3],t}])},function(e){var t;return t=[r[16],r[17],r[18],r[19]],r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=t[3],t}])},function(e){var t;return t=[r[12],r[13],r[14],r[15]],r[8]=t[0],r[9]=t[1],r[10]=t[2],r[11]=t[3],t}])},function(e){var t;return t=[r[8],r[9],r[10],r[11]],r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],t}])},function(o){return e[3]?t.sequence([function(e){return r[9]=r[1]==="60009"||r[1]==="60006"||r[1]==="60008"||r[1]==="60011"||r[1]==="765"||r[1]==="1006"||r[1]==="160009"||r[1]==="761"||r[1]==="1018"||r[1]==="632"||r[1]==="384"||r[1]==="384",r[9]&&r[1]!==void 0?(r[15]=["Deidentified task is being executed through the 'identified' path. Canceling task with label: ",r[1]].join(""),(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSCoreSerializeTaskStoredProcedure] ","",r[15]].join("")),r[14]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSCoreSerializeTaskStoredProcedure",r[15],r[14],t.i64.cast([0,3]))):t.resolve()},function(e){return t.resolve(r[8]=!1)},function(e){var t,n,o;return r[9]||r[8]?(t=[void 0,void 0,void 0,void 0],r[10]=t[0],r[11]=t[1],r[12]=t[2],r[13]=t[3]):(n=[r[0],r[1],r[2],r[3]],r[10]=n[0],r[11]=n[1],r[12]=n[2],r[13]=n[3]),o=[r[10],r[11],r[12],r[13]],r[4]=o[0],r[5]=o[1],r[6]=o[2],r[7]=o[3]}]):t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerUnauthenticatedTask"),e[0],r[1],r[0]).then(function(e){var t;return t=e,r[8]=t[0],r[9]=t[1],r[10]=t[2],r[11]=t[3],t})},function(e){return t.i64.neq(r[11],void 0)?t.storedProcedure(n("LSForceTaskExecutionImmediately"),r[11]):t.resolve()},function(e){var n;return n=[r[8],t.i64.to_string(r[9]),void 0,r[10]],r[4]=n[0],r[5]=n[1],r[6]=n[2],r[7]=n[3],n}])},function(e){var t;return t=[r[4],r[5],r[6],r[7]],o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSCoreSerializeTaskStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSSerializeTaskStoredProcedure",["LSSerializeTask","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSSerializeTask"),a.taskId,a.taskLabel,a.taskValue,a.requiresAuthentication);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSShape",["LSDict"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return r("LSDict").fromObject(e)}function s(e){return r("LSDict").shapeToRecord(e)}l.ofRecord=e,l.toRecord=s}),98);
__d("LSBeginHandlingPendingTasksForQueue2",["I64","LSFactory","LSIntEnum","LSPendingTasksPluginType","LSSerializeTaskStoredProcedure","LSShape","LSVec","Promise","ReQL","XPlatReactCrypto","asyncToGeneratorRuntime","gkx","isNativeTask"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=500,d=3e4,m=5,p=100,_=7;function f(e,t){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield e.lightspeed_task_context.get(t);return n==null||n.requiresAuthentication}),g.apply(this,arguments)}function h(e,t){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.pending_tasks.index("queueNameTaskId")).getKeyRange(t));return n==null?{context:void 0,failureCount:(s||(s=o("I64"))).neg_one,httpUrlOverride:void 0,minTimeToSyncTimestampMs:s.neg_one,pluginType:(u||(u=o("LSIntEnum"))).ofNumber(r("LSPendingTasksPluginType").LS_BROKER),queueName:""}:n}),y.apply(this,arguments)}function C(e,t){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.network_requests).getKeyRange(t));return n==null?0:(s||(s=o("I64"))).to_float(n.lastSyncRequestTimestampMs)}),b.apply(this,arguments)}function v(e,t,n){var r=(s||(s=o("I64"))).equal(e.failureCount,(s||(s=o("I64"))).zero)||t;if(r)return 0;var a=(s||(s=o("I64"))).to_float(e.failureCount)>_?(s||(s=o("I64"))).to_float(e.failureCount)-_:(s||(s=o("I64"))).to_float(e.failureCount),i=Math.min((1<<Math.min(a-1,_))*c,d),l=n+i;return Math.max(l-Date.now(),0)}function S(){var e=Array.from(o("XPlatReactCrypto").getRandomValues(new Uint32Array(2)));return e[0]>>>=1,(s||(s=o("I64"))).add(s.lsl_(s.of_float(e[0]),32),s.of_float(e[1]))}function R(){var e=(s||(s=o("I64"))).of_float(Date.now());return s.and_(s.or_(s.lsl_(e,22),s.and_(S(),s.castExn([0,4194303]))),s.castExn([2147483647,4294967295]))}function L(e,t){return E.apply(this,arguments)}function E(){return E=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=R(),r=yield e.network_requests.get(t,(s||(s=o("I64"))).neg_one);return r==null?yield e.network_requests.add({epochId:n,failureCount:(s||(s=o("I64"))).zero,lastSentTimestampMs:s.zero,lastSyncRequestTimestampMs:s.of_float(Date.now()),syncDatabaseId:s.neg_one,taskQueueName:t}):yield e.network_requests.put(babelHelpers.extends({},r,{epochId:n,lastSyncRequestTimestampMs:(s||(s=o("I64"))).of_float(Date.now())})),n}),E.apply(this,arguments)}function k(e,t){return I.apply(this,arguments)}function I(){return I=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){return(yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.network_requests).getKeyRange(t).filter(function(e){return e.epochId!=null})))!=null}),I.apply(this,arguments)}function T(e,t,n){var r=(s||(s=o("I64"))).to_float(e.minTimeToSyncTimestampMs),a=Date.now(),i=r-a,l=i<=0;return l?v(e,t,n):i}function D(e){return e.httpUrlOverride!=null||(s||(s=o("I64"))).to_float(e.failureCount)>_}function x(e){return e.timeoutTimestampMs!=null?(s||(s=o("I64"))).to_float(e.timeoutTimestampMs)<=Date.now():!1}function $(e){return e==="90"||e==="130"||e==="153"}function P(e,t,n,r,o){var a=o===0?void 0:o;return{failureCount:a,label:e,payload:t,queueName:n,taskId:r}}function N(e,t,n){return M.apply(this,arguments)}function M(){return M=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var a=yield r("LSSerializeTaskStoredProcedure")(r("LSFactory")(e),{requiresAuthentication:n,taskId:t.taskId,taskLabel:t.context,taskValue:t.taskValue}),i=a[0],l=a[1],u=a[2],c=a[3];return i==null?c!=null?{minRetryDelayMs:c}:void 0:P(l,i,t.queueName,t.taskId,(s||(s=o("I64"))).to_float(t.failureCount))}),M.apply(this,arguments)}function w(e,t,n){return A.apply(this,arguments)}function A(){return A=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){if(t.context==null){yield e.pending_tasks.delete(t.taskId);return}var r=x(t);if(r){yield e.pending_tasks.delete(t.taskId);return}return N(e,t,n)}),A.apply(this,arguments)}function F(e,t){var n=t>=(r("gkx")("26373")&&e===String(207)?p:m)||$(e);return!n}function O(e,t){return B.apply(this,arguments)}function B(){return B=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield e.pending_tasks.get(t.taskId);n!=null&&(s||(s=o("I64"))).equal(t.firstExecutedTimestampMs,(s||(s=o("I64"))).zero)&&(yield e.pending_tasks.put(babelHelpers.extends({},n,{firstExecutedTimestampMs:(s||(s=o("I64"))).of_float(Date.now())})))}),B.apply(this,arguments)}function W(e,t){return q.apply(this,arguments)}function q(){return q=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r){if(r.length===0)return{epochId:void 0,tasks:[]};var a=[],i=r[0].httpUrlOverride,l=(yield(e||(e=n("Promise"))).all(r.map(function(e){return f(t,e.taskId)}))).some(Boolean);for(var u of r){var c=u.httpUrlOverride===i,d=(yield f(t,u.taskId))===l;if(yield O(t,u),!c||!d)break;var m=yield w(t,u,l);if(m!=null&&m.payload!=null)a.push(m);else if((m==null?void 0:m.minRetryDelayMs)!=null){var p=yield t.pending_tasks.get(u.taskId);if(p!=null){var _;yield t.pending_tasks.put(babelHelpers.extends({},p,{failureCount:(s||(s=o("I64"))).add((_=p.failureCount)!=null?_:(s||(s=o("I64"))).zero,s.one),minTimeToSyncTimestampMs:s.add(m.minRetryDelayMs,s.of_float(Date.now()))}))}}else yield t.pending_tasks.delete(u.taskId);if(!F(u.context,a.length))break}return{epochId:void 0,tasks:a}}),q.apply(this,arguments)}function U(e,t,n,r,o){return V.apply(this,arguments)}function V(){return V=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r,o){o===void 0&&(o=!0);var a=yield W(e,t),i=a.tasks;if(i.length===0)return{httpUrlOverride:void 0,networkPayload:void 0,nextSyncMs:void 0,queueName:n,skipRealtimeGateway:!1,workItemType:4};if(o===!0){var l=yield L(e,n);a.epochId=l}var s=yield h(e,n);return{httpUrlOverride:s.httpUrlOverride,networkPayload:a,nextSyncMs:void 0,queueName:n,skipRealtimeGateway:D(s),workItemType:r}}),V.apply(this,arguments)}function H(e,t,n){return G.apply(this,arguments)}function G(){return G=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var a=yield h(e,t),i=yield C(e,t),l=T(a,n,i),s=l!==0;if(s)return[{httpUrlOverride:void 0,networkPayload:void 0,nextSyncMs:l,queueName:t,skipRealtimeGateway:!1,workItemType:3}];var u=[],c=yield o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(e.pending_tasks.index("queueNameTaskId")).getKeyRange(t)),d=c.filter(r("isNativeTask"));if(d.length>0){var m=yield U(e,d,t,2,r("gkx")("4778")===!0);u.push(m)}var p=c.filter(function(e){return!r("isNativeTask")(e)});if(p.length>0){var _=yield U(e,p,t,1);u.push(_)}return u}),G.apply(this,arguments)}function z(e,t,n){return j.apply(this,arguments)}function j(){return j=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=!(yield k(e,t));return r?H(e,t,n):[{httpUrlOverride:void 0,networkPayload:void 0,nextSyncMs:void 0,queueName:t,skipRealtimeGateway:!1,workItemType:4}]}),j.apply(this,arguments)}function K(e,t){return Q.apply(this,arguments)}function Q(){return Q=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=t.ignoreSoftDelay,a=t.queueName,i=yield z(e,a,n);return i.map(function(e){var t,n,a;return o("LSShape").ofRecord({network_payload:o("LSShape").ofRecord({epoch_id:(t=e.networkPayload)==null?void 0:t.epochId,tasks:r("LSVec").ofArray(((n=(a=e.networkPayload)==null?void 0:a.tasks)!=null?n:[]).map(function(e){var t;return o("LSShape").ofRecord({failure_count:e.failureCount!=null?(s||(s=o("I64"))).of_float(e.failureCount):void 0,label:(t=e.label)!=null?t:void 0,payload:e.payload,queue_name:e.queueName,task_id:e.taskId})}))}),next_sync_ms:e.nextSyncMs!=null?(s||(s=o("I64"))).of_float(e.nextSyncMs):void 0,queue_name:e.queueName,skip_realtime_gateway:e.skipRealtimeGateway,work_item_type:(u||(u=o("LSIntEnum"))).ofNumber(e.workItemType)})})}),Q.apply(this,arguments)}K._updateTaskIfNeeded=O,K._getHeadOfNormalQueue=h,K._lastSyncRequestTimestampForQueue=C,K._exponentialBackoffForNormalQueue=v,K._generateNewEpoch=R,K._openNewEpochForQueue=L,K._isEpochOpenForQueue=k,K._calculateDelayForNormalQueue=T,K._queueShouldSkipRealtimeGateway=D,K._isNativeTask=r("isNativeTask"),K._taskIsTimedOut=x,K._taskShouldStopBatching=$,K._buildTaskPayloadExpressionForNormalTaskWithParameters=P,K._buildTaskPayloadExpressionForValidatedNormalTask=N,K._buildTaskPayloadExpressionForUnvalidatedNormalTask=w,K._workForNormalQueueWithoutDelay=U,K._workForNormalQueueWithClosedEpoch=H,K._buildWorkForNormalQueue=z,K._buildNetworkPayloadShapeForTasks=W,K._canContinueBatchingForQueue=F,l.default=K}),98);
__d("LSBitOffset",["I64","LSBitFlag"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,n){return o("LSBitFlag").set((e||(e=o("I64"))).lsl_(e.one,e.to_int32(t)),n)}function u(t,n){return o("LSBitFlag").clear((e||(e=o("I64"))).lsl_(e.one,e.to_int32(t)),n)}l.set=s,l.clear=u,l.empty=(e||(e=o("I64"))).zero}),98);
__d("LSContactBitOffset",["I64","LSBitFlag","LSBitOffset"],(function(t,n,r,o,a,i,l){"use strict";var e,s=["capabilities","capabilities2"];function u(e,t){return c(e,t,!1)}function c(t,n,r){var a,i=n.capabilities,l=n.capabilities2;if(t>=64){var s;return l==null?r:o("LSBitFlag").has((e||(e=o("I64"))).lsl_(e.one,t-64),(s=n.capabilities2)!=null?s:o("LSBitOffset").empty)}return i==null?r:o("LSBitFlag").has((e||(e=o("I64"))).lsl_(e.one,t),(a=n.capabilities)!=null?a:o("LSBitOffset").empty)}function d(t,n){return o("LSBitFlag").has((e||(e=o("I64"))).lsl_(e.one,t-64),n!=null?n:o("LSBitOffset").empty)}l.contactCapabilityFields=s,l.has=u,l.hasWithDefault=c,l.contactCapabilitiesHas=d}),98);
__d("LSContactBlockedByViewerStatus",[],(function(t,n,r,o,a,i){var e=Object.freeze({UNBLOCKED:0,MESSAGE_BLOCKED:1,FULLY_BLOCKED:2});i.default=e}),66);
__d("LSContactType",[],(function(t,n,r,o,a,i){var e=Object.freeze({UNKNOWN:0,USER:1,PAGE:2,PAGE_PERSONA:3});i.default=e}),66);
__d("LSContactViewerRelationship",[],(function(t,n,r,o,a,i){var e=Object.freeze({UNKNOWN:0,NOT_CONTACT:1,CONTACT_OF_VIEWER:2,FACEBOOK_FRIEND:3,SOFT_CONTACT:4});i.default=e}),66);
__d("LSCookie",["$InternalEnum","Cookie","CookieCore","CurrentEnvironment","CurrentMessengerUser","FBLogger","I64","LSE2EEMetadataSyncGroupUtils","LSIntEnum","MessengerLogHistory","MqttWebDeviceID","ReQL","SortedAsyncIterable","getErrorSafe","isPromise","isStringNullOrEmpty","pageID","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=n("$InternalEnum")({SYNCING:"1",NOT_SYNCING:"0"}),d=o("MessengerLogHistory").getInstance("client_init"),m=r("CurrentEnvironment").instagramdotcom?"igd_ls":"m_ls",p={c:{},d:r("MqttWebDeviceID").clientID,s:c.NOT_SYNCING,u:r("pageID")};function _(e){function t(e){o("CookieCore").setWithDomain_FOR_MESSENGER_LS_ONLY(m,JSON.stringify(e),window.location.hostname)}var n=r("Cookie").get(m);if(n==null){var a;t((a={},a[o("CurrentMessengerUser").getIDorEIMU()]=e,a));return}var i=JSON.parse(n);if(i.u==null){var l;t(babelHelpers.extends({},i,(l={},l[o("CurrentMessengerUser").getIDorEIMU()]=e,l)))}else{var s;t((s={},s[o("CurrentMessengerUser").getIDorEIMU()]=e,s))}}function f(){r("Cookie").clear(m)}function g(e){if(typeof e!="object"||e==null)return null;var t=e.c,n=e.d,r=e.s,o=e.u,a=typeof r=="string"?c.cast(r):null,i=typeof t=="object"&&t!=null?Object.entries(t).reduce(function(e,t){var n=t[0],r=t[1];return e==null||typeof r!="string"?null:(e[n]=r,e)},{}):null;return typeof n!="string"||a==null||i==null||typeof o!="string"?null:{c:i,d:n,s:a,u:o}}function h(){var e,t=r("Cookie").get(m);if(r("isStringNullOrEmpty")(t))return p;var n=JSON.parse(t),a=o("CurrentMessengerUser").getIDorEIMU(),i=g(n),l=typeof n=="object"&&n!=null?g(n[a]):null;return(e=l!=null?l:i)!=null?e:p}function y(e){var t=h();if(t.u===r("pageID")){var n={};e.forEach(function(e){var t=e[0],r=e[1],a=r.currentCursor,i=r.groupId;a!=null&&(n[(s||(s=o("I64"))).to_string(i)]=a)}),d.debug("Updated sync cookie to set syncing=false, saving latest cursors"),_(babelHelpers.extends({},t,{c:n,s:c.NOT_SYNCING}))}}var C=[1,2,o("LSE2EEMetadataSyncGroupUtils").shouldAlwaysResetE2EEMetadata()?null:95];function b(t){var n=o("SortedAsyncIterable").toArray(o("ReQL").union.apply(void 0,C.map(function(e){return e==null?o("ReQL").empty():o("ReQL").fromTableAscending(t.tables.sync_groups).getKeyRange((u||(u=o("LSIntEnum"))).ofNumber(e))})));if((e||(e=r("isPromise")))(n)){r("promiseDone")(n.then(function(e){y(e)}));return}y(n)}function v(){try{var e=h();d.debug("Updated sync cookie to set syncing=true"),_(babelHelpers.extends({},e,{s:c.SYNCING,u:r("pageID")}))}catch(e){r("FBLogger")("messenger_web").catching(r("getErrorSafe")(e)).warn("[LS] Failed to sync cookie")}}l.Status=c,l.DEFAULT_COOKIE=p,l.clear=f,l.get=h,l.syncBeforeUnload=b,l.setSyncing=v}),98);
__d("LSDataTraceFlushDeferred",["MetaConfig","Promise","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s=r("requireDeferred")("LSDataTraceFlush").__setRef("LSDataTraceFlushDeferred");function u(t){return r("MetaConfig")._("62")?s.load().then(function(e){return e.flushExpiredDataTraces(t)}):(e||(e=n("Promise"))).resolve(function(){})}l.watchForExpiredTraces=u}),98);
__d("LSDatabaseProviderType",[],(function(t,n,r,o,a,i){"use strict";function e(e){return l(e.persistenceTypes)}function l(e){return e.includes("indexeddb")}i.isProviderPersisted=e,i.hasPersistentType=l}),66);
__d("LSJSONOp",["$InternalEnum"],(function(t,n,r,o,a,i){var e=n("$InternalEnum")({BLOCK:1,LOAD:2,STORE:3,STORE_ARRAY:4,CALL_STORED_PROCEDURE:5,CALL_NATIVE_TYPE_OPERATION:6,CALL_NATIVE_OPERATION:7,LIST:8,UNDEFINED:9,INFINITY:10,NAN:11,RETURN:12,BOOL_TO_STR:13,BLOBS_TO_STRING:14,BLOBS_OF_STRING:15,TO_BLOB:16,I64_OF_FLOAT:17,I64_TO_FLOAT:18,I64_FROM_STRING:19,I64_TO_STRING:20,READ_GK:21,READ_QE:22,IF:23,OR:24,AND:25,NOT:26,IS_NULL:27,ENFORCE_NOT_NULL:28,GENERIC_EQUAL:29,I64_EQUAL:30,BLOB_EQUAL:31,GENERIC_NOT_EQUAL:32,I64_NOT_EQUAL:33,BLOB_NOT_EQUAL:34,GENERIC_GREATER_THAN:35,I64_GREATER_THAN:36,BLOB_GREATER_THAN:37,GENERIC_GREATER_THAN_OR_EQUAL:38,I64_GREATER_THAN_OR_EQUAL:39,BLOB_GREATER_THAN_OR_EQUAL:40,GENERIC_LESS_THAN:41,I64_LESS_THAN:42,BLOB_LESS_THAN:43,GENERIC_LESS_THAN_OR_EQUAL:44,I64_LESS_THAN_OR_EQUAL:45,BLOB_LESS_THAN_OR_EQUAL:46,THROW:47,LOG_CONSOLE:48,LOGGER_LOG:49,NATIVE_OP_ARRAY_CREATE:50,NATIVE_OP_ARRAY_APPEND:51,NATIVE_OP_ARRAY_GET_SIZE:52,NATIVE_OP_MAP_CREATE:53,NATIVE_OP_MAP_GET:54,NATIVE_OP_MAP_SET:55,NATIVE_OP_MAP_KEYS:56,NATIVE_OP_MAP_DELETE:57,NATIVE_OP_MAP_HAS:58,NATIVE_OP_STR_JOIN:59,NATIVE_OP_CURRENT_TIME:60,NATIVE_OP_JSON_STRINGIFY:61,NATIVE_OP_RNG_NUM:62,NATIVE_OP_LOCALIZATION_SUPPORTED:63,NATIVE_OP_LOCALIZATION_SUPPORTED_V2:64,NATIVE_OP_RESOLVE_LOCALIZED:65,NATIVE_OP_RESOLVE_LOCALIZED_V2:66,ADD:68,I64_ADD:69,I64_CAST:70,READ_JUSTKNOB:71,READ_IGGK:72,GET_RUN_MODE:73,STR_TRIM:74,STR_REPLACE:75,JOIN:76,STR_LIKE:77,LENGTH:78,IN:79,IN_VEC:80,SUB:81,MUL:82,DIV:83,MOD:84,I64_SUB:85,I64_MUL:86,I64_DIV:87,I64_MOD:88,I64_IN:89,I64_IN_VEC:90,BITWISE_LEFT_SHIFT:91,BITWISE_RIGHT_SHIFT:92,ARITHMETIC_RIGHT_SHIFT:93,BITWISE_AND:94,BITWISE_OR:95,BITWISE_XOR:96,TERNARY:97,XOR:98,NULLISH_COALESE:99,READ_COLUMN:100,READ_COLUMN_REF:101,READ_GROUP_COUNT:102,COMMENT:103,IMPORT:104,LOOP:105,QUERY_COMPARISON_EQUAL:106,QUERY_COMPARISON_NOT_EQUAL:107,QUERY_COMPARISON_GREATER_THAN:108,QUERY_COMPARISON_GREATER_THAN_OR_EQUAL:109,QUERY_COMPARISON_LESS_THAN:110,QUERY_COMPARISON_LESS_THAN_OR_EQUAL:111,QUERY_MERGE_CONSTRAINTS:112,QUERY_FETCH_ROWS:113,QUERY_FILTER_ROWS:114,QUERY_SORT_ROWS_BY:115,QUERY_DELETE_ROWS:116,QUERY_SLICE_ROWS:117,QUERY_COUNT_ROWS:118,QUERY_PEEK_NEXT_ROW_ID:119,QUERY_UPDATE_ROWS:120,QUERY_INSERT_ROWS:121,QUERY_PUT_ROWS:122,QUERY_FOREACH_ROW:123,QUERY_SELECT_MATCH_ROW:124,QUERY_CURSOR_SLICE:125,QUERY_GROUP_BY:126,SUB_STRING:127}),l=e;i.default=l}),66);
__d("LSMaybeDeferredImports",["LSSynchronousPromise"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return u(e)}function s(e){return u(e)}function u(e){var t=null;return{load:function(){return t==null?e.load().then(function(e){return t=e,t}):o("LSSynchronousPromise").makeSynchronousPromise(t)}}}l.wrapReqDeferredMaybeSync=e,l.wrapJSResourceForInteractionMaybeSync=s}),98);
__d("LSSelectOrder",["$InternalEnum"],(function(t,n,r,o,a,i){var e=n("$InternalEnum").Mirrored(["ASC","DESC"]),l=e;i.default=l}),66);
__d("LSDatascriptJSONEval",["FBLogger","JSResourceForInteraction","LS","LSMaybeDeferredImports","getErrorSafe","isPromise"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=o("LSMaybeDeferredImports").wrapJSResourceForInteractionMaybeSync(r("JSResourceForInteraction")("LSLocalize").__setRef("LSDatascriptJSONEval"));function d(e,t,n){if((u||(u=r("isPromise")))(e))return e.then(t,n);try{return t(e)}catch(e){var o=r("getErrorSafe")(e);if(n)return n(o);throw o}}var m=(function(){function t(e,t,n,o){var a=this;o===void 0&&(o=[]),this.$4={},this.$5=[],this.$6=null,this.$7=function(e){return d(a.$8(e),function(e){return e},function(t){throw r("FBLogger")("messenger_web").catching(t).mustfix("Error evaluating step op: %s",Array.isArray(e)?e[0]:"<primitive value>"),t})},this.$1=t,this.$2=e,this.$3=n;for(var i=0;i<o.length;i++)this.$4[i]=o[i]}var o=t.prototype;return o.eval=function(){return this.$2==null?this.$1.resolveGuaranteeAsync([]):this.$1.resolveGuaranteeAsync(this.$7(this.$2.step))},o.$8=function(o){var t=this,a,i,l,u,m,p,_,f,g,h,y,C;if(!Array.isArray(o))return o;var b=o[0],v=babelHelpers.arrayLikeToArray(o).slice(1),S=v;switch(b){case 8:return S.map(this.$7);case 2:return this.$4[S[0]];case 3:return d(this.$7(S[1]),function(e){return t.$4[S[0]]=e});case 4:return d(this.$7(S[2]),function(e){for(var n=S[0],r=S[1],o=0;o<r;o++,n++)t.$4[n]=e[o];return e});case 12:{for(var R=S[0],L=S[1],E=[],k=R;k<L;k++)E[k]=this.$4[k];return E}case 1:{for(var I,T=function(n){I=d(I,function(){return t.$7(S[n])})},D=0;D<S.length;D++)T(D);return I}case 5:return(a=this.$1).storedProcedure.apply(a,S.map(this.$7));case 6:return(i=this.$1).nativeTypeOperation.apply(i,S.map(this.$7));case 7:return(l=this.$1).nativeOperation.apply(l,S.map(this.$7));case 9:return;case 10:return 1/0;case 11:return NaN;case 13:return this.$7(S[0])?"1":"0";case 14:return this.$1.blobs.to_string(this.$7(S[0]));case 15:return this.$1.blobs.of_string(this.$7(S[0]));case 16:return this.$1.blob(this.$7(S[0]));case 17:return this.$1.i64.of_float(this.$7(S[0]));case 18:{var x=this.$7(S[0]);return x!=null?this.$1.i64.to_float(x):void 0}case 19:return this.$1.i64.from_string(this.$7(S[0]));case 70:return this.$1.i64.cast(this.$7(S[0]));case 20:return this.$1.i64.to_string(this.$7(S[0]));case 21:return(u=this.$3)==null||(u=u.gk)==null?void 0:u[S[0]];case 22:{var $,P=S[0],N=S[1],M=S[2],w=S[3],A=($=this.$3)==null||($=$.qe)==null||($=$[P])==null||($=$[N])==null?void 0:$[M];if(A==null)return A;switch(w){case"BOOL":case"STR":return A;case"I64":{if(typeof A!="object")throw r("FBLogger")("messenger_web").mustfixThrow("Cannot convert value to string");return this.$1.i64.from_string(A.toString())}}return}case 23:return this.$7(S[0])?this.$7(S[1]):S[2]!=null?this.$7(S[2]):void 0;case 24:return this.$7(S[0])||this.$7(S[1]);case 25:return this.$7(S[0])&&this.$7(S[1]);case 26:return!this.$7(S[0]);case 27:return this.$7(S[0])==null;case 28:return this.$1.notnull(this.$7(S[0]));case 29:return this.$7(S[0])===this.$7(S[1]);case 30:return this.$1.i64.eq(this.$7(S[0]),this.$7(S[1]));case 31:return this.$1.blobs.eq(this.$7(S[0]),this.$7(S[1]));case 32:return this.$7(S[0])!==this.$7(S[1]);case 33:return this.$1.i64.neq(this.$7(S[0]),this.$7(S[1]));case 34:return this.$1.blobs.neq(this.$7(S[0]),this.$7(S[1]));case 35:return this.$7(S[0])>this.$7(S[1]);case 36:return this.$1.i64.gt(this.$7(S[0]),this.$7(S[1]));case 37:return this.$1.blobs.gt(this.$7(S[0]),this.$7(S[1]));case 38:return this.$7(S[0])>=this.$7(S[1]);case 39:return this.$1.i64.ge(this.$7(S[0]),this.$7(S[1]));case 40:return this.$1.blobs.ge(this.$7(S[0]),this.$7(S[1]));case 41:return this.$7(S[0])<this.$7(S[1]);case 42:return this.$1.i64.lt(this.$7(S[0]),this.$7(S[1]));case 43:return this.$1.blobs.lt(this.$7(S[0]),this.$7(S[1]));case 44:return this.$7(S[0])<=this.$7(S[1]);case 45:return this.$1.i64.le(this.$7(S[0]),this.$7(S[1]));case 46:return this.$1.blobs.le(this.$7(S[0]),this.$7(S[1]));case 47:return this.$1.throw(S[0]);case 48:return this.$1.print(this.$7(S[0]));case 49:{var F=this.$7(S[0]),O=S[1],B=this.$1.logger(F);switch(O){case"mustfix":return B.mustfix(F);case"info":return B.info(F);case"warn":return B.warn(F);case"debug":return B.debug(F);default:throw r("FBLogger")("messenger_web").mustfixThrow("Invalid logger level %s",O)}}case 50:return S.length===0?this.$1.createArray():(m=this.$1).createArrayWithElements.apply(m,this.$7(S[0]));case 51:{var W=this.$7(S[0]);return W.push(this.$7(S[1])),W}case 52:return this.$1.i64.of_int32(this.$7(S[0]).length);case 53:return new this.$1.Map;case 54:return this.$7(S[0]).get(this.$7(S[1]));case 55:return this.$7(S[0]).set(this.$7(S[1]),this.$7(S[2]));case 56:return this.$7(S[0]).keys();case 57:return this.$7(S[0]).delete(this.$7(S[1]));case 58:return this.$7(S[0]).has(this.$7(S[1]));case 59:return this.$7(S[0]).join(this.$7(S[1])||"");case 60:return this.$1.i64.of_float(Date.now());case 61:return this.$1.toJSON(this.$7(S[0]));case 62:return this.$1.i64.random();case 63:case 64:return!0;case 65:return c.load().then(function(e){var n=e.localizeV1Async;return n(t.$7(S[0]),t.$7(S[1]))});case 66:return c.load().then(function(e){var n=e.localizeV2Async;return n(t.$7(S[0]),t.$7(S[1]))});case 68:return this.$7(S[0])+this.$7(S[1]);case 69:return this.$1.i64.add(this.$7(S[0]),this.$7(S[1]));case 71:return(p=this.$3)==null||(p=p.justknob)==null?void 0:p[S[0]];case 72:return(_=this.$3)==null||(_=_.iggk)==null?void 0:_[S[0]];case 100:return this.$5[S[0]][S[1]];case 101:{if(this.$6==null)throw r("FBLogger")("messenger_web").mustfixThrow("Attempting to read column ref when none exist!");return this.$6[S[0]]}case 102:return this.$5[this.$7(S[0])].group_count;case 73:return this.$1.rm;case 74:return this.$7(S[0]).trim();case 75:return this.$7(S[0]).split(this.$7(S[1])).join(this.$7(S[2]));case 76:return S.map(this.$7).join("");case 77:return this.$1.like(this.$7(S[0]),this.$7(S[1]));case 78:return[0,this.$7(S[0]).length];case 79:{var q=S.map(this.$7),U=q[0],V=babelHelpers.arrayLikeToArray(q).slice(1);return V.includes(U)}case 80:return this.$7(S[1]).includes(this.$7(S[0]));case 81:return this.$7(S[0])-this.$7(S[1]);case 82:return this.$7(S[0])*this.$7(S[1]);case 83:return this.$7(S[0])/this.$7(S[1]);case 84:return this.$7(S[0])%this.$7(S[1]);case 91:return this.$1.i64.lsl_(this.$7(S[0]),this.$1.i64.to_int32(this.$7(S[1])));case 92:return this.$1.i64.lsr_(this.$7(S[0]),this.$1.i64.to_int32(this.$7(S[1])));case 93:return this.$1.i64.asr_(this.$7(S[0]),this.$1.i64.to_int32(this.$7(S[1])));case 94:return this.$1.i64.and_(this.$7(S[0]),this.$7(S[1]));case 95:return this.$1.i64.or_(this.$7(S[0]),this.$7(S[1]));case 96:return this.$1.i64.xor(this.$7(S[0]),this.$7(S[1]));case 85:return this.$1.i64.sub(this.$7(S[0]),this.$7(S[1]));case 86:return this.$1.i64.mul(this.$7(S[0]),this.$7(S[1]));case 87:return this.$1.i64.div(this.$7(S[0]),this.$7(S[1]));case 88:return this.$1.i64.mod_(this.$7(S[0]),this.$7(S[1]));case 89:{var H=S.map(this.$7),G=H[0],z=babelHelpers.arrayLikeToArray(H).slice(1);return z.some(function(e){return t.$1.i64.eq(G,e)})}case 90:{var j=this.$7(S[0]);return this.$7(S[1]).some(function(e){return t.$1.i64.eq(j,e)})}case 97:return this.$7(S[0])?this.$7(S[1]):this.$7(S[2]);case 98:{var K=this.$7(S[0]),Q=this.$7(S[1]);return(K||Q)&&!(K&&Q)}case 99:return(f=this.$7(S[0]))!=null?f:this.$7(S[1]);case 103:return;case 104:return n.call(null,S[0]);case 105:{for(var X=this.$7(S[0]),Y=S[1],J=r("LS").n,Z,ee=function(n){Z=d(Z,function(){return t.$4[Y]=n,t.$7(S[2])})},te=J(e||(e=babelHelpers.taggedTemplateLiteralLoose(["0"])));this.$1.i64.lt(te,X);te=this.$1.i64.add(te,J(s||(s=babelHelpers.taggedTemplateLiteralLoose(["2"])))))ee(te);return Z}case 106:return this.$7(S[0]);case 107:throw r("FBLogger")("messenger_web").mustfixThrow("not equal query comparison operator not supported");case 108:return{gt:this.$7(S[0])};case 109:return{gte:this.$7(S[0])};case 110:return{lt:this.$7(S[0])};case 111:return{lte:this.$7(S[0])};case 112:return S.length===1?this.$7(S[0]):(g=this.$1).merge.apply(g,S.map(this.$7));case 113:{var ne=S[0],re=S[1],oe=babelHelpers.arrayLikeToArray(S).slice(2),ae=oe.map(this.$7);switch(re){case"ASC":return(h=this.$1.db.table(ne)).fetch.apply(h,ae);case"DESC":return(y=this.$1.db.table(ne)).fetchDesc.apply(y,ae)}return}case 114:return this.$1.filter(this.$7(S[0]),function(e){t.$6=e;var n=t.$7(S[1]);return t.$6=null,n});case 115:return(C=this.$1).sortBy.apply(C,S.map(this.$7));case 116:return this.$1.forEach(this.$7(S[0]),function(e){return e.delete()});case 117:return this.$1.islc(this.$7(S[0]),0,this.$7(S[1]));case 118:return this.$1.count(this.$7(S[0]));case 119:return this.$1.db.table(S[0]).peekNextAutoIncrementId();case 120:return this.$1.forEach(this.$7(S[0]),function(e){var n=e.item,r=e.update,o={};t.$6=n;for(var a=1;a<S.length;a+=2)o[S[a]]=t.$7(S[a+1]);return t.$6=null,r(o)});case 121:{for(var ie=S[0],le={},se=1;se<S.length;se+=2)le[S[se]]=this.$7(S[se+1]);return this.$1.db.table(ie).add(le)}case 122:{for(var ue=S[0],ce={},de=1;de<S.length;de+=2)ce[S[de]]=this.$7(S[de+1]);return this.$1.db.table(ue).put(ce)}case 123:return this.$1.forEach(this.$7(S[0]),function(e){var n=e.item;return t.$5[S[1]]=n,t.$7(S[2])});case 124:return this.$7(S[0]).next().then(function(e){var n=e.done,r=e.value;if(n)return t.$7(S[3]);var o=S[1];return o!=null?(t.$5[o]=r.item,t.$7(S[2])):0});case 125:return this.$7(S[0]).slice(0,this.$7(S[1]));case 126:return this.$1.groupBy(this.$7(S[0]),S[1]).forEach(function(e){return t.$5[S[2]]=e,t.$7(S[3])});case 127:return this.$7(S[0]).substr(this.$1.i64.to_int32(this.$7(S[1])),this.$1.i64.to_int32(this.$7(S[2])))}},t})();l.default=m}),98);
__d("LSProgramTarget",["$InternalEnum"],(function(t,n,r,o,a,i){var e=n("$InternalEnum")({DASM:1,JS:2,JSON:3}),l=e;i.default=l}),66);
__d("MWPBumpEntityKey",["CurrentAppID","ODS"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,n){(e||(e=o("ODS"))).bumpEntityKey(3185,t,n)}function u(e,t){var n=o("CurrentAppID").getAppID(),r=n==null?"unknown":n;return s(e,t+"."+r)}l.bumpEntityKey=s,l.bumpEntityKeyWithAppId=u}),98);
__d("TrustedTypesUnsafeFunctionScriptPolicy_DO_NOT_USE",["Env","TrustedTypes","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s={createScript:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];n.forEach(function(e){if(typeof window!="undefined"&&typeof window.trustedTypes!="undefined"&&!window.trustedTypes.isScript(e))throw r("err")("Trusted Function requires TrustedScripts args only.")});var a=n.slice(0,-1).join(","),i=n.pop().toString();return"(function anonymous(\n     "+a+"\n     ) {\n     "+i+"\n     })"}},u=r("TrustedTypes").createPolicy("unsafe-function-do-not-use",s);function c(){for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];if(r("TrustedTypes").isSupportedNatively()&&(e||(e=r("Env"))).useTrustedTypes){var i=u.createScript.apply(u,[""].concat(o));return t.eval(i)}else return babelHelpers.construct(Function,o)}l.TrustedTypesUnsafeFunctionScriptPolicy_DO_NOT_USE=u,l.createTrustedFunction=c}),98);
__d("LSDatascriptEvaluator",["ExecutionEnvironment","FBLogger","LSDatascriptJSONEval","LSFactory","MWPBumpEntityKey","TrustedTypesNoOpPolicy_DO_NOT_USE","TrustedTypesUnsafeFunctionScriptPolicy_DO_NOT_USE","cr:8018","getErrorSafe","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t){var n=function(n){return function(t,r){var o;return e==null||(o=e.qe)==null||(o=o[t])==null||(o=o[n])==null?void 0:o[r]}},a=new Proxy({getBool:n("fb"),getNumber:n("fb"),getString:n("fb")},{get:function(t,r){return r in t?t[r]:{getBool:n(r),getNumber:n(r),getString:n(r)}}}),i=function(n){var t;return e==null||(t=e.gk)==null?void 0:t[n]};i.ig=function(t){var n;return e==null||(n=e.iggk)==null?void 0:n[t]};var l={getBool:function(n){var t;return e==null||(t=e.justknob)==null?void 0:t[n]}};return function(e){var n,s=o("TrustedTypesUnsafeFunctionScriptPolicy_DO_NOT_USE").createTrustedFunction((n=r("TrustedTypesNoOpPolicy_DO_NOT_USE")).createScript("gkx"),n.createScript("qex"),n.createScript("justknobx"),n.createScript("return "+t));return s(i,a,l)(r("LSFactory")(e,{dynamic:!0}))}}var u=function(t){return r("FBLogger")("messenger_web","invalid_sync_script_target").mustfixThrow('Received a sync script with an illegal target of "%s"',t!=null?t:-1)};function c(t,o){var a=JSON.parse(o),i=t!=null?t:{gk:{},iggk:{},justknob:{},qe:{}};return function(t){var o=n("cr:8018")!=null?new(n("cr:8018")):void 0,l=o==null?void 0:o.start({bool:{isInWorker:(e||(e=r("ExecutionEnvironment"))).isInWorker},string:{dynamic:String(!0)}}),s=r("LSFactory")(t,{dynamic:!0,lsRuntimeLogger:o});return new(r("LSDatascriptJSONEval"))(a,s,i).eval().finally(function(){return l==null||l.end(),Promise.resolve()})}}function d(e,t,n){if(!r("justknobx")._("3078"))return m(e,t,n);if(n==null)throw u(n);switch(n){case 3:return c(e,t);default:throw u(n)}}function m(e,t,n){if(n==null)return r("FBLogger")("lightspeed","null_target").mustfix("Received <null> target field for sync script!"),s(e,t);switch(n){case 3:return c(e,t);case 2:return s(e,t);case 1:throw r("FBLogger")("messenger_web","invalid_sync_script_target").mustfixThrow("Received a sync script with LSProgramTarget of DASM, this should never happen!")}}function p(e){return function(t){if(t==null)throw r("FBLogger")("messenger_web").mustfixThrow("Error creating eval function, db is undefined. This is likely a currying error in the definition for LSDatascriptEvaluator");return function(n){var a=n.experiments,l=n.priority,s=n.syncScript,u=n.target,c=n.taskNames,m=a!=null?JSON.parse(a):null;try{var p=d(m,s,u);return t.runInTransaction(function(t){return e&&e(),p(t)},"readwrite",l,{taskNames:c,type:"sync_script"},i.id+":247")}catch(e){o("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform","eval_datascript_failure");var _=r("getErrorSafe")(e);throw r("FBLogger")("messenger_web").catching(_).mustfix("Error executing sync script"),e}}}}p.__debugModuleName="LSDatascriptEvaluator",l.default=p}),98);
__d("LSDatascriptEvaluatorEager",["LSDatascriptEvaluator","Promise"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return(e||(e=n("Promise"))).resolve(r("LSDatascriptEvaluator"))}l.default=s}),98);
__d("LSDatascriptEvaluatorMaybeDeferred",["cr:6542"],(function(t,n,r,o,a,i,l){"use strict";l.default=n("cr:6542")}),98);
__d("LSTruncateTableAndSetShowError",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(r){return t.sequence([function(e){return t.forEach(t.db.table(115).fetch(),function(e){return e.delete()})},function(r){return n[0]=t.i64.of_float(Date.now()),t.db.table(115).add({statusId:t.i64.cast([0,0]),timestampMs:n[0],errorShouldBeShown:e[0]})}])},function(e){return t.resolve(r)}])}e.__sproc_name__="LSConnectivityTruncateTableAndSetShowErrorStoredProcedure",e.__tables__=["user_visible_network_connectivity_error"],a.exports=e}),null);
__d("LSDeleteAllAndInsertConnectivityStatus",["LSTruncateTableAndSetShowError"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(e){return t.forEach(t.db.table(114).fetch(),function(e){return e.delete()})},function(n){return r[0]=t.i64.of_float(Date.now()),t.db.table(114).add({statusId:void 0,timestampMs:r[0],internetConnectionState:e[0]})},function(r){return t.storedProcedure(n("LSTruncateTableAndSetShowError"),t.i64.neq(e[0],t.i64.cast([0,1])))}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSConnectivityDeleteAllAndInsertConnectivityStatusStoredProcedure",e.__tables__=["connectivity_status"],a.exports=e}),null);
__d("LSDeleteAllAndInsertConnectivityStatusStoredProcedure",["LSDeleteAllAndInsertConnectivityStatus","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSDeleteAllAndInsertConnectivityStatus"),a.internetConnectionState);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSEagerlyLoadOnMessenger",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e}i.eagerlyLoadOnMessenger=e}),66);
__d("LSGroupParticipantJoinState",[],(function(t,n,r,o,a,i){var e=Object.freeze({MEMBER:0,PENDING:1,INVITED:2});i.default=e}),66);
__d("LSSyncStoredProcedureUtils",["I64","ReQL","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t,n){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,r){var a=r!=null?(e||(e=o("I64"))).of_float(Date.now()+r):n.minTimeToSyncTimestampMs;yield t.pending_tasks.put(babelHelpers.extends({},n,{failureCount:(e||(e=o("I64"))).add(n.failureCount,e.one),minTimeToSyncTimestampMs:a}))}),u.apply(this,arguments)}function c(e,t,n){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.pending_tasks.index("queueNameTaskId")).getKeyRange(t));if(r!=null)return s(e,r,n)}),d.apply(this,arguments)}function m(e,t,n){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,r){var a=yield t.network_requests.get(n,r);a!=null&&(yield t.network_requests.put(babelHelpers.extends({},a,{failureCount:(e||(e=o("I64"))).add(a==null?void 0:a.failureCount,e.one)})))}),p.apply(this,arguments)}function _(e,t,n){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=yield e.network_requests.get(t,n);r!=null&&(yield e.network_requests.put(babelHelpers.extends({},r,{epochId:void 0,networkTaskIdentifier:void 0})))}),f.apply(this,arguments)}l.incrementPendingTaskFailureCount=s,l.incrementPendingTasksTaskFailureCount=c,l.incrementNetworkRequestsTaskFailureCount=m,l.closeEpoch=_}),98);
__d("LSHandleTaskSendFailureForQueue2",["I64","LSSyncStoredProcedureUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t,n){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,r){yield o("LSSyncStoredProcedureUtils").incrementPendingTasksTaskFailureCount(t,n,r),yield o("LSSyncStoredProcedureUtils").incrementNetworkRequestsTaskFailureCount(t,n,(e||(e=o("I64"))).neg_one),yield o("LSSyncStoredProcedureUtils").closeEpoch(t,n,e.neg_one)}),u.apply(this,arguments)}l.default=s}),98);
__d("LSHandleTaskSendSuccessForQueue2",["I64","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){var r=yield t.network_requests.get(n,(e||(e=o("I64"))).neg_one);r==null||r.epochId==null||(yield t.network_requests.delete(n,e.neg_one))}),u.apply(this,arguments)}l.default=s}),98);
__d("LSHandleTaskSuccessOpsDownloadFailureForQueue",["I64","ReQL","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){var r=yield t.network_requests.get(n,(e||(e=o("I64"))).neg_one);r!=null&&r.epochId!=null&&(yield t.network_requests.delete(n,(e||(e=o("I64"))).neg_one));var a=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.pending_tasks.index("queueNameTaskId")).getKeyRange(n));a!=null&&(yield t.pending_tasks.delete(a.taskId))}),u.apply(this,arguments)}l.default=s}),98);
__d("LSInternetConnectionState",[],(function(t,n,r,o,a,i){var e=Object.freeze({NOT_CONNECTED:0,CONNECTED:1});i.default=e}),66);
__d("LSMessageReplySourceTypeV2",[],(function(t,n,r,o,a,i){var e=Object.freeze({NONE:0,MESSAGE:1,STORY:2,FORWARD:3,FB_STORY_SHARE:4,IG_STORY_SHARE:5,STORY_BASE64_ENCODED:6,LIGHTWEIGHT_STATUS:7,CLOSE_FRIENDS:8,XMA:9,IG_NOTE:10,CLOSE_FRIENDS_NOTE_REPLY:11,LIGHTWEIGHT_STATUS_REACTION:12,FB_FEED_POST:13,HIGHLIGHTS_TAB_POST_REPLY:14,HIGHLIGHTS_TAB_LOCAL_EVENT_REPLY:15,SHARED_ALBUM:16,AVATAR_DETAIL:17,NOTE_REPLY_ARMADILLO:18,FB_STORY_MENTION:22,EXPIRED_STORY:23,FB_PRODUCER_STORY_REPLY:24,FB_POST_MENTION:25,AI_PERSONA_NOTE_REPLY:26,AI_PERSONA_NOTE_REACTION:27,FB_MSGR_NOTE:28,IG_COLLAB_INVITE:29,FB_QUICKSNAP:30});i.default=e}),66);
__d("LSMessageSendStatus",[],(function(t,n,r,o,a,i){var e=Object.freeze({NONE:0,SENDING_TO_SERVER:1,SERVER_RECEIVED:2,NON_RETRIABLE_ERROR:4,RETRIABLE_ERROR:5});i.default=e}),66);
__d("LSPlatformDefaultUnderlyingApi",["Promise","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return r("emptyFunction")}function u(){return(e||(e=n("Promise"))).resolve()}var c={cleanup:r("emptyFunction"),logEvent:function(t){},onConnectionStatusChange:s,onReconnect:s,publish:u,subscribe:s};l.default=c}),98);
__d("LSPlatformDeviceId",["ChannelClientID","FBLogger","LSCookie","MqttWebDeviceID","gkx"],(function(t,n,r,o,a,i,l){"use strict";function e(){return r("gkx")("21118")?r("MqttWebDeviceID").clientID:r("ChannelClientID").getID()}var s=e();function u(t){return t==null&&r("FBLogger")("messenger_web").info("Missed provider type for deviceId"),t==="persisted"?o("LSCookie").get().d:e()}l.deviceId=s,l.getDeviceIdForProviderType=u}),98);
__d("LSStreamGroupRef",["I64","LSMailboxInitialSyncCursor"],(function(t,n,r,o,a,i,l){"use strict";var e,s={connectionStatusChangeHandler:null,current:null,currentStreamGroupId:null,publishBuffer:new Map,reconnectHandler:null,status:"Disconnected",subscribers:new Map};function u(){return(e||(e=o("I64"))).equal((e||(e=o("I64"))).of_int32(1),o("LSMailboxInitialSyncCursor").syncChannel)?"mqtt":s.current==null||s.current.streamGroupLoggingContext.sgTransportId==null?"null":s.current.streamGroupLoggingContext.sgTransportId}function c(){return s.status}l.streamGroupRef=s,l.getTransportId=u,l.getTransportStatus=c}),98);
__d("MessengerPWAVersionForUserAgent",["isMessengerPWA"],(function(t,n,r,o,a,i,l){"use strict";function e(){var e,t=r("isMessengerPWA")();if(t){var n=(e=new URL(window.location.href).searchParams.get("__pwa"))!=null?e:"1.0.0";return n}}l.default=e}),98);
__d("LSPlatformRealtimeTransport",["I64","LSDynamicDependencies","LSIntEnum","LSJson","LSMailboxInitialSyncCursor","LSShape","LSStreamGroupRef","MessengerPWAVersionForUserAgent","NetworkStatus","Promise","QuickPerformanceLogger","Random","clearTimeout","promiseDone","qpl","setTimeout"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=r("qpl")._(701246226,"1285"),m="LSPlatformRealtimeTransport.NotConnected",p="LSPlatformRealtimeTransport.Timeout";function _(e){var t=new Map;return{getAll:function(){return Array.from(t.values())},getOrStart:function(r){var n=r.toString(),o=t.get(n);return o==null&&(o=e(r),t.set(n,o)),o}}}function f(e){}function g(t,a,i){var l=new Map,m={contents:f},g=new Set,h=new Map,y=[],C=_(function(e){var n=t(e,i);return y.push(n.subscribe(function(e){var t=JSON.parse(e),n=o("LSDynamicDependencies").downloadBootloaderDependencies(t.sp,t.nop,t.ntop),a=t.request_id,i;if(a!=null){var s=l.get(a);if(s==null)i=!1;else{r("clearTimeout")(s.timeoutId),s.resolve({downloadTask:n,payload:t,type:"taskresponse"}),l.delete(a);var u=s.instanceKey;(c||(c=r("QuickPerformanceLogger"))).markerPoint(d,"response",{instanceKey:u}),c.markerEnd(d,2,u),i=!0}}else i=!1;if(!i){Array.from(h.entries()).forEach(function(e){return e[1](n,t)});return}})),y.push(n.onReconnect(function(e){return m.contents(e)})),y.push(n.onConnectionStatusChange(function(e){g.forEach(function(t){return t(e)})})),n});return C.getOrStart((u||(u=o("LSIntEnum"))).unwrapIntEnum(o("LSMailboxInitialSyncCursor").syncChannel)),{cleanup:function(){y.forEach(function(e){return e()}),C.getAll().forEach(function(e){return e.cleanup()})},logEvent:function(t){C.getAll().forEach(function(e){return e.logEvent(t)})},onConnectionStatusChange:function(t){return g.add(t),function(){g.delete(t)}},onReconnect:function(t){return m.contents=t,function(){m.contents=f}},publish:function(i){var t=i.databaseType,m=i.payload,_=i.queueName,f=i.requestId,g=i.syncChannel,h=i.type_;return new(e||(e=n("Promise")))(function(e,n){var i=C.getOrStart((u||(u=o("LSIntEnum"))).unwrapIntEnum(g)),y=Date.now()+(Math.round(o("Random").random()*1e4)+1e4);if((s||(s=o("I64"))).equal(h,(u||(u=o("LSIntEnum"))).ofNumber(3))){var b=r("setTimeout")(function(){i.logEvent("Timeout");var e=l.get(f);return(c||(c=r("QuickPerformanceLogger"))).markerPoint(d,"timeout",{instanceKey:y}),c.markerEnd(d,3,y),e!=null&&(l.delete(f),e.reject({RE_EXN_ID:p})),n({RE_EXN_ID:p})},3e4);l.set(f,{instanceKey:y,queueName:_,reject:n,resolve:e,timeoutId:b,timestamp:Date.now()})}(c||(c=r("QuickPerformanceLogger"))).markerStart(d,y),c.markerPoint(d,"publish",{instanceKey:y}),c.markerAnnotate(d,{string:{networkStatus:String(r("NetworkStatus").isOnline()),streamGroupId:o("LSStreamGroupRef").getTransportId(),streamGroupStatus:o("LSStreamGroupRef").getTransportStatus()}},{instanceKey:y}),c.markerAnnotate(d,{int:{databaseType:t,requestType:u.toNumber(h)}},{instanceKey:y});var v=r("MessengerPWAVersionForUserAgent")();r("promiseDone")(i.publish(o("LSJson").stringify(o("LSShape").ofRecord(babelHelpers.extends({app_id:a,payload:m},v!=null?{pwa_version:v}:{},{request_id:f,type:h}))),h,t),function(){if(!(s||(s=o("I64"))).equal(h,(u||(u=o("LSIntEnum"))).ofNumber(3)))return(c||(c=r("QuickPerformanceLogger"))).markerPoint(d,"response",{instanceKey:y}),c.markerEnd(d,2,y),e({type:"noresponseexpected"})},function(e){(c||(c=r("QuickPerformanceLogger"))).markerPoint(d,"fail",{instanceKey:y}),c.markerEnd(d,3,y),n(e)})})},subscribeToNonTaskResponses:function(t){var e={};return h.set(e,t),function(){h.delete(e)}}}}l.NotConnected=m,l.Timeout=p,l.LSPlatformRealtimeTransport=g}),98);
__d("shouldStubUnderlyingTransport",["ExecutionEnvironment"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return!(e||(e=r("ExecutionEnvironment"))).canUseDOM&&!(e||(e=r("ExecutionEnvironment"))).isInWorker}l.default=s}),98);
__d("LSPlatformMqttRealtimeTransport",["I64","LSIntEnum","LSPlatformDefaultUnderlyingApi","LSPlatformRealtimeTransport","Promise","promiseDone","shouldStubUnderlyingTransport"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(e){return[{payload:JSON.stringify({ls_fdid:"",ls_sv:e}),qos:1,topic:"/ls_app_settings"}]}function d(t){var a={contents:t.getConnectionState()},i={contents:function(){}},l={contents:new(u||(u=n("Promise")))(function(e,t){i.contents=e})},c={onMQTTStateChanged:function(t){t==="Connected"?i.contents():t==="Disconnected"&&a.contents==="Connected"&&(l.contents=new(u||(u=n("Promise")))(function(e,t){i.contents=e})),a.contents=t}};return a.contents==="Connected"&&i.contents(),t.subscribeChannelEvents(c),[function(){t.unsubscribeChannelEvents(c)},function(a,i,c){return l.contents.then(function(){return new(u||(u=n("Promise")))(function(n,l){r("promiseDone")(t.publish("/ls_req",a,{listener:{onEvent:function(t){if(t==="NOT_CONNECTED")return l({RE_EXN_ID:o("LSPlatformRealtimeTransport").NotConnected})}},qos:(e||(e=o("I64"))).equal(i,(s||(s=o("LSIntEnum"))).ofNumber(4))?0:1,skipBuffer:!1}),function(){return n()},function(e){return e.message==="Publish Timed Out"?l({RE_EXN_ID:o("LSPlatformRealtimeTransport").Timeout}):l(e)})})})}]}var m={contents:void 0};function p(e,t,n){if(r("shouldStubUnderlyingTransport")())return r("LSPlatformDefaultUnderlyingApi");var o=n.getInstance(t),a={getPublishMessages:function(){return c(e)}};o.registerExtraConnectPayloadProvider(a);var i={onMQTTStateChanged:function(t){var e=m.contents;if(e!=null)return e(t)}};o.subscribeChannelEvents(i);var l=o.subscribe("/ls_foreground_state",function(){}),s=d(o),u=s[0],p=s[1];return{cleanup:function(){o.unregisterExtraConnectPayloadProvider(a),n.shutdownAndClear(),o.unsubscribeChannelEvents(i),l(),u()},logEvent:function(t){},onConnectionStatusChange:function(t){return m.contents=t,function(){m.contents=void 0}},onReconnect:function(t){var e={contents:o.getConnectionState()},n={contents:e.contents==="Connected"},r={onMQTTStateChanged:function(o){o==="Connected"&&(n.contents&&e.contents!=="Connected"&&t(1),n.contents=!0),e.contents=o}};return o.subscribeChannelEvents(r),function(){o.unsubscribeChannelEvents(r)}},publish:p,subscribe:function(t){return o.subscribe("/ls_resp",function(e){return t(e)})}}}l.default=p}),98);
__d("LSPlatformRequestId",[],(function(t,n,r,o,a,i){"use strict";var e=4;function l(){var t=e;return e+=1,t}var s={generate:l};i.default=s}),66);
__d("LSPlatformRequestScheduler",["clearTimeout","justknobx","setTimeout"],(function(t,n,r,o,a,i,l){"use strict";var e=Math.pow(2,31)-1,s=(function(){function t(){this.requests=new Map}var n=t.prototype;return n.schedule=function(n,o,a){var t=this.requests.get(o);t!=null&&r("clearTimeout")(t);var i=r("justknobx")._("4435")?Math.min(a,e):a;this.requests.set(o,r("setTimeout")(n,i))},n.cleanup=function(){this.requests.forEach(function(e){return r("clearTimeout")(e)})},t})();l.default=s}),98);
__d("LSPlatformServerResponseHandler",["FBLogger","Promise","asyncToGeneratorRuntime","clearTimeout","nullthrows","setTimeout"],(function(t,n,r,o,a,i,l){"use strict";var e,s="executeFirstBlockForSyncTransaction",u=(function(){function t(e){this.eval=e,this.currentlyRunning=new Map}var o=t.prototype;return o.evalWhenReady=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n;try{yield e,n=r("setTimeout")(function(){r("FBLogger")("messenger_web").mustfix("waited longer than 30 seconds to eval sync script")},3e4),yield this.eval(t)}finally{r("clearTimeout")(n)}});function t(t,n){return e.apply(this,arguments)}return t})(),o.$1=function(r){var t=this.currentlyRunning.get(r);return t==null&&(t=(e||(e=n("Promise"))).resolve(),this.currentlyRunning.set(r,t)),t},t.getSyncScriptType=function(t){var e;if(!((e=t.sp)!=null&&e.includes(s)))return{status:"non-transactional"};var n=(function(){try{var e;return(e=JSON.parse(t.syncScript))==null?void 0:e.step}catch(e){return null}})();if(!Array.isArray(n))return r("FBLogger")("messenger_web").warn("Sync payload appears invalid."),{status:"non-transactional"};for(var o=[n];o.length;){var a=r("nullthrows")(o.shift());for(var i of a)if(Array.isArray(i)){if(i[0]===5&&i[1]===s&&Array.isArray(i[2]))return{status:"transactional",syncGroup:parseInt(i[2][1],10)};o.push(i)}}return{status:"err"}},o.maybeEvalInOrderReceived=function(n,o){var e,a=this,i=t.getSyncScriptType(o),l=0;switch(i.status){case"err":r("FBLogger")("messenger_web").warn("Sync script sync group parsing failed: employed sprocs were %s",JSON.stringify((e=o.sp)!=null?e:void 0));break;case"non-transactional":return this.evalWhenReady(n,o);case"transactional":l=i.syncGroup;break}var s=this.$1(l),u=s.then(function(){return a.evalWhenReady(n,babelHelpers.extends({},o,{priority:"sync_script"}))}).catch(function(e){throw a.currentlyRunning.delete(l),e});return this.currentlyRunning.set(l,u),u},t})();l.default=u}),98);
__d("LSPlatformTaskSyncGroupId",[],(function(t,n,r,o,a,i){"use strict";var e=-1,l=e;i.default=l}),66);
__d("MWPBeginHandlingPendingTasksForQueue",["LSBeginHandlingFireForgetTasksForQueueStoredProcedure","LSBeginHandlingPendingTasksForQueue2","LSFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var o=t.fireAndForgetTask,a=t.ignoreSoftDelay,l=t.queueName,s=yield e.runInTransaction((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(o===!0){var t=yield r("LSBeginHandlingFireForgetTasksForQueueStoredProcedure")(r("LSFactory")(e),{queueName:l}),n=t[0];return[n]}return r("LSBeginHandlingPendingTasksForQueue2")(e,{ignoreSoftDelay:a,queueName:l})});return function(t){return e.apply(this,arguments)}})(),"readwrite",void 0,void 0,i.id+":37");return s}),s.apply(this,arguments)}l.default=e}),98);
__d("MWPlatformTaskUtils",["FBLogger","I64","JSScheduler","MetaConfig","Promise","ReQL","asyncToGeneratorRuntime","getErrorSafe","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(e,t){function a(){return i.apply(this,arguments)}function i(){return i=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{yield e(t)}catch(e){var n=r("getErrorSafe")(e);r("FBLogger")("messenger_web").catching(n).warn("Failed to calculate work for task queue %s",t.queueName)}}),i.apply(this,arguments)}if((u||(u=o("I64"))).gt(t.priority,(u||(u=o("I64"))).zero)&&r("MetaConfig")._("78")){var l=function(){var e=a()};(s||(s=r("JSScheduler"))).scheduleLoggingPriCallback(l)}else r("promiseDone")(a())}function d(e,t){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){try{yield e(t)}catch(e){var n=r("getErrorSafe")(e);r("FBLogger")("messenger_web").catching(n).warn("Failed to calculate work for fire forget queue %s",t.queueName)}}),m.apply(this,arguments)}function p(e,t){var r=new Set,a=[],i=[];return i.push(e.tables.pending_tasks.index("queueNameTaskId").subscribe(function(e,t){var n,i;if(t.operation==="delete"){r.add(e[0]);return}var l=t.operation==="put"&&t.prevValue==null||t.operation==="add",s=t.operation==="put"&&(u||(u=o("I64"))).compare(t.value.failureCount,(n=(i=t.prevValue)==null?void 0:i.failureCount)!=null?n:(u||(u=o("I64"))).zero)>0;(l||s)&&r.add(t.value.queueName),(t.operation==="add"&&t.value.dataTraceId==null||t.value.dataTraceId==="")&&a.push(t.value)})),i.push(e.tables.network_requests.subscribe(function(e,t){var n=e[0];n!==""&&(t.operation==="delete"||t.value.epochId==null)&&r.add(n)})),i.push(e.subscribeToCommit(function(){var i=Array.from(r);r.clear(),a=[],i.forEach((function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n){var r=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.tables.pending_tasks.index("queueNameTaskId")).bounds({gte:[n]}));r!=null&&c(t,r)});return function(e){return r.apply(this,arguments)}})())})),i}function _(e,t){r("promiseDone")(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var n=yield o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(e.tables.pending_tasks)),r=new Set;for(var a of n)r.has(a.queueName)||(r.add(a.queueName),c(t,a))})())}function f(t,a){r("promiseDone")(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var l=yield o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(t.tables.pending_fire_and_forget_tasks));yield(e||(e=n("Promise"))).all(l.map(function(e){return d(a,e)})),r("promiseDone")(t.runInTransaction(function(t){return(e||(e=n("Promise"))).all(l.map(function(e){return t.pending_fire_and_forget_tasks.delete(e.taskId)}))},"readwrite","background",void 0,i.id+":199"))})())}function g(e,t){var n=!1,r=[];return r.push(e.tables.pending_fire_and_forget_tasks.subscribe(function(e,t){if(t.operation!=="delete"){var r=t.operation==="put"&&t.prevValue==null||t.operation==="add";r&&(n=!0)}})),r.push(e.subscribeToCommit(function(){n&&f(e,t),n=!1})),r}l.checkQueuesWhenPendingTaskTableUpdates=p,l.checkAllPendingTasksForWork=_,l.checkAllFireForgetTasksForWork=f,l.checkQueuesWhenPendingFireForgetTaskTableUpdates=g}),98);
__d("LSPlatformTaskSystemTransport",["CurrentMessengerUser","FBLogger","I64","JSResourceForInteraction","JSScheduler","LSDatabaseProviderType","LSHandleTaskSendFailureForQueue2","LSHandleTaskSendSuccessForQueue2","LSHandleTaskSuccessOpsDownloadFailureForQueue","LSIntEnum","LSJson","LSMailboxInitialSyncCursor","LSPlatformRealtimeTransport","LSPlatformRequestId","LSPlatformRequestScheduler","LSPlatformServerResponseHandler","LSPlatformTaskSyncGroupId","LSShape","LSVec","MWPBeginHandlingPendingTasksForQueue","MWPBumpEntityKey","MWPlatformTaskUtils","Promise","ReQL","asyncToGeneratorRuntime","cr:4031","cr:6668","gkx","promiseDone","qex"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=500,m=r("JSResourceForInteraction")("publishLSPlatformDeidentifiedPayload").__setRef("LSPlatformTaskSystemTransport"),p=new Set([632,765,60011,1006,1018].map(function(e){return e.toString()})),_=(function(){function t(e,t,a,i){var l=this;this.key="ls",this.$8=!1,this.$19=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield r("MWPBeginHandlingPendingTasksForQueue")(l.$1,{ignoreSoftDelay:t,queueName:e});for(var a of n)yield l.$18(o("LSShape").toRecord(a))});return function(t,n){return e.apply(this,arguments)}})(),this.$1=e,this.$2=t,this.$3=a,this.$4=i,this.$8=o("LSDatabaseProviderType").isProviderPersisted(e),this.$5=new(r("LSPlatformRequestScheduler")),this.$6=new(r("LSPlatformServerResponseHandler"))(a),this.$7=this.$9(),this.$10()}var a=t.prototype;return a.$11=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=e.filter(function(e){return e.label!=null&&p.has(e.label)});if(n.length<e.length){n.length>0&&r("FBLogger")("maw_ohai").mustfix("Deidentifed tasks label %s sent together with normal tasks",n[0].label);var o=yield this.$2.publish(t);return o}var a=n[0],i=yield m.load(),l=yield i(babelHelpers.extends({},t,{taskLabel:a.label}));return l});function t(t,n){return e.apply(this,arguments)}return t})(),a.$12=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield this.$1.runInTransaction(function(t){return r("LSHandleTaskSendFailureForQueue2")(t,e)},"readwrite",void 0,void 0,i.id+":151")});function t(t){return e.apply(this,arguments)}return t})(),a.$13=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield this.$1.runInTransaction(function(t){return r("LSHandleTaskSendSuccessForQueue2")(t,e)},"readwrite","background",void 0,i.id+":160")});function t(t){return e.apply(this,arguments)}return t})(),a.$14=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield this.$1.runInTransaction(function(t){return r("LSHandleTaskSuccessOpsDownloadFailureForQueue")(t,e)},"readwrite",void 0,void 0,i.id+":168")});function t(t){return e.apply(this,arguments)}return t})(),a.$15=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=r("LSVec").toArray(e.tasks).slice(0).map(function(e){return o("LSShape").toRecord(e)}),n=t[0];if(n!=null){var a=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(this.$1.tables.pending_tasks).getKeyRange(n.task_id));return a==null?void 0:a.dataTraceId}});function t(t){return e.apply(this,arguments)}return t})(),a.$16=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a){var i=this;if(t.network_payload!=null){var l=o("LSShape").toRecord(t.network_payload);(c||(c=r("JSScheduler"))).scheduleLoggingPriCallback(function(){return l&&(n("cr:6668")==null?void 0:n("cr:6668").recordTaskSending(l.tasks))});var s=this.$4;try{yield(u||(u=n("Promise"))).all(r("LSVec").toArray(l.tasks).map(function(e){return o("LSShape").toRecord(e)}).map(function(n){var l=r("LSPlatformRequestId").generate();return i.$11([n],{databaseType:r("LSPlatformTaskSyncGroupId"),payload:o("LSJson").stringify(o("LSShape").ofRecord({label:n.label,payload:n.payload,version:s})),queueName:t.queue_name,requestId:l,syncChannel:o("LSMailboxInitialSyncCursor").taskChannel,type_:(e||(e=o("I64"))).of_int32(a)})}))}catch(e){}}});function a(e,n){return t.apply(this,arguments)}return a})(),a.$17=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a){if(t.network_payload!=null){var i=o("LSShape").toRecord(t.network_payload),l=r("LSVec").toArray(i.tasks).map(function(e){return o("LSShape").toRecord(e)}),u=yield this.$15(i);(c||(c=r("JSScheduler"))).scheduleLoggingPriCallback(function(){return i&&(n("cr:6668")==null?void 0:n("cr:6668").recordTaskSending(i.tasks))});var d=r("LSPlatformRequestId").generate(),m,p=r("qex")._("2071");if(p!=null&&p!=="default"){var _=p+"."+(s||(s=o("LSIntEnum"))).toNumber(o("LSMailboxInitialSyncCursor").taskChannel)+"."+a.toString();o("MWPBumpEntityKey").bumpEntityKeyWithAppId("messenger.lightspeed",_)}try{m=yield this.$11(l,{databaseType:r("LSPlatformTaskSyncGroupId"),payload:o("LSJson").stringify(o("LSShape").ofRecord(babelHelpers.extends({},i,{version_id:this.$4},u==null?{}:{data_trace_id:u}))),queueName:t.queue_name,requestId:d,syncChannel:o("LSMailboxInitialSyncCursor").taskChannel,type_:(e||(e=o("I64"))).of_int32(a)})}catch(e){if(p!=null&&p!=="default"){var f=p+"."+(s||(s=o("LSIntEnum"))).toNumber(o("LSMailboxInitialSyncCursor").taskChannel)+"."+a.toString();o("MWPBumpEntityKey").bumpEntityKeyWithAppId("messenger.lightspeed",f+".exception"),e.RE_EXN_ID===o("LSPlatformRealtimeTransport").Timeout?o("MWPBumpEntityKey").bumpEntityKeyWithAppId("messenger.lightspeed",f+".exception.timeout"):e.RE_EXN_ID===o("LSPlatformRealtimeTransport").NotConnected&&o("MWPBumpEntityKey").bumpEntityKeyWithAppId("messenger.lightspeed",f+".exception.notconnected")}e.RE_EXN_ID===o("LSPlatformRealtimeTransport").Timeout?o("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_tasks","send_fail_timeout"):e.RE_EXN_ID===o("LSPlatformRealtimeTransport").NotConnected?(o("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_tasks","send_fail_notconnected"),r("FBLogger")("messenger_web").warn("Publishing a task to the server not connected")):(o("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_tasks","send_fail_generic"),r("FBLogger")("messenger_web").warn("Error while publishing a task for request: %s, error %s",a,JSON.stringify(e))),yield this.$12(t.queue_name)}if(m!=null&&m.type==="taskresponse")try{var g=m.downloadTask,h=m.payload,y={experiments:h.ex,sp:h.sp,syncScript:h.payload,target:h.target,taskNames:l.map(function(e){return e.label}).filter(Boolean)};yield this.$6.evalWhenReady(g,y),yield this.$13(t.queue_name),(c||(c=r("JSScheduler"))).scheduleLoggingPriCallback(function(){return i&&(n("cr:6668")==null?void 0:n("cr:6668").recordTaskSent(i.tasks,h.payload))})}catch(e){o("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_tasks","handle_task_failure"),r("FBLogger")("messenger_web").catching(e).mustfix("Encountered an error while processing a task response via realtime transport"),(e==null?void 0:e.name)==="dynamic_sproc_loading_timeout"&&r("gkx")("14417")?yield this.$14(t.queue_name):yield this.$12(t.queue_name)}}});function a(e,n){return t.apply(this,arguments)}return a})(),a.decideWhatToDoWithTask=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,a,i){var l=this,s=yield r("MWPBeginHandlingPendingTasksForQueue")(e,{fireAndForgetTask:i,ignoreSoftDelay:!1,queueName:t,transportKey:a});r("promiseDone")(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){for(var e of s)yield l.$18(o("LSShape").toRecord(e))})())});function t(t,n,r,o){return e.apply(this,arguments)}return t})(),a.$18=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var a=this.$5,i=this.$19;function l(t,n){a.schedule(function(){r("promiseDone")(i(t,!1))},t,n!=null?(e||(e=o("I64"))).to_float(n):d)}var s=(e||(e=o("I64"))).to_int32(t.work_item_type);switch(s){case 1:yield this.$17(t,3);break;case 5:yield this.$16(t,4);break;case 3:l(t.queue_name,t.next_sync_ms);break;case 2:yield n("cr:4031").handleLSWork(this.$1,t,o("CurrentMessengerUser").getAccountID());break;case 4:break;default:r("FBLogger")("messenger_web").warn("Unknown Task type of %s",s)}});function a(e){return t.apply(this,arguments)}return a})(),a.$9=function(){var e=this,t=this.$1;return this.$2.onReconnect(function(a){o("LSMailboxInitialSyncCursor").isWebApp&&a===3&&r("qex")._("2082")===!0||(r("promiseDone")(t.runInTransaction((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(e.network_requests).bounds({gte:o("ReQL").key("")}));yield(u||(u=n("Promise"))).all(t.map(function(t){var n=t.taskQueueName;return r("LSHandleTaskSendFailureForQueue2")(e,n)}))});return function(t){return e.apply(this,arguments)}})(),"readwrite",void 0,void 0,i.id+":481")),e.$10())})},a.$10=function(){var e=this;o("MWPlatformTaskUtils").checkAllPendingTasksForWork(this.$1,function(t){var n=t.queueName;return e.decideWhatToDoWithTask(e.$1,n)})},a.cleanup=function(){this.$7()},t})();l.default=_}),98);
__d("LSReplyMessageAttachmentType",[],(function(t,n,r,o,a,i){var e=Object.freeze({OTHER:0,PHOTO:1,VIDEO:2,GIF:3,STICKER:4,LINK:5,MULTIPHOTO:6,PERMANENT_RAVEN_PHOTO:7,PERMANENT_RAVEN_VIDEO:8,AUDIO:10,ROLL_CALL_PHOTO_CONTRIBUTION:11,ROLL_CALL_VIDEO_CONTRIBUTION:12,FEED_POST:13,POWER_UP:14,XMA:15,ROLL_CALL_TEXT_CONTRIBUTION:16,BLOKS_XMA:17,EPHEMERAL_RAVEN_MESSAGE:18,THIRD_PARTY_STICKER:19,SOUND_BITE:9});i.default=e}),66);
__d("LSVersion",[],(function(t,n,r,o,a,i){a.exports="32381005491547324"}),null);
__d("LSXmaContentType",[],(function(t,n,r,o,a,i){var e=Object.freeze({TEST:-1,NONE:0,IG_SINGLE_IMAGE_POST_SHARE:1e3,IG_MULTIPOST_SHARE:1001,IG_STORY_REPLY:1002,IG_STORY_PHOTO_SHARE:1003,IG_STORY_PHOTO_MENTION:1004,IG_CLIPS_SHARE:1005,IG_SINGLE_VIDEO_POST_SHARE:1006,IG_STORY_VIDEO_SHARE:1007,IG_STORY_REACTION:1008,IG_IGTV_SHARE:1009,IG_SHOP_SHARE:1010,IG_PROFILE_SHARE:1011,IG_STORY_PHOTO_HIGHLIGHT_SHARE:1012,IG_STORY_VIDEO_HIGHLIGHT_SHARE:1013,IG_STORY_VIDEO_MENTION:1014,IG_STORY_HIGHLIGHT_REPLY:1015,IG_STORY_HIGHLIGHT_REACTION:1016,IG_EXTERNAL_LINK:1017,IG_RECEIVER_FETCH:1018,IG_TEXT_POST_APP_SHARE:1019,IG_MULTI_MEDIA_RESPONSE:1020,FB_FEED_SHARE:2e3,FB_STORY_REPLY:2001,FB_STORY_SHARE:2002,FB_STORY_MENTION:2003,FB_FEED_VIDEO_SHARE:2004,FB_GAMING_CUSTOM_UPDATE:2005,FB_PRODUCER_STORY_REPLY:2006,FB_EVENT:2007,FB_FEED_POST_PRIVATE_REPLY:2008,FB_SHORT:2009,FB_COMMENT_MENTION_SHARE:2010,FB_STORY_LWI_REPLY:2011,FB_COMMENT_SHARE:2012,FB_POST_MENTION:2013,FB_PROFILE_DIRECTORY_ITEM:2014,FB_FEED_POST_REACTION_REPLY:2015,FB_QUICKSNAP_REPLY:2016,FB_SPARK_ICEBREAKER:2017,MSG_EXTERNAL_LINK_SHARE:3e3,MSG_P2P_PAYMENT:3001,MSG_LOCATION_SHARING:3002,MSG_LOCATION_SHARING_V2:3003,MSG_HIGHLIGHTS_TAB_FRIEND_UPDATES_REPLY:3004,MSG_HIGHLIGHTS_TAB_LOCAL_EVENT_REPLY:3005,MSG_RECEIVER_FETCH:3006,MSG_IG_MEDIA_SHARE:3007,MSG_GEN_AI_SEARCH_PLUGIN_RESPONSE:3008,MSG_REELS_LIST:3009,MSG_CONTACT:3010,MSG_THREADS_POST_SHARE:3011,MSG_FILE:3012,MSG_AVATAR_DETAILS:3013,MSG_AI_CONTACT:3014,MSG_MEMORIES_SHARE:3015,MSG_SHARED_ALBUM_REPLY:3016,MSG_SHARED_ALBUM:3017,MSG_OCCAMADILLO_XMA:3018,MSG_GEN_AI_1P_SEARCH_RESULT:3019,MSG_EARLY_ACCESS_FB_SHARE:3020,MSG_GEN_AI_SUBSCRIPTION:3021,MSG_GEN_AI_REMINDER:3022,MSG_GEN_AI_MEMU_ONBOARDING_RESPONSE:3023,MSG_MAGICAL_MESSENGER_PLACES:3024,MSG_RECEIVER_FETCH_FALLBACK:3025,MSG_MAGICAL_MESSENGER_TASKS:3026,MSG_NOTE_REPLY:3027,MSG_NOTE_MENTION:3028,MSG_PROMPT_REPLY:3029,MSG_GEN_AI_TASK:3030,MSG_GEN_AI_RICH_RESPONSE:3040,MSG_RECEIVER_FETCH_ENT_DELETED:3041,MSG_GEN_AI_APP_DOWNLOAD_LINK:3042,MSG_GEN_AI_ENTITY:3043,MSG_OPG_P2P_PAYMENT:3044,MSG_MARKETPLACE:3045,MSG_MUSIC_STICKER:3046,MSG_META_AI_DIGEST:3047,MSG_PHONE_NUMBER:3048,MSG_GEN_AI_CONCORD_FEED_POST:3049,MSG_META_AI_MEDIA_SHARE:3050,RTC_AUDIO_CALL:4e3,RTC_VIDEO_CALL:4001,RTC_MISSED_AUDIO_CALL:4002,RTC_MISSED_VIDEO_CALL:4003,RTC_GROUP_AUDIO_CALL:4004,RTC_GROUP_VIDEO_CALL:4005,RTC_MISSED_GROUP_AUDIO_CALL:4006,RTC_MISSED_GROUP_VIDEO_CALL:4007,RTC_ONGOING_AUDIO_CALL:4008,RTC_ONGOING_VIDEO_CALL:4009,DATACLASS_SENDER_COPY:5e3,OC_AVATAR_STATIC_STICKER:6e3,LIVE_LOCATION:7e3});i.default=e}),66);
__d("MAWODSProxy",["CurrentMessengerUser","ODS"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n=t.amount,r=t.entity,a=t.key;(e||(e=o("ODS"))).bumpEntityKey(3185,r,a+"."+(o("CurrentMessengerUser").getAppID()||"unknown"),n)}l.odsBumpEntityKey=s}),98);
__d("WAGlobals",["WAJids","WALogger","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s=null;function u(e){s=e}function c(){if(s==null)throw r("err")("WaMsgr api called before set");return s}function d(){var e;return(e=c().myJids)==null?void 0:e.deviceJid}function m(){var e;return(e=c().myJids)==null?void 0:e.userJid}function p(e){return o("WAJids").extractUserJid(e)===o("WAJids").extractUserJid(d())}function _(){return c().config}function f(){return c().dependencies}var g="WAOneQueue is not defined";function h(){var t=c().waOneQueue;if(t==null)throw o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["",""])),g),r("err")(g);return t}function y(){return c().hmacKey}l.setGlobals=u,l.getMyDeviceJid=d,l.getMyUserJid=m,l.isPeerDevice=p,l.getConfig=_,l.getDependencies=f,l.getWaOneQueue=h,l.getHMACKey=y}),98);
__d("MAWUserJidWrapper",["ExecutionEnvironment","MAWCurrentUser","MAWODSProxy","WAGlobals","WAJids","WAOdsEnums"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){var t=o("WAJids").toMsgrUserJid(o("MAWCurrentUser").getID());if((e||(e=r("ExecutionEnvironment"))).isInWorker){var n=o("WAGlobals").getMyUserJid();return o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_MY_USER_JID_GETTER,key:n===t?"same":"different"}),n}return t}l.getMyUserJid=s}),98);
__d("MAWAuthor",["MAWUserJidWrapper","WAJids","isStringNullOrEmpty"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t){if(t==null||t===o("WAJids").AUTHOR_SYSTEM)return null;if(o("WAJids").isAuthorMe(t))return o("MAWUserJidWrapper").getMyUserJid();var e=o("WAJids").authorAsUserJid(t);return e==null||r("isStringNullOrEmpty")(o("WAJids").userIdFromJid(e))?null:o("WAJids").authorAsUserJid(t)};l.getAuthorUserJid=e}),98);
__d("MAWErrorObject",["err"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return e instanceof Error?e:typeof e=="string"?r("err")(e):null}l.getErrorObject=e}),98);
__d("MAWExternalId",["I64","Random","WAStanzaUtils"],(function(t,n,r,o,a,i,l){"use strict";var e,s=131071,u=null,c=0;function d(){var e=u,t=Date.now();if(e==null||p(e)!==p(t))return u=t,c=0,t;var n=t+100*(c+1),r=g(t),o=g(n);return r==null||o==null||r>o?t:(c++,n)}function m(e){return new Date(e).getTime()>0}function p(e){return Math.floor(e/100)*100}function _(e){return Math.floor(r("Random").random()*e)}function f(){var t=d();return o("WAStanzaUtils").toStanzaId((e||(e=o("I64"))).to_string(e.and_(e.or_(e.lsl_(e.of_float(t),22),e.and_(e.of_float(_(s)),e.of_float(s))),e.max_int)))}function g(e){return m(e)?Math.floor(Number(e)%1e5/100):null}l.generateExternalId=f,l.getThreeMostSignificantDigitsForSortOrderTimestamp=g}),98);
__d("MAWJids",["I64","WAJids"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("WAJids").createJidUtils({platform:"msgr"}),u=s.toUserJid,c=function(n,r){var t=(e||(e=o("I64"))).to_string(n);return r?o("WAJids").toGroupJid(t):u(t)};function d(e){return c(e,!1)}function m(e){return c(e,!0)}var p=function(n){var t=o("WAJids").threadIdForChatJid(n);return(e||(e=o("I64"))).of_string(t)};function _(e){return o("WAJids").unsafeCoerceToChatJid(e)}l.jidUtils=s,l.toUserJid=u,l.convertIntJidToChatJid=c,l.convertIntJidToOneToOneChatJid=d,l.convertIntJidToGroupJid=m,l.convertChatJidToIntJid=p,l.threadIdToChatJid=_}),98);
__d("MAWLeakDetection",[],(function(t,n,r,o,a,i){"use strict";var e="[Vault] Vaulted string detected";function l(e){var t=/\d{10}##\d{10}/gm;return t.test(e)}function s(t){return l(t)?e:t}i.VAULTED_STRING_DETECTED=e,i.detectVaultedString=l,i.maybeReplaceVaultedString=s}),66);
__d("MAWSendQplToServer",["BrowserLockManager","ExecutionEnvironment","QPLUserFlow","WAExceededStorageQuota","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,n,o,a){return r("QPLUserFlow").start(t,{annotations:babelHelpers.extends({},n||{},{bool:babelHelpers.extends({},(n==null?void 0:n.bool)||{},{isDev:0,isFromUIThread:(e||(e=r("ExecutionEnvironment"))).isInMainThread,isGifSearchEnbled:!0,isLockApiSupported:r("BrowserLockManager")!=null,processAcksInOneQueue:r("gkx")("23955"),useSharedWorker:"SharedWorkerGlobalScope"in self&&self instanceof self.SharedWorkerGlobalScope})}),instanceKey:o,timeoutInMs:a}),u(t,o)}function u(e,t){return{addAnnotations:function(o){r("QPLUserFlow").addAnnotations(e,o,{instanceKey:t})},addPoint:function(o,a){a&&r("QPLUserFlow").addAnnotations(e,a,{instanceKey:t}),r("QPLUserFlow").addPoint(e,o,{instanceKey:t})},endCancel:function(a){var n;r("QPLUserFlow").addAnnotations(e,babelHelpers.extends({},a,{bool:babelHelpers.extends({},a==null?void 0:a.bool,{exceededStorageQuota:o("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0}),string:babelHelpers.extends({},a==null?void 0:a.string,{threadID:a==null||(n=a.string)==null?void 0:n.jid})}),{instanceKey:t}),r("QPLUserFlow").endCancel(e,{annotations:a,instanceKey:t})},endFail:function(a,i){var n;r("QPLUserFlow").addAnnotations(e,babelHelpers.extends({},i,{bool:babelHelpers.extends({},i==null?void 0:i.bool,{exceededStorageQuota:o("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0}),string:babelHelpers.extends({},i==null?void 0:i.string,{threadID:i==null||(n=i.string)==null?void 0:n.jid})}),{instanceKey:t}),r("QPLUserFlow").endFailure(e,a,{annotations:i,instanceKey:t})},endSuccess:function(a){r("QPLUserFlow").addAnnotations(e,{bool:{exceededStorageQuota:o("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0}},{instanceKey:t}),r("QPLUserFlow").endSuccess(e,{annotations:a,instanceKey:t})},markError:function(o,a,i){return r("QPLUserFlow").markError(e,o,{debugInfo:a,error:i,instanceKey:t})}}}l.startQplUserFlow=s,l.makeMAWQPLProxyForExistingQPLUserFlow=u}),98);
__d("WAErrorMessage",[],(function(t,n,r,o,a,i){"use strict";var e="NoErrorMessageProvided";function l(t){if(typeof t=="string")return t;if(t instanceof Error)return t.toString();if(typeof t=="object"){if(typeof(t==null?void 0:t.description)=="string")return t.description;if(typeof(t==null?void 0:t.message)=="string")return t.message}return e}i.NO_ERROR_MESSAGE_PROVIDED=e,i.maybeGetMessageFromError=l}),66);
__d("MAWQplProxy",["Deferred","ExecutionEnvironment","FBLogger","MAWBridge","MAWSendQplToServer","QPLEvent","WAErrorMessage","asyncToGeneratorRuntime","getErrorSafe","gkx","justknobx","performanceAbsoluteNow","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p=(e=r("gkx")("23949"))!=null?e:!1,_=new Set([25313175,25310776,1056839232,1056836502,1056836703,1056847537,521478596,521479468,521476165,521480391,521472095]),f=0,g=(d||(d=r("performanceAbsoluteNow")))()-Date.now();function h(){return Date.now()}var y=new(r("Deferred")),C=function(){y.resolve()};function b(e,t,n,a,i){a===void 0&&(a=!1),r("promiseDone")(y.getPromise(),function(){return o("MAWBridge").getBridge().fireAndForget("event","qplEvent",{action:{name:t,type:"point"},annotations:n==null?void 0:n.annotations,event:e,instanceKey:n==null?void 0:n.instanceKey,performanceAndDateSkew:g,timestamp:a?h():void 0},!0,void 0,i)})}function v(e,t,n,r,o){var a;E(e,{bool:(a={},a[t]=n,a)},r,o)}function S(e,t,n,r,o){var a;E(e,{string:(a={},a[t]=n,a)},r,o)}function R(e,t,n,r,o){var a;E(e,{int:(a={},a[t]=n,a)},r,o)}function L(e,t,n,r){E(e,{double:t},n,r)}function E(e,t,n,a){r("promiseDone")(y.getPromise(),function(){return o("MAWBridge").getBridge().fireAndForget("event","qplEvent",{action:{type:"annotations"},annotations:t,event:e,instanceKey:n},!0,void 0,a)})}function k(e,t,n,a,i,l){i===void 0&&(i=!1);var s=h();r("promiseDone")(y.getPromise(),function(){return o("MAWBridge").getBridge().fireAndForget("event","qplEvent",{action:{name:t,type:"failure"},annotations:n,event:e,instanceKey:a,timestamp:i?s:void 0},!0,void 0,l)})}function I(e,t,n,a,i){a===void 0&&(a=!1);var l=h();r("promiseDone")(y.getPromise(),function(){return o("MAWBridge").getBridge().fireAndForget("event","qplEvent",{action:{type:"success"},annotations:t,event:e,instanceKey:n,timestamp:a?l:void 0},!0,void 0,i)})}function T(e,t,n,a,i,l){i===void 0&&(i=!1);var s=h();r("promiseDone")(y.getPromise(),function(){return o("MAWBridge").getBridge().fireAndForget("event","qplEvent",{action:{cancelReason:t,type:"cancel"},annotations:n,event:e,instanceKey:a,timestamp:i?s:void 0},!0,void 0,l)})}function D(e,t,n,a){r("promiseDone")(y.getPromise(),function(){return o("MAWBridge").getBridge().fireAndForget("event","qplEvent",{action:{name:t,type:"error"},debugInfo:n==null?void 0:n.debugInfo,error:n==null?void 0:n.error,event:e,instanceKey:n==null?void 0:n.instanceKey},!0,void 0,a)})}function x(e,t,n,r,o){return $.apply(this,arguments)}function $(){return $=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,a,i){b(e,t+"_start",{annotations:a,instanceKey:i});try{var l=yield n();return b(e,t+"_end",{instanceKey:i}),l}catch(n){throw r("FBLogger")("messenger_web").catching(r("getErrorSafe")(n)).MUSTFIX(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Caught exception for "," during measurePerf"])),t),b(e,t+"_fail",{annotations:{string:{caughtError:o("WAErrorMessage").maybeGetMessageFromError(n)}},instanceKey:i}),n}}),$.apply(this,arguments)}function P(e,t,n){return N.apply(this,arguments)}function N(){return N=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){e.addPoint(t+"_start");try{var a=yield n;return e.addPoint(t+"_end"),a}catch(n){throw r("FBLogger")("messenger_web").catching(r("getErrorSafe")(n)).MUSTFIX(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Caught exception for "," during measurePerf"])),t),e.addPoint(t+"_fail",{string:{caughtError:o("WAErrorMessage").maybeGetMessageFromError(n)}}),n}}),N.apply(this,arguments)}var M=r("justknobx")._("2596");function w(e,t,n){n===void 0&&(n={});var a=n,i=a.callBridgeWithTimestamp,l=i===void 0?!1:i,s=a.providedInstanceKey,u=a.providedTimeoutInMs,c=a.sendThroughBridge,d=c===void 0?!1:c;s==null&&f++;var p=s!=null?s:f,_=u!=null?u:M,g=!(m||(m=r("ExecutionEnvironment"))).isInWorker,C=d||F(e);if(g||!C)return o("MAWSendQplToServer").startQplUserFlow(e,t,p,_);var v=d?{toLastActiveClient:!0}:void 0;return r("promiseDone")(y.getPromise(),function(){return o("MAWBridge").getBridge().fireAndForget("event","qplEvent",{action:{type:"start"},annotations:babelHelpers.extends({},t||{},{bool:babelHelpers.extends({},(t==null?void 0:t.bool)||{})}),event:e,instanceKey:p,timeoutInMs:_,timestamp:l?h():void 0},!0,void 0,v)}),{addAnnotations:function(n){return E(e,n,p,v)},addPoint:function(n,r){return b(e,n,{annotations:r,instanceKey:p},void 0,v)},endCancel:function(n){return T(e,void 0,n,p,void 0,v)},endFail:function(n,r){return k(e,n,r,p,void 0,v)},endSuccess:function(n){return I(e,n,p,void 0,v)},markError:function(n,r,o){return D(e,n,{debugInfo:r,error:o,instanceKey:p},v)}}}function A(e,t){return!(m||(m=r("ExecutionEnvironment"))).isInWorker||!F(e)?o("MAWSendQplToServer").makeMAWQPLProxyForExistingQPLUserFlow(e,t):{addAnnotations:function(r){return E(e,r,t)},addPoint:function(r,o){return b(e,r,{annotations:o,instanceKey:t})},endCancel:function(r){return T(e,void 0,r,t)},endFail:function(r,o){return k(e,r,o,t)},endSuccess:function(r){return I(e,r,t)},markError:function(r,o,a){return D(e,r,{debugInfo:o,error:a,instanceKey:t})}}}function F(e){return p||_.has((c||(c=o("QPLEvent"))).getMarkerId(e))}function O(e,t){return W(e,t)}var B=0;function W(e,t){var n,o=(n=t==null?void 0:t.instanceKey)!=null?n:B++,a=!0;return{addAnnotations:function(n){E(e,n,o)},addPoint:function(n,r){b(e,n,{annotations:r,instanceKey:o})},endCancel:function(n,r){T(e,n,r,o),a=!1},endFail:function(n,r){k(e,n,r,o),a=!1},endSuccess:function(n){I(e,n,o),a=!1},getQPLAttrs:function(){return{instanceKey:o}},isActive:function(){return a},start:function(t){r("FBLogger")("messenger_web").warn("start() should not be called for cross-bridge QPL flow")}}}l.performanceAbsoluteNow=h,l.workerBridgeDeferred=y,l.resolveWorkerBridge=C,l.sendQplPointThroughBridge=b,l.sendQPLBoolAnnotationThroughBridge=v,l.sendQPLStringAnnotationThroughBridge=S,l.sendQPLIntAnnotationThroughBridge=R,l.sendQPLDoubleAnnotationsThroughBridge=L,l.sendQPLAnnotationsThroughBridge=E,l.sendQPLFailThroughBridge=k,l.sendQPLSuccessThroughBridge=I,l.sendQPLCancelThroughBridge=T,l.sendQPLErrorThroughBridge=D,l.measurePerfInQPL_USE_WITH_CARE=x,l.measurePerfInQPL=P,l.DEFAULT_WORKER_QPL_TIMEOUT_MS=M,l.startQplUserFlow=w,l.makeQplUserFlowFromExistedInstance=A,l.continueQplAsCrossBridgeQplFlow=O}),98);
__d("MAWTransactionMode",[],(function(t,n,r,o,a,i){"use strict";var e="r!",l="rw!";i.READONLY=e,i.READWRITE=l}),66);
__d("MAWLogIndexedDb",["FBLogger","MAWCurrentUser","MAWErrorObject","MAWIndexedDbMetadata","MAWQplProxy","MAWTransactionMode","Promise","WAExceededStorageQuota","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e,s=null,u=null;function c(){return r("justknobx")._("1399")}function d(){if(s==null)throw r("FBLogger")("messenger_web").mustfixThrow("LogDB IndexDB should've been initialized");return s}function m(){return u==null?f().then(function(){return d()}):u.then(function(){return d()})}function p(){return s!=null}var _=[function(e){var t=e.target.transaction;o("WAExceededStorageQuota").listenToQuotaExceededError(t);var n=t.db.createObjectStore("logs",{autoIncrement:!0,keyPath:"id"});n.createIndex("date","date",{unique:!1})}];function f(t){var r;if(u!=null)return u;if(s!=null)return(e||(e=n("Promise"))).resolve();var a=o("MAWCurrentUser").getID(),i=o("MAWIndexedDbMetadata").logDbName(a),l=(r=t!=null?t:c())!=null?r:_.length;return u=new(e||(e=n("Promise")))(function(e,t){var n=indexedDB.open(i,l);n.onupgradeneeded=function(e){for(var t=0;t<_.length;t++){var n=_[t];g(e,t+1)&&n(e)}},n.onsuccess=function(t){var n=t.target.result;n.onversionchange=function(){n.close()},s=n,e()},n.onerror=function(){t(n.error)}}),u}function g(e,t){var n=e.newVersion,r=e.oldVersion;return r<t&&n>=t}function h(e){return e===o("MAWTransactionMode").READWRITE?"readwrite":"readonly"}function y(e,t,n){var a=h(t);return function(t){return function(){for(var i=arguments.length,l=new Array(i),s=0;s<i;s++)l[s]=arguments[s];var u=n!=null?o("MAWQplProxy").startQplUserFlow(n):null;return m().then(function(n){var r=function(r){var t=n.transaction(e,r!=null?h(r):a,{durability:"relaxed"});return o("WAExceededStorageQuota").listenToQuotaExceededError(t),t.objectStore(e)};return t.apply(void 0,[r].concat(l))}).then(function(e){return u==null||u.endSuccess(),e}).catch(function(e){u==null||u.endFail("transaction_fail");var t=o("MAWErrorObject").getErrorObject(e),n=r("FBLogger")("maw_db");throw t instanceof Error?n.catching(t).mustfixThrow("LOG - Error performing transaction in log transactor"):n.mustfixThrow("LOG - Error performing transaction in log transactor")})}}}l.getLogDbVersion=c,l.getLogDB=d,l.isLogDBInitted=p,l.dbMigrations=_,l.makeLogMsgrTransactor=y}),98);
__d("MAWLoggingSwitches",["gkx"],(function(t,n,r,o,a,i,l){"use strict";var e=r("gkx")("503");l.removeLoggingFromBridge=e}),98);
__d("MAWSaveLogToDisk",["Deferred","MAWLogIndexedDb","MAWTransactionMode","Promise","asyncToGeneratorRuntime","justknobx","pageID","promiseDone","throttle"],(function(t,n,r,o,a,i,l){"use strict";var e,s=r("justknobx")._("1403"),u=r("justknobx")._("1404"),c=r("justknobx")._("1401");function d(e){if(Number.isInteger(e))return e;if(typeof e=="string")return(e||"").replace(/\n/g,"");try{return JSON.stringify(e)}catch(e){return"Data could not be serialized"}}function m(e,t){return t===void 0&&(t=""),e.length>0?"["+e.join("|")+"]":t}function p(e){switch(e){case"logRestricted":return"warn";case"count":return"log";case"debug":case"log":case"warn":case"error":return e}}function _(e){return{args:e.logString,date:e.date,event:m(e.tags,"[]"),level:p(e.logLevel)}}function f(e,t,n,r,o,a){return{args:e+"; ERROR="+n.message+";",data:{entriesToReport:o,error:n,framesToPop:r,stack:a},date:Date.now(),event:m(t,"[]"),level:"error"}}var g=[],h=[],y=5,C=0,b=!1,v=function(){g.length=0},S=function(t){var e=I(t);h.length<y?h.push(e):h[C%y]=e,C=(C+1)%y},R=function(r){for(var t=[],o=0;o<r;){var a=((C-o-1)%y+y)%y,i=h[a];t.push(i),o++}return(e||(e=n("Promise"))).resolve(t)},L=function(t,n){g.push({context:t,logEntry:n}),S({context:t,logEntry:n}),g.length>s?r("promiseDone")(E()):k()},E=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){b=!0;try{var e=[].concat(g);v(),yield T(e)}catch(e){}b=!1});return function(){return e.apply(this,arguments)}})(),k=r("throttle")(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(!b){b=!0;try{var e=[].concat(g);v(),yield T(e)}catch(e){}b=!1}}),u),I=function(t){var e=t.context,n=t.logEntry;return Object.entries(n).reduce(function(e,t){var n=t[0],r=t[1];return e[n]=d(r),e},babelHelpers.extends({},n,{category:e+"-"+r("pageID")}))},T=o("MAWLogIndexedDb").makeLogMsgrTransactor("logs",o("MAWTransactionMode").READWRITE)(function(e,t){var n=new(r("Deferred")),o=e();return t.forEach(function(e){o.add(I(e))}),o.transaction.oncomplete=function(){return n.resolve()},o.transaction.onerror=function(e){return n.reject(e)},n.getPromise()}),D=o("MAWLogIndexedDb").makeLogMsgrTransactor("logs",o("MAWTransactionMode").READONLY)(function(e){var t=new(r("Deferred")),n=e(),o=n.getAll();return o.onsuccess=function(e){var n=e.target.result,r=n.slice(Math.max(0,n.length-c));t.resolve(r)},o.onerror=function(e){return t.reject(e)},t.getPromise()}),x=function(){return D().catch(function(e){return[]})},$=function(t){var e=t<=h.length?R(t):P(t);return e.catch(function(e){return[]})},P=o("MAWLogIndexedDb").makeLogMsgrTransactor("logs",o("MAWTransactionMode").READONLY)(function(e,t){var n=new(r("Deferred")),o=e(),a=o.index("date"),i=a.openCursor(null,"prev"),l=[];return i.onsuccess=function(e){var r=e.target.result;if(r==null){n.resolve(l);return}if(l.push(r.value),l.length>=t){n.resolve(l);return}r.continue()},i.onerror=function(e){return n.reject(e)},n.getPromise()});l.joinTags=m,l.formatLog=_,l.formatErrorForLogging=f,l.clearLogEntryCache=v,l.saveLogEntry=L,l.forceCachedLogEntryPersist=E,l.getEntriesFromDb=x,l.getLastNEntries=$}),98);
__d("WADevToolsBridge",["WADynamicRouterAsync"],(function(t,n,r,o,a,i,l){"use strict";var e=new(o("WADynamicRouterAsync")).DynamicRouter;function s(){return e}l.getDevToolBridge=s}),98);
__d("MAWLoggerUtils",["ErrorBrowserConsole","ErrorPubSub","MAWLeakDetection","MAWLoggingSwitches","MAWSaveLogToDisk","Random","ServerJsRuntimeEnvironment","WADevToolsBridge","WAJids","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e,s=!1;function u(e,t){var n=c.has(e==null?void 0:e.project);if(n){var o,a,i;f(e.type==="error"||e.type==="fatal"?"error":e.type==="warn"?"warn":"log",e.message,(o=e.tags)!=null?o:[],(a=(i=e.metadata)==null?void 0:i.includes("MESSENGER_E2EE_WEB:ENVIRONMENT:worker"))!=null?a:!1)}t&&r("ErrorBrowserConsole").errorListener(e)}var c=new Set(["messenger_web","wmi_eb","labyrinth_web","messenger_web_media","messenger_web_calling","mps","wmi","MAWCacheService","MAWUIPersistedDataServices","fts_worker","maw_threads"]),d={CleanerPurge:"CleanerPurge",CleanerStart:"CleanerStart",CleanerTimestamp:"CleanerTimestamp",CleanerUpdate:"CleanerUpdate",Countdown:"Countdown",Ephemeral:"Ephemeral",Incoming:"Incoming",MsgCleaner:"MsgCleaner",OnLoad:"OnLoad",OnRead:"OnRead",Outgoing:"Outgoing",PeerReceipt:"PeerReceipt",SettingChange:"SettingChange",SettingSync:"SettingSync",DeviceRegistration:"DeviceRegistration",MessageReceive:"MessageReceive",MediaDownload:"MediaDownload",WorkerSetup:"WorkerSetup",MAWWorker:"MAWWorker",MAWInit:"MAWInit",LogoutHandler:"LogoutHandler",MiActMapping:"MiActMapping",ThreadReady:"ThreadReady"};function m(){return Math.floor(Date.now()+o("Random").random()*1e4+1e4)}function p(e){var t=e.split("");return t.reduce(function(e,t){var n=t.charCodeAt(0),r=(e<<5)-e+n;return r&=r,r},0)}function _(){if(!s){s=!0;var t=r("gkx")("2656");(e||(e=r("ErrorPubSub"))).removeListener(r("ErrorBrowserConsole").errorListener),e.addListener(function(e){return u(e,t)})}}function f(e,t,n,a){if(!o("ServerJsRuntimeEnvironment").isRunningServerJsRuntime()){var i=o("MAWLeakDetection").maybeReplaceVaultedString(o("WAJids").maybeSanitizeLogLineText(t)),l=Date.now();if(r("gkx")("3282")&&o("WADevToolsBridge").getDevToolBridge().fireAndForget("devtool","logLine",{logLevel:e,logString:g(i,n)},!0),!!o("MAWLoggingSwitches").removeLoggingFromBridge){var s=i.replace(/\n/g," ");e==="debug"||typeof s!="string"||o("MAWSaveLogToDisk").saveLogEntry(a?"worker":"browser",{args:s,date:l,event:o("MAWSaveLogToDisk").joinTags(n,"[unknown]"),level:e})}}}function g(e,t){return t.length>0?o("MAWSaveLogToDisk").joinTags(t)+" "+e:e}l.Tag=d,l.getInstanceKey=m,l.getInstanceKeyFromId=p,l.initMessengerWebLogging=_,l.logToHistory=f}),98);
__d("MNLSXMALayoutType",[],(function(t,n,r,o,a,i){var e=Object.freeze({SINGLE:0,HSCROLL:1,XCENTER:2,PORTRAIT:4,LAYERED:5,PLACEHOLDER:6,EXPIRED_PLACEHOLDER:7,PILE_PROMPT:8,STACK:9,SHARED_STACK:10,STACK_CARD:11,STANDARD_DXMA:12,DXMA_PLACEHOLDER:13,THREAD_SHORTCUT:14,LIST_DXMA:15,GRID:16,BLOKS_XMA:17,TWO_CARD:18,NOTE:19,VSTACK:20,SQUIRCLE:21,REPLY:22,RICH_RESPONSE:23,CODE:24,TABLE:25,SQUIRCLE_SHARED_STACK:26,UNIFIED_RESPONSE:27,CARD:28,CONDENSED_LINK:29,DOODLE_SPACE:30});i.default=e}),66);
__d("MNXMAPreviewImageDecorationType",[],(function(t,n,r,o,a,i){var e=Object.freeze({DEFAULT:0,COLLAGE:1,VIDEO:2,MESSENGER_ICON:3,INSTAGRAM_ICON:4,SHOPPING:5,UPCOMING_EVENT:6,LIVE:7,REEL:8,IGTV:9,YOUTUBE_VIDEO:10,YOUTUBE_SHORTS:11,COMMENT:12,BLUR:13,PILL:14,MESSENGER_CHANNEL_IMAGE:15,TROPHY:16,DXMA_LIVE:17,DXMA_LIVE_ENDED:18,LIKE_BUBBLE_REPLY:19,LIKE_BUBBLES:20,REPOST:21,FUBS_EXCLUSIVE_CONTENT_TEASER:22});i.default=e}),66);
__d("MWPlatformTaskSystem",["LSPlatformRequestScheduler","MWPlatformTaskUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t){var n=this;this.$1=e,this.$2=t,this.$3=new(r("LSPlatformRequestScheduler")),this.$4=o("MWPlatformTaskUtils").checkQueuesWhenPendingTaskTableUpdates(e,function(t){var r=t.queueName,o=t.transportKey;return n.$6(e,r,o,!1)}),this.$5=o("MWPlatformTaskUtils").checkQueuesWhenPendingFireForgetTaskTableUpdates(e,function(t){var r=t.queueName,o=t.transportKey;return n.$6(e,r,o,!0)}),this.$7()}var t=e.prototype;return t.$6=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r){yield this.$2.decideWhatToDoWithTask(e,t,n,r)});function t(t,n,r,o){return e.apply(this,arguments)}return t})(),t.$7=function(){var e=this;o("MWPlatformTaskUtils").checkAllPendingTasksForWork(this.$1,function(t){var n=t.queueName;return e.$6(e.$1,n)})},t.cleanup=function(){this.$4.forEach(function(e){return e()}),this.$5.forEach(function(e){return e()}),this.$2.cleanup()},e})();l.default=e}),98);
__d("MessagingAttachmentType",[],(function(t,n,r,o,a,i){var e=Object.freeze({NONE:0,STICKER:1,IMAGE:2,ANIMATED_IMAGE:3,VIDEO:4,AUDIO:5,FILE:6,XMA:7,EPHEMERAL_IMAGE:8,EPHEMERAL_VIDEO:9,SELFIE_STICKER:10,SOUND_BITE:12,CATALOG_ITEM:13,POWER_UP:14,THIRD_PARTY_STICKER:15});i.default=e}),66);
__d("NestedTimeRange",["SimpleHook","performance","performanceAbsoluteNow"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=new(o("SimpleHook")).SimpleHook,c=new(o("SimpleHook")).SimpleHook,d="/";function m(e,t){return""+e+d+t}var p=(function(){function t(e,t){t===void 0&&(t=null),this.$3=0,this.$1=e,this.$2=t}var n=t.prototype;return n.isRunning=function(){return this.$3>0},n.fullname=function(){return this.$2!==null?m(this.$2.fullname(),this.$1):this.$1},n.start=function(n){if(n===void 0&&(n=(e||(e=r("performanceAbsoluteNow")))()),this.$3===0){var t;(t=this.$2)==null||t.start(n),this.__onStart(n)}return++this.$3,n},n.__onStart=function(t){u.call(this,t)},n.stop=function(n){if(n===void 0&&(n=(e||(e=r("performanceAbsoluteNow")))()),--this.$3,this.$3===0){var t;this.__onStop(n),(t=this.$2)==null||t.stop(n)}return n},n.__onStop=function(t){c.call(this,t)},t})();function _(){(s||(s=r("performance"))).mark&&(s||(s=r("performance"))).measure&&(u.add(function(e,t){(s||(s=r("performance"))).mark(e.fullname()+"_start")}),c.add(function(e,t){(s||(s=r("performance"))).measure(e.fullname(),e.fullname()+"_start")}))}l.OnRangeStart=u,l.OnRangeStop=c,l.TIME_RANGE_LEVEL_SEPARATOR=d,l.rangeFullName=m,l.NestedTimeRange=p,l.enableDevConsoleTimeline=_}),98);
__d("OfflineThreadingId",["I64","XPlatReactCrypto"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(e||(e=o("I64"))).of_string("4194303");function u(){return(e||(e=o("I64"))).to_string(c())}function c(){var t=o("XPlatReactCrypto").getRandomValues(new Uint8Array(8)),n=new DataView(t.buffer),r=(e||(e=o("I64"))).add(e.lsl_(e.of_int32(n.getUint32(0)),32),e.of_int32(n.getUint32(4)));return d(Date.now(),r)}function d(t,n){return(e||(e=o("I64"))).and_(e.or_(e.lsl_(e.of_float(t),22),e.and_(n,s)),e.max_int)}function m(t){for(var n=c(),r=[],a=0;a<t.length;a++)r.push([t[a],(e||(e=o("I64"))).to_string(n)]),n=p(n);return r}function p(t,n){n===void 0&&(n=(e||(e=o("I64"))).one);var r=_(t),a=f(t);return d(r,(e||(e=o("I64"))).add(a,n))}function _(t){return(e||(e=o("I64"))).to_float(e.lsr_(t,22))}function f(t){return(e||(e=o("I64"))).and_(t,s)}l.createOfflineThreadingID=u,l.createForItemsInOrder=m,l.createNewFromExisting=p,l.extractTimestamp=_}),98);
__d("QLogEvent",["DoubleKeyMap","FBLogger","NestedTimeRange","QPLEvent","SimpleHook","performanceNavigationStart"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=new(o("DoubleKeyMap")).DoubleKeyMap,c=(function(e){function t(t,n,r){var o;return o=e.call(this,t,r)||this,o.$QPLRange$p_1=n,u.set(n,o.fullname(),o),o}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.__onStart=function(n){e.prototype.__onStart.call(this,n),this.$QPLRange$p_1.point(this.fullname()+"_START",{timestamp:n})},n.__onStop=function(n){e.prototype.__onStop.call(this,n),this.$QPLRange$p_1.point(this.fullname()+"_END",{timestamp:n}),u.delete(this.$QPLRange$p_1,this.fullname())},n.range=function(n){var e;this.fullname().startsWith(o("NestedTimeRange").TIME_RANGE_LEVEL_SEPARATOR)||r("FBLogger")("qpl").warn("Range %s cannot have subrange since root name does not start with /",this.fullname());var a=o("NestedTimeRange").rangeFullName(this.fullname(),n);return(e=u.get(this.$QPLRange$p_1,a))!=null?e:new t(n,this.$QPLRange$p_1,this)},t})(o("NestedTimeRange").NestedTimeRange),d=new(o("DoubleKeyMap")).DoubleKeyMap,m=new(s=o("SimpleHook")).SimpleHook,p=new s.SimpleHook,_=new s.SimpleHook,f=new s.SimpleHook,g=(function(t){function n(n,r,a,i,l){var s;r===void 0&&(r=0),a===void 0&&(a=2),i===void 0&&(i=!1);var u=(e||(e=o("QPLEvent"))).getMarkerId(n);return s=t.call(this,"event_"+u)||this,s.event=n,s.instanceKey=r,s.$QPLEvent$p_1=a,s.isUserFlow=i,s.$QPLEvent$p_2=l,d.set(u,r,s),s}babelHelpers.inheritsLoose(n,t);var a=n.prototype;return a.action=function(t){return this.$QPLEvent$p_1=t,this},a.getAction=function(){return this.$QPLEvent$p_1},a.setIsUserFlow=function(t){return this.isUserFlow=t,this},a.startFromNavStart=function(){return this.start(r("performanceNavigationStart")()),this},a.startFromTime=function(t){return this.start(t),this},a.__onStart=function(t){var e;(e=this.$QPLEvent$p_2)==null||e.onStart(this,t),m.call(this,t)},a.__onStop=function(n){var t;(t=this.$QPLEvent$p_2)==null||t.onStop(this,n),p.call(this,n),u.deleteAll(this),d.delete((e||(e=o("QPLEvent"))).getMarkerId(this.event),this.instanceKey)},a.range=function(t){var e;return(e=u.get(this,t))!=null?e:new c(t,this)},a.point=function(t,n){var e;return n===void 0&&(n={}),(e=this.$QPLEvent$p_2)==null||e.onPoint(this,t,n),_.call(this,t,n),this},a.annotate=function(t){var e;return(e=this.$QPLEvent$p_2)==null||e.onAnnotate(this,t),f.call(this,t),this},n})(o("NestedTimeRange").NestedTimeRange);function h(t,n,r){var a;return n===void 0&&(n=0),(a=d.get((e||(e=o("QPLEvent"))).getMarkerId(t),n))!=null?a:new g(t,n,2,!1,r)}l.OnEventStart=m,l.OnEventStop=p,l.OnEventPoint=_,l.OnEventAnnotate=f,l.QPLEvent=g,l.event=h}),98);
__d("URLMatcherConfig",[],(function(t,n,r,o,a,i){a.exports={tlds:"(?:\\.(com|\uD55C\uAD6D|\uC0BC\uC131|\uB2F7\uCEF4|\uB2F7\uB137|\u9999\u6E2F|\u9999\u683C\u91CC\u62C9|\u9910\u5385|\u98DF\u54C1|\u98DE\u5229\u6D66|\u96FB\u8A0A\u76C8\u79D1|\u96C6\u56E2|\u901A\u8CA9|\u8D2D\u7269|\u8C37\u6B4C|\u8BFA\u57FA\u4E9A|\u8054\u901A|\u7F51\u7EDC|\u7F51\u7AD9|\u7F51\u5E97|\u7F51\u5740|\u7EC4\u7EC7\u673A\u6784|\u79FB\u52A8|\u73E0\u5B9D|\u70B9\u770B|\u6FB3\u9580|\u6E38\u620F|\u6DE1\u9A6C\u9521|\u673A\u6784|\u66F8\u7C4D|\u65F6\u5C1A|\u65B0\u95FB|\u65B0\u52A0\u5761|\u653F\u5E9C|\u653F\u52A1|\u624B\u8868|\u624B\u673A|\u6211\u7231\u4F60|\u6148\u5584|\u5FAE\u535A|\u5E7F\u4E1C|\u5DE5\u884C|\u5BB6\u96FB|\u5A31\u4E50|\u5929\u4E3B\u6559|\u5927\u62FF|\u5927\u4F17\u6C7D\u8F66|\u5728\u7EBF|\u5609\u91CC\u5927\u9152\u5E97|\u5609\u91CC|\u5546\u6807|\u5546\u5E97|\u5546\u57CE|\u53F0\u7063|\u53F0\u6E7E|\u516C\u76CA|\u516C\u53F8|\u516B\u5366|\u5065\u5EB7|\u4FE1\u606F|\u4F5B\u5C71|\u4F01\u4E1A|\u4E2D\u6587\u7F51|\u4E2D\u570B|\u4E2D\u56FD|\u4E2D\u4FE1|\u4E16\u754C|\u30DD\u30A4\u30F3\u30C8|\u30D5\u30A1\u30C3\u30B7\u30E7\u30F3|\u30BB\u30FC\u30EB|\u30B9\u30C8\u30A2|\u30B3\u30E0|\u30B0\u30FC\u30B0\u30EB|\u30AF\u30E9\u30A6\u30C9|\u307F\u3093\u306A|\u10D2\u10D4|\u0E44\u0E17\u0E22|\u0E04\u0E2D\u0E21|\u0DBD\u0D82\u0D9A\u0DCF|\u0D2D\u0D3E\u0D30\u0D24\u0D02|\u0CAD\u0CBE\u0CB0\u0CA4|\u0C2D\u0C3E\u0C30\u0C24\u0C4D|\u0B9A\u0BBF\u0B99\u0BCD\u0B95\u0BAA\u0BCD\u0BAA\u0BC2\u0BB0\u0BCD|\u0B87\u0BB2\u0B99\u0BCD\u0B95\u0BC8|\u0B87\u0BA8\u0BCD\u0BA4\u0BBF\u0BAF\u0BBE|\u0B2D\u0B3E\u0B30\u0B24|\u0AAD\u0ABE\u0AB0\u0AA4|\u0A2D\u0A3E\u0A30\u0A24|\u09AD\u09BE\u09F0\u09A4|\u09AD\u09BE\u09B0\u09A4|\u09AC\u09BE\u0982\u09B2\u09BE|\u0938\u0902\u0917\u0920\u0928|\u092D\u093E\u0930\u094B\u0924|\u092D\u093E\u0930\u0924\u092E\u094D|\u092D\u093E\u0930\u0924|\u0928\u0947\u091F|\u0915\u0949\u092E|\u0680\u0627\u0631\u062A|\u067E\u0627\u06A9\u0633\u062A\u0627\u0646|\u0647\u0645\u0631\u0627\u0647|\u0645\u0648\u0642\u0639|\u0645\u0648\u0628\u0627\u064A\u0644\u064A|\u0645\u0644\u064A\u0633\u064A\u0627|\u0645\u0635\u0631|\u0643\u0648\u0645|\u0643\u0627\u062B\u0648\u0644\u064A\u0643|\u0642\u0637\u0631|\u0641\u0644\u0633\u0637\u064A\u0646|\u0639\u0645\u0627\u0646|\u0639\u0631\u0628|\u0639\u0631\u0627\u0642|\u0634\u0628\u0643\u0629|\u0633\u0648\u0631\u064A\u0629|\u0633\u0648\u062F\u0627\u0646|\u062A\u0648\u0646\u0633|\u0628\u06BE\u0627\u0631\u062A|\u0628\u064A\u062A\u0643|\u0628\u0627\u0632\u0627\u0631|\u0628\u0627\u0631\u062A|\u0627\u06CC\u0631\u0627\u0646|\u0627\u0645\u0627\u0631\u0627\u062A|\u0627\u0644\u0645\u063A\u0631\u0628|\u0627\u0644\u0639\u0644\u064A\u0627\u0646|\u0627\u0644\u0633\u0639\u0648\u062F\u064A\u0629|\u0627\u0644\u062C\u0632\u0627\u0626\u0631|\u0627\u0644\u0627\u0631\u062F\u0646|\u0627\u0631\u0627\u0645\u0643\u0648|\u0627\u062A\u0635\u0627\u0644\u0627\u062A|\u0627\u0628\u0648\u0638\u0628\u064A|\u05E7\u05D5\u05DD|\u0570\u0561\u0575|\u049B\u0430\u0437|\u0443\u043A\u0440|\u0441\u0440\u0431|\u0441\u0430\u0439\u0442|\u0440\u0444|\u0440\u0443\u0441|\u043E\u0440\u0433|\u043E\u043D\u043B\u0430\u0439\u043D|\u043C\u043E\u0441\u043A\u0432\u0430|\u043C\u043E\u043D|\u043C\u043A\u0434|\u043A\u043E\u043C|\u043A\u0430\u0442\u043E\u043B\u0438\u043A|\u0435\u044E|\u0434\u0435\u0442\u0438|\u0431\u0435\u043B|\u0431\u0433|\u03B5\u03BB|zw|zuerich|zone|zm|zip|zero|zara|zappos|za|yun|yt|youtube|you|yokohama|yoga|yodobashi|ye|yandex|yamaxun|yahoo|yachts|xyz|xxx|xn--zfr164b|xn--ygbi2ammx|xn--yfro4i67o|xn--y9a3aq|xn--xkc2dl3a5ee0h|xn--xkc2al3hye2a|xn--xhq521b|xn--wgbl6a|xn--wgbh1c|xn--w4rs40l|xn--w4r85el8fhu5dnra|xn--vuq861b|xn--vhquv|xn--vermgensberatung-pwb|xn--vermgensberater-ctb|xn--unup4y|xn--tiq49xqyj|xn--tckwe|xn--t60b56a|xn--ses554g|xn--s9brj9c|xn--rvc1e0am3e|xn--rovu88b|xn--rhqv96g|xn--qxam|xn--qxa6a|xn--qcka1pmc|xn--q9jyb4c|xn--q7ce6a|xn--pssy2u|xn--pgbs0dh|xn--p1ai|xn--p1acf|xn--otu796d|xn--ogbpf8fl|xn--o3cw4h|xn--nyqy26a|xn--nqv7fs00ema|xn--nqv7f|xn--node|xn--ngbrx|xn--ngbe9e0a|xn--ngbc5azd|xn--mxtq1m|xn--mk1bu44c|xn--mix891f|xn--mgbx4cd0ab|xn--mgbtx2b|xn--mgbt3dhd|xn--mgbpl2fh|xn--mgbi4ecexp|xn--mgbgu82a|xn--mgberp4a5d4ar|xn--mgbcpq6gpa1a|xn--mgbca7dzdo|xn--mgbc0a9azcg|xn--mgbbh1a71e|xn--mgbbh1a|xn--mgbayh7gpa|xn--mgbai9azgqp6j|xn--mgbah1a3hjkrd|xn--mgbab2bd|xn--mgbaam7a8h|xn--mgba7c0bbn0a|xn--mgba3a4f16a|xn--mgba3a3ejt|xn--mgb9awbf|xn--lgbbat1ad8j|xn--l1acc|xn--kput3i|xn--kpry57d|xn--kprw13d|xn--kcrx77d1x4a|xn--jvr189m|xn--jlq480n2rg|xn--j6w193g|xn--j1amh|xn--j1aef|xn--io0a7i|xn--imr513n|xn--i1b6b1a6a2e|xn--hxt814e|xn--h2brj9c8c|xn--h2brj9c|xn--h2breg3eve|xn--gk3at1e|xn--gecrj9c|xn--gckr3f0f|xn--g2xx48c|xn--fzys8d69uvgm|xn--fzc2c9e2c|xn--fpcrj9c3d|xn--flw351e|xn--fjq720a|xn--fiqz9s|xn--fiqs8s|xn--fiq64b|xn--fiq228c5hs|xn--fhbei|xn--fct429k|xn--efvy88h|xn--eckvdtc9d|xn--e1a4c|xn--d1alf|xn--d1acj3b|xn--czru2d|xn--czrs0t|xn--czr694b|xn--clchc0ea0b2g2a9gcd|xn--cg4bki|xn--cckwcxetd|xn--cck2b3b|xn--c2br7g|xn--c1avg|xn--bck1b9a5dre4c|xn--b4w605ferd|xn--9krt00a|xn--9et52u|xn--9dbq2a|xn--90ais|xn--90ae|xn--90a3ac|xn--8y0a063a|xn--80aswg|xn--80asehdb|xn--80aqecdr1a|xn--80ao21a|xn--80adxhks|xn--6qq986b3xl|xn--6frz82g|xn--5tzm5g|xn--5su34j936bgsg|xn--55qx5d|xn--55qw42g|xn--54b7fta0cc|xn--4gbrim|xn--4dbrk0ce|xn--45q11c|xn--45brj9c|xn--45br5cyl|xn--42c2d9a|xn--3pxu8k|xn--3hcrj9c|xn--3e0b707e|xn--3ds443g|xn--3bst00m|xn--30rr7y|xn--2scrj9c|xn--1qqw23a|xn--1ck2e1b|xn--11b4c3d|xin|xihuan|xerox|xbox|wtf|wtc|ws|wow|world|works|work|woodside|wolterskluwer|wme|winners|wine|windows|win|williamhill|wiki|wien|whoswho|wf|weir|weibo|wedding|wed|website|weber|webcam|weatherchannel|weather|watches|watch|wanggou|wang|walter|walmart|wales|vu|voyage|voto|voting|vote|volvo|vodka|vn|vlaanderen|vivo|viva|vision|visa|virgin|vip|vin|villas|viking|vig|video|viajes|vi|vg|vet|versicherung|verisign|ventures|vegas|ve|vc|vanguard|vana|vacations|va|uz|uy|us|ups|uol|uno|university|unicom|uk|ug|ubs|ubank|ua|tz|tw|tvs|tv|tushu|tunes|tui|tube|tt|trv|trust|travelersinsurance|travelers|travel|training|trading|trade|tr|toys|toyota|town|tours|total|toshiba|toray|top|tools|tokyo|today|to|tn|tmall|tm|tl|tkmaxx|tk|tjx|tjmaxx|tj|tirol|tires|tips|tienda|tickets|tiaa|theatre|theater|thd|th|tg|tf|teva|tennis|temasek|tel|technology|tech|team|tdk|td|tci|tc|taxi|tax|tattoo|tatar|tatamotors|target|taobao|talk|taipei|tab|sz|systems|sydney|sy|sx|swiss|swatch|sv|suzuki|surgery|surf|support|supply|supplies|sucks|su|style|study|studio|stream|store|storage|stockholm|stcgroup|stc|statefarm|statebank|star|staples|stada|st|ss|srl|sr|spot|sport|space|spa|soy|sony|song|solutions|solar|sohu|software|softbank|social|soccer|so|sncf|sn|smile|smart|sm|sling|sl|skype|sky|skin|ski|sk|sj|site|singles|sina|silk|si|show|shouji|shopping|shop|shoes|shiksha|shia|shell|sharp|shangrila|sh|sg|sfr|sexy|sex|sew|seven|services|sener|select|seek|security|secure|seat|search|se|sd|scot|science|schwarz|schule|school|scholarships|schmidt|schaeffler|scb|sc|sbs|sbi|sb|saxo|save|sas|sarl|sap|sanofi|sandvikcoromant|sandvik|samsung|samsclub|salon|sale|sakura|safety|safe|saarland|sa|ryukyu|rwe|rw|run|ruhr|rugby|ru|rsvp|rs|room|rogers|rodeo|rocks|ro|rip|rio|ril|ricoh|richardli|rich|rexroth|reviews|review|restaurant|rest|republican|report|repair|rentals|rent|ren|reliance|reit|reisen|reise|rehab|redumbrella|redstone|red|recipes|realty|realtor|realestate|read|re|radio|racing|quest|quebec|qpon|qa|py|pwc|pw|pub|pt|ps|prudential|pru|protection|property|properties|promo|progressive|prof|productions|prod|pro|prime|press|praxi|pramerica|pr|post|porn|politie|poker|pohl|pnc|pn|pm|plus|plumbing|playstation|play|place|pl|pk|pizza|pioneer|pink|ping|pin|pid|pictures|pictet|pics|physio|photos|photography|photo|phone|philips|phd|pharmacy|ph|pg|pfizer|pf|pet|pe|pccw|pay|party|parts|partners|pars|paris|panasonic|page|pa|ovh|ott|otsuka|osaka|origins|organic|org|orange|oracle|open|ooo|online|onl|ong|one|omega|om|ollo|olayangroup|olayan|okinawa|office|observer|obi|nz|nyc|nu|ntt|nrw|nra|nr|np|nowtv|nowruz|now|norton|nokia|no|nl|nissay|nissan|ninja|nikon|nike|nico|ni|nhk|ngo|ng|nfl|nf|nexus|nextdirect|next|news|new|neustar|network|netflix|netbank|net|nec|ne|nc|nba|navy|name|nagoya|nab|na|mz|my|mx|mw|mv|music|museum|mu|mtr|mtn|mt|msd|ms|mr|mq|mp|movie|mov|motorcycles|moto|moscow|mortgage|mormon|monster|money|monash|mom|moi|moe|moda|mobile|mobi|mo|mn|mma|mm|mls|mlb|ml|mk|mitsubishi|mit|mint|mini|mil|microsoft|miami|mh|mg|merckmsd|menu|men|memorial|meme|melbourne|meet|media|med|me|md|mckinsey|mc|mba|mattel|marshalls|marriott|markets|marketing|market|map|mango|management|man|makeup|maison|maif|madrid|ma|ly|lv|luxury|luxe|lundbeck|lu|ltda|ltd|lt|ls|lr|lplfinancial|lpl|love|lotto|lotte|london|lol|locus|locker|loans|loan|llp|llc|lk|living|live|lipsy|link|lincoln|limo|limited|lilly|like|lighting|lifestyle|lifeinsurance|life|lidl|li|lgbt|lexus|lego|legal|lefrak|leclerc|lease|lds|lc|lb|lawyer|law|latrobe|latino|lat|lasalle|lanxess|landrover|land|lancaster|lamer|lamborghini|lacaixa|la|kz|kyoto|ky|kw|kuokgroup|kred|krd|kr|kpn|kpmg|kp|kosher|komatsu|koeln|kn|km|kiwi|kitchen|kindle|kim|kids|kia|ki|kh|kg|kfh|kerryproperties|kerrylogistics|kerryhotels|ke|kddi|kaufen|juniper|juegos|jprs|jpmorgan|jp|joy|jot|joburg|jobs|jo|jnj|jmp|jm|jll|jio|jewelry|jetzt|jeep|je|jcb|java|jaguar|itv|itau|it|istanbul|ist|ismaili|is|irish|ir|iq|ipiranga|io|investments|intuit|international|int|insure|insurance|institute|ink|ing|info|infiniti|industries|inc|in|immobilien|immo|imdb|imamat|im|il|ikano|ifm|ieee|ie|id|icu|ice|icbc|ibm|hyundai|hyatt|hughes|hu|ht|hsbc|hr|how|house|hotmail|hotels|hot|hosting|host|hospital|horse|honda|homesense|homes|homegoods|homedepot|holiday|holdings|hockey|hn|hm|hkt|hk|hiv|hitachi|hisamitsu|hiphop|hermes|here|helsinki|help|healthcare|health|hdfcbank|hdfc|hbo|haus|hangout|hamburg|hair|gy|gw|guru|guitars|guide|guge|gucci|gu|gt|gs|group|grocery|gripe|green|gratis|graphics|grainger|gr|gq|gp|gov|got|gop|google|goog|goodyear|goo|golf|goldpoint|gold|godaddy|gn|gmx|gmo|gmbh|gmail|gm|globo|global|gle|glass|gl|giving|gives|gifts|gift|gi|gh|ggee|gg|gf|george|genting|gent|gea|ge|gdn|gd|gbiz|gb|gay|garden|gap|games|game|gallup|gallo|gallery|gal|ga|fyi|futbol|furniture|fund|fun|fujitsu|ftr|frontier|frogans|frl|fresenius|free|fr|fox|foundation|forum|forsale|forex|ford|football|food|foo|fo|fm|fly|flowers|florist|flir|flights|flickr|fk|fj|fitness|fit|fishing|fish|firmdale|firestone|fire|financial|finance|final|film|fido|fidelity|fi|ferrero|ferrari|feedback|fedex|fast|fashion|farmers|farm|fans|fan|family|faith|fairwinds|fail|fage|extraspace|express|exposed|expert|exchange|events|eus|eurovision|eu|et|estate|esq|es|erni|ericsson|er|equipment|epson|enterprises|engineering|engineer|energy|emerck|email|eg|ee|education|edu|edeka|eco|ec|eat|earth|dz|dvr|dvag|durban|dupont|dunlop|dubai|dtv|drive|download|dot|domains|dog|doctor|docs|do|dnp|dm|dk|dj|diy|dish|discover|discount|directory|direct|digital|diet|diamonds|dhl|dev|design|desi|dentist|dental|democrat|delta|deloitte|dell|delivery|degree|deals|dealer|deal|de|dds|dclk|day|datsun|dating|date|data|dance|dad|cz|cyou|cymru|cy|cx|cw|cv|cuisinella|cu|cruises|cruise|crs|crown|cricket|creditunion|creditcard|credit|cr|cpa|courses|coupons|coupon|country|corsica|coop|cool|cooking|contractors|contact|consulting|construction|condos|comsec|computer|compare|company|community|commbank|com|cologne|college|coffee|codes|coach|co|cn|cm|clubmed|club|cloud|clothing|clinique|clinic|click|cleaning|claims|cl|ck|city|citic|citi|citadel|cisco|circle|cipriani|ci|church|chrome|christmas|chintai|cheap|chat|chase|charity|channel|chanel|ch|cg|cfd|cfa|cf|cern|ceo|center|cd|cc|cbre|cbn|cba|catholic|catering|cat|casino|cash|case|casa|cars|careers|career|care|cards|caravan|car|capitalone|capital|capetown|canon|camp|camera|cam|calvinklein|call|cal|cafe|cab|ca|bzh|bz|by|bw|bv|buzz|buy|business|builders|build|bt|bs|brussels|brother|broker|broadway|bridgestone|bradesco|br|box|boutique|bot|boston|bostik|bosch|booking|book|boo|bond|bom|bofa|boehringer|boats|bo|bnpparibas|bn|bmw|bms|bm|blue|bloomberg|blog|blockbuster|blackfriday|black|bj|biz|bio|bingo|bing|bike|bid|bible|bi|bharti|bh|bg|bf|bet|bestbuy|best|berlin|bentley|beer|beauty|beats|be|bd|bcn|bcg|bbva|bbt|bbc|bb|bayern|bauhaus|basketball|baseball|bargains|barefoot|barclays|barclaycard|barcelona|bar|bank|band|banamex|baidu|baby|ba|azure|az|axa|ax|aws|aw|autos|auto|author|auspost|audio|audible|audi|auction|au|attorney|athleta|at|associates|asia|asda|as|arte|art|arpa|army|archi|aramco|arab|ar|aquarelle|aq|apple|app|apartments|aol|ao|anz|anquan|android|analytics|amsterdam|amica|amfam|amex|americanfamily|americanexpress|amazon|am|alstom|alsace|ally|allstate|allfinanz|alipay|alibaba|al|akdn|airtel|airforce|airbus|aig|ai|agency|agakhan|ag|africa|afl|af|aetna|aero|aeg|ae|adult|ads|ad|actor|aco|accountants|accountant|accenture|academy|ac|abudhabi|abogado|able|abc|abbvie|abbott|abb|aarp|aaa))"}}),null);
__d("URLMatcher",["URLMatcherConfig"],(function(t,n,r,o,a,i){var e="!\"#%&'()*,-./:;<>?@[\\]^_`{|}",l="\u2000-\u206F\xAB\xBB\uFF08\uFF09",s="(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])",u="(?:https?)://",c="(?:(^|\\s)(?:"+s+"[.]){3}"+s+")",d=c,m="\\[(?:(?:[A-Fa-f0-9]{1,4}::?){1,7}[A-Fa-f0-9]{1,4})\\]",p="(?:\\b)www\\d{0,3}[.]",_="[^\\s"+e+l+"]",f="(?:(?:(?:[.:\\-_%@]|"+_+")*"+_+")|"+m+")",g="(?::\\d+){0,1}",h="(?=[/?#])",y=n("URLMatcherConfig").tlds,C="(?:(?:"+u+f+g+")|(?:"+d+g+")|(?:"+m+g+")|(?:"+p+f+y+g+")|(?:"+f+y+g+h+"))",b="(?:(?:"+u+f+g+")|(?:"+d+g+")|(?:"+m+g+")|(?:"+p+f+y+g+")|(?:"+f+y+g+"))",v="[/#?]",S="\\([^\\s()<>]+\\)",R="[^\\s()<>?#]+",L=new RegExp(C,"im"),E="^\\[[0-9]{1,4}:[0-9]{1,4}:[A-Fa-f0-9]{1,4}\\]",k=new RegExp(E,"im"),I="(?:(?:"+v+")(?:(?:"+S+"|"+R+")*)*)*",T=new RegExp("((?:"+b+")(?:"+I+"))","im");function D(){T.compile()}var x=new RegExp("((?:"+u+f+g+")|(?:"+p+f+y+g+"))"),$=/[\s\'\";]/,P=new RegExp(v,"im"),N=new RegExp("[\\s!\"#%&'()*,./:;<>?@[\\]^`{|}\xAB\xBB\u2000-\u206F\uFF08\uFF09]","im"),M=new RegExp("[\\s()<>?#]","im"),w=new RegExp("\\s()<>"),A=function(t){return t!=null&&t.indexOf("@")!==-1?x.exec(t)?t:null:t},F=function(t){return new RegExp("((?:"+C+")(?:"+I+"))",t)};function O(){return T.source}var B=function(t){return U(t,F("im"))},W=function(t){return V(t,F("igm"))},q=function(t){return U(t,T)},U=function(t,n){var e=n.exec(t);return e==null||e.length===0?null:A(e[1]||null)},V=function(t,n){var e=t.match(n);return e==null?[]:e.filter(Boolean)||[]},H=function(t){return L.exec(t)},G=function(t){return!$.test(t.charAt(t.length-1))},z=function(t){var e=t,n=!1;do{var r,o=L.exec(e);if(!o)return null;if(((r=o[1])==null?void 0:r.trim())===""&&(o[0]=o[0].trim(),o.index+=o[1].length),n=!1,o[0][0]==="["&&o.index>0&&e[o.index-1]==="@"){var a=k.exec(o[0]);a&&(n=!0,e=e.substr(o.index+a[0].length))}}while(n);if(!o)return null;var i=e.substr(o.index+o[0].length);if(i.length===0||!P.test(i[0]))return A(o[0]);for(var l=0,s=0,u=1,c=["(","["],d=[")","]"],m=0,p=s,_=1;_<i.length;_++){var f=i[_];if(p===s){if(c.includes(f))m+=1,p=u;else if(P.test(f)||!N.test(f))l=_;else if(M.test(f))break}else if(c.includes(f))m+=1;else if(d.includes(f))m-=1,m===0&&(p=s,l=_);else if(w.test(f))break}return A(o[0]+i.substring(0,l+1))},j={compilePermissiveHostPathMatcher:D,permissiveHostPathMatch:q,permissiveMatch:B,permissiveMultiMatch:W,matchToPattern:U,multiMatchToPattern:V,matchHost:H,trigger:G,match:z,getPermissiveHostPathMatcherSource:O};a.exports=j}),null);
__d("VirtualMessageChannel",["invariant","Promise","SimpleHook","nullthrows","promiseDone"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=(function(){function t(e){e===void 0&&(e=!1),this.$2=new(o("SimpleHook")).SimpleHook,this.onmessage=null,this.onmessageerror=null,this.$3=e}var a=t.prototype;return a.setRemotePort=function(t){this.$1=t},a.addEventListener=function(t,n,r){if((t==="message"||t==="error")&&r==null||s(0,55320,t),t==="message")if(typeof n=="function")this.$2.add(n);else{var e=n.handleEvent.bind(n);this.$2.add(e),n.__handler=e}},a.removeEventListener=function(t,n,r){if(typeof n=="function")this.$2.remove(n);else{var e=n.__handler;this.$2.remove(e)}},a.postMessage=function(o,a){var t=this,i=function(){var e=r("nullthrows")(t.$1,"By now remote port must have value!");e.$2.call({data:o,ports:a})};this.$3?i():r("promiseDone")((e||(e=n("Promise"))).resolve(),i)},a.start=function(){},a.close=function(){},t})(),c=function(t,n){this.port1=new u(t),this.port2=new u(n),this.port1.setRemotePort(this.port2),this.port2.setRemotePort(this.port1)};l.VirtualMessagePort=u,l.VirtualMessageChannel=c}),98);
__d("WACustomError",[],(function(t,n,r,o,a,i){"use strict";var e=Object.create(Error.prototype,{constructor:{value:void 0,writable:!0,configurable:!0}});function l(t,n,r){n===void 0&&(n=!0);function o(e){var r=Error.call(this,e);this.message=e,r.name=t,this.name=t,n&&(this.stack=r.stack)}return o.prototype=Object.create(r?r.prototype:e),o.prototype.constructor=o,o}function s(e){return e.length===0?"No errors":e.length===1?e[0].message:e.map(function(e){return"- "+e.message}).join("\n")}var u=(function(e){function t(t,n){var r,o=n!=null&&n.length>0?n:s(t);return r=e.call(this,o)||this,r.errors=t,r}return babelHelpers.inheritsLoose(t,e),t})(l("AggregateError",!0)),c=(function(e){function t(){return e.apply(this,arguments)||this}return babelHelpers.inheritsLoose(t,e),t})(l("TimeoutError",!1)),d=(function(e){function t(t,n){var r;return r=e.call(this,t)||this,r.code=n,r}return babelHelpers.inheritsLoose(t,e),t})(l("HttpError",!1)),m=(function(e){function t(){return e.apply(this,arguments)||this}return babelHelpers.inheritsLoose(t,e),t})(l("UnimplementedMethod")),p=!1;function _(e){if(e==null||e.name!=="QuotaExceededError")throw e;p=!0}function f(){return p}function g(e){return JSON.stringify(e,Object.getOwnPropertyNames(e))}var h=(function(e){function t(t,n){var r;return r=e.call(this,t)||this,r.inner=n,r}return babelHelpers.inheritsLoose(t,e),t})(babelHelpers.wrapNativeSuper(Error));i.customError=l,i.AggregateError=u,i.TimeoutError=c,i.HttpError=d,i.UnimplementedMethod=m,i.supressQuotaExceededError=_,i.hasSupressedQuotaExceededError=f,i.obtainErrorSummary=g,i.WrappedError=h}),66);
__d("WAAbortError",["WACustomError"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(){return e.apply(this,arguments)||this}return babelHelpers.inheritsLoose(t,e),t})(o("WACustomError").customError("AbortError")),s="AbortError";function u(e){return function(t){if(t.name===s)return e(t);throw t}}l.AbortError=e,l.ABORT_ERROR=s,l.catchAbort=u}),98);
__d("WAArrayZip",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){var n=Math.min(e.length,t.length);return e.slice(0,n).map(function(e,n){return[e,t[n]]})}i.zip=e}),66);
__d("WALongInt",["WAHex","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(t){if(typeof t!="number")throw o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose([""," is not a safe integer"])),t).color("red"),new Error("numberOrThrowIfTooLarge is given a non-safe integer");return t}var d=function(t){return t==null?t:c(t)};function m(e){return e==null||typeof e!="number"?null:e}function p(e,t){if(typeof e=="number"&&typeof t=="number")return e>t;var n=typeof e=="number"?o("WAHex").hexLongFromNumber(e):e,r=typeof t=="number"?o("WAHex").hexLongFromNumber(t):t;return o("WAHex").isBiggerHexLong(n,r)}function _(e){if(typeof e=="number")return e.toString(10);for(var t=o("WAHex").hexLongToHex(e),n=[0],r=0,a=0;a<t.length;a++){r=o("WAHex").hexAt(t,a);for(var i=0;i<n.length;i++)n[i]=n[i]*16+r,r=n[i]/10|0,n[i]%=10;for(;r>0;)n.push(r%10),r=r/10|0}var l=n.reverse().join("");return o("WAHex").hexLongIsNegative(e)?"-"+l:l}function f(e){if(!/^-?\d+$/.test(e))throw o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(['"','" is not a valid decimal string'])),e).color("red"),new Error("decimalStringToLongInt is given an invalid decimal string");var t=e[0]==="-",n=e.replace(/^-?0*/,""),r=n.length;if(r<16||r===16&&n<="9007199254740991")return t?-Number(n):Number(n);if(r>20||r===20&&n>"18446744073709551615"||t&&(r>19||r===19&&n>"9223372036854775807"))throw o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(['"','" is over 64 bits'])),e).color("red"),new Error("decimalStringToHexLong is given value over 64 bits");for(var a=0,i=0,l=0;l<r;l++)a=a*10+Number(n[l]),i=i*10+Math.floor(a/4294967296),a=a%4294967296;return o("WAHex").createHexLongFrom32Bits(i,a,t)}l.numberOrThrowIfTooLarge=c,l.maybeNumberOrThrowIfTooLarge=d,l.maybeNumber=m,l.isBiggerLongInt=p,l.longIntToDecimalString=_,l.decimalStringToLongInt=f}),98);
__d("WAPromiseDelays",["Promise","WAAbortError"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,r){return new(e||(e=n("Promise")))(function(e,n){if(r!=null&&r.aborted)throw new(o("WAAbortError")).AbortError;var a=setTimeout(i,t);r==null||r.addEventListener("abort",l);function i(){r==null||r.removeEventListener("abort",l),e()}function l(){r==null||r.removeEventListener("abort",l),clearTimeout(a),n(new(o("WAAbortError")).AbortError)}})}function u(t,r,o){return new(e||(e=n("Promise")))(function(e,n){var a=setTimeout(function(){try{e(o())}catch(e){n(e)}},r);t.then(function(t){clearTimeout(a),e(t)},function(e){clearTimeout(a),n(e)})})}l.delayMs=s,l.withTimeout=u}),98);
__d("WARetryableError",["WACustomError"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t){var n;return n=e.call(this,"see error at this.source")||this,n.source=t,n}return babelHelpers.inheritsLoose(t,e),t})(o("WACustomError").customError("RetryableError"));l.default=e}),98);
__d("WAWorkerGlobalScope",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){return typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:self})();i.workerGlobalScope=e}),66);
__d("WorkerMessagePortLogging",["MainPageUrl","QLogEvent","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e=Math.random()<.1,s=20,u=100,c=50;function d(){return o("MainPageUrl").isWorkerLogEnabled()||o("MainPageUrl").mainPageUrl.searchParams.get("worker_log")===1}var m=0;function p(){return o("QLogEvent").event(r("qpl")._(41497718,"106"),m++)}function _(t,n,r){if(r===void 0&&(r=!1),!(n==null||!e)){var o=n.sendDelayHighPrecision,a=n.sendTimestamp,i=n.sendDateTime,l=n.receiveTimestamp,d=n.receiveDateTime,m=p();m.startFromTime();var _=m.range("SEND_DELAY");_.start(a),_.stop(l);var f=m.range("SEND_DELAY_LOW_PRECISION");f.start(i),f.stop(d);var g=Math.abs(a-i),h=Math.abs(l-d);if(m.annotate({string:{port_name:t},int:{send_delay:o,send_drift:g,receive_drift:h},bool:{send_delay_above_max:o!=null&&o>s,send_drift_above_max:g>u,receive_drift_above_max:h>u}}),r){var y=m.range("ROUND_TRIP");y.start(n.sendTimestamp),y.stop(n.receiveTimestamp);var C=n.receiveTimestamp-n.sendTimestamp;m.annotate({int:{round_trip:C},bool:{round_trip_above_max:C>c}})}m.stop()}}l.isWorkerLogEnabled=d,l.logMessageTiming=_}),98);
__d("WorkerMessagePort",["Deferred","FBLogger","MainPageUrl","Promise","PromiseAnnotate","SimpleHook","VirtualMessageChannel","WorkerMessagePortLogging","performanceAbsoluteNow","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(e){return e}var d=(function(e){function t(){return e.apply(this,arguments)||this}return babelHelpers.inheritsLoose(t,e),t})(o("SimpleHook").SimpleHook);function m(e,t){var n=e;n.__timing=t}function p(e){return e.__timing}var _=(function(){function e(e,t){var n=this;this.$1={},this.onUnhandledMessage=new d,this.onMessage=new d,this.onPostMessage=new d,this.onError=new d,this.$2=e,this.name=t,this.$2.addEventListener("message",function(e){return n.onMessageHandler(e.data)}),this.$2.addEventListener("error",function(e){return n.onError.call(e)}),this.onPostMessage.add(function(e){m(e,{receiveDateTime:-1,receiveTimestamp:-1,sendDateTime:Date.now(),sendDelayHighPrecision:0,sendDelayLowPrecision:0,sendTimestamp:(u||(u=r("performanceAbsoluteNow")))()})}),this.onMessage.add(function(e){var t=p(e);if(t!=null){var a=t.sendDateTime,i=t.sendTimestamp,l=(u||(u=r("performanceAbsoluteNow")))(),s=Date.now();t.receiveTimestamp=l,t.receiveDateTime=s,t.sendDelayHighPrecision=l-i,t.sendDelayLowPrecision=s-a,o("WorkerMessagePortLogging").logMessageTiming(n.name,t)}})}var t=e.prototype;return t.onMessageHandler=function(t){try{this.onMessage.call(t);var e=this.$1[t.type];e?e.call(t):this.onUnhandledMessage.call(t)}catch(e){this.onError.call(e)}},t.postMessage=function(t,n){this.onPostMessage.call(t),n?this.$2.postMessage(t,n):this.$2.postMessage(t)},t.addMessageListener=function(t,n){var e=this.$1[t];return e||(e=new d,this.$1[t]=e),e.add(n)},t.removeMessageListener=function(t,n){var e=this.$1[t];return!!e&&e.remove(n)},t.removeAllMessageListeners=function(t){var e=this.$1[t];e&&e.clear()},t.onMessageOnce=function(t,r){var e=this;return new(s||(s=n("Promise")))(function(n){var o=e.addMessageListener(t,function(a){r(a)&&(e.removeMessageListener(t,o),n(a))})})},t.close=function(){var e=this.$2;e.close==null||e.close(),e.terminate==null||e.terminate()},t.isWrappingVirtualMessagePort=function(){return this.$2 instanceof o("VirtualMessageChannel").VirtualMessagePort},e})();function f(e){return e}var g=(function(t){function a(a,i){var l;l=t.call(this,a,i)||this;var u=f(l),c=new(r("Deferred")),d=c.getPromise();u.addMessageListener("endpoint_started",function(e){c.resolve(e);var t=p(e);u.postMessage({endpoint:e.endpoint,startSendTimestamp:t==null?void 0:t.sendTimestamp,targetEndpoint:l.name,type:"endpoint_started_received"})});var m=u.onMessageOnce("endpoint_started_received",function(){return!0});return(e||(e=o("PromiseAnnotate"))).setDisplayName(d,"endpoint_started"),e.setDisplayName(m,"endpoint_started_received"),u.postMessage({endpoint:l.name,type:"endpoint_started"}),r("promiseDone")(d,function(e){var t=p(e);o("WorkerMessagePortLogging").logMessageTiming(l.name,t)}),r("promiseDone")(m,function(e){var t=p(e);t!=null&&o("WorkerMessagePortLogging").logMessageTiming(l.name,t,!0)}),l.fullyConnected=(s||(s=n("Promise"))).race([d,m]).then(function(){return l}),l}return babelHelpers.inheritsLoose(a,t),a})(_);l.getMessageTiming=p,l.WorkerMessagePort=_,l.CastWorkerMessagePort=f,l.WorkerSyncedMessagePort=g}),98);
__d("XPlatRelayEnvironment",["CometRelayEnvironment","err"],(function(t,n,r,o,a,i,l){"use strict";function e(e){throw r("err")("RelayEnvironment is already set")}function s(){return r("CometRelayEnvironment")}l.setRelayEnvironment=e,l.getRelayEnvironment=s}),98);
__d("getMWLSRegion",["MessengerWebRegion"],(function(t,n,r,o,a,i,l){"use strict";function e(){var e=r("MessengerWebRegion").regionNullable;return e==null?"":e}l.default=e}),98);
__d("last",[],(function(t,n,r,o,a,i){"use strict";function e(e){var t=null;if(Array.isArray(e)||typeof e=="string")e.length&&(t={value:e[e.length-1]});else for(var n of e)t=t||{},t.value=n;return t?t.value:null}i.default=e}),66);
__d("mergeDeep",["mergeDeepInto","mergeHelpers"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){var o,a=(o=r("mergeHelpers")).normalizeMergeArg(e),i=o.normalizeMergeArg(t);o.checkMergeObjectArgs(a,i),o.checkArrayStrategy(n);var l={};return r("mergeDeepInto")(l,a,n),r("mergeDeepInto")(l,i,n),l}l.default=e}),98);